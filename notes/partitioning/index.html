<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1>Partitioning</h1><div class="post-content"><h2 id="recommended-best-practices">Recommended / Best Practices</h2>
<ul>
<li>/boot 200Mb</li>
<li>swap 1.5x times the amount of RAM</li>
<li>/</li>
<li>/home</li>
<li>/tmp</li>
<li>/var</li>
<li>/var/log</li>
<li>/var/log/audit</li>
<li>Encrypt all partitions except /boot</li>
</ul>
<h2 id="creating-an-lvm-partition">Creating an LVM partition</h2>
<h3 id="create-a-physical-partition">Create a Physical Partition</h3>
<ul>
<li>Open the drive in fdisk, create a new primary partition</li>
<li>Mark the new partition as type '8e' or Linux LVM</li>
<li>Write the partition table</li>
</ul>
<h3 id="create-physical-lvm-volume">Create Physical LVM Volume</h3>
<pre><code>pvcreate /dev/sdc1 (assuming /dev/sdc1 was the partition just created)
</code></pre>
<h3 id="volume-group-creation">Volume Group Creation</h3>
<p>This point needs a bit of thinking before doing. There is a limit on the number
of physical extents that can be accessed. This in turn limits the size of the
volume group. This limit is 65,536 extents.</p>
<p>The default size is 4MB/extent. This by default leads to a limit of 256GB per
volume group. 8MB/extent gets you 512GB. The maximum size I see needing is
32MB/extent for a size of 2TB. The following example uses an extent size of
16MB and assumes the partition is <code>/dev/sdc1</code>.</p>
<pre><code>vgcreate -s 16M vg_test /dev/sdc1
</code></pre>
<h3 id="logical-volume-creation">Logical Volume Creation</h3>
<p>The following creates a 1GB logical volume group, there does not seem to be a
way to create a logical volume with all the remaining space in the volume
group.</p>
<pre><code>lvcreate -L 1G -n lv_test vg_test
</code></pre>
<h2 id="securing-partitions">Securing Partitions</h2>
<ul>
<li>Add <code>nodev</code> to all non-root local ext{2,3,4} partitions in <code>/etc/fstab</code></li>
<li>Add <code>nosuid</code> and <code>noexec</code> to <code>/tmp</code> partition</li>
<li>Bind mount /tmp to /var/tmp with <code>rw,nodev,nosuid,noexec,bind</code> as options</li>
<li>If removable storage is enabled add <code>nodev</code>, <code>nosuid</code>, <code>noexec</code> to their
partitions</li>
<li>Disable auto mounter (autofs)</li>
<li>Dynamically <a href="https://stelfox.net/notes/swap/">encrypt the swap partition</a> (not for any machine that will be
hibernated)</li>
</ul>
<h2 id="encrypting-additional-partitions">Encrypting Additional Partitions</h2>
<pre><code>cryptsetup luksFormat -c aes-xts-plain -s 256 -h sha256 /dev/vg_test/lv_test
cryptsetup luksOpen -c aes-xts-plain -s 256 -h sha256 /dev/vg_test/lv_test \
  cryptTest
mkfs.ext4 /dev/mapper/cryptTest
cryptsetup luksClose /dev/mapper/cryptTest
</code></pre>
</div>
</article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
