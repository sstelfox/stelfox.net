<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='GRE encapsulates all layer 2 traffic, but does so through an unencrypted tunnel. Sensitive traffic should exclusively go through a lower level encrypted tunnel like IPSec.
Firewall The following iptables need to be enabled to allow the GRE traffic to and from the system. This should be restricted to / from IP addresses as well.
-A INPUT -p 47 -j ACCEPT -A OUTPUT -p 47 -j ACCEPT Manual Setup I&#39;ve seen several setups on the internet that make some&hellip; Odd choices.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='GRE Tunnel • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='GRE encapsulates all layer 2 traffic, but does so through an unencrypted tunnel. Sensitive traffic should exclusively go through a lower level encrypted tunnel like IPSec.
Firewall The following iptables need to be enabled to allow the GRE traffic to and from the system. This should be restricted to / from IP addresses as well.
-A INPUT -p 47 -j ACCEPT -A OUTPUT -p 47 -j ACCEPT Manual Setup I&#39;ve seen several setups on the internet that make some&hellip; Odd choices.'>
<meta property='og:url' content='https://stelfox.net/notes/gre-tunnel/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta property='article:tag' content='linux'><meta property='article:tag' content='networking'><meta property='article:published_time' content='2017-10-09T22:14:23Z'/><meta property='article:modified_time' content='2017-10-09T22:14:23Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>GRE Tunnel • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/gre-tunnel/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-notes'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>GRE Tunnel</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-10-09T22:14:23Z'>2017, Oct 09</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>GRE encapsulates all layer 2 traffic, but does so through an unencrypted
tunnel. Sensitive traffic should exclusively go through a lower level encrypted
tunnel like IPSec.</p>
<h2 id="firewall">Firewall</h2>
<p>The following iptables need to be enabled to allow the GRE traffic to and from
the system. This should be restricted to / from IP addresses as well.</p>
<pre><code>-A INPUT  -p 47 -j ACCEPT
-A OUTPUT -p 47 -j ACCEPT
</code></pre><h2 id="manual-setup">Manual Setup</h2>
<p>I've seen several setups on the internet that make some&hellip; Odd choices. When
making one of these tunnels, the inner IP addresses should be an independent
network from any other on the router. Other setups recommend re-using an
already existing IP, or another IP on an existing network which will likely
leak traffic between the tunnel and the local network.</p>
<p>Tunnel keys don't provide very much security, but it is a small layer of
protection that is trivial to add.</p>
<p>This setup is between two hosts. The first host has a private network of
10.0.0.0/24, a public IP of 1.2.3.4 and will use an inner tunnel IP of
172.16.10.1. The second host has a private network of 10.16.0.0/24, a public IP
of 4.3.2.1, and an inner tunnel IP of 172.16.10.2.</p>
<p>I have a suspicion that the local value isn't required but it does restrict
where the tunnel can come from to be valid.</p>
<pre><code># Host 1
ip tunnel add gre0 mode gre key 0x12345678 csum remote 4.3.2.1 local 1.2.3.4
ip addr add dev gre0 172.16.10.1 peer 172.16.10.2/30
ip link set gre0 up
ip route add 10.16.0.0/24 dev gre0
</code></pre><pre><code># Host 2
ip tunnel add gre0 mode gre key 0x12345678 csum remote 1.2.3.4 local 4.3.2.1
ip addr add dev gre0 172.16.10.2 peer 172.16.10.1/30
ip link set gre0 up
ip route add 10.0.0.0/24 dev gre0
</code></pre><p>To remove the tunnels you can run this on both machines:</p>
<pre><code>ip link set gre0 down
ip tunnel del gre0
</code></pre><h2 id="centos--fedora--rhel-config">CentOS / Fedora / RHEL Config</h2>
<p>A simple point to point tunnel can be established using the standard CentOS
network config pretty straight forward. I believe the <code>MY_OUTER_IPADDR</code> is
optional (just like the &lsquo;local&rsquo; field in the manual setup).</p>
<p>For a single host to host connection it seems like it's pretty straight
forward. You'll need to pick IPs for the inside of the tunnel for both the
local and remote side and place a file on both hosts with a file at
<code>/etc/sysconfig/network-scripts/ifcfg-gre0</code> with contents like the following
(replacing the addresses with appropriate ones).</p>
<pre><code># /etc/sysconfig/network-scripts/ifcfg-gre0

DEVICE=gre0
BOOTPROTO=none
ONBOOT=yes
TYPE=GRE

MY_INNER_IPADDR=10.98.0.1
#MY_OUTER_IPADDR=192.168.76.3

PEER_INNER_IPADDR=10.98.0.2
PEER_OUTER_IPADDR=192.168.56.72
</code></pre><h2 id="other-notes">Other Notes</h2>
<p>There are at least two forms of GRE tunneling, point to point and point to
multipoint. I believe there is a multipoint to multipoint as well but haven't
been able to find much about either multipoint anything other than a reference
that it appears to use a shared key for tunnel authentication.</p>
<p>You can specify any remote can connect as long as they have the correct tunnel
key using the following command:</p>
<pre><code>ip tunnel add gre0 mode gre key 0x12345678 csum remote any
</code></pre>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a>, <a class='tag' href='/tags/networking/'>networking</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/amanda/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Amanda</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/disk-errors/'>
        <span class='screen-reader-text'>Next post: </span>Disk Errors<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox | <!-- raw HTML omitted -->Licensing<!-- raw HTML omitted --></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script>

</body>

</html>

