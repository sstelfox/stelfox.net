<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="GRE encapsulates all layer 2 traffic, but does so through an unencrypted tunnel. Sensitive traffic should exclusively go through a lower level encrypted tunnel like IPSec.
FirewallThe following iptables need to be enabled to allow the GRE traffic to and from the system. This should be restricted to / from IP addresses as well.
-A INPUT -p 47 -j ACCEPT -A OUTPUT -p 47 -j ACCEPT Manual SetupI've seen several setups on the internet that make some."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,networking"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/gre-tunnel/><title>GRE Tunnel :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="GRE Tunnel"><meta itemprop=description content="GRE encapsulates all layer 2 traffic, but does so through an unencrypted tunnel. Sensitive traffic should exclusively go through a lower level encrypted tunnel like IPSec.
FirewallThe following iptables need to be enabled to allow the GRE traffic to and from the system. This should be restricted to / from IP addresses as well.
-A INPUT -p 47 -j ACCEPT -A OUTPUT -p 47 -j ACCEPT Manual SetupI've seen several setups on the internet that make some."><meta itemprop=datePublished content="2017-10-09T22:14:23+00:00"><meta itemprop=dateModified content="2017-10-09T22:52:37-04:00"><meta itemprop=wordCount content="497"><meta itemprop=keywords content="Linux,Networking"><meta name=twitter:card content="summary"><meta name=twitter:title content="GRE Tunnel"><meta name=twitter:description content="GRE encapsulates all layer 2 traffic, but does so through an unencrypted tunnel. Sensitive traffic should exclusively go through a lower level encrypted tunnel like IPSec.
FirewallThe following iptables need to be enabled to allow the GRE traffic to and from the system. This should be restricted to / from IP addresses as well.
-A INPUT -p 47 -j ACCEPT -A OUTPUT -p 47 -j ACCEPT Manual SetupI've seen several setups on the internet that make some."><meta property="article:published_time" content="2017-10-09 22:14:23 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/gre-tunnel/>GRE Tunnel</a></h2><div class=post-content><p>GRE encapsulates all layer 2 traffic, but does so through an unencrypted
tunnel. Sensitive traffic should exclusively go through a lower level encrypted
tunnel like IPSec.</p><h2 id=firewall>Firewall</h2><p>The following iptables need to be enabled to allow the GRE traffic to and from
the system. This should be restricted to / from IP addresses as well.</p><pre tabindex=0><code>-A INPUT  -p 47 -j ACCEPT
-A OUTPUT -p 47 -j ACCEPT
</code></pre><h2 id=manual-setup>Manual Setup</h2><p>I've seen several setups on the internet that make some... Odd choices. When
making one of these tunnels, the inner IP addresses should be an independent
network from any other on the router. Other setups recommend re-using an
already existing IP, or another IP on an existing network which will likely
leak traffic between the tunnel and the local network.</p><p>Tunnel keys don't provide very much security, but it is a small layer of
protection that is trivial to add.</p><p>This setup is between two hosts. The first host has a private network of
10.0.0.0/24, a public IP of 1.2.3.4 and will use an inner tunnel IP of
172.16.10.1. The second host has a private network of 10.16.0.0/24, a public IP
of 4.3.2.1, and an inner tunnel IP of 172.16.10.2.</p><p>I have a suspicion that the local value isn't required but it does restrict
where the tunnel can come from to be valid.</p><pre tabindex=0><code># Host 1
ip tunnel add gre0 mode gre key 0x12345678 csum remote 4.3.2.1 local 1.2.3.4
ip addr add dev gre0 172.16.10.1 peer 172.16.10.2/30
ip link set gre0 up
ip route add 10.16.0.0/24 dev gre0
</code></pre><pre tabindex=0><code># Host 2
ip tunnel add gre0 mode gre key 0x12345678 csum remote 1.2.3.4 local 4.3.2.1
ip addr add dev gre0 172.16.10.2 peer 172.16.10.1/30
ip link set gre0 up
ip route add 10.0.0.0/24 dev gre0
</code></pre><p>To remove the tunnels you can run this on both machines:</p><pre tabindex=0><code>ip link set gre0 down
ip tunnel del gre0
</code></pre><h2 id=centos--fedora--rhel-config>CentOS / Fedora / RHEL Config</h2><p>A simple point to point tunnel can be established using the standard CentOS
network config pretty straight forward. I believe the <code>MY_OUTER_IPADDR</code> is
optional (just like the 'local' field in the manual setup).</p><p>For a single host to host connection it seems like it's pretty straight
forward. You'll need to pick IPs for the inside of the tunnel for both the
local and remote side and place a file on both hosts with a file at
<code>/etc/sysconfig/network-scripts/ifcfg-gre0</code> with contents like the following
(replacing the addresses with appropriate ones).</p><pre tabindex=0><code># /etc/sysconfig/network-scripts/ifcfg-gre0

DEVICE=gre0
BOOTPROTO=none
ONBOOT=yes
TYPE=GRE

MY_INNER_IPADDR=10.98.0.1
#MY_OUTER_IPADDR=192.168.76.3

PEER_INNER_IPADDR=10.98.0.2
PEER_OUTER_IPADDR=192.168.56.72
</code></pre><h2 id=other-notes>Other Notes</h2><p>There are at least two forms of GRE tunneling, point to point and point to
multipoint. I believe there is a multipoint to multipoint as well but haven't
been able to find much about either multipoint anything other than a reference
that it appears to use a shared key for tunnel authentication.</p><p>You can specify any remote can connect as long as they have the correct tunnel
key using the following command:</p><pre tabindex=0><code>ip tunnel add gre0 mode gre key 0x12345678 csum remote any
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/networking/>networking</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=2f46db776decd69b6b791b1ea22bd6f17c742d1c target=_blank rel=noopener>2f46db77</a> @ 2017-10-09</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>