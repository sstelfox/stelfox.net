<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1>Chronyd</h1><div class="post-content"><p>Replacement for the ntpd daemon.</p>
<span id="continue-reading"></span><h2 id="installation">Installation</h2>
<pre><code>yum install chrony -y
</code></pre>
<p>After configuration enable the service like so</p>
<pre><code>systemctl enable chronyd.service
</code></pre>
<h2 id="server">Server</h2>
<ul>
<li><a href="https://stelfox.net/notes/chronyd/chrony_server.conf">/etc/chrony.conf</a></li>
</ul>
<p>If you want to have multiple chrony servers on the local network it's a good
idea to mark them as peers with each other with the following directive:</p>
<pre><code>peer <Other Server IP>
</code></pre>
<p>This will automatically generate a unique key in <code>/etc/chrony.keys</code></p>
<h2 id="client-always-on">Client (always on)</h2>
<ul>
<li><a href="https://stelfox.net/notes/chronyd/chrony_client_always_on.conf">/etc/chrony.conf</a></li>
</ul>
<p>This will automatically generate a unique key in <code>/etc/chrony.keys</code></p>
<h2 id="client-intermittant-connection">Client (Intermittant Connection)</h2>
<p>This section relies on NetworkManager's dispatcher to inform chronyd when we
have and don't have a network connection to take the synchronization on and
offline.</p>
<ul>
<li><a href="https://stelfox.net/notes/chronyd/chrony_client_intermittent.conf">/etc/chrony.conf</a></li>
</ul>
<p>This will automatically generate a unique key in /etc/chrony.keys</p>
<p>This following file needs to be placed at
<code>/etc/NetworkManager/dispatcher.d/20-chrony</code>, marked as executable, and should
be owned by root. A similar version of this script comes with Fedora, however,
it isn't quite as friendly as mine. Just replace it.</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">#!/bin/sh

INTERFACE=$1    # The interface which is brought up or down
STATUS=$2       # Interface status

case "$STATUS" in
  'up')
    # Check to see if the interface added a default route
    /sbin/ip route list dev "$INTERFACE" | grep -q '^default' &&
      /usr/libexec/chrony-helper command online > /dev/null 2>&1
    ;;
  'down')
    # If we don't have a default route anymore mark chrony as offline
    /sbin/ip route list | grep -q '^default' ||
      /usr/libexec/chrony-helper command offline > /dev/null 2>&1
    ;;
esac
</code></pre>
</div>
</article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
