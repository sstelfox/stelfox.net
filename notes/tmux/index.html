<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install tmux -y Shared Session ConfigurationThe idea behind this was to allow easy pair programming in a fairly secure way using a separate unprivileged account to host the session. I've used a combination of tmux, some bash scripts, and sudo to accomplish this environment."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/tmux/><title>Tmux :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Tmux"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install tmux -y Shared Session ConfigurationThe idea behind this was to allow easy pair programming in a fairly secure way using a separate unprivileged account to host the session. I've used a combination of tmux, some bash scripts, and sudo to accomplish this environment."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="809"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tmux"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install tmux -y Shared Session ConfigurationThe idea behind this was to allow easy pair programming in a fairly secure way using a separate unprivileged account to host the session. I've used a combination of tmux, some bash scripts, and sudo to accomplish this environment."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/tmux/>Tmux</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><h2 id=installation>Installation</h2><pre tabindex=0><code>yum install tmux -y
</code></pre><h2 id=shared-session-configuration>Shared Session Configuration</h2><p>The idea behind this was to allow easy pair programming in a fairly secure way
using a separate unprivileged account to host the session. I've used a
combination of tmux, some bash scripts, and sudo to accomplish this
environment. Please note that I don't add the shared user to the 'sshers' group
so there is only local access to the account.</p><h3 id=user-setup>User Setup</h3><p>Create a new user, I used "shared" for the user name as shown in the example
below. This will also create the "shared" group.</p><pre tabindex=0><code>useradd shared
password shared
</code></pre><p>Set some rediculous password for the user as no one will be logging directly
in.</p><p>Add any users that you want to participate in the shared environment to the
shared group like so:</p><pre tabindex=0><code>usermod -a -G shared &lt;username&gt;
</code></pre><p>Add this line to the <code>/etc/sudoers</code> to allow any user added to the shared group
to be able to switch to it without a password:</p><pre tabindex=0><code>%shared   ALL=(ALL) NOPASSWD: /bin/su shared -
</code></pre><h3 id=shared-session-setup>Shared Session Setup</h3><p>Switch to the shared user's account from a user that is a member of the shared
group and create a .bin directory in their home.</p><pre tabindex=0><code>mkdir /home/shared/.bin
</code></pre><p>Inside of that create a file "shared-tmux" with the following contents and make
it executable. This is a simplified version of a more flexible shared tmux
session script I found on the <a href=https://wiki.archlinux.org/index.php/Tmux#Clients_simultaneously_interacting_with_various_windows_of_a_session>Arch Linux Wiki</a> which has a ridiculous
amount of very good information that I strongly recommend people reference with
any questions.</p><pre tabindex=0><code>#!/bin/bash

base_session=&#34;shared-session&#34;
tmux_session_count=`tmux ls | grep &#34;^$base_session&#34; | wc -l`

if [[ &#34;$tmux_session_count&#34; == &#34;0&#34; ]]; then
  echo &#34;Launching tmux base session $base_session ...&#34;
  tmux new-session -s $base_session
else
  # Make sure we are not already in a tmux session
  if [[ -z &#34;$TMUX&#34; ]]; then
    # Kill defunct sessions first
    old_sessions=$(tmux ls 2&gt;/dev/null | egrep &#34;^[0-9]{14}.*[0-9]+\)$&#34; | cut -f 1 -d:)
    for old_session_id in $old_sessions; do
        tmux kill-session -t $old_session_id
    done

    echo &#34;Launching copy of base session $base_session ...&#34;

    # Session is is date and time to prevent conflict
    session_id=`date +%Y%m%d%H%M%S`

    # Create a new session (without attaching it) and link to base session 
    # to share windows
    tmux new-session -d -t $base_session -s $session_id
    
    # Attach to the new session
    tmux attach-session -t $session_id

    # When we detach from it, kill the session
    tmux kill-session -t $session_id
  fi
fi
</code></pre><p>I added the following to the shared user's .bashrc file so the shared session
pops open automatically as soon as a user has opened a shell and it will drop
them out of the user's account as soon as they leave tmux.</p><pre tabindex=0><code>if [[ -z &#34;$TMUX&#34; ]]; then
  export PS1=&#34;\W\$(__git_ps1)\$ &#34;
  shared-session
  # The following is needed because funny shit happens when the server drops
  reset
  exit
else
  export PS1=&#34;[\u@\h \W]\$(__git_ps1)\$ &#34;
fi
</code></pre><p>I also created a small shell script to make it easier for user's to make use of
the shared session in <code>/bin/shared</code>. The contents are below, make sure to make
it executable:</p><pre tabindex=0><code>#!/bin/bash

sudo su shared -
clear
echo &#34;Left shared environment&#34;
</code></pre><h4 id=vim--tmux>VIM & Tmux</h4><p>I made a few compromises on my vim and tmux configuration to work with a
co-worker and tried to keep it simple at the same time, so I'm including their
configuration.</p><p>Here is the tmux configuration <code>/home/shared/.tmux.conf</code>, there are two
configuration items that are relevant to the shared session configuration and
should be included even if you don't use any of the rest of it. The two
relevant configuration lines are the "setw -g aggressive-resize on" and the
"set-option destroy-unattached on".</p><pre tabindex=0><code>set-option -g prefix C-a
set-option destroy-unattached on
bind r source-file ~/.tmux.conf
bind C-a last-window
bind a send-prefix
set-window-option -g mode-keys vi
bind-key k select-pane -U
bind-key j select-pane -D
bind-key h select-pane -L
bind-key l select-pane -R
setw -g aggressive-resize on
bind \ split-window -h
bind - split-window -v
set -g base-index 1
set -g visual-activity on
set -g monitor-activity on
set -g history-limit 100000
set -g status-bg black
set -g status-fg green
set -g status-interval 30
set -g status-left-length 40
set -g status-left &#39;#[fg=green](#S) #(whoami)@#H#[default]&#39;
set -g status-right &#39;#[fg=yellow]#(cut -d &#34; &#34; -f 1-3 /proc/loadavg)#[default] #[fg=cyan]%H:%M#[default]&#39;
</code></pre><p>Here is the vim configuration I use /home/shared/vimrc, nothing specifically
related to the shared session in this one:</p><pre tabindex=0><code>set history=500
set nocompatible
autocmd! bufwritepost vimrc source ~/.vimrc
set modelines=10
set autoread
set scrolloff=5
set wildmenu
set ruler
set cmdheight=2
set nostartofline
set confirm
set pastetoggle=&lt;F11&gt;
nnoremap &lt;C-L&gt; :nohl&lt;CR&gt;&lt;C-L&gt;
set shiftwidth=2 tabstop=2
set expandtab
set ai
set smarttab
set ignorecase
set hlsearch
set magic
set showmatch
set noerrorbells
set visualbell
set number
set hidden
syntax on
set ai
set encoding=utf8
try
  lang en_US
catch
endtry
set ffs=unix,dos,mac
set lbr
set laststatus=2
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>