<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1>Software RAID</h1><div class="post-content"><h2 id="installation">Installation</h2>
<p>The mdadm package is required for software RAID:</p>
<pre><code>yum install mdadm -y
</code></pre>
<h2 id="array-creation">Array Creation</h2>
<pre><code>mdadm --create /dev/md0 --verbose --level=1 --raid-devices=2 /dev/sda /dev/sdb
</code></pre>
<p>Shorthand:</p>
<pre><code>mdadm -Cv /dev/md0 -l1 -n2 /dev/sd[ab]
</code></pre>
<p>Note: If you use a RAID 0 and want to put ZFS on top of be sure to set a chunk
size &lt;= 256 (maybe even 128 if you're still getting errors) otherwise ZFS will
warn about issues creating it's partitions.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h2 id="status-check">Status Check</h2>
<p>You can view the status of the RAID by cat'ing <code>/proc/mdstat</code>. You can see more
details by using the mdadm utility like so:</p>
<pre><code>mdadm --misc --detail /dev/md0
</code></pre>
<p>As long as the state is clean you're golden.</p>
<h2 id="recovery">Recovery</h2>
<h3 id="configuration-file">Configuration File</h3>
<p>During initial setup the <code>/etc/mdadm.conf</code> is created automatically. All this
data exists in the metadata on the disks and can be rebuilt with the mdadm tool
like so:</p>
<pre><code>mdadm --examine --scan > /etc/mdadm.conf
</code></pre>
<h3 id="remove-disk-from-array">Remove Disk from Array</h3>
<p>A disk needs to be failed before it can be removed from an array, if it isn't
already you'll need to fail it manually:</p>
<pre><code>mdadm /dev/md0 --fail /dev/sda
</code></pre>
<p>Then remove it:</p>
<pre><code>mdadm /dev/md0 --remove /dev/sda
</code></pre>
<p>Or in a single step:</p>
<pre><code>mdadm /dev/md0 --fail /dev/sda --remove /dev/sda
</code></pre>
<h3 id="adding-a-disk-to-an-existing-array">Adding a Disk to an Existing Array</h3>
<p>Probably useful for replacing a failed disk:</p>
<pre><code>mdadm /dev/md0 --add /dev/sda
</code></pre>
<h2 id="delete-an-array">Delete an Array</h2>
<p>You'll lose all data... don't say I didn't warn you...</p>
<pre><code>mdadm --stop /dev/md0
</code></pre>
<p>I didn't need the second command but you'll want to run it if the device is
still kicking around:</p>
<pre><code>mdadm --remove /dev/md0
</code></pre>
<p>And blow away the super block on all of the drives:</p>
<pre><code>mdadm --zero-superblock /dev/sd[ab]
</code></pre>
</div>
</article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
