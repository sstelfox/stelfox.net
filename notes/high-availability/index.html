<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup 1 $ yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don't know it by name)."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,networking,operations"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/high-availability/><title>High Availability :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="High Availability"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup 1 $ yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don't know it by name)."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="268"><meta itemprop=keywords content="Linux,Networking,Operations"><meta name=twitter:card content="summary"><meta name=twitter:title content="High Availability"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup 1 $ yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don't know it by name)."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/high-availability/>High Availability</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.</strong></em></p><p>Packages of interest:</p><ul><li>keepalived</li><li>ipvsadm</li><li>pacemaker</li></ul><h2 id=ipvs>IPVS</h2><p>IPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.</p><h2 id=installation--setup>Installation / Setup</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> yum install ipvsadm -y
</span></span></code></pre></td></tr></table></div></div><p>A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don't know it by name). Additionally the simplest version, VS/NAT, requires enabling IPv4 packet forwarding which requires modification of the read-only proc filesystem and thus doesn't seem to be an easy option, there may be work arounds for this, and it may effect the other forms but they haven't been tested yet.</p><p>First pass at commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ipvsadm -A -t 192.168.122.30:443 -s wlc
</span></span><span class=line><span class=cl><span class=gp>$</span> ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.61:443 -g -w <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.62:443 -g -w <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>That didn't work so I rebooted to clear it all out.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> yum install keepalived -y
</span></span></code></pre></td></tr></table></div></div><p>Ah ha, Eureka moment. Inside the LXC container I can unmount the "/proc/sys" overlay as long as I'm root...</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> umount /proc/sys
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=m>1</span> &gt; /proc/sys/net/ipv4/ip_forward
</span></span></code></pre></td></tr></table></div></div><p>It seems the sysctl setting "net.ipv4.ip_nonlocal_bind" isn't available within an LXC container.</p><p>Valuable sites:</p><ul><li><a href=http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/>http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/</a></li><li><a href=https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/>https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/</a></li></ul><p>Interesting use for this as a firewall:</p><ul><li><a href=http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html>http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html</a></li><li><a href=http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/>http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/</a></li></ul></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/networking/>networking</a></span>
<span class=tag><a href=https://stelfox.net/tags/operations/>operations</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=05d8865c5bb4f32ad03ef2fb02f70765921e7d67 target=_blank rel=noopener>05d8865c</a> @ 2024-07-16</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>