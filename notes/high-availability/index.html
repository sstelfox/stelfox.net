<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setupyum install ipvsadm -yA note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don&amp;rsquo;t know it by name)."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/high-availability/><title>High Availability :: Sam Stelfox — A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.c8c76086c15b9d686ec1778dcf935d2ad37f3bb9c23165d2bd157ba7b18e5aec.css integrity="sha256-yMdghsFbnWhuwXeNz5NdKtN/O7nCMWXSvRV7p7GOWuw="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="High Availability"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setupyum install ipvsadm -yA note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don’t know it by name)."><meta itemprop=datePublished content="2017-10-09T17:34:50-04:00"><meta itemprop=dateModified content="2017-10-09T17:34:50-04:00"><meta itemprop=wordCount content="249"><meta name=twitter:card content="summary"><meta name=twitter:title content="High Availability"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVSIPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setupyum install ipvsadm -yA note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don’t know it by name)."></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/>Posts</a></li><li><a href=/notes/>Notes</a></li><li><a href=/about/>About Me</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/high-availability/>High Availability</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><p>Packages of interest:</p><ul><li>keepalived</li><li>ipvsadm</li><li>pacemaker</li></ul><h2 id=ipvs>IPVS</h2><p>IPVS (IP Virtual Server) is used to present a single address in a high
availability scenario for one more services.</p><h2 id=installation--setup>Installation / Setup</h2><pre tabindex=0><code>yum install ipvsadm -y</code></pre><p>A note about LXC containers: In order to make use of ipvsadm within an LXC
container, you will also need to install the ipvsadm package on the LXC host
and reboot it (optionally just load the kernel module though I don&rsquo;t know it by
name). Additionally the simplest version, VS/NAT, requires enabling IPv4 packet
forwarding which requires modification of the read-only proc filesystem and
thus doesn&rsquo;t seem to be an easy option, there may be work arounds for this, and
it may effect the other forms but they haven&rsquo;t been tested yet.</p><p>First pass at commands:</p><pre tabindex=0><code>ipvsadm -A -t 192.168.122.30:443 -s wlc
ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.61:443 -g -w 1
ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.62:443 -g -w 1</code></pre><p>That didn&rsquo;t work so I rebooted to clear it all out.</p><pre tabindex=0><code>yum install keepalived -y</code></pre><p>Ah ha, Eureka moment. Inside the LXC container I can unmount the <code>/proc/sys</code>
overlay as long as I&rsquo;m root&mldr;</p><pre tabindex=0><code>umount /proc/sys
echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></pre><p>It seems that <code>net.ipv4.ip_nonlocal_bind</code> isn&rsquo;t available within an LXC
container: <code>cat /proc/sys/net/ipv4/ip_nonlocal_bind</code>.</p><p>Valuable sites:</p><ul><li><a href=http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/>http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/</a></li><li><a href=https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/>https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/</a></li></ul><p>Interesting use for this as a firewall:</p><ul><li><a href=http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html>http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html</a></li><li><a href=http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/>http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/</a></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=c874df2d3c16755a1982631bab31b5ea56bba632 target=_blank rel=noopener>c874df2d</a> @ 2017-10-09</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>