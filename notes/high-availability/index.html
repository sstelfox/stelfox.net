<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sam@stelfox.net Sam Stelfox ">
<meta name="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVS IPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don&amp;rsquo;t know it by name)." />
<meta name="keywords" content="blog, programming, linux, systems, personal" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://stelfox.net/notes/high-availability/" />


    <title>
        
            High Availability :: Sam Stelfox 
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css" integrity="sha256-KgZMRVsOy9axSBs7&#43;d8kQelYOGkQIvQKUzjCyxJE8HU=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="High Availability">
<meta itemprop="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVS IPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don&rsquo;t know it by name).">

<meta itemprop="wordCount" content="255">
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="High Availability"/>
<meta name="twitter:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVS IPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don&rsquo;t know it by name)."/>



    <meta property="og:title" content="High Availability" />
<meta property="og:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Packages of interest:
keepalived ipvsadm pacemaker IPVS IPVS (IP Virtual Server) is used to present a single address in a high availability scenario for one more services.
Installation / Setup yum install ipvsadm -y A note about LXC containers: In order to make use of ipvsadm within an LXC container, you will also need to install the ipvsadm package on the LXC host and reboot it (optionally just load the kernel module though I don&rsquo;t know it by name)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stelfox.net/notes/high-availability/" /><meta property="article:section" content="notes" />

















    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                ./Sam_Stelfox.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/blog/">Blog Posts</a></li><li><a href="/notes/">Various Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://stelfox.net/notes/high-availability/">High Availability</a></h2>

            
            
            

            <div class="post-content">
                <p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p>
<p>Packages of interest:</p>
<ul>
<li>keepalived</li>
<li>ipvsadm</li>
<li>pacemaker</li>
</ul>
<h2 id="ipvs">IPVS</h2>
<p>IPVS (IP Virtual Server) is used to present a single address in a high
availability scenario for one more services.</p>
<h2 id="installation--setup">Installation / Setup</h2>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>yum install ipvsadm -y
</span></span></code></pre></div><p>A note about LXC containers: In order to make use of ipvsadm within an LXC
container, you will also need to install the ipvsadm package on the LXC host
and reboot it (optionally just load the kernel module though I don&rsquo;t know it by
name). Additionally the simplest version, VS/NAT, requires enabling IPv4 packet
forwarding which requires modification of the read-only proc filesystem and
thus doesn&rsquo;t seem to be an easy option, there may be work arounds for this, and
it may effect the other forms but they haven&rsquo;t been tested yet.</p>
<p>First pass at commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ipvsadm -A -t 192.168.122.30:443 -s wlc
</span></span><span style="display:flex;"><span>ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.61:443 -g -w 1
</span></span><span style="display:flex;"><span>ipvsadm -a -t 192.168.122.30:443 -r 192.168.122.62:443 -g -w 1
</span></span></code></pre></div><p>That didn&rsquo;t work so I rebooted to clear it all out.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>yum install keepalived -y
</span></span></code></pre></div><p>Ah ha, Eureka moment. Inside the LXC container I can unmount the <code>/proc/sys</code>
overlay as long as I&rsquo;m root&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>umount /proc/sys
</span></span><span style="display:flex;"><span>echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</span></span></code></pre></div><p>It seems that <code>net.ipv4.ip_nonlocal_bind</code> isn&rsquo;t available within an LXC
container: <code>cat /proc/sys/net/ipv4/ip_nonlocal_bind</code>.</p>
<p>Valuable sites:</p>
<ul>
<li><a href="http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/">http://mojobojo.com/blog/2011/01/14/lvs-nginx-nodejs-mongodb-cluster-setup-on-rackspace/</a></li>
<li><a href="https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/">https://www.rackspace.com/blog/installing-and-configuring-lvs-tun/</a></li>
</ul>
<p>Interesting use for this as a firewall:</p>
<ul>
<li><a href="http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html">http://keepalived.org/Keepalived-LVS-NAT-Director-ProxyArp-Firewall-HOWTO.html</a></li>
<li><a href="http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/">http://backreference.org/2013/04/03/firewall-ha-with-conntrackd-and-keepalived/</a></li>
</ul>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>



    </body>
</html>
