<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
InstallationI&amp;rsquo;ve been using a BU-353 which if I remember correctly was ~$20 and has been fairly reliable. It&amp;rsquo;s also got a magnetic base allowing you to attach it to the roof of a car when war-driving."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/gpsd/><title>GPSd :: Sam Stelfox — A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.c8c76086c15b9d686ec1778dcf935d2ad37f3bb9c23165d2bd157ba7b18e5aec.css integrity="sha256-yMdghsFbnWhuwXeNz5NdKtN/O7nCMWXSvRV7p7GOWuw="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="GPSd"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
InstallationI’ve been using a BU-353 which if I remember correctly was ~$20 and has been fairly reliable. It’s also got a magnetic base allowing you to attach it to the roof of a car when war-driving."><meta itemprop=datePublished content="2017-10-09T17:21:50-04:00"><meta itemprop=dateModified content="2017-10-09T17:21:50-04:00"><meta itemprop=wordCount content="877"><meta name=twitter:card content="summary"><meta name=twitter:title content="GPSd"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
InstallationI’ve been using a BU-353 which if I remember correctly was ~$20 and has been fairly reliable. It’s also got a magnetic base allowing you to attach it to the roof of a car when war-driving."></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/>Posts</a></li><li><a href=/notes/>Notes</a></li><li><a href=/about/>About Me</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/gpsd/>GPSd</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><h2 id=installation>Installation</h2><p>I&rsquo;ve been using a BU-353 which if I remember correctly was ~$20 and has been
fairly reliable. It&rsquo;s also got a magnetic base allowing you to attach it to the
roof of a car when war-driving.</p><pre tabindex=0><code>yum install gpsd gpsd-clients -y</code></pre><p>If you want to use gpsd on a headless server you&rsquo;ll want to exclude the
<code>gpsd-clients</code> as they will install <code>xgps</code> and all of X as a dependency.</p><h2 id=configuration>Configuration</h2><p>My GPS device is identified by udev as a serial port, which is fairly common as
NMEA specifies a serial connection with a baud rate of 4800. There is an issue,
however, with a program running in the background called <code>modem-manager</code>.</p><p>It will actively take control over any serial device that gets plugged in and
send &ldquo;AT&rdquo; commands at it to try and determine whether or not the device is a
modem. It will release control if it fails after 10 seconds but that initial
control breaks GPSd auto-device detection.</p><p>To prevent this from happening we need to blacklist the device to
modem-manager. If you use a modem (hah) then you&rsquo;ll want to make sure the
device IDs don&rsquo;t conflict. To get your device ID run the following command:</p><pre tabindex=0><code>udevadm monitor --env</code></pre><p>Now plug in your GPS device and you should see something similar to the
following output:</p><pre tabindex=0><code>**snip**

UDEV  [10963.023977] add      /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/ttyUSB4/tty/ttyUSB4 (tty)
ACTION=add
DEVLINKS=/dev/gps4 /dev/serial/by-id/usb-Prolific_Technology_Inc._USB-Serial_Controller-if00-port0 /dev/serial/by-path/pci-0000:00:1d.0-usb-0:1.2:1.0-port0
DEVNAME=/dev/ttyUSB4
DEVPATH=/devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/ttyUSB4/tty/ttyUSB4
ID_BUS=usb
ID_MM_CANDIDATE=1
ID_MODEL=USB-Serial_Controller
ID_MODEL_ENC=USB-Serial\x20Controller
ID_MODEL_FROM_DATABASE=PL2303 Serial Port
ID_MODEL_ID=2303
ID_PATH=pci-0000:00:1d.0-usb-0:1.2:1.0
ID_PATH_TAG=pci-0000_00_1d_0-usb-0_1_2_1_0
ID_REVISION=0300ID_SERIAL=Prolific_Technology_Inc._USB-Serial_Controller
ID_TYPE=generic
ID_USB_DRIVER=pl2303
ID_USB_INTERFACES=:ff0000:
ID_USB_INTERFACE_NUM=00
ID_VENDOR=Prolific_Technology_Inc.
ID_VENDOR_ENC=Prolific\x20Technology\x20Inc.
ID_VENDOR_FROM_DATABASE=Prolific Technology, Inc.
ID_VENDOR_ID=067b
MAJOR=188
MINOR=4
SEQNUM=2470
SUBSYSTEM=tty
TAGS=:systemd:
USEC_INITIALIZED=10963017963

**snip**</code></pre><p>You&rsquo;ll probably see this a couple time as udev announces all kinds of
crazyness. The important fields to look for are <code>ID_VENDOR_ID</code> and
<code>ID_MODEL_ID</code>, these will become your <code>idVendor</code> and <code>idProduct</code> the udev rules
to come. The values for mine are <code>067b</code> and <code>2303</code> respectively.</p><p>Create the file <code>/etc/udev/rules.d/77-user-mm-usb-device-blacklist.rules</code> with
the following contents, you&rsquo;ll want to replace the values of <code>idVendor</code> and
<code>idProduct</code> if yours differ from mine:</p><pre tabindex=0><code>ACTION!=&#34;add|change&#34;, GOTO=&#34;user_mm_usb_device_blacklist_end&#34;
SUBSYSTEM!=&#34;usb&#34;, GOTO=&#34;user_mm_usb_device_blacklist_end&#34;
ENV{DEVTYPE}!=&#34;usb_device&#34;, GOTO=&#34;user_mm_usb_device_blacklist_end&#34;

ATTRS{idVendor}==&#34;067b&#34;, ATTRS{idProduct}==&#34;2303&#34;, ENV{ID_MM_DEVICE_IGNORE}=&#34;1&#34;

LABEL=&#34;user_mm_usb_device_blacklist_end&#34;</code></pre><p>The changes should be picked up immediately so no need to restart or anything
silly like that.</p><p>Now you&rsquo;ll want to start up gpsd and ensure it starts up on boot as well:</p><pre tabindex=0><code>systemctl enable gpsd.service
systemctl start gpsd.service</code></pre><p>Thats the end of the configuration, whenever you plug in one or more GPS
devices hotplug will take care of notifying gpsd of the devices, and will
remove it when it&rsquo;s been removed. You can view information on your position as
well as a fix of your location with <code>xgps</code> which is installed with the
<code>gpsd-clients</code>.</p><h2 id=using-as-a-time-source>Using as a Time Source</h2><p>TODO</p><h2 id=extending-accuracy-with-ntrip--rtcm-data>Extending Accuracy with NTRIP / RTCM data</h2><p>TODO</p><ul><li><a href=http://en.wikipedia.org/wiki/Networked_Transport_of_RTCM_via_Internet_Protocol>http://en.wikipedia.org/wiki/Networked_Transport_of_RTCM_via_Internet_Protocol</a></li><li><a href=http://igs.bkg.bund.de/ntrip/caster>http://igs.bkg.bund.de/ntrip/caster</a></li><li><a href=http://www.linuxcertif.com/man/5/rtcm-104/173922/>http://www.linuxcertif.com/man/5/rtcm-104/173922/</a></li><li><a href=http://software.rtcm-ntrip.org/>http://software.rtcm-ntrip.org/</a> (BNC is the relevant one)</li></ul><h2 id=profiling-accuracy-of-gps-receivers>Profiling Accuracy of GPS Receivers</h2><p>Included with the gpsd-clients is a utility called <code>gpsprof</code> which can take
samples from a GPS receiver and test the margin of error in x,y,z spaces. By
default it collects 100 samples.</p><p>Since NMEA specifies producing 1/sample/sec this will by default take 100
seconds or 1 minute 40 seconds to complete. It outputs the information in
gnuplot format so we&rsquo;ll need that to view the data:</p><pre tabindex=0><code>yum install gnuplot -y</code></pre><p>During the test you&rsquo;ll want to ensure that the GPS receiver is in a fixed
location. Personally I trust data more with a larger sample size so I opted to
test my receiver over a period of two hours. Like so:</p><pre tabindex=0><code>gpsprof -n 7200 | tee two-hour-gps-prof.gnuplot | gnuplot -persist</code></pre><p>This also saves the data into a file so you can regenerate the graph without
running the test for two hours again.</p><p>What I found while running the test indoors is that my GPS receiver isn&rsquo;t that
accurate (big surprise for $20).</p><p>Over the course of two hours of testing is that 50% of the fixes were with 9.24
meters of the average, 95% were within 27.32 meters of the average, and 99% of
the fixes were within 37.5 meters (this is only for latitude and longitude).</p><p>The latitude varied by as much as 60 meters and the logitude by as much as 40
meters. The altitude varied by as much as 80 meters though I don&rsquo;t have a
statistical breakdown for that. Of the 7200 data point there was also 45 where
the receiver was unable to calculate altitude. The average location (at least
for lat/long) was incredibly accurate as verified by Google Maps so at least
that&rsquo;s something.</p><p>A second test run over the course of an hour with a clear view of the sky
through the two separate windows provided an accuracy with 50% of fixes within
6.23 meters of average, 95% of fixes within 25.01 meters, and 99% wihin 31.94
meters.</p><p>The latitude varied by as much as 40 meters and the longitude by as much as 25
meters. The altitude varied by as much as 40 meters. All fixes had altitude
fixes as well.</p><p>I suspect some if not quite a bit of the error was because I was indoors and
nowhere near a window (my office is in the heart of a building unfortunately).</p><h2 id=misc-references>Misc References</h2><ul><li><a href=http://catb.org/gpsd/hacking.html>http://catb.org/gpsd/hacking.html</a></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=1757019b191a9d7e13bb03e7fade2accbadbbda9 target=_blank rel=noopener>1757019b</a> @ 2017-10-09</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>