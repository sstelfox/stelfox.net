<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
This page goes through how to create a local PKI infrastructure for use with all the other components listed in my notes and many may not mention it at all. It uses OpenSSL and provides scripts, information about choices made during the process and where to go next."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/certificate-authority/><title>Building a Certificate Authority :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Building a Certificate Authority"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
This page goes through how to create a local PKI infrastructure for use with all the other components listed in my notes and many may not mention it at all. It uses OpenSSL and provides scripts, information about choices made during the process and where to go next."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="1624"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a Certificate Authority"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
This page goes through how to create a local PKI infrastructure for use with all the other components listed in my notes and many may not mention it at all. It uses OpenSSL and provides scripts, information about choices made during the process and where to go next."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/certificate-authority/>Building a Certificate Authority</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><p>This page goes through how to create a local PKI infrastructure for use with
all the other components listed in my notes and many may not mention it at all.
It uses OpenSSL and provides scripts, information about choices made during the
process and where to go next.</p><h2 id=security-notes>Security Notes</h2><p>There are varying levels of security that need to be taken into account
throughout this process. The first and most important certificate is the 'root'
certificate authority's certificate. If the private key for this is compromised
everything else will need to be done by scratch. Additionally the private key
needs to be generated from a true random source. This is important as a little
bit of predictability will impair all future operations done with this
certificate and thus all encrypted operations done from certificates at the
heart of this system.</p><p>Second level certificate authorities should still be protected with utmost
caution, but these are for secondary services such as one for the [Linux/389
Directory Server] to hand out certificates, another for [Linux/OpenVPN]
certificates, one for websites and perhaps even another for personal
certificates for email and code signing. If one of these gets compromised the
root certificate can issue a CRL automatically invalidating all certificates
from that authority and limits the damage done.</p><h2 id=root-ca>Root CA</h2><p>Caution needs to be taken when working with the root certificate from the get
go. It should be generated on a clean machine disconnected from the network.</p><h3 id=support-structure>Support Structure</h3><p>The following set of commands builds a directory structure in the current
user's home drive in a folder called pki. It adjusts the permissions on the
folders to ensure that it is somewhat protected (though not protected from the
root user). Once again this should be performed on a trusted machine.</p><pre tabindex=0><code>mkdir -p ~/pki/root/{certs,crl,newcerts,private}
chown -R `id -u`:`id -g` ~/pki
chmod -R 700 ~/pki
</code></pre><h3 id=create-the-configuration-file>Create the Configuration File</h3><p>Create a file in the root CA's directory named openssl.cnf with the following
contents:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>  1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>  2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>  3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>  4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>  5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>  6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>  7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>  8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>  9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10> 10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11> 11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12> 12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13> 13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14> 14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15> 15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16> 16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17> 17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18> 18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19> 19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20> 20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21> 21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22> 22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23> 23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24> 24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25> 25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26> 26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27> 27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28> 28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29> 29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30> 30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31> 31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32> 32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33> 33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34> 34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35> 35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36> 36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37> 37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38> 38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39> 39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40> 40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41> 41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42> 42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43> 43</a>
</span><span class=lnt id=hl-1-44><a class=lnlinks href=#hl-1-44> 44</a>
</span><span class=lnt id=hl-1-45><a class=lnlinks href=#hl-1-45> 45</a>
</span><span class=lnt id=hl-1-46><a class=lnlinks href=#hl-1-46> 46</a>
</span><span class=lnt id=hl-1-47><a class=lnlinks href=#hl-1-47> 47</a>
</span><span class=lnt id=hl-1-48><a class=lnlinks href=#hl-1-48> 48</a>
</span><span class=lnt id=hl-1-49><a class=lnlinks href=#hl-1-49> 49</a>
</span><span class=lnt id=hl-1-50><a class=lnlinks href=#hl-1-50> 50</a>
</span><span class=lnt id=hl-1-51><a class=lnlinks href=#hl-1-51> 51</a>
</span><span class=lnt id=hl-1-52><a class=lnlinks href=#hl-1-52> 52</a>
</span><span class=lnt id=hl-1-53><a class=lnlinks href=#hl-1-53> 53</a>
</span><span class=lnt id=hl-1-54><a class=lnlinks href=#hl-1-54> 54</a>
</span><span class=lnt id=hl-1-55><a class=lnlinks href=#hl-1-55> 55</a>
</span><span class=lnt id=hl-1-56><a class=lnlinks href=#hl-1-56> 56</a>
</span><span class=lnt id=hl-1-57><a class=lnlinks href=#hl-1-57> 57</a>
</span><span class=lnt id=hl-1-58><a class=lnlinks href=#hl-1-58> 58</a>
</span><span class=lnt id=hl-1-59><a class=lnlinks href=#hl-1-59> 59</a>
</span><span class=lnt id=hl-1-60><a class=lnlinks href=#hl-1-60> 60</a>
</span><span class=lnt id=hl-1-61><a class=lnlinks href=#hl-1-61> 61</a>
</span><span class=lnt id=hl-1-62><a class=lnlinks href=#hl-1-62> 62</a>
</span><span class=lnt id=hl-1-63><a class=lnlinks href=#hl-1-63> 63</a>
</span><span class=lnt id=hl-1-64><a class=lnlinks href=#hl-1-64> 64</a>
</span><span class=lnt id=hl-1-65><a class=lnlinks href=#hl-1-65> 65</a>
</span><span class=lnt id=hl-1-66><a class=lnlinks href=#hl-1-66> 66</a>
</span><span class=lnt id=hl-1-67><a class=lnlinks href=#hl-1-67> 67</a>
</span><span class=lnt id=hl-1-68><a class=lnlinks href=#hl-1-68> 68</a>
</span><span class=lnt id=hl-1-69><a class=lnlinks href=#hl-1-69> 69</a>
</span><span class=lnt id=hl-1-70><a class=lnlinks href=#hl-1-70> 70</a>
</span><span class=lnt id=hl-1-71><a class=lnlinks href=#hl-1-71> 71</a>
</span><span class=lnt id=hl-1-72><a class=lnlinks href=#hl-1-72> 72</a>
</span><span class=lnt id=hl-1-73><a class=lnlinks href=#hl-1-73> 73</a>
</span><span class=lnt id=hl-1-74><a class=lnlinks href=#hl-1-74> 74</a>
</span><span class=lnt id=hl-1-75><a class=lnlinks href=#hl-1-75> 75</a>
</span><span class=lnt id=hl-1-76><a class=lnlinks href=#hl-1-76> 76</a>
</span><span class=lnt id=hl-1-77><a class=lnlinks href=#hl-1-77> 77</a>
</span><span class=lnt id=hl-1-78><a class=lnlinks href=#hl-1-78> 78</a>
</span><span class=lnt id=hl-1-79><a class=lnlinks href=#hl-1-79> 79</a>
</span><span class=lnt id=hl-1-80><a class=lnlinks href=#hl-1-80> 80</a>
</span><span class=lnt id=hl-1-81><a class=lnlinks href=#hl-1-81> 81</a>
</span><span class=lnt id=hl-1-82><a class=lnlinks href=#hl-1-82> 82</a>
</span><span class=lnt id=hl-1-83><a class=lnlinks href=#hl-1-83> 83</a>
</span><span class=lnt id=hl-1-84><a class=lnlinks href=#hl-1-84> 84</a>
</span><span class=lnt id=hl-1-85><a class=lnlinks href=#hl-1-85> 85</a>
</span><span class=lnt id=hl-1-86><a class=lnlinks href=#hl-1-86> 86</a>
</span><span class=lnt id=hl-1-87><a class=lnlinks href=#hl-1-87> 87</a>
</span><span class=lnt id=hl-1-88><a class=lnlinks href=#hl-1-88> 88</a>
</span><span class=lnt id=hl-1-89><a class=lnlinks href=#hl-1-89> 89</a>
</span><span class=lnt id=hl-1-90><a class=lnlinks href=#hl-1-90> 90</a>
</span><span class=lnt id=hl-1-91><a class=lnlinks href=#hl-1-91> 91</a>
</span><span class=lnt id=hl-1-92><a class=lnlinks href=#hl-1-92> 92</a>
</span><span class=lnt id=hl-1-93><a class=lnlinks href=#hl-1-93> 93</a>
</span><span class=lnt id=hl-1-94><a class=lnlinks href=#hl-1-94> 94</a>
</span><span class=lnt id=hl-1-95><a class=lnlinks href=#hl-1-95> 95</a>
</span><span class=lnt id=hl-1-96><a class=lnlinks href=#hl-1-96> 96</a>
</span><span class=lnt id=hl-1-97><a class=lnlinks href=#hl-1-97> 97</a>
</span><span class=lnt id=hl-1-98><a class=lnlinks href=#hl-1-98> 98</a>
</span><span class=lnt id=hl-1-99><a class=lnlinks href=#hl-1-99> 99</a>
</span><span class=lnt id=hl-1-100><a class=lnlinks href=#hl-1-100>100</a>
</span><span class=lnt id=hl-1-101><a class=lnlinks href=#hl-1-101>101</a>
</span><span class=lnt id=hl-1-102><a class=lnlinks href=#hl-1-102>102</a>
</span><span class=lnt id=hl-1-103><a class=lnlinks href=#hl-1-103>103</a>
</span><span class=lnt id=hl-1-104><a class=lnlinks href=#hl-1-104>104</a>
</span><span class=lnt id=hl-1-105><a class=lnlinks href=#hl-1-105>105</a>
</span><span class=lnt id=hl-1-106><a class=lnlinks href=#hl-1-106>106</a>
</span><span class=lnt id=hl-1-107><a class=lnlinks href=#hl-1-107>107</a>
</span><span class=lnt id=hl-1-108><a class=lnlinks href=#hl-1-108>108</a>
</span><span class=lnt id=hl-1-109><a class=lnlinks href=#hl-1-109>109</a>
</span><span class=lnt id=hl-1-110><a class=lnlinks href=#hl-1-110>110</a>
</span><span class=lnt id=hl-1-111><a class=lnlinks href=#hl-1-111>111</a>
</span><span class=lnt id=hl-1-112><a class=lnlinks href=#hl-1-112>112</a>
</span><span class=lnt id=hl-1-113><a class=lnlinks href=#hl-1-113>113</a>
</span><span class=lnt id=hl-1-114><a class=lnlinks href=#hl-1-114>114</a>
</span><span class=lnt id=hl-1-115><a class=lnlinks href=#hl-1-115>115</a>
</span><span class=lnt id=hl-1-116><a class=lnlinks href=#hl-1-116>116</a>
</span><span class=lnt id=hl-1-117><a class=lnlinks href=#hl-1-117>117</a>
</span><span class=lnt id=hl-1-118><a class=lnlinks href=#hl-1-118>118</a>
</span><span class=lnt id=hl-1-119><a class=lnlinks href=#hl-1-119>119</a>
</span><span class=lnt id=hl-1-120><a class=lnlinks href=#hl-1-120>120</a>
</span><span class=lnt id=hl-1-121><a class=lnlinks href=#hl-1-121>121</a>
</span><span class=lnt id=hl-1-122><a class=lnlinks href=#hl-1-122>122</a>
</span><span class=lnt id=hl-1-123><a class=lnlinks href=#hl-1-123>123</a>
</span><span class=lnt id=hl-1-124><a class=lnlinks href=#hl-1-124>124</a>
</span><span class=lnt id=hl-1-125><a class=lnlinks href=#hl-1-125>125</a>
</span><span class=lnt id=hl-1-126><a class=lnlinks href=#hl-1-126>126</a>
</span><span class=lnt id=hl-1-127><a class=lnlinks href=#hl-1-127>127</a>
</span><span class=lnt id=hl-1-128><a class=lnlinks href=#hl-1-128>128</a>
</span><span class=lnt id=hl-1-129><a class=lnlinks href=#hl-1-129>129</a>
</span><span class=lnt id=hl-1-130><a class=lnlinks href=#hl-1-130>130</a>
</span><span class=lnt id=hl-1-131><a class=lnlinks href=#hl-1-131>131</a>
</span><span class=lnt id=hl-1-132><a class=lnlinks href=#hl-1-132>132</a>
</span><span class=lnt id=hl-1-133><a class=lnlinks href=#hl-1-133>133</a>
</span><span class=lnt id=hl-1-134><a class=lnlinks href=#hl-1-134>134</a>
</span><span class=lnt id=hl-1-135><a class=lnlinks href=#hl-1-135>135</a>
</span><span class=lnt id=hl-1-136><a class=lnlinks href=#hl-1-136>136</a>
</span><span class=lnt id=hl-1-137><a class=lnlinks href=#hl-1-137>137</a>
</span><span class=lnt id=hl-1-138><a class=lnlinks href=#hl-1-138>138</a>
</span><span class=lnt id=hl-1-139><a class=lnlinks href=#hl-1-139>139</a>
</span><span class=lnt id=hl-1-140><a class=lnlinks href=#hl-1-140>140</a>
</span><span class=lnt id=hl-1-141><a class=lnlinks href=#hl-1-141>141</a>
</span><span class=lnt id=hl-1-142><a class=lnlinks href=#hl-1-142>142</a>
</span><span class=lnt id=hl-1-143><a class=lnlinks href=#hl-1-143>143</a>
</span><span class=lnt id=hl-1-144><a class=lnlinks href=#hl-1-144>144</a>
</span><span class=lnt id=hl-1-145><a class=lnlinks href=#hl-1-145>145</a>
</span><span class=lnt id=hl-1-146><a class=lnlinks href=#hl-1-146>146</a>
</span><span class=lnt id=hl-1-147><a class=lnlinks href=#hl-1-147>147</a>
</span><span class=lnt id=hl-1-148><a class=lnlinks href=#hl-1-148>148</a>
</span><span class=lnt id=hl-1-149><a class=lnlinks href=#hl-1-149>149</a>
</span><span class=lnt id=hl-1-150><a class=lnlinks href=#hl-1-150>150</a>
</span><span class=lnt id=hl-1-151><a class=lnlinks href=#hl-1-151>151</a>
</span><span class=lnt id=hl-1-152><a class=lnlinks href=#hl-1-152>152</a>
</span><span class=lnt id=hl-1-153><a class=lnlinks href=#hl-1-153>153</a>
</span><span class=lnt id=hl-1-154><a class=lnlinks href=#hl-1-154>154</a>
</span><span class=lnt id=hl-1-155><a class=lnlinks href=#hl-1-155>155</a>
</span><span class=lnt id=hl-1-156><a class=lnlinks href=#hl-1-156>156</a>
</span><span class=lnt id=hl-1-157><a class=lnlinks href=#hl-1-157>157</a>
</span><span class=lnt id=hl-1-158><a class=lnlinks href=#hl-1-158>158</a>
</span><span class=lnt id=hl-1-159><a class=lnlinks href=#hl-1-159>159</a>
</span><span class=lnt id=hl-1-160><a class=lnlinks href=#hl-1-160>160</a>
</span><span class=lnt id=hl-1-161><a class=lnlinks href=#hl-1-161>161</a>
</span><span class=lnt id=hl-1-162><a class=lnlinks href=#hl-1-162>162</a>
</span><span class=lnt id=hl-1-163><a class=lnlinks href=#hl-1-163>163</a>
</span><span class=lnt id=hl-1-164><a class=lnlinks href=#hl-1-164>164</a>
</span><span class=lnt id=hl-1-165><a class=lnlinks href=#hl-1-165>165</a>
</span><span class=lnt id=hl-1-166><a class=lnlinks href=#hl-1-166>166</a>
</span><span class=lnt id=hl-1-167><a class=lnlinks href=#hl-1-167>167</a>
</span><span class=lnt id=hl-1-168><a class=lnlinks href=#hl-1-168>168</a>
</span><span class=lnt id=hl-1-169><a class=lnlinks href=#hl-1-169>169</a>
</span><span class=lnt id=hl-1-170><a class=lnlinks href=#hl-1-170>170</a>
</span><span class=lnt id=hl-1-171><a class=lnlinks href=#hl-1-171>171</a>
</span><span class=lnt id=hl-1-172><a class=lnlinks href=#hl-1-172>172</a>
</span><span class=lnt id=hl-1-173><a class=lnlinks href=#hl-1-173>173</a>
</span><span class=lnt id=hl-1-174><a class=lnlinks href=#hl-1-174>174</a>
</span><span class=lnt id=hl-1-175><a class=lnlinks href=#hl-1-175>175</a>
</span><span class=lnt id=hl-1-176><a class=lnlinks href=#hl-1-176>176</a>
</span><span class=lnt id=hl-1-177><a class=lnlinks href=#hl-1-177>177</a>
</span><span class=lnt id=hl-1-178><a class=lnlinks href=#hl-1-178>178</a>
</span><span class=lnt id=hl-1-179><a class=lnlinks href=#hl-1-179>179</a>
</span><span class=lnt id=hl-1-180><a class=lnlinks href=#hl-1-180>180</a>
</span><span class=lnt id=hl-1-181><a class=lnlinks href=#hl-1-181>181</a>
</span><span class=lnt id=hl-1-182><a class=lnlinks href=#hl-1-182>182</a>
</span><span class=lnt id=hl-1-183><a class=lnlinks href=#hl-1-183>183</a>
</span><span class=lnt id=hl-1-184><a class=lnlinks href=#hl-1-184>184</a>
</span><span class=lnt id=hl-1-185><a class=lnlinks href=#hl-1-185>185</a>
</span><span class=lnt id=hl-1-186><a class=lnlinks href=#hl-1-186>186</a>
</span><span class=lnt id=hl-1-187><a class=lnlinks href=#hl-1-187>187</a>
</span><span class=lnt id=hl-1-188><a class=lnlinks href=#hl-1-188>188</a>
</span><span class=lnt id=hl-1-189><a class=lnlinks href=#hl-1-189>189</a>
</span><span class=lnt id=hl-1-190><a class=lnlinks href=#hl-1-190>190</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>HOME</span>                    <span class=o>=</span> <span class=s>.</span>
</span></span><span class=line><span class=cl><span class=na>RANDFILE</span>                <span class=o>=</span> <span class=s>$ENV::HOME/.rnd</span>
</span></span><span class=line><span class=cl><span class=na>oid_section</span>             <span class=o>=</span> <span class=s>new_oids</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ new_oids ]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ ca ]</span>
</span></span><span class=line><span class=cl><span class=na>default_ca</span> <span class=o>=</span> <span class=s>CA_default</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ CA_default ]</span>
</span></span><span class=line><span class=cl><span class=na>dir</span> <span class=o>=</span> <span class=s>/home/sstelfox/pki             # The root directory</span>
</span></span><span class=line><span class=cl><span class=na>certs</span> <span class=o>=</span> <span class=s>$dir/certs                   # Where the issued certs are kept</span>
</span></span><span class=line><span class=cl><span class=na>crl_dir</span> <span class=o>=</span> <span class=s>$dir/crl                   # Where the issued crl are kept</span>
</span></span><span class=line><span class=cl><span class=na>database</span> <span class=o>=</span> <span class=s>$dir/index.txt            # Database index file.</span>
</span></span><span class=line><span class=cl><span class=na>unique_subject</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>new_certs_dir</span> <span class=o>=</span> <span class=s>$dir/newcerts        # Default place for new certs.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>certificate</span> <span class=o>=</span> <span class=s>$dir/cacert.pem        # The CA certificate</span>
</span></span><span class=line><span class=cl><span class=na>serial</span> <span class=o>=</span> <span class=s>$dir/serial                 # The current serial number</span>
</span></span><span class=line><span class=cl><span class=na>crlnumber</span> <span class=o>=</span> <span class=s>$dir/crlnumber           # The current crl number</span>
</span></span><span class=line><span class=cl><span class=na>crl</span> <span class=o>=</span> <span class=s>$dir/crl.pem                   # The current CRL</span>
</span></span><span class=line><span class=cl><span class=na>private_key</span> <span class=o>=</span> <span class=s>$dir/private/ca.key # The private key</span>
</span></span><span class=line><span class=cl><span class=na>RANDFILE</span> <span class=o>=</span> <span class=s>$dir/private/.rand        # Private random number file</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>x509_extensions</span> <span class=o>=</span> <span class=s>usr_cert           # The extentions to add to the cert</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>name_opt</span> <span class=o>=</span> <span class=s>ca_default                # Subject Name options</span>
</span></span><span class=line><span class=cl><span class=na>cert_opt</span> <span class=o>=</span> <span class=s>ca_default                # Certificate field options</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>crl_extensions</span> <span class=o>=</span> <span class=s>crl_ext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>default_days</span> <span class=o>=</span> <span class=s>365                   # How long to certify for</span>
</span></span><span class=line><span class=cl><span class=na>default_crl_days</span> <span class=o>=</span> <span class=s>7                 # How long before next CRL</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span> <span class=o>=</span> <span class=s>sha256                  # Use sha256 for the hash</span>
</span></span><span class=line><span class=cl><span class=na>preserve</span> <span class=o>=</span> <span class=s>no                        # Keep passed DN ordering</span>
</span></span><span class=line><span class=cl><span class=na>policy</span> <span class=o>=</span> <span class=s>policy_match</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For the CA policy</span>
</span></span><span class=line><span class=cl><span class=k>[ policy_match ]</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span> <span class=o>=</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span> <span class=o>=</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=na>organizationName</span> <span class=o>=</span> <span class=s>match</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span> <span class=o>=</span> <span class=s>supplied</span>
</span></span><span class=line><span class=cl><span class=na>emailAddress</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ policy_anything ]</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>localityName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>organizationName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span> <span class=o>=</span> <span class=s>supplied</span>
</span></span><span class=line><span class=cl><span class=na>emailAddress</span> <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>###################### CA Request Defaults ##########################</span>
</span></span><span class=line><span class=cl><span class=k>[ req ]</span>
</span></span><span class=line><span class=cl><span class=na>default_bits</span> <span class=o>=</span> <span class=s>4096</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span> <span class=o>=</span> <span class=s>sha256</span>
</span></span><span class=line><span class=cl><span class=na>default_keyfile</span> <span class=o>=</span> <span class=s>priv.key</span>
</span></span><span class=line><span class=cl><span class=na>distinguished_name</span> <span class=o>=</span> <span class=s>req_distinguished_name</span>
</span></span><span class=line><span class=cl><span class=na>attributes</span> <span class=o>=</span> <span class=s>req_attributes</span>
</span></span><span class=line><span class=cl><span class=na>x509_extensions</span> <span class=o>=</span> <span class=s>v3_ca # The extentions to add to the self signed cert</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>string_mask</span> <span class=o>=</span> <span class=s>utf8only</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ req_distinguished_name ]</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span> <span class=o>=</span> <span class=s>Country Name</span>
</span></span><span class=line><span class=cl><span class=na>countryName_default</span> <span class=o>=</span> <span class=s>AC</span>
</span></span><span class=line><span class=cl><span class=na>countryName_min</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl><span class=na>countryName_max</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span> <span class=o>=</span> <span class=s>State or Province Name (full name)</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName_default</span> <span class=o>=</span> <span class=s>YmVkcm9vbXByb2dyYW1tZXJzLm5ldA==</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>localityName</span> <span class=o>=</span> <span class=s>Locality Name</span>
</span></span><span class=line><span class=cl><span class=na>localityName_default</span> <span class=o>=</span> <span class=s>dHJ1ZWR1YWxpdHk=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>0.organizationName</span> <span class=o>=</span> <span class=s>Organization Name</span>
</span></span><span class=line><span class=cl><span class=na>0.organizationName_default</span> <span class=o>=</span> <span class=s>QmVkcm9vbSBQcm9ncmFtbWVycyAtIENvZGUgVGhlIFBsYW5ldA==</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span> <span class=o>=</span> <span class=s>Organizational Unit Name (eg, section)</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName_default</span> <span class=o>=</span> <span class=s>QWRtaW5pc3RyYXRpb24=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>commonName</span>  <span class=o>=</span> <span class=s>Common Name (User\&#39;s name the server\&#39;s hostname)</span>
</span></span><span class=line><span class=cl><span class=na>commonName_max</span> <span class=o>=</span> <span class=s>64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>emailAddress</span> <span class=o>=</span> <span class=s>Email Address</span>
</span></span><span class=line><span class=cl><span class=na>emailAddress_max</span> <span class=o>=</span> <span class=s>64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ req_attributes ]</span>
</span></span><span class=line><span class=cl><span class=na>challengePassword</span> <span class=o>=</span> <span class=s>A challenge password</span>
</span></span><span class=line><span class=cl><span class=na>challengePassword_min</span> <span class=o>=</span> <span class=s>4</span>
</span></span><span class=line><span class=cl><span class=na>challengePassword_max</span> <span class=o>=</span> <span class=s>24</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ usr_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># These two are the only expected use cases at the time for this CA. If it is</span>
</span></span><span class=line><span class=cl><span class=c1># omitted the certificate can be used for anything *except* object signing.</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = server</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = client, email, objsign</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is typical in keyUsage for a client certificate.</span>
</span></span><span class=line><span class=cl><span class=c1># keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;Certificate issued by BedroomProgrammers.net&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PKIX recommendations harmless if included in all certificates.</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span><span class=o>=</span><span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span><span class=o>=</span><span class=s>keyid,issuer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This stuff is for subjectAltName and issuerAltname.</span>
</span></span><span class=line><span class=cl><span class=c1># Import the email address.</span>
</span></span><span class=line><span class=cl><span class=c1># subjectAltName=email:copy</span>
</span></span><span class=line><span class=cl><span class=c1># An alternative to produce certificates that aren&#39;t</span>
</span></span><span class=line><span class=cl><span class=c1># deprecated according to PKIX.</span>
</span></span><span class=line><span class=cl><span class=c1># subjectAltName=email:move</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Location of the public cert</span>
</span></span><span class=line><span class=cl><span class=na>issuerAltName</span> <span class=o>=</span> <span class=s>URI:http://bedroomprogrammers.net/bpca.crt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Information about the certificates</span>
</span></span><span class=line><span class=cl><span class=na>nsCaRevocationUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/bpca.crl</span>
</span></span><span class=line><span class=cl><span class=na>nsBaseUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/</span>
</span></span><span class=line><span class=cl><span class=na>nsRevocationUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/revoke/?</span>
</span></span><span class=line><span class=cl><span class=na>nsRenewalUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/renew/?</span>
</span></span><span class=line><span class=cl><span class=na>nsCaPolicyUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/policy/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is required for TSA certificates.</span>
</span></span><span class=line><span class=cl><span class=c1># extendedKeyUsage = critical,timeStamping</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ v3_req ]</span>
</span></span><span class=line><span class=cl><span class=c1># Extensions to add to a certificate request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:false</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ v3_ca ]</span>
</span></span><span class=line><span class=cl><span class=c1># Extensions for a typical CA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PKIX recommendation.</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span><span class=o>=</span><span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span><span class=o>=</span><span class=s>keyid:always,issuer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This may break some older clients</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>critical,CA:true</span>
</span></span><span class=line><span class=cl><span class=c1># If this happens the certificate will have to be remade using this option:</span>
</span></span><span class=line><span class=cl><span class=c1>#basicConstraints = CA:true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Some might want this also</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = sslCA, emailCA</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Include email address in subject alt name: another PKIX recommendation</span>
</span></span><span class=line><span class=cl><span class=c1># subjectAltName=email:copy</span>
</span></span><span class=line><span class=cl><span class=c1># Copy issuer details</span>
</span></span><span class=line><span class=cl><span class=na>issuerAltName</span> <span class=o>=</span> <span class=s>URI:http://bedroomprogrammers.net/bpca.crt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ crl_ext ]</span>
</span></span><span class=line><span class=cl><span class=na>issuerAltName</span> <span class=o>=</span> <span class=s>URI:http://bedroomprogrammers.net/bpca.crt</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid:always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ proxy_cert_ext ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span><span class=o>=</span><span class=s>CA:false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = server</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = objsign</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = client, email</span>
</span></span><span class=line><span class=cl><span class=c1># nsCertType = client, email, objsign</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is typical in keyUsage for a client certificate.</span>
</span></span><span class=line><span class=cl><span class=c1># keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;Certificate issued by BedroomProgrammers.net&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PKIX recommendations harmless if included in all certificates.</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Copy subject details</span>
</span></span><span class=line><span class=cl><span class=na>issuerAltName</span> <span class=o>=</span> <span class=s>issuer:copy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>nsCaRevocationUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/bpca.crl</span>
</span></span><span class=line><span class=cl><span class=na>nsBaseUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/</span>
</span></span><span class=line><span class=cl><span class=na>nsRevocationUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/revoke/?</span>
</span></span><span class=line><span class=cl><span class=na>nsRenewalUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/renew/?</span>
</span></span><span class=line><span class=cl><span class=na>nsCaPolicyUrl</span> <span class=o>=</span> <span class=s>http://bedroomprogrammers.net/ssl/policy/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This really needs to be in place for it to be a proxy certificate.</span>
</span></span><span class=line><span class=cl><span class=na>proxyCertInfo</span><span class=o>=</span><span class=s>critical,language:id-ppl-anyLanguage,pathlen:3,policy:foo</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=create-ca-key--certificate>Create CA Key & Certificate</h3><p>This section creates the CA private key, public certificate, and serial file
using the <code>openssl.cnf</code> file above.</p><pre tabindex=0><code>openssl req -new -keyout private/ca.key -out ca.csr -config openssl.cnf
openssl ca -create_serial -config ./openssl.cnf -out ca.crt -days 1095 -batch \
  -keyfile private/ca.key -selfsign -extensions v3_ca -infiles ca.csr
</code></pre><p>You will now want to distribute "ca.crt" to any client that will use a service
with your CA.</p><h2 id=common-tasks>Common Tasks</h2><h3 id=simple-client-certificate-creation>Simple Client Certificate Creation</h3><p>First we'll need to create a key for client, this should be done on the client
itself. It may be easier if the CA config (openssl.cnf) was distributed as well
as there are some strict signing requirements in the above configuration where
the country, state, and org name need to match exactly.</p><pre tabindex=0><code>openssl genrsa 2048 &gt; host.example.org.key
openssl req -new -key host.example.org.key -out host.example.org.csr \
  -extensions v3_req
</code></pre><p>Once the CSR has been generated transfer it to the host containing the CA, this
assumes you have placed the file (and are currently within) the CA's directory.</p><pre tabindex=0><code>openssl ca -config ./openssl.cnf -out host.example.org.crt -days 365 -batch \
  -keyfile private/ca.key -cert ca.crt -infiles host.example.org.csr
</code></pre><h3 id=advanced-client-certificate-creation>Advanced Client Certificate Creation</h3><p>Creating a certificate with multiple domains requires one extra step, create a
key and certificate as normal but create an additional file
<code>test.domain.net.cnf</code> that includes something along the following lines:</p><pre tabindex=0><code>subjectAltName=DNS:www.test.domain.net,DNS:*.test.domain.net,DNS:other.domain.net
</code></pre><p>When you sign the key you'll need to add the flag <code>-extfile</code> and specify the
file with the above contents. This will append those domains to the
certificate. An example way to sign the CSR:</p><pre tabindex=0><code>openssl ca -config ./openssl.cnf -out test.domain.net.crt -days 365 -batch \
  -keyfile private/ca.key -cert ca.crt -infiles test.domain.net.csr \
  -extfile test.domain.net.cnf
</code></pre><h3 id=convert-a-certificate-for-microsoft-certificate-store>Convert a Certificate for Microsoft Certificate Store</h3><p>This will convert a standard OpenSSL certificate/key pair into a pfx for use by
Microsoft products (fuck them for being different).</p><pre tabindex=0><code>openssl pkcs12 -export -out keycert.pfx -inkey priv.key -in cert.crt
</code></pre><h3 id=view-the-contents-of-a-certificate>View the Contents of a Certificate</h3><p>To view the text content of a certificate you can use the following command:</p><pre tabindex=0><code>openssl x509 -text -noout -in cert.crt
</code></pre><p>You can also view the contents of a signing request using:</p><pre tabindex=0><code>openssl req -text -noout -in cert.csr
</code></pre><h2 id=quick-self-signed-cert>Quick Self Signed Cert</h2><pre tabindex=0><code>openssl req -new -x509 -newkey rsa:4096 -keyout server.key -nodes -days 365 \
  -out server.crt
</code></pre><h2 id=add--change-a-password-on-a-keyfile>Add / Change a Password on a Keyfile</h2><pre tabindex=0><code>openssl rsa -des -in unprotected.key -out encrypted.key
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=05d8865c5bb4f32ad03ef2fb02f70765921e7d67 target=_blank rel=noopener>05d8865c</a> @ 2024-07-16</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>