<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux Adjustments SELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/samba/><title>Samba :: Sam Stelfox
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Samba"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux Adjustments SELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."><meta itemprop=wordCount content="481"><meta name=twitter:card content="summary"><meta name=twitter:title content="Samba"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux Adjustments SELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/blog/>Blog Posts</a></li><li><a href=/notes/>Various Notes</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/samba/>Samba</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><p>FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.</p><h2 id=selinux-adjustments>SELinux Adjustments</h2><p>SELinux hates Samba and with good reason. To allow authenticated clients to
access the contents of a samba share you need to label the share. The easiest
way to make this persistent is by adjusting the targeted SELinux config. In the
following example the only samba share is location at /media/sharing.</p><p>Add this to <code>/etc/selinux/targeted/contexts/files/file_contexts</code>:</p><pre tabindex=0><code>/media/storage(/.*)?    system_u:object_r:samba_share_t:s0
</code></pre><p>Then run this command:</p><pre tabindex=0><code>[root@localhost ~]# restorecon -R /media/storage
</code></pre><h2 id=on-anonymous-access>On Anonymous Access</h2><p>If you intend to allow anonymous browsing of shares and/or access to a share,
you will need to create a &rsquo;nobody&rsquo; user with no password and add a few lines to
the configuration file. Add the user by following the instructions in &lsquo;Managing
Users&rsquo;</p><h2 id=managing-users>Managing Users</h2><p>To add a samba user make sure they have an account on the local machine, and
run the command:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -a &lt;username&gt;
</code></pre><p>To list samba users:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -L
</code></pre><p>To delete a samba user:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -x &lt;username&gt;
</code></pre><h2 id=configuration>Configuration</h2><h3 id=etcsambasmbconf>/etc/samba/smb.conf</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[global]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ----------------------- Network-Related Options -------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>workgroup</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>Pantheon
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        server string = For Sexual Favors
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        netbios name = Moirae
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        interfaces = eth0:0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        bind interfaces only = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        hosts allow = 10.13.37.0/24
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        guest account = nobody
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        map to guest = bad user
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        force directory mode = 0777
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        force create mode = 0666</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Force master browser elections to choose this server</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>domain master</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        local master = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        preferred master = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        os level = 60</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket options</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>TCP_NODELAY
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        read raw = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        write raw = yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>security</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>user
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        passdb backend = tdbsam</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --------------------------- Logging Options -----------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># log files split per-machine:</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log file</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/var/log/samba/log.%m</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># maximum size of 50KB per log file, then rotate:</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>max log size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>50</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --------------------------- Printing Options -----------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Disable printing altogether</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>load printers</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        printcap name = /dev/null
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        printing = bsd
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        disable spoolss = yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># --------------------------- File System Options ---------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;       map archive = no</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;       map hidden = no</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;       map read only = no</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;       map system = no</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;       store dos attributes = yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#============================ Share Definitions ==============================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Hidden]</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>I&#39;m a secret!
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        browsable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        path = /media/storage/Dropbox
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        public = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        writable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        printable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        write list = @users
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        guest ok = no</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Anonymous Dropbox]</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>Public File Drop Be Nice
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        browsable = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        path = /media/storage/Dropbox
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        public = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        writable = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        printable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        guest ok = yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[Media]</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>Public Media Shares
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        browsable = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        path = /media/storage/Media
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        public = yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        writable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        printable = no
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        write list = @users
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        guest ok = yes</span>
</span></span></code></pre></div></div></article><hr><div class=post-info></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>