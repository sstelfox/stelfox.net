<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux AdjustmentsSELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/samba/><title>Samba :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Samba"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux AdjustmentsSELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="559"><meta name=twitter:card content="summary"><meta name=twitter:title content="Samba"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.
SELinux AdjustmentsSELinux hates Samba and with good reason. To allow authenticated clients to access the contents of a samba share you need to label the share."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/samba/>Samba</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><p>FEAR FOR THOSE WHO TREAD THESE WATERS FOR THEY ARE DEEP AND EVIL.</p><h2 id=selinux-adjustments>SELinux Adjustments</h2><p>SELinux hates Samba and with good reason. To allow authenticated clients to
access the contents of a samba share you need to label the share. The easiest
way to make this persistent is by adjusting the targeted SELinux config. In the
following example the only samba share is location at /media/sharing.</p><p>Add this to <code>/etc/selinux/targeted/contexts/files/file_contexts</code>:</p><pre tabindex=0><code>/media/storage(/.*)?    system_u:object_r:samba_share_t:s0
</code></pre><p>Then run this command:</p><pre tabindex=0><code>[root@localhost ~]# restorecon -R /media/storage
</code></pre><h2 id=on-anonymous-access>On Anonymous Access</h2><p>If you intend to allow anonymous browsing of shares and/or access to a share,
you will need to create a 'nobody' user with no password and add a few lines to
the configuration file. Add the user by following the instructions in 'Managing
Users'</p><h2 id=managing-users>Managing Users</h2><p>To add a samba user make sure they have an account on the local machine, and
run the command:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -a &lt;username&gt;
</code></pre><p>To list samba users:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -L
</code></pre><p>To delete a samba user:</p><pre tabindex=0><code>[root@localhost ~]# pdbedit -x &lt;username&gt;
</code></pre><h2 id=configuration>Configuration</h2><h3 id=etcsambasmbconf>/etc/samba/smb.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41>41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42>42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43>43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44>44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45>45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46>46</a>
</span><span class=lnt id=hl-5-47><a class=lnlinks href=#hl-5-47>47</a>
</span><span class=lnt id=hl-5-48><a class=lnlinks href=#hl-5-48>48</a>
</span><span class=lnt id=hl-5-49><a class=lnlinks href=#hl-5-49>49</a>
</span><span class=lnt id=hl-5-50><a class=lnlinks href=#hl-5-50>50</a>
</span><span class=lnt id=hl-5-51><a class=lnlinks href=#hl-5-51>51</a>
</span><span class=lnt id=hl-5-52><a class=lnlinks href=#hl-5-52>52</a>
</span><span class=lnt id=hl-5-53><a class=lnlinks href=#hl-5-53>53</a>
</span><span class=lnt id=hl-5-54><a class=lnlinks href=#hl-5-54>54</a>
</span><span class=lnt id=hl-5-55><a class=lnlinks href=#hl-5-55>55</a>
</span><span class=lnt id=hl-5-56><a class=lnlinks href=#hl-5-56>56</a>
</span><span class=lnt id=hl-5-57><a class=lnlinks href=#hl-5-57>57</a>
</span><span class=lnt id=hl-5-58><a class=lnlinks href=#hl-5-58>58</a>
</span><span class=lnt id=hl-5-59><a class=lnlinks href=#hl-5-59>59</a>
</span><span class=lnt id=hl-5-60><a class=lnlinks href=#hl-5-60>60</a>
</span><span class=lnt id=hl-5-61><a class=lnlinks href=#hl-5-61>61</a>
</span><span class=lnt id=hl-5-62><a class=lnlinks href=#hl-5-62>62</a>
</span><span class=lnt id=hl-5-63><a class=lnlinks href=#hl-5-63>63</a>
</span><span class=lnt id=hl-5-64><a class=lnlinks href=#hl-5-64>64</a>
</span><span class=lnt id=hl-5-65><a class=lnlinks href=#hl-5-65>65</a>
</span><span class=lnt id=hl-5-66><a class=lnlinks href=#hl-5-66>66</a>
</span><span class=lnt id=hl-5-67><a class=lnlinks href=#hl-5-67>67</a>
</span><span class=lnt id=hl-5-68><a class=lnlinks href=#hl-5-68>68</a>
</span><span class=lnt id=hl-5-69><a class=lnlinks href=#hl-5-69>69</a>
</span><span class=lnt id=hl-5-70><a class=lnlinks href=#hl-5-70>70</a>
</span><span class=lnt id=hl-5-71><a class=lnlinks href=#hl-5-71>71</a>
</span><span class=lnt id=hl-5-72><a class=lnlinks href=#hl-5-72>72</a>
</span><span class=lnt id=hl-5-73><a class=lnlinks href=#hl-5-73>73</a>
</span><span class=lnt id=hl-5-74><a class=lnlinks href=#hl-5-74>74</a>
</span><span class=lnt id=hl-5-75><a class=lnlinks href=#hl-5-75>75</a>
</span><span class=lnt id=hl-5-76><a class=lnlinks href=#hl-5-76>76</a>
</span><span class=lnt id=hl-5-77><a class=lnlinks href=#hl-5-77>77</a>
</span><span class=lnt id=hl-5-78><a class=lnlinks href=#hl-5-78>78</a>
</span><span class=lnt id=hl-5-79><a class=lnlinks href=#hl-5-79>79</a>
</span><span class=lnt id=hl-5-80><a class=lnlinks href=#hl-5-80>80</a>
</span><span class=lnt id=hl-5-81><a class=lnlinks href=#hl-5-81>81</a>
</span><span class=lnt id=hl-5-82><a class=lnlinks href=#hl-5-82>82</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[global]</span>
</span></span><span class=line><span class=cl><span class=c1># ----------------------- Network-Related Options -------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=na>workgroup</span> <span class=o>=</span> <span class=s>Pantheon
</span></span></span><span class=line><span class=cl><span class=s>        server string = For Sexual Favors
</span></span></span><span class=line><span class=cl><span class=s>        netbios name = Moirae
</span></span></span><span class=line><span class=cl><span class=s>        interfaces = eth0:0
</span></span></span><span class=line><span class=cl><span class=s>        bind interfaces only = yes
</span></span></span><span class=line><span class=cl><span class=s>        hosts allow = 10.13.37.0/24
</span></span></span><span class=line><span class=cl><span class=s>        guest account = nobody
</span></span></span><span class=line><span class=cl><span class=s>        map to guest = bad user
</span></span></span><span class=line><span class=cl><span class=s>        force directory mode = 0777
</span></span></span><span class=line><span class=cl><span class=s>        force create mode = 0666</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Force master browser elections to choose this server</span>
</span></span><span class=line><span class=cl>        <span class=na>domain master</span> <span class=o>=</span> <span class=s>no
</span></span></span><span class=line><span class=cl><span class=s>        local master = yes
</span></span></span><span class=line><span class=cl><span class=s>        preferred master = yes
</span></span></span><span class=line><span class=cl><span class=s>        os level = 60</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=na>socket options</span> <span class=o>=</span> <span class=s>TCP_NODELAY
</span></span></span><span class=line><span class=cl><span class=s>        read raw = yes
</span></span></span><span class=line><span class=cl><span class=s>        write raw = yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=na>security</span> <span class=o>=</span> <span class=s>user
</span></span></span><span class=line><span class=cl><span class=s>        passdb backend = tdbsam</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------------------------- Logging Options -----------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># log files split per-machine:</span>
</span></span><span class=line><span class=cl>        <span class=na>log file</span> <span class=o>=</span> <span class=s>/var/log/samba/log.%m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># maximum size of 50KB per log file, then rotate:</span>
</span></span><span class=line><span class=cl>        <span class=na>max log size</span> <span class=o>=</span> <span class=s>50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------------------------- Printing Options -----------------------------</span>
</span></span><span class=line><span class=cl><span class=c1># Disable printing altogether</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=na>load printers</span> <span class=o>=</span> <span class=s>no
</span></span></span><span class=line><span class=cl><span class=s>        printcap name = /dev/null
</span></span></span><span class=line><span class=cl><span class=s>        printing = bsd
</span></span></span><span class=line><span class=cl><span class=s>        disable spoolss = yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --------------------------- File System Options ---------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>;       map archive = no</span>
</span></span><span class=line><span class=cl><span class=c1>;       map hidden = no</span>
</span></span><span class=line><span class=cl><span class=c1>;       map read only = no</span>
</span></span><span class=line><span class=cl><span class=c1>;       map system = no</span>
</span></span><span class=line><span class=cl><span class=c1>;       store dos attributes = yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#============================ Share Definitions ==============================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Hidden]</span>
</span></span><span class=line><span class=cl>        <span class=na>comment</span> <span class=o>=</span> <span class=s>I&#39;m a secret!
</span></span></span><span class=line><span class=cl><span class=s>        browsable = no
</span></span></span><span class=line><span class=cl><span class=s>        path = /media/storage/Dropbox
</span></span></span><span class=line><span class=cl><span class=s>        public = no
</span></span></span><span class=line><span class=cl><span class=s>        writable = no
</span></span></span><span class=line><span class=cl><span class=s>        printable = no
</span></span></span><span class=line><span class=cl><span class=s>        write list = @users
</span></span></span><span class=line><span class=cl><span class=s>        guest ok = no</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Anonymous Dropbox]</span>
</span></span><span class=line><span class=cl>        <span class=na>comment</span> <span class=o>=</span> <span class=s>Public File Drop Be Nice
</span></span></span><span class=line><span class=cl><span class=s>        browsable = yes
</span></span></span><span class=line><span class=cl><span class=s>        path = /media/storage/Dropbox
</span></span></span><span class=line><span class=cl><span class=s>        public = yes
</span></span></span><span class=line><span class=cl><span class=s>        writable = yes
</span></span></span><span class=line><span class=cl><span class=s>        printable = no
</span></span></span><span class=line><span class=cl><span class=s>        guest ok = yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Media]</span>
</span></span><span class=line><span class=cl>        <span class=na>comment</span> <span class=o>=</span> <span class=s>Public Media Shares
</span></span></span><span class=line><span class=cl><span class=s>        browsable = yes
</span></span></span><span class=line><span class=cl><span class=s>        path = /media/storage/Media
</span></span></span><span class=line><span class=cl><span class=s>        public = yes
</span></span></span><span class=line><span class=cl><span class=s>        writable = no
</span></span></span><span class=line><span class=cl><span class=s>        printable = no
</span></span></span><span class=line><span class=cl><span class=s>        write list = @users
</span></span></span><span class=line><span class=cl><span class=s>        guest ok = yes</span>
</span></span></code></pre></td></tr></table></div></div></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>