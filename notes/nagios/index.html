<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1>Nagios</h1><div class="post-content"><pre><code>yum install nagios nagios-plugins httpd nagios-plugins-load \
  nagios-plugins-users nagios-plugins-http nagios-plugins-ping \
  nagios-plugins-ssh nagios-plugins-procs nagios-plugins-disk \
  nagios-plugins-smtp nagios-plugins-dns nagios-plugins-tcp -y
</code></pre>
<pre><code>rm -f /etc/httpd/conf.d/welcome.conf
</code></pre>
<p>There is also an undeclared depedency:</p>
<pre><code>yum install perl-Text-ParseWords -y
</code></pre>
<pre><code>htpasswd -c /etc/nagios/passwd nagiosadmin
</code></pre>
<p>Updates are going to be handled by yum exclusively, so the first change is
adjusting <code>check_for_updates=1</code> to <code>0</code>, and for good measure
<code>bare_update_check=0</code> to <code>1</code> in <code>/etc/nagios/nagios.cfg</code>.</p>
<pre><code>systemctl enable httpd.service
systemctl enable nagios.service
systemctl start httpd.service
systemctl start nagios.service
</code></pre>
<p>I had a strange issue where the ping plugin wasn't working with an error like
&quot;CRITICAL - Could not interpret output from ping command&quot; the solution was to
give the setuid bit to the ping program like so:</p>
<pre><code>chmod u+s /usr/bin/ping
</code></pre>
<p>Next steps:</p>
<ul>
<li>Investigate using nginx instead of apache</li>
<li>Setup nagios to be the root of apache</li>
<li>Add SSL to apache</li>
<li>Add a port forward through to nagios</li>
</ul>
<h2 id="permission-fixing">Permission Fixing</h2>
<p>In the event all the editing goo breaks nagios's ability to access files I
wrote the following quick little script to fix the various ownerships and
permissions.</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">#!/bin/bash

# Fix the ownership of the various directories
chown root:root /etc/nagios
chown -R root:nagios /etc/nagios/*
chown root:apache /etc/nagios/passwd

# And fix the permissions on the various files and directories
chmod -R u=rwX,g=rX,o=rX /etc/nagios
chmod 0640 /etc/nagios/private/resource.cfg /etc/nagios/passwd

# And restore any selinux attributes on the files
restorecon -R /etc/nagios
</code></pre>
</div>
</article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
