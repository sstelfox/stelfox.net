<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='NEO dnf install ykpers -y ykpersonalize -m82 Unplug and replug it back in and it should be usable as a smartcard.
NFC / HTTP Auth dnf install ykpers -y ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t= This will hit the API with a URL like:
https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh The API can then return a token that for accessing additional functionality.
Resetting This will wipe all keys, user, and admin pins on the card.
This requires scdaemon and gpg-agent to be working and able to connect to the smartcard.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Yubikey • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='NEO dnf install ykpers -y ykpersonalize -m82 Unplug and replug it back in and it should be usable as a smartcard.
NFC / HTTP Auth dnf install ykpers -y ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t= This will hit the API with a URL like:
https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh The API can then return a token that for accessing additional functionality.
Resetting This will wipe all keys, user, and admin pins on the card.
This requires scdaemon and gpg-agent to be working and able to connect to the smartcard.'>
<meta property='og:url' content='https://stelfox.net/notes/yubikey/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta property='article:tag' content='linux'><meta property='article:tag' content='security'><meta property='article:published_time' content='2017-10-10T00:28:32Z'/><meta property='article:modified_time' content='2017-10-10T00:28:32Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>Yubikey • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/yubikey/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-notes'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Yubikey</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-10-10T00:28:32Z'>2017, Oct 10</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <h2 id="neo">NEO</h2>
<pre><code>dnf install ykpers -y
ykpersonalize -m82
</code></pre><p>Unplug and replug it back in and it should be usable as a smartcard.</p>
<h2 id="nfc--http-auth">NFC / HTTP Auth</h2>
<pre><code>dnf install ykpers -y
ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t=
</code></pre><p>This will hit the API with a URL like:</p>
<pre><code>https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh
</code></pre><p>The API can then return a token that for accessing additional functionality.</p>
<h2 id="resetting">Resetting</h2>
<p>This will wipe all keys, user, and admin pins on the card.</p>
<p>This requires scdaemon and gpg-agent to be working and able to connect to the
smartcard. It needs to be plugged into the computer and requires GPG version
2.0.22 or later. On yubikeys prior to the YubiKey4 check the version and
confirm it's version 1.0.6 or later using the following command:</p>
<pre><code>gpg-connect-agent --hex &quot;scd apdu 00 f1 00 00&quot; /bye
</code></pre><p>You'll get back a line that looks like:</p>
<pre><code>D[0000]  01 00 06 90 00
</code></pre><p>Indicating version 1.0.6. To reset the applet create a file with the following
contents:</p>
<pre><code>/hex
scd serialno
scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
scd apdu 00 e6 00 00
scd apdu 00 44 00 00
/echo Card has been successfully reset.
/bye
</code></pre><p>And cat it into <code>gpg-connect-agent</code> like so:</p>
<pre><code>cat FILE | gpg-connect-agent
</code></pre><h2 id="using-as-a-rng-source">Using as a RNG source</h2>
<p>This may allow me to use the yubikey's hardware RNG to generate entropy on my
host:</p>
<p><a href="https://github.com/infincia/TokenTools">https://github.com/infincia/TokenTools</a></p>
<h2 id="vulnerability">Vulnerability</h2>
<p>A vulnerability was published around YubiKey NEOs use as smartcards and
<a href="https://developers.yubico.com/ykneo-openpgp/SecurityAdvisory%202015-04-14.html">Yubico's</a> response is top notch. I recommend following the steps in
checking on your key to see if you're affected.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a>, <a class='tag' href='/tags/security/'>security</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/gpg-process-notes/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>GPG Process Notes</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/aide/'>
        <span class='screen-reader-text'>Next post: </span>AIDE<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2020 Sam Stelfox </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.c3bcf2df.js'></script>

</body>

</html>

