<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="NEO 1 2 $ dnf install ykpers -y $ ykpersonalize -m82 Unplug and plug it back in and it should be usable as a smartcard.
NFC / HTTP Auth 1 2 $ dnf install ykpers -y $ ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t= This will hit the API with a URL like https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh.
The API can then return a token that for accessing additional functionality.
ResettingThis will wipe all keys, user, and admin pins on the card."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,operations,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/yubikey/><title>Yubikey :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Yubikey"><meta itemprop=description content="NEO 1 2 $ dnf install ykpers -y $ ykpersonalize -m82 Unplug and plug it back in and it should be usable as a smartcard.
NFC / HTTP Auth 1 2 $ dnf install ykpers -y $ ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t= This will hit the API with a URL like https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh.
The API can then return a token that for accessing additional functionality.
ResettingThis will wipe all keys, user, and admin pins on the card."><meta itemprop=datePublished content="2017-10-10T00:28:32+00:00"><meta itemprop=dateModified content="2017-10-10T00:28:32+00:00"><meta itemprop=wordCount content="371"><meta itemprop=keywords content="Linux,Operations,Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="Yubikey"><meta name=twitter:description content="NEO 1 2 $ dnf install ykpers -y $ ykpersonalize -m82 Unplug and plug it back in and it should be usable as a smartcard.
NFC / HTTP Auth 1 2 $ dnf install ykpers -y $ ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t= This will hit the API with a URL like https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh.
The API can then return a token that for accessing additional functionality.
ResettingThis will wipe all keys, user, and admin pins on the card."><meta property="article:published_time" content="2017-10-10 00:28:32 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/yubikey/>Yubikey</a></h2><div class=post-content><h2 id=neo>NEO</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dnf install ykpers -y
</span></span><span class=line><span class=cl><span class=gp>$</span> ykpersonalize -m82
</span></span></code></pre></td></tr></table></div></div><p>Unplug and plug it back in and it should be usable as a smartcard.</p><h2 id=nfc--http-auth>NFC / HTTP Auth</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dnf install ykpers -y
</span></span><span class=line><span class=cl><span class=gp>$</span> ykpersonalize -n https://api.stelfox.net/sessions/yknfc?t<span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p>This will hit the API with a URL like <code>https://api.stelfox.net/session/yknfc?t=ccccccuddclhrkuvurcufviveulljleihvreukifegjh</code>.</p><p>The API can then return a token that for accessing additional functionality.</p><h2 id=resetting>Resetting</h2><p>This will wipe all keys, user, and admin pins on the card.</p><p>This requires scdaemon and gpg-agent to be working and able to connect to the smartcard. It needs to be plugged into the computer and requires GPG version 2.0.22 or later. On yubikeys prior to the YubiKey4 check the version and confirm it's version 1.0.6 or later using the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> gpg-connect-agent --hex <span class=s2>&#34;scd apdu 00 f1 00 00&#34;</span> /bye
</span></span><span class=line><span class=cl><span class=go>D[0000]  01 00 06 90 00
</span></span></span></code></pre></td></tr></table></div></div><p>Indicating version 1.0.6. To reset the applet you can use the following manual hex commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cat &lt;&lt;EOF <span class=p>|</span> gpg-connect-agent
</span></span><span class=line><span class=cl><span class=go>/hex
</span></span></span><span class=line><span class=cl><span class=go>scd serialno
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 e6 00 00
</span></span></span><span class=line><span class=cl><span class=go>scd apdu 00 44 00 00
</span></span></span><span class=line><span class=cl><span class=go>/echo Card has been successfully reset.
</span></span></span><span class=line><span class=cl><span class=go>/bye
</span></span></span></code></pre></td></tr></table></div></div><h2 id=using-as-a-rng-source>Using as a RNG source</h2><ul><li><a href=https://github.com/infincia/TokenTools>This may allow me to use the Yubikey's hardware RNG to generate entropy on my host</a></li></ul><h2 id=vulnerability>Vulnerability</h2><p>A vulnerability was published around YubiKey NEOs use as smartcards and <a href=https://developers.yubico.com/ykneo-openpgp/SecurityAdvisory%202015-04-14.html>Yubico's</a> response is top notch. I recommend following the steps in checking on your key to see if you're affected.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/operations/>operations</a></span>
<span class=tag><a href=https://stelfox.net/tags/security/>security</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=fbd8ca38d421539154d91c5d7396464201f62ccb target=_blank rel=noopener>fbd8ca38</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>