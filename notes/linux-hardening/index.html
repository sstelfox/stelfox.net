<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
PLEASE NOTE: This guide was developed for Red Had Based architectures, specifically CentOS 5, and Fedora 16+. A lot of the information here is generally solid principles but you may need to adapt it to your distribution."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,hardening,linux,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/linux-hardening/><title>Linux Hardening :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Linux Hardening"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
PLEASE NOTE: This guide was developed for Red Had Based architectures, specifically CentOS 5, and Fedora 16+. A lot of the information here is generally solid principles but you may need to adapt it to your distribution."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="2529"><meta itemprop=keywords content="Hardening,Linux,Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Hardening"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
PLEASE NOTE: This guide was developed for Red Had Based architectures, specifically CentOS 5, and Fedora 16+. A lot of the information here is generally solid principles but you may need to adapt it to your distribution."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/linux-hardening/>Linux Hardening</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.</strong></em></p><p>PLEASE NOTE: This guide was developed for Red Had Based architectures, specifically CentOS 5, and Fedora 16+. A lot of the information here is generally solid principles but you may need to adapt it to your distribution.</p><p>Hardening of all my servers is the largest piece IMHO to the <a href=https://en.wikipedia.org/wiki/Defence_in_depth>defence in depth</a>. It brings to them each a strength to stand on their own. I want to be able to plug each and everyone on a raw internet connection and feel safe knowing that they won't be compromised.</p><p>In the event that any section of my defence fails, I'll know that the rest of my systems are strong enough to hopefully be protected from whatever the weak link was.</p><p>This section of my documentation provides a quick overview of procedures to harden a system to make sure I never miss a step.</p><p>This hardening guide started out as a summary and a few updates to the <a href=http://www.nsa.gov/ia/_files/os/redhat/NSA_RHEL_5_GUIDE_v4.2.pdf>NSA RedHat 5 Operating System Security Guidelings</a>. Since then it has grown to include a lot of services that were not mentioned anywhere in there, and a few best practices that I've developed myself over the years of managing Linux boxes.</p><p>I've started including information from <a href=http://web.nvd.nist.gov/view/ncp/repository>National Vulnerability Database (NVD) National Checklist Program Repository</a> hosted by NIST. They aggregate some useful information from a few sites including the <a href=http://benchmarks.cisecurity.org/en-us/>Center for Internet Security (CIS) Security Benchmarks</a>. One more site I've got some information from is the <a href=http://www.sans.org/reading_room/>SANS Information Security Reading Room</a>.</p><p>These have all been listed here to give them some credit towards the following security guidelines. If you doubt anything I've mentioned here I'd recommend you go look through these sites.</p><h2 id=general-principles>General Principles</h2><ul><li>Encrypt Transmitted Data Whenever Possible</li><li>Minimize Software to Minimize Vulnerability</li><li>Run Different Network Services on Separate Systems</li><li>Configure Security Tools to Improve System Robustness</li><li>Least Privilege</li></ul><h2 id=review-of-the-security-notes>Review of the Security Notes</h2><p>This section is mostly a TODO for myself. To keep this as up to date and relevant as possible I need to annually review the following information:</p><ul><li>Any pre-bootloader changes include BIOS, EFI, RAID, etc.</li><li>OS install instructions</li><li>Applications to be installed, possibly sorted by machine function</li><li>Hardening guidelines starting with OS and including applications</li><li>Instructions for validating the configuration</li><li>Ensure exceptions are documented in the ticket for the device/machine</li><li>Regularly validate the configuration, this should be automated if possible</li></ul><h2 id=hardware>Hardware</h2><p>Hardware and BIOS's change from machine to machine but there are some quick best practices that should be followed. The BIOS should be hardened and physical security should be assessed.</p><h2 id=installation-notes>Installation Notes</h2><ul><li>Follow the <a href=/notes/partitioning/>Partitioning</a> guidelines.</li><li>Ensure you set the date correctly so that the remote certificates can have their expiration properly checked</li><li>Set a sufficiently strong boot loader password</li><li>Set a sufficiently strong root password</li><li>Install the absolute minimum required packages (Service specific packages can be installed afterwards)</li><li>Include the updates repository, so there is never any initial out of date packages</li></ul><h2 id=firewall>Firewall</h2><p>A strong firewall does not just protect against incoming attacks but also prevents a machine from connecting to things it shouldn't. In the event of a partially compromised system, an egress ruleset can help prevent an attacker from using the machine as a springboard to launch further attacks on the internal networks.</p><p>IPv4 and IPv6 traffic have separate firewalls. I have examples and a decent base config on the <a href=/notes/iptables/>IPTables</a> page.</p><h2 id=networking>Networking</h2><p>Follow the <a href=/notes/network/>Network</a> guide to configure a static address and gateway.</p><p>Update "/etc/resolv.conf" to include the proper domain and nameserver. It will look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>search internal.example.org
</span></span><span class=line><span class=cl>nameserver 4.2.2.2
</span></span><span class=line><span class=cl>nameserver 8.8.8.8
</span></span></code></pre></td></tr></table></div></div><p>Verify hostname / domain in "/etc/sysconfig/network". An example is given below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>NETWORKING</span><span class=o>=</span>yes
</span></span><span class=line><span class=cl><span class=nv>HOSTNAME</span><span class=o>=</span>testing.internal.example.org
</span></span></code></pre></td></tr></table></div></div><p>Edit "/etc/hosts". Remove all the IPv6 loopback entries with the exception of "localhost6" and all of the IPv4 addresses with the exception of "localhost". "127.0.0.1" should also have entries for the FQDN of this server and just the hostname. Other extraneous entries should be removed unless absolutely necessary.</p><pre tabindex=0><code class=language-hosts data-lang=hosts>127.0.0.1       testing.internal.example.org testing localhost localhost4
::1             testing.internal.example.org testing localhost localhost6
</code></pre><h2 id=logging>Logging</h2><p>You'll want to make sure you configure <a href=/notes/rsyslog/>RSyslog</a>, <a href=/notes/logrotate/>Logrotate</a>, and <a href=/notes/logwatch/>Logwatch</a> according to their appropriate guides. Logwatch is not installed in the minimum install and should be installed.</p><h3 id=configure-roots-mail-recipient>Configure Root's Mail Recipient</h3><p>Add the line to following line to "/etc/aliases", replacing <code>administrator@example.tld</code> with an administrator's email address. This is where logs will be emailed.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>root:     administrator@example.tld
</span></span></code></pre></td></tr></table></div></div><p>As root run the "newaliases" command which will update the binary database of mail recipients.</p><h2 id=services>Services</h2><p>Review the list of services running on the machine with the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> systemctl --type<span class=o>=</span>service
</span></span></code></pre></td></tr></table></div></div><p>Pay special attention to any that is listed as "running", these are the always on services that start up on boot. If it says "exited" it has started up on boot finished whatever part in the boot process it took care of and then properly exited. The latter need to be audited as well, if they're not needed they should not be executing on boot.</p><p>Whenever you find a service that shouldn't be started on boot run the following command replacing "rpcbind.service" with the service you would like to disable.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> systemctl disable rpcbind.service
</span></span><span class=line><span class=cl><span class=gp>$</span> systemctl stop rpcbind.service
</span></span></code></pre></td></tr></table></div></div><p>If it's particularly pesky about not going away you may need to mask it. This will essentially create a symlink of the service to "/dev/null", allowing it to attempt to execute without actually accomplishing anything.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> systemctl mask rpcbind.service
</span></span></code></pre></td></tr></table></div></div><p>To re-enable a service you'll want to execute the following commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> systemctl <span class=nb>enable</span> rpcbind.service
</span></span><span class=line><span class=cl><span class=gp>$</span> systemctl start rpcbind.service
</span></span></code></pre></td></tr></table></div></div><p>If you masked the service you'll need to unmask it before re-enabling it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> systemctl unmask rpcbind.service
</span></span></code></pre></td></tr></table></div></div><p>You need to be aware that the mask / unmask command is a stronger version of "disable", disable just prevents systemd from starting the service on boot. "mask" links the service file to "/dev/null" preventing manual activation as well as other services attempting to start it as requirements.</p><p>If you mask a critical service that the machine need to boot it will fail and you'll need to fix this by hand in the debug shell.</p><h3 id=all-server-services>All Server Services</h3><p>On all of my servers I configure:</p><ul><li><a href=/notes/sshd/>SSHd</a> (If you follow this guide, you won't be able to SSH into the box until users and groups have been configured)</li><li><a href=/notes/ntpd/>NTPd</a> or <a href=/notes/chronyd/>Chronyd</a> (pick your preference)</li><li><a href=/notes/rsyslog/>RSyslog</a></li></ul><h2 id=updates>Updates</h2><p>Updates regardless of whether KSplice is being used should be done as soon as possible. For the most part there shouldn't be any reason not to update automatically unless you are using untrusted repositories.</p><p>There is a daemon available yum-updatesd in the Fedora repositories which can be configured to notify administrators of new packages and optionally install them automatically.</p><h3 id=updating-manually>Updating Manually</h3><p>Updating the system manually can be performed using the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> yum update
</span></span></code></pre></td></tr></table></div></div><h2 id=init-process>Init Process</h2><p>Ensure that root logins are only permitted on appropriate terminals in "/etc/securetty". An example used by me is the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>tty1
</span></span><span class=line><span class=cl>tty2
</span></span><span class=line><span class=cl>tty3
</span></span></code></pre></td></tr></table></div></div><p>If I'm going to access the system of the serial console I'd want to add "console" to that as well.</p><p>The init process by default starts with that pretty plymouth graphical boot loader, to change it back to the default linux boot sequence that is actually verbose and useful you need to make a few changes to the "/etc/sysconfig/init" file. I use the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>BOOTUP</span><span class=o>=</span>verbose
</span></span><span class=line><span class=cl><span class=nv>AUTOSWAP</span><span class=o>=</span>no
</span></span><span class=line><span class=cl><span class=nv>ACTIVE_CONSOLES</span><span class=o>=</span>/dev/tty<span class=o>[</span>1-3<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>SINGLE</span><span class=o>=</span>/sbin/sulogin
</span></span></code></pre></td></tr></table></div></div><p>The changes actually made reduces the number of active TTYs to 3 from 6, requires a root login to get into single user mode, and disables the pretty color status display when in text mode during boot up.</p><p>The other change that needs to be made is in the default grub options in "/etc/default/grub". Remove "rhgb" and "quiet" from the "GRUB_CMDLINE_LINUX" variable. Strictly speaking you don't need to remove quiet, however, it allows the kernel to print out it's boot messages which can help debug some lower level issues and I generally find it useful. After making the change you'll need to run <code>grub2-mkconfig -o /boot/grub2/grub.cfg</code> as root.</p><p>One thing that I have noticed is that as of grub2 if a boot password is defined you need to add "--unrestricted" to the menu entry if you want to boot the menu entry without a super user password. I've done this in "/etc/grub.d/10_linux" by adding "--unrestricted" to the "CLASS" environment variable around line 29 and rebuilding the grub config.</p><h2 id=sudo>Sudo</h2><p>Sudo is one of those things that I need to go through and properly restrict. Since I'm usually the lone administrator or am very close with the few others on servers and I trust the people given sudo permissions with global root like permissions.</p><p>This definitely has larger security implications but here is how to configure that. This grants unlimited sudo privileges to any user in the sudoers group. They still need to authenticate however.</p><p>Edit "/etc/sudoers" adding the line:</p><pre tabindex=0><code class=language-sudoers data-lang=sudoers>%sudoers                ALL=(ALL)        ALL
</code></pre><h2 id=users>Users</h2><h3 id=password-requirements>Password Requirements</h3><p>Update the minimum user password to 10 characters in "/etc/login.defs".</p><h3 id=creation>Creation</h3><p>If local authentication is used, create any users that will need access to the system using the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>useradd &lt;username&gt;
</span></span><span class=line><span class=cl>passwd &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><p>If the user isn't available locally to enter their own password, a hash from another system can be extracted and dropped into place or alternatively a very strong temporary password can be set and provided to the user through secure means. You can then run the following command to force the user to change their password the next time they login:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> chage -d <span class=m>0</span> &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><h3 id=securing-system-users>Securing System Users</h3><p>Review "/etc/passwd" to ensure all non-user accounts have their account shells set to "/sbin/nologin" with the exception of "halt", "shutdown", "sync" which should be "/sbin/halt", "/sbin/shutdown", and "/bin/sync" respectively.</p><p><a href=/notes/mysql/>Mysql</a> creates it's user with "/bin/bash" as the shell which shouldn't be (this is just an example).</p><h3 id=system-wide-settings>System Wide Settings</h3><p>Edit "/etc/profile", find "HISTSIZE" replace that line with these couple of lines.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>readonly</span> <span class=nv>HISTSIZE</span><span class=o>=</span><span class=m>50</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>export</span> <span class=nb>readonly</span> <span class=nv>TMOUT</span><span class=o>=</span><span class=m>900</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>export</span> <span class=nb>readonly</span> <span class=nv>HISTFILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.bash_history&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=groups>Groups</h2><h3 id=creation-1>Creation</h3><p>Create the sudoers and sshers group</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> groupadd sudoers -g <span class=m>400</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> groupadd sshers -g <span class=m>401</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=add-users>Add Users</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> useradd &lt;username&gt;
</span></span><span class=line><span class=cl><span class=gp>$</span> passwd &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><p>Any users that are going to be SSH'ing into the server should be added to the "sshers" group. This includes root if necessary (which by default is only available to pubkey based authentication if you follow this guide).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> usermod -a -G sshers &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><p>Any users that NEED sudo permission should be added to the "sudoers" group like so:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> usermod -a -G sudoers &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><p>You can do both at the same time like so:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> usermod -a -G sshers,sudoers &lt;username&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=system-hardening>System Hardening</h2><ul><li>Change the permissions of the rpm binary "/bin/rpm" to "0700"</li><li>Remove suid privileges on "/bin/mount" and "/bin/umount" using the following command: "chmod a-s /bin/mount /bin/umount"</li><li>Create "/etc/cron.allow" and "/etc/at.allow" putting "root" in both of them. Set the permissions on the files to "600".</li><li>Restrict permissions on all of the cron tasks using the following command: "chmod -R go-rwx /etc/cron.* /etc/crontab"</li><li>Restrict boot configurations to only be readable / writable by root "chmod 600 /etc/grub.conf"</li><li>Restrict access to the boot scripts "chmod -R go-rwx /etc/rc.d"</li><li>Change the owner and permission of the sudo binary to be owned by "root:sudoers" and have permissions "750"</li></ul><p>You'll want to verify that that there are not more SUID or GUID flags set than absolutely necessary. You can find all of the files with these flags set with the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-21-1><a class=lnlinks href=#hl-21-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> find / -type f <span class=se>\(</span> -perm -04000 -o -perm -02000 <span class=se>\)</span>
</span></span></code></pre></td></tr></table></div></div><p>The same goes for unowned files as there should never be any of these:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-22-1><a class=lnlinks href=#hl-22-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> find / <span class=se>\(</span> -nouser -o -nogroup <span class=se>\)</span> -print
</span></span></code></pre></td></tr></table></div></div><p>Something that should be considered is security limits per user. This can not only be used to prevent users from abusing the system but to prevent a user accidentally fork bombing a system or causing other kinds of havoc. These settings can be found in "/etc/security/limits.conf".</p><h3 id=checklist>Checklist</h3><ul><li>Network<ul><li>If DHCP is used, minimize accepted options "/etc/dhclient.conf"<ul><li>Accept only IP, Router, DNS</li><li>Override domain name</li></ul></li></ul></li><li>Package updating<ul><li>Install additional packages<ul><li>aide</li></ul></li></ul></li><li>Disable USB Support<ul><li>Disable usb-storage kernel module in "/etc/modules.d/blacklist.conf"</li><li>If USB devices are completely unecessary, disable USB completely with the "nousb" option in kernel boot options</li></ul></li><li>Set "kernel.randomize_va_space" to 2, 1 if that's not possible</li><li>Disable Rebooting When 'ctrl-alt-del' is Pressed<ul><li>"/etc/init/control-alt-delete.conf": -exec /sbin/shutdown -r now "Control-Alt-Delete pressed"</li></ul></li></ul><h3 id=updating-software>Updating Software</h3><ul><li>Repository Configuration<ul><li>yum install yum-plugin-fastestmirror yum-plugin-security yum-presto<br>yum-plugin-changelog yum-plugin-protectbase -y</li><li>Configure local repository if available</li><li>If using the btrfs filesystem install yum-plugin-fs-snapshot</li></ul></li><li>Manual Software Update<ul><li>Manual verification of installed GPG key with remote resource</li><li>Verify gpgcheck is enabled in all yum configuration files</li></ul></li><li>Configuring Automatic Updates<ul><li>Fedora Update & Security Check Script</li></ul></li></ul><h3 id=permission-verification>Permission Verification</h3><ul><li>Verify Permissions on passwd, shadow, group, and gshadow Files</li><li>Verify All World-Writeable Directories Have Sticky Bits Set</li><li>Verify All World Writeable Directories Have Proper Ownership</li><li>Find Unauthorized World-Writeable Files</li><li>Find Unauthorized SUID/SGID System Executables</li><li>Find and Repair Unowned Files</li><li>Restrict access to init files only to root "/etc/rc.d"</li><li>Restrict Permissions on Files Used by cron</li></ul><h3 id=restrict-dangerous-execution-patterns>Restrict Dangerous Execution Patterns</h3><ul><li>Set Daemon umask to "027"<ul><li>"/etc/init.d/functions": "umask 022" -> "umask 027"</li></ul></li><li>Disable Core Dumps<ul><li>"/etc/security/limits.conf": "+* hard core 0"</li><li>"/etc/sysctl.conf": "+fs.suid_dumpable = 0"</li></ul></li><li>Disable Prelink (if turned on)<ul><li>"/etc/sysconfig/prelink": "PRELINKING=yes" -> "PRELINKING=no"</li><li>"/usr/sbin/prelink -ua"</li><li>"yum remove prelink -y"</li></ul></li></ul><h3 id=restrict-password-based-login>Restrict Password Based Login</h3><ul><li>Limit "su" Access to "root" and the "wheel" Group<ul><li>"chgrp wheel /bin/su && chmod o-rx /bin/su"</li></ul></li><li>Configure sudo to Improve Auditing of Root Access<ul><li>Create "sudoers" Group and Allow it to Use sudo</li></ul></li><li>Verify Proper Storage and Existence of Password Hashes</li><li>Verify No Non-root Accounts Have UID 0</li></ul><h3 id=account-security>Account Security</h3><ul><li>Create a Unique Default Group for Each User</li><li>Create and Maintain a Group Containing All Human Users<ul><li>"users" Group</li></ul></li><li>Set Password Quality Requirements<ul><li>Either pam_cracklib or pam_passwdqc</li></ul></li><li>Set Lockouts for Failed Password Attempts<ul><li>pam_tally2</li></ul></li><li>Set Password Hashing Algorithm to SHA-512<ul><li>"/etc/pam.d/system-auth": Ensure: "password sufficient pam_unix.so {sha512}"</li><li>"/etc/login.defs": Ensure: "ENCRYPT_METHOD SHA512"</li><li>"/etc/libuser.conf": Ensure: "crypt_style = sha512"</li></ul></li><li>Limit Password Reuse<ul><li>"/etc/pam.d/system-auth": "password sufficient pam_unix.so" + (existing options) remember=5</li></ul></li><li>Ensure User Home Directories Are Not Group-Writable or World-Readable</li><li>Ensure User's Hidden Files Are Not World-Writeable</li><li>Configure User umask Values<ul><li>"/etc/profile": "umask 022" -> "umask 027"</li></ul></li><li>Use a Centralized Authentication Service</li><li>Ensure there are no dangerous directories in root's path (relative or world-writable)</li></ul><h3 id=selinux>SELinux</h3><ul><li>Ensure SELinux is Properly Enabled</li><li>Disable and Remove SETroubleshoot if Possible</li><li>Disable MCS Translation Service (mcstrans) if Possible</li><li>Configure Restorecon Service (restorecond)</li><li>Check for Unconfined Daemons</li><li>Check for Unlabeled Device Files</li><li>Debug any SELinux Policy Errors</li><li>Strengthen the Default SELinux Boolean Configuration</li></ul><h3 id=networkfirewall-configuration>Network/Firewall Configuration</h3><ul><li>Ensure System is Not Acting as a Network Sniffer</li><li>Remove Wireless Hardware if Possible</li><li>Disable Wireless Through Software Configuration if Possible</li></ul><h3 id=logging-and-auditing>Logging and Auditing</h3><ul><li>Configure auditd's Data Retention</li><li>Enable Auditing for Processes Which Start Prior to the Audit Daemon</li><li>Configure auditd Rules for Comprehensive Auditing</li><li>Configure Audit Log aureport To Send Daily Emails</li></ul><h3 id=misc>Misc</h3><ul><li>Add Local <a href=/notes/certificate-authority/>Certificate Authority</a>'s Public Key to the Trusted Store</li><li>Harden sysctl.conf Values</li></ul><h3 id=services-1>Services</h3><ul><li>Configure SMART Disk Monitoring</li><li>Disable at & anacron if Possible</li><li>Configure an MTA if necessary</li></ul></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/hardening/>hardening</a></span>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/security/>security</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=05d8865c5bb4f32ad03ef2fb02f70765921e7d67 target=_blank rel=noopener>05d8865c</a> @ 2024-07-16</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>