<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
ServerInstallationInstall the package.
yum install mysql-server -y Set to start up auto-magically and get it going now.
systemctl enable mysqld.service systemctl start mysqld.service Run the quick and dirty secure installation script that comes with the server."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/mysql/><title>MySQL :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="MySQL"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
ServerInstallationInstall the package.
yum install mysql-server -y Set to start up auto-magically and get it going now.
systemctl enable mysqld.service systemctl start mysqld.service Run the quick and dirty secure installation script that comes with the server."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="2197"><meta name=twitter:card content="summary"><meta name=twitter:title content="MySQL"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
ServerInstallationInstall the package.
yum install mysql-server -y Set to start up auto-magically and get it going now.
systemctl enable mysqld.service systemctl start mysqld.service Run the quick and dirty secure installation script that comes with the server."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/mysql/>MySQL</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><h2 id=server>Server</h2><h3 id=installation>Installation</h3><p>Install the package.</p><pre tabindex=0><code>yum install mysql-server -y
</code></pre><p>Set to start up auto-magically and get it going now.</p><pre tabindex=0><code>systemctl enable mysqld.service
systemctl start mysqld.service
</code></pre><p>Run the quick and dirty secure installation script that comes with the server.
The questions are pretty straight-forward just set a secure password when it
asks for it.</p><pre tabindex=0><code>mysql_secure_installation
</code></pre><h3 id=configuration>Configuration</h3><p>Before applying the following configuration file in <code>/etc/my.cnf</code>. Safely
shutdown the server and delete the logfiles <code>/var/lib/mysql/ib_logfile*</code>. This
configuration file will change the size of the log buffer and it will cause an
error when starting the server backup that will look like:</p><pre tabindex=0><code>InnoDB: Error: log file ./ib_logfile0 is of a different size 0 5242880 bytes
InnoDB: than specified in the .cnf file 0 67108864 bytes!
</code></pre><p>There is still one major security feature that I haven't added to this
configuration yet. Running the mysql daemon in a chroot environment. Details on
setting up a chroot environment for mysql can be found, <a href=http://www.symantec.com/connect/articles/securing-mysql-step-step>here</a>, and
<a href=http://www.webhostingskills.com/articles/mysql_in_a_chrooted_environment>here</a>.</p><p>Detailed information on all of the configuration options can be found
<a href=http://dev.mysql.com/doc/refman/5.5/en/dynamic-system-variables.html>here</a>. There is a script that can assist in tuning larger production
databases I've stored <a href=https://stelfox.net/notes/mysql-tuning/>here</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>  1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>  2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>  3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>  4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>  5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>  6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>  7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>  8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>  9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10> 10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11> 11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12> 12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13> 13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14> 14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15> 15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16> 16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17> 17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18> 18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19> 19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20> 20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21> 21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22> 22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23> 23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24> 24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25> 25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26> 26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27> 27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28> 28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29> 29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30> 30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31> 31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32> 32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33> 33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34> 34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35> 35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36> 36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37> 37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38> 38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39> 39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40> 40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41> 41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42> 42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43> 43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44> 44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45> 45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46> 46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47> 47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48> 48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49> 49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50> 50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51> 51</a>
</span><span class=lnt id=hl-4-52><a class=lnlinks href=#hl-4-52> 52</a>
</span><span class=lnt id=hl-4-53><a class=lnlinks href=#hl-4-53> 53</a>
</span><span class=lnt id=hl-4-54><a class=lnlinks href=#hl-4-54> 54</a>
</span><span class=lnt id=hl-4-55><a class=lnlinks href=#hl-4-55> 55</a>
</span><span class=lnt id=hl-4-56><a class=lnlinks href=#hl-4-56> 56</a>
</span><span class=lnt id=hl-4-57><a class=lnlinks href=#hl-4-57> 57</a>
</span><span class=lnt id=hl-4-58><a class=lnlinks href=#hl-4-58> 58</a>
</span><span class=lnt id=hl-4-59><a class=lnlinks href=#hl-4-59> 59</a>
</span><span class=lnt id=hl-4-60><a class=lnlinks href=#hl-4-60> 60</a>
</span><span class=lnt id=hl-4-61><a class=lnlinks href=#hl-4-61> 61</a>
</span><span class=lnt id=hl-4-62><a class=lnlinks href=#hl-4-62> 62</a>
</span><span class=lnt id=hl-4-63><a class=lnlinks href=#hl-4-63> 63</a>
</span><span class=lnt id=hl-4-64><a class=lnlinks href=#hl-4-64> 64</a>
</span><span class=lnt id=hl-4-65><a class=lnlinks href=#hl-4-65> 65</a>
</span><span class=lnt id=hl-4-66><a class=lnlinks href=#hl-4-66> 66</a>
</span><span class=lnt id=hl-4-67><a class=lnlinks href=#hl-4-67> 67</a>
</span><span class=lnt id=hl-4-68><a class=lnlinks href=#hl-4-68> 68</a>
</span><span class=lnt id=hl-4-69><a class=lnlinks href=#hl-4-69> 69</a>
</span><span class=lnt id=hl-4-70><a class=lnlinks href=#hl-4-70> 70</a>
</span><span class=lnt id=hl-4-71><a class=lnlinks href=#hl-4-71> 71</a>
</span><span class=lnt id=hl-4-72><a class=lnlinks href=#hl-4-72> 72</a>
</span><span class=lnt id=hl-4-73><a class=lnlinks href=#hl-4-73> 73</a>
</span><span class=lnt id=hl-4-74><a class=lnlinks href=#hl-4-74> 74</a>
</span><span class=lnt id=hl-4-75><a class=lnlinks href=#hl-4-75> 75</a>
</span><span class=lnt id=hl-4-76><a class=lnlinks href=#hl-4-76> 76</a>
</span><span class=lnt id=hl-4-77><a class=lnlinks href=#hl-4-77> 77</a>
</span><span class=lnt id=hl-4-78><a class=lnlinks href=#hl-4-78> 78</a>
</span><span class=lnt id=hl-4-79><a class=lnlinks href=#hl-4-79> 79</a>
</span><span class=lnt id=hl-4-80><a class=lnlinks href=#hl-4-80> 80</a>
</span><span class=lnt id=hl-4-81><a class=lnlinks href=#hl-4-81> 81</a>
</span><span class=lnt id=hl-4-82><a class=lnlinks href=#hl-4-82> 82</a>
</span><span class=lnt id=hl-4-83><a class=lnlinks href=#hl-4-83> 83</a>
</span><span class=lnt id=hl-4-84><a class=lnlinks href=#hl-4-84> 84</a>
</span><span class=lnt id=hl-4-85><a class=lnlinks href=#hl-4-85> 85</a>
</span><span class=lnt id=hl-4-86><a class=lnlinks href=#hl-4-86> 86</a>
</span><span class=lnt id=hl-4-87><a class=lnlinks href=#hl-4-87> 87</a>
</span><span class=lnt id=hl-4-88><a class=lnlinks href=#hl-4-88> 88</a>
</span><span class=lnt id=hl-4-89><a class=lnlinks href=#hl-4-89> 89</a>
</span><span class=lnt id=hl-4-90><a class=lnlinks href=#hl-4-90> 90</a>
</span><span class=lnt id=hl-4-91><a class=lnlinks href=#hl-4-91> 91</a>
</span><span class=lnt id=hl-4-92><a class=lnlinks href=#hl-4-92> 92</a>
</span><span class=lnt id=hl-4-93><a class=lnlinks href=#hl-4-93> 93</a>
</span><span class=lnt id=hl-4-94><a class=lnlinks href=#hl-4-94> 94</a>
</span><span class=lnt id=hl-4-95><a class=lnlinks href=#hl-4-95> 95</a>
</span><span class=lnt id=hl-4-96><a class=lnlinks href=#hl-4-96> 96</a>
</span><span class=lnt id=hl-4-97><a class=lnlinks href=#hl-4-97> 97</a>
</span><span class=lnt id=hl-4-98><a class=lnlinks href=#hl-4-98> 98</a>
</span><span class=lnt id=hl-4-99><a class=lnlinks href=#hl-4-99> 99</a>
</span><span class=lnt id=hl-4-100><a class=lnlinks href=#hl-4-100>100</a>
</span><span class=lnt id=hl-4-101><a class=lnlinks href=#hl-4-101>101</a>
</span><span class=lnt id=hl-4-102><a class=lnlinks href=#hl-4-102>102</a>
</span><span class=lnt id=hl-4-103><a class=lnlinks href=#hl-4-103>103</a>
</span><span class=lnt id=hl-4-104><a class=lnlinks href=#hl-4-104>104</a>
</span><span class=lnt id=hl-4-105><a class=lnlinks href=#hl-4-105>105</a>
</span><span class=lnt id=hl-4-106><a class=lnlinks href=#hl-4-106>106</a>
</span><span class=lnt id=hl-4-107><a class=lnlinks href=#hl-4-107>107</a>
</span><span class=lnt id=hl-4-108><a class=lnlinks href=#hl-4-108>108</a>
</span><span class=lnt id=hl-4-109><a class=lnlinks href=#hl-4-109>109</a>
</span><span class=lnt id=hl-4-110><a class=lnlinks href=#hl-4-110>110</a>
</span><span class=lnt id=hl-4-111><a class=lnlinks href=#hl-4-111>111</a>
</span><span class=lnt id=hl-4-112><a class=lnlinks href=#hl-4-112>112</a>
</span><span class=lnt id=hl-4-113><a class=lnlinks href=#hl-4-113>113</a>
</span><span class=lnt id=hl-4-114><a class=lnlinks href=#hl-4-114>114</a>
</span><span class=lnt id=hl-4-115><a class=lnlinks href=#hl-4-115>115</a>
</span><span class=lnt id=hl-4-116><a class=lnlinks href=#hl-4-116>116</a>
</span><span class=lnt id=hl-4-117><a class=lnlinks href=#hl-4-117>117</a>
</span><span class=lnt id=hl-4-118><a class=lnlinks href=#hl-4-118>118</a>
</span><span class=lnt id=hl-4-119><a class=lnlinks href=#hl-4-119>119</a>
</span><span class=lnt id=hl-4-120><a class=lnlinks href=#hl-4-120>120</a>
</span><span class=lnt id=hl-4-121><a class=lnlinks href=#hl-4-121>121</a>
</span><span class=lnt id=hl-4-122><a class=lnlinks href=#hl-4-122>122</a>
</span><span class=lnt id=hl-4-123><a class=lnlinks href=#hl-4-123>123</a>
</span><span class=lnt id=hl-4-124><a class=lnlinks href=#hl-4-124>124</a>
</span><span class=lnt id=hl-4-125><a class=lnlinks href=#hl-4-125>125</a>
</span><span class=lnt id=hl-4-126><a class=lnlinks href=#hl-4-126>126</a>
</span><span class=lnt id=hl-4-127><a class=lnlinks href=#hl-4-127>127</a>
</span><span class=lnt id=hl-4-128><a class=lnlinks href=#hl-4-128>128</a>
</span><span class=lnt id=hl-4-129><a class=lnlinks href=#hl-4-129>129</a>
</span><span class=lnt id=hl-4-130><a class=lnlinks href=#hl-4-130>130</a>
</span><span class=lnt id=hl-4-131><a class=lnlinks href=#hl-4-131>131</a>
</span><span class=lnt id=hl-4-132><a class=lnlinks href=#hl-4-132>132</a>
</span><span class=lnt id=hl-4-133><a class=lnlinks href=#hl-4-133>133</a>
</span><span class=lnt id=hl-4-134><a class=lnlinks href=#hl-4-134>134</a>
</span><span class=lnt id=hl-4-135><a class=lnlinks href=#hl-4-135>135</a>
</span><span class=lnt id=hl-4-136><a class=lnlinks href=#hl-4-136>136</a>
</span><span class=lnt id=hl-4-137><a class=lnlinks href=#hl-4-137>137</a>
</span><span class=lnt id=hl-4-138><a class=lnlinks href=#hl-4-138>138</a>
</span><span class=lnt id=hl-4-139><a class=lnlinks href=#hl-4-139>139</a>
</span><span class=lnt id=hl-4-140><a class=lnlinks href=#hl-4-140>140</a>
</span><span class=lnt id=hl-4-141><a class=lnlinks href=#hl-4-141>141</a>
</span><span class=lnt id=hl-4-142><a class=lnlinks href=#hl-4-142>142</a>
</span><span class=lnt id=hl-4-143><a class=lnlinks href=#hl-4-143>143</a>
</span><span class=lnt id=hl-4-144><a class=lnlinks href=#hl-4-144>144</a>
</span><span class=lnt id=hl-4-145><a class=lnlinks href=#hl-4-145>145</a>
</span><span class=lnt id=hl-4-146><a class=lnlinks href=#hl-4-146>146</a>
</span><span class=lnt id=hl-4-147><a class=lnlinks href=#hl-4-147>147</a>
</span><span class=lnt id=hl-4-148><a class=lnlinks href=#hl-4-148>148</a>
</span><span class=lnt id=hl-4-149><a class=lnlinks href=#hl-4-149>149</a>
</span><span class=lnt id=hl-4-150><a class=lnlinks href=#hl-4-150>150</a>
</span><span class=lnt id=hl-4-151><a class=lnlinks href=#hl-4-151>151</a>
</span><span class=lnt id=hl-4-152><a class=lnlinks href=#hl-4-152>152</a>
</span><span class=lnt id=hl-4-153><a class=lnlinks href=#hl-4-153>153</a>
</span><span class=lnt id=hl-4-154><a class=lnlinks href=#hl-4-154>154</a>
</span><span class=lnt id=hl-4-155><a class=lnlinks href=#hl-4-155>155</a>
</span><span class=lnt id=hl-4-156><a class=lnlinks href=#hl-4-156>156</a>
</span><span class=lnt id=hl-4-157><a class=lnlinks href=#hl-4-157>157</a>
</span><span class=lnt id=hl-4-158><a class=lnlinks href=#hl-4-158>158</a>
</span><span class=lnt id=hl-4-159><a class=lnlinks href=#hl-4-159>159</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[mysqld]</span>
</span></span><span class=line><span class=cl><span class=c1># Bind only to expected address. You can not bind to multiple addresses, it&#39;s</span>
</span></span><span class=line><span class=cl><span class=c1># none, 1 or all (0.0.0.0)</span>
</span></span><span class=line><span class=cl><span class=na>bind-address</span> <span class=o>=</span> <span class=s>127.0.0.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Always use UTF-8</span>
</span></span><span class=line><span class=cl><span class=na>character-set-server</span> <span class=o>=</span> <span class=s>utf8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Root path used to store MySQL&#39;s data</span>
</span></span><span class=line><span class=cl><span class=na>datadir</span> <span class=o>=</span> <span class=s>/var/lib/mysql</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Use innodb by default (true anyways but I like to be explicit)</span>
</span></span><span class=line><span class=cl><span class=na>default-storage-engine</span> <span class=o>=</span> <span class=s>innodb</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0 = Don&#39;t log warnings, 1 = log warnings, 2 = log warnings and access denied</span>
</span></span><span class=line><span class=cl><span class=c1># errors.</span>
</span></span><span class=line><span class=cl><span class=na>log-warnings</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># How many real world seconds pass before we consider a query to be long</span>
</span></span><span class=line><span class=cl><span class=c1># running. Default is 10.</span>
</span></span><span class=line><span class=cl><span class=na>long_query_time</span> <span class=o>=</span> <span class=s>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Which port to listen on, default is 3306</span>
</span></span><span class=line><span class=cl><span class=na>port</span> <span class=o>=</span> <span class=s>3306</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># A user needs to have the INSERT privilege on the mysql.user table to use the</span>
</span></span><span class=line><span class=cl><span class=c1># GRANT statement. This can be provided to non-root users with the following</span>
</span></span><span class=line><span class=cl><span class=c1># command:</span>
</span></span><span class=line><span class=cl><span class=c1># GRANT INSERT(user) ON mysql.user TO &#39;user_name&#39;@&#39;host_name&#39;;</span>
</span></span><span class=line><span class=cl><span class=na>safe_user_create</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Prevent client connections from clients attempting to use insecure password</span>
</span></span><span class=line><span class=cl><span class=c1># authentication</span>
</span></span><span class=line><span class=cl><span class=na>secure_auth</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Only allow load data and outfile to be to/from the given directory. This</span>
</span></span><span class=line><span class=cl><span class=c1># ensures that whatever user is trying to load or dump data from this server</span>
</span></span><span class=line><span class=cl><span class=c1># instance already needs to be able to write to that directory. If an</span>
</span></span><span class=line><span class=cl><span class=c1># unauthorized person can write to the mysql data directory anyways the data</span>
</span></span><span class=line><span class=cl><span class=c1># can&#39;t be trusted anyway.</span>
</span></span><span class=line><span class=cl><span class=na>secure-file-priv</span> <span class=o>=</span> <span class=s>/var/lib/mysql</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Require privileges to actually list/enumerate the databases</span>
</span></span><span class=line><span class=cl><span class=na>skip-show-database</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Prevent symbolic links as a security measureskip-symbolic-links</span>
</span></span><span class=line><span class=cl><span class=c1># Log any &#34;slow&#34; queries from hosts, useful as a diagnostic measure for both</span>
</span></span><span class=line><span class=cl><span class=c1># application development and production diagnostics. A slow query is defined by</span>
</span></span><span class=line><span class=cl><span class=c1># the long_query_time variable.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># These logs will live in /var/lib/mysql/ and will be pre-pended with the</span>
</span></span><span class=line><span class=cl><span class=c1># hostname that caused the slow query itself.</span>
</span></span><span class=line><span class=cl><span class=na>slow_query_log</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Path to the socket file used to access the server locally</span>
</span></span><span class=line><span class=cl><span class=na>socket</span> <span class=o>=</span> <span class=s>/var/lib/mysql/mysql.sock</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### SSL Settings #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># All three options are required to enable SSL for the server. To force a user</span>
</span></span><span class=line><span class=cl><span class=c1># to use an SSL connection when they are connecting to the server, while granting</span>
</span></span><span class=line><span class=cl><span class=c1># them privileges add &#34;REQUIRE SSL&#34; to the end of the grant statement. &#34;REQUIRE</span>
</span></span><span class=line><span class=cl><span class=c1># X509&#34; will require the user to present a valid certificate (it&#39;s unclear whether</span>
</span></span><span class=line><span class=cl><span class=c1># this needs to be signed by a certificate in the server&#39;s CA file), &#34;REQUIRE</span>
</span></span><span class=line><span class=cl><span class=c1># ISSUER&#34; and &#34;REQUIRE SUBJECT&#34; specify details required in the provided</span>
</span></span><span class=line><span class=cl><span class=c1># certificate. The last three imply &#34;REQUIRE SSL&#34;.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define the certificate authority file, it should have been used to sign the</span>
</span></span><span class=line><span class=cl><span class=c1># server&#39;s certificate, and will be used to validate client certificates that</span>
</span></span><span class=line><span class=cl><span class=c1># have been presented.</span>
</span></span><span class=line><span class=cl><span class=c1>#ssl_ca = ca.crt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The name of the SSL certficate file in PEM format to use for establishing a</span>
</span></span><span class=line><span class=cl><span class=c1># secure connection.</span>
</span></span><span class=line><span class=cl><span class=c1>#ssl_cert = mysql.crt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The name of the SSL key file in PEM format to use for establishing a secure</span>
</span></span><span class=line><span class=cl><span class=c1># connection</span>
</span></span><span class=line><span class=cl><span class=c1>#ssl_key = mysql.key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### InnoDB specific settings #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># If there are lots of tables in the database you may need to increase this</span>
</span></span><span class=line><span class=cl><span class=c1># value from it&#39;s default of 8Mb. MySQLd will log warning messages if this is</span>
</span></span><span class=line><span class=cl><span class=c1># the case.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_additional_mem_pool_size</span> <span class=o>=</span> <span class=s>8M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Amount of data to cache, default is 8Mb, shouldn&#39;t ever be more than 80% of</span>
</span></span><span class=line><span class=cl><span class=c1># server&#39;s physical memory size even on a dedicated box. Even that high may</span>
</span></span><span class=line><span class=cl><span class=c1># cause other issues on the server such as competition from the OS, and the</span>
</span></span><span class=line><span class=cl><span class=c1># space must be contiguous which isn&#39;t always available. This is only the table</span>
</span></span><span class=line><span class=cl><span class=c1># and data cache, MySQLd may allocate additional memory for buffers and control</span>
</span></span><span class=line><span class=cl><span class=c1># structures. On dedicated MySQL boxes it is recommended that this be between</span>
</span></span><span class=line><span class=cl><span class=c1># 75% and 80%</span>
</span></span><span class=line><span class=cl><span class=na>innodb_buffer_pool_size</span> <span class=o>=</span> <span class=s>32M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Validate the checksums of all pages read from disk to ensure fault tolerance</span>
</span></span><span class=line><span class=cl><span class=c1># against broken hardware or data files. Enabled by default but I like to be</span>
</span></span><span class=line><span class=cl><span class=c1># explicit...</span>
</span></span><span class=line><span class=cl><span class=na>innodb_checksums</span> <span class=o>=</span> <span class=s>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Breaks the database into smaller more managable pieces, and if careful can</span>
</span></span><span class=line><span class=cl><span class=c1># allow for individual table backups and restoration while the server is</span>
</span></span><span class=line><span class=cl><span class=c1># running. There is a special process to handle this and it should looked up</span>
</span></span><span class=line><span class=cl><span class=c1># before attempting. The main benefit of using this option is the prevention</span>
</span></span><span class=line><span class=cl><span class=c1># of main tablespace growth.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_file_per_table</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 0 = A most one second of transactions are lost in the event of an application</span>
</span></span><span class=line><span class=cl><span class=c1># crash, 1 = ACID compliant and most reliable storage of data, 2 is somewhere in</span>
</span></span><span class=line><span class=cl><span class=c1># between 0 and 1 losing at most 1 second of data only in the case of power</span>
</span></span><span class=line><span class=cl><span class=c1># outage or server failure. 1 is the default. If you&#39;re not worried about losing</span>
</span></span><span class=line><span class=cl><span class=c1># transactions for the last second or two a value of 2 can have a dramatic increase</span>
</span></span><span class=line><span class=cl><span class=c1># especially when there are a lot of short write transactions.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_flush_log_at_trx_commit</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># An upper limit on the IO activity performed by InnoDB background tasks.</span>
</span></span><span class=line><span class=cl><span class=c1># Default value is 200 with a minimum value of 100. This parameter should be set</span>
</span></span><span class=line><span class=cl><span class=c1># approximately what the IOPS of the system disk the tables are stored on is</span>
</span></span><span class=line><span class=cl><span class=c1># able to provide (100 for 5.2k &amp; 7.2k drives, 150 for 10k, 200 for 15k and</span>
</span></span><span class=line><span class=cl><span class=c1># 250 for SSDs). It is recommended to &#39;keep this setting as low as practical, but</span>
</span></span><span class=line><span class=cl><span class=c1># not so low that these background activities fall behind.&#39; Too high and data will</span>
</span></span><span class=line><span class=cl><span class=c1># be removed from the buffer pool too quickly to benefit from the caching.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_io_capacity</span> <span class=o>=</span> <span class=s>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This will prevent too much log switching on write heavy databases (default is</span>
</span></span><span class=line><span class=cl><span class=c1># 8Mb). Larger buffers all larger transactions to run without the need to write</span>
</span></span><span class=line><span class=cl><span class=c1># the log to disk before the transactions commit. On larger databases this should</span>
</span></span><span class=line><span class=cl><span class=c1># be set higher to something like 256Mb, there isn&#39;t a large benefit above 512Mb</span>
</span></span><span class=line><span class=cl><span class=na>innodb_log_file_size</span> <span class=o>=</span> <span class=s>64M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The size of the buffer that InnoDB uses to write to the log files on disk.</span>
</span></span><span class=line><span class=cl><span class=c1># Default is 8Mb. A larger log buffer allows larger transactions to run without</span>
</span></span><span class=line><span class=cl><span class=c1># a need to write the log to disk before the transactions commit.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_log_buffer_size</span> <span class=o>=</span> <span class=s>8M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The size of each transaction log (default is 5Mb). The larger the value the</span>
</span></span><span class=line><span class=cl><span class=c1># less checkpoint flush activity is needed in the buffer pool saving disk IO at</span>
</span></span><span class=line><span class=cl><span class=c1># the expense of crash recovery time. Recommended is 1/nth of the</span>
</span></span><span class=line><span class=cl><span class=c1># innodb_buffer_pool_size where N is the value of innodb_log_files_in_group. In</span>
</span></span><span class=line><span class=cl><span class=c1># this file that&#39;s 1/2 of 32Mb.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_log_file_size</span> <span class=o>=</span> <span class=s>16M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The number of transaction logs to make use of, the default, recommended and</span>
</span></span><span class=line><span class=cl><span class=c1># minimum is 2. These will written to in a circular fashion.</span>
</span></span><span class=line><span class=cl><span class=na>innodb_log_files_in_group</span> <span class=o>=</span> <span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[mysqld_safe]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Where to store the MySQLd process ID</span>
</span></span><span class=line><span class=cl><span class=na>pid-file</span> <span class=o>=</span> <span class=s>/var/run/mysqld/mysqld.pid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Enable logging to syslog</span>
</span></span><span class=line><span class=cl><span class=na>syslog</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[mysql]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Adjust the prompt to be more useful/verbose.</span>
</span></span><span class=line><span class=cl><span class=na>prompt</span><span class=o>=</span><span class=s>(\\u@\\h) [\\d]&gt;\\_</span>
</span></span></code></pre></td></tr></table></div></div><p>There is some additional configuration in the systemd init script, specifically
which user/group the service will fork too (default is mysql/mysql). If you
need to change this you'll need to make the adjustment in
<code>/etc/systemd/system/multi-user.target.wants/mysqld.service</code>.</p><h3 id=firewall>Firewall</h3><pre tabindex=0><code>-A SERVICES -m tcp -p tcp --dport 3306 -j ACCEPT
</code></pre><h3 id=resetting-the-root-password>Resetting the Root Password</h3><p>Stop the MySQL daemon, and disable remote access to the server (block in
firewall etc). Start up MySQL with privilege checking disabled (In this mode
any credential will be accepted for any username and that user will have full
root database privileges (thus blocking remote access).</p><pre tabindex=0><code>mysqld_safe --skip-grant-tables
</code></pre><p>In a separate terminal window connect to the database:</p><pre tabindex=0><code>mysql -u root
</code></pre><p>Refer to the section on changing a user's password at this point. When done be
sure to kill the <code>mysqld_safe</code> instance, start up the daemon normally and
restore access to the server.</p><h3 id=quick-self-signed-ssl-cert-w-client>Quick Self Signed SSL Cert w/ Client</h3><p>This should be used for testing and development only, it requires a bit more
than a simple SSL cert as MySQL requires a CA cert as well so we'll generate a
self signed CA, a server certificate, and then a client certificate that can be
used for user authentication.</p><p>First the CA:</p><pre tabindex=0><code>openssl req -new -x509 -newkey rsa:4096 -keyout ca.key -nodes -days 365 \
  -out ca.crt
</code></pre><p>Then the server cert:</p><pre tabindex=0><code>openssl req -newkey rsa:4096 -keyout server.key -nodes -days 365 \
  -out server.csr
openssl x509 -req -in server.csr -days 365 -CA ca.crt -CAkey ca.key \
  -set_serial 01 -out server.crt
rm server.csr
</code></pre><p>Then the client cert:</p><pre tabindex=0><code>openssl req -newkey rsa:4096 -keyout client.key -nodes -days 365 \
  -out client.csr
openssl x509 -req -in client.csr -days 365 -CA ca.crt -CAkey ca.key \
  -set_serial 02 -out client.crt
rm client.csr
</code></pre><h2 id=client>Client</h2><h3 id=remotely-calculate-the-size-of-a-database>Remotely Calculate the Size of a Database</h3><p>Paste the following query into an interactive console session to collect the
sizes of all databases the current user has access to:</p><pre tabindex=0><code>SELECT table_schema &#34;Database Name&#34;, SUM(data_length + index_length) / 1024
  / 1024 &#34;Size in Mb&#34; FROM information_schema.TABLES GROUP BY table_schema;
</code></pre><h3 id=drop-tables>Drop Tables</h3><p>Without being able to drop a database and create a new one it can be kind of
frustrating to empty a database of all it's tables so I've written a quick
script to drop all the tables from a specified database.</p><pre tabindex=0><code>#!/bin/bash

DBUSER=&#34;$1&#34;
DBPASS=&#34;$2&#34;
DBNAME=&#34;$3&#34;
DBHOST=&#34;$4&#34;

if [ $# -ne 4 ]; then
  echo &#34;Usage: $0 {username} {password} {database} {hostname}&#34;
  echo &#34;Drops all tables from a MySQL&#34;
  exit 1
fi

TABLES=$(mysql -u $DBUSER -p$DBPASS -h$DBHOST $DBNAME -e &#39;show tables;&#39; |
  awk &#39;{ print $1}&#39; | grep -v &#39;^Tables&#39; )

for t in $TABLES; do
  echo &#34;Deleting $t table from $MDB database...&#34;
  mysql -u $DBUSER -p$DBPASS -h$DBHOST $DBNAME -e &#34;drop table $t;&#34;
done
</code></pre><h3 id=new-database-and-user>New Database and User</h3><p>Note: For security reasons user creation should be performed over an encrypted
channel. See the section on Using SSL.</p><pre tabindex=0><code>CREATE DATABASE example;
GRANT ALL ON example.* TO &#39;some-example-user&#39;@&#39;%.home-network.net&#39; IDENTIFIED
  BY &#39;mYsUperSt0ngpassWordD0ntcoPyM3!&#39;;
FLUSH PRIVILEGES;
</code></pre><h3 id=change-user-password>Change User Password</h3><p>Note: For security reasons this password update should be performed over an
encrypted channel. See the section on Using SSL.</p><pre tabindex=0><code>UPDATE mysql.user SET password=PASSWORD(&#34;my-new-super-secure-password&#34;) WHERE
  user=&#39;some-user-name&#39;;
</code></pre><h3 id=configuration-1>Configuration</h3><p>Quick and simple change I make to my client configuration to make the prompt a
little more verbose. Create the following file in <code>~/.my.cnf</code>:</p><pre tabindex=0><code>[mysql]prompt=(\\u@\\h) [\\d]&gt;\\_
</code></pre><p>This can also be set system wide in <code>/etc/my.cnf</code> for all users by appending
the above (which I do in all my server configurations).</p><h3 id=using-ssl>Using SSL</h3><p>Pretty straight forward, one off can be done like the following:</p><pre tabindex=0><code>mysql -u user -ppassword -h host --ssl-ca=./ca.crt database
</code></pre><p>Once connected you can verify the session is encrypted with the following
query:</p><pre tabindex=0><code>(root@127.0.0.1) [(none)]&gt; show status like &#39;ssl_cipher&#39;;
</code></pre><p>If the second column returned is non-empty then your session is encrypted.</p><h3 id=see-remote-version>See Remote Version</h3><pre tabindex=0><code>(user@example-mysql) [(none)]&gt; SELECT VERSION();
</code></pre><h3 id=useful-diagnostic--testing--maintenance-scripts>Useful Diagnostic / Testing / Maintenance Scripts</h3><ul><li><a href=http://www.percona.com/doc/percona-toolkit/2.1/>http://www.percona.com/doc/percona-toolkit/2.1/</a></li></ul><h3 id=tcmalloc>TCMalloc</h3><p>Due to high thread contention in some versions of MySQL a huge performance
boost can be gained by using a third party malloc, TCMalloc has been proven to
reduce thread contention in MySQL and provide as much as a 30% boost in all
query timing.</p><ul><li><a href=http://goog-perftools.sourceforge.net/doc/tcmalloc.html>http://goog-perftools.sourceforge.net/doc/tcmalloc.html</a></li><li><a href=https://code.google.com/p/gperftools/>https://code.google.com/p/gperftools/</a></li></ul><p>MORE TODO</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>