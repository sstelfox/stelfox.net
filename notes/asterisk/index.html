<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Asterisk is a software implementation of a telephone private branch exchange (PBX) originally created in 1999 by Mark Spencer of Digium. Like any PBX, it allows attached telephones to make calls to one another, and to connect to other telephone services including the public switched telephone network (PSTN) and Voice over Internet Protocol (VoIP) services. Its name comes from the asterisk symbol, “*”.
NOTE: FreeSWITCH may be a solid replacement for asterisk as it has support for the Linksys SPA3000 as well as ZRTP and SRTP support."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,operations,telephony,voip"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/asterisk/><title>Asterisk :: ./Sam_Stelfox.sh — A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Asterisk"><meta itemprop=description content="Asterisk is a software implementation of a telephone private branch exchange (PBX) originally created in 1999 by Mark Spencer of Digium. Like any PBX, it allows attached telephones to make calls to one another, and to connect to other telephone services including the public switched telephone network (PSTN) and Voice over Internet Protocol (VoIP) services. Its name comes from the asterisk symbol, “*”.
NOTE: FreeSWITCH may be a solid replacement for asterisk as it has support for the Linksys SPA3000 as well as ZRTP and SRTP support."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="4957"><meta itemprop=keywords content="Linux,Operations,Telephony,Voip"><meta name=twitter:card content="summary"><meta name=twitter:title content="Asterisk"><meta name=twitter:description content="Asterisk is a software implementation of a telephone private branch exchange (PBX) originally created in 1999 by Mark Spencer of Digium. Like any PBX, it allows attached telephones to make calls to one another, and to connect to other telephone services including the public switched telephone network (PSTN) and Voice over Internet Protocol (VoIP) services. Its name comes from the asterisk symbol, “*”.
NOTE: FreeSWITCH may be a solid replacement for asterisk as it has support for the Linksys SPA3000 as well as ZRTP and SRTP support."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/asterisk/>Asterisk</a></h2><div class=post-content><p>Asterisk is a software implementation of a telephone private branch exchange (PBX) originally created in 1999 by Mark Spencer of Digium. Like any PBX, it allows attached telephones to make calls to one another, and to connect to other telephone services including the public switched telephone network (PSTN) and Voice over Internet Protocol (VoIP) services. Its name comes from the asterisk symbol, “*”.</p><p>NOTE: FreeSWITCH may be a solid replacement for asterisk as it has support for the Linksys SPA3000 as well as ZRTP and SRTP support. It might be wise to look into using kamailio as a front end SIP router though this doesn't seem to be necessary unless we want to start handling multi-thousands of calls concurrently.</p><p>A few <a href=http://robsmart.co.uk/2009/06/02/freeswitch_linksys3102/>references</a> for help when building FreeSWITCH.</p><h2 id=previous-reasoning>Previous Reasoning</h2><p>This was setup on my private network to provide a land line phone to my office using our existing internet connection. I wanted to go about doing this without having to pay for the services as I don't expect this to get a lot of use.</p><p>This Asterisk setup involves the use of <a href=http://google.com/voice>Google Voice</a> and <a href=http://www.sipgate.com/>SIPGate</a>. SIPGate provides a single phone number, SIP connectivity and call forwarding. Google Voice doesn't provide services to receive phone calls, however, it can be setup as an intermediary that will call you and then connect to another number on your behalf, while also providing call forwarding.</p><p>Combining the three will get free incoming and outgoing to anywhere in the US and Canada. Incoming calls will come from Google Voice, which will forward the call to the SIPGate phone number, which the Asterisk PBX will be tied to and we'll in turn be able to receive the call.</p><p>Outgoing calls are a bit more tricky. Implemented using <a href=http://code.google.com/p/pygooglevoice/>pygooglevoice</a>, the Asterisk box will actually connect to Google Voice's APIs to dial the number and call back (making it an incoming call and thus free) to make the outgoing call.</p><h2 id=links>Links</h2><ul><li><a href=http://ofps.oreilly.com/titles/9780596517342/asterisk-Arch.html>http://ofps.oreilly.com/titles/9780596517342/asterisk-Arch.html</a></li><li><a href=http://www.asteriskdocs.org/>http://www.asteriskdocs.org/</a></li><li><a href=http://www.voip-info.org/>http://www.voip-info.org/</a></li><li><a href="http://nerdvittles.com/index.php?p=65">http://nerdvittles.com/index.php?p=65</a></li><li><a href="http://www.voip-info.org/wiki/index.php?page=Asterisk+LDAP">http://www.voip-info.org/wiki/index.php?page=Asterisk+LDAP</a></li><li><a href=http://download.ag-projects.com/>http://download.ag-projects.com/</a></li></ul><h2 id=security-notes>Security Notes</h2><p>Asterisk/SIP are going to be a significant security hole in the network if I allow outside access to the SIP services (In case I want to say be able to pick up the phone from my laptop while at a cafe or from my office). I intend to research making this considerably more secure before allowing this kind of setup and will document it here.</p><p>One of the things for me to note ahead of time is to not put incoming calls into the same context as my dial plans. This alone will be a significant increase in any kind of security.</p><h3 id=encryption>Encryption</h3><p>The configurations provided have TLS enabled BUT it won't do any good until the server has a certificate. A normal webserver certificate in PKCS12 format. FOR TESTING ONLY you can generate a self signed certificate. You'll need both the certificate authority's cert and the key/cert pair for the server.</p><p>You can use the following to create a self-signed one:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> openssl genrsa -out ca.key <span class=m>4096</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> openssl req -new -x509 -days <span class=m>3650</span> -key ca.key -out ca.crt
</span></span><span class=line><span class=cl><span class=gp>#</span> openssl genrsa -des3 -out pbx.key <span class=m>4096</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> openssl req -new -key argus.key -out pbx.csr
</span></span><span class=line><span class=cl><span class=gp>#</span> openssl x509 -req -days <span class=m>3650</span> -in pbx.csr -CA ca.crt -CAkey ca.key -set_serial <span class=m>01</span> -out pbx.crt
</span></span><span class=line><span class=cl><span class=gp>#</span> openssl rsa -in pbx.key -out pbx.key.insecure
</span></span><span class=line><span class=cl><span class=gp>#</span> cat pbx.crt &gt; pbx.pem
</span></span><span class=line><span class=cl><span class=gp>#</span> cat pbx.key.insecure &gt;&gt; pbx.pem
</span></span><span class=line><span class=cl><span class=gp>#</span> mv pbx.pem ca.crt /var/lib/asterisk/
</span></span><span class=line><span class=cl><span class=gp>#</span> restorecon -R /var/lib/asterisk/
</span></span><span class=line><span class=cl><span class=gp>#</span> chown asterisk:asterisk /var/lib/asterisk
</span></span></code></pre></td></tr></table></div></div><h3 id=firewall-adjustments>Firewall Adjustments</h3><pre tabindex=0><code class=language-iptables data-lang=iptables># Allow incoming SIP calls from the local network
-A PRIMARYSERVICES -s 10.13.37.0/24 -m udp -p udp --dport 5060 -j ACCEPT
-A PRIMARYSERVICES -s 10.13.37.0/24 -m tcp -p tcp --dport 5060:5061 -j ACCEPT

# Log and allow SIP traffic from other people
-A PRIMARYSERVICES -m state --state NEW -m udp -p udp --dport 5060 -j LOG --log-prefix &#34;SIP Traffic &#34;
-A PRIMARYSERVICES -m state --state NEW -m tcp -p tcp --dport 5060:5061 -j LOG --log-prefix &#34;SIP Traffic &#34;
-A PRIMARYSERVICES -m udp -p udp --dport 5060 -j ACCEPT
-A PRIMARYSERVICES -m tcp -p tcp --dport 5060:5061 -j ACCEPT

# Allow incoming RTP traffic from the local network
-A PRIMARYSERVICES -s 10.13.37.0/24 -m udp -p udp --dport 10000:10100 -j ACCEPT

# Log and allow RTP traffic from other people
-A PRIMARYSERVICES -m state --state NEW -m udp -p udp --dport 10000:10100 -j LOG --log-prefix &#34;RTP Traffic &#34;
-A PRIMARYSERVICES -m udp -p udp --dport 10000:10100 -j ACCEPT
</code></pre><h3 id=fail2ban>Fail2Ban</h3><p>Due to the overwhelmingly large number of attackers trying to exploit unsecured Asterisk boxes, configuring <a href=/notes/fail2ban/>Fail2Ban</a> with Asterisk is HIGHLY recommended. I'm updating the regular expressions in that template as I see attacks, and in some cases where I intentionally generate the logs myself.</p><h2 id=config-files>Config Files</h2><p>There are a significant number of configuration files created when asterisk is installed, these all reside in "/etc/asterisk". I'll go over the ones that I made modifications too including full source (without the comments that come included, there are a lot of them). I copied the original files to "*.conf.o" and blew away most of the files I edited (including the stock comments).</p><h3 id=etcasteriskasteriskconf>/etc/asterisk/asterisk.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span><span class=lnt id=hl-2-27><a class=lnlinks href=#hl-2-27>27</a>
</span><span class=lnt id=hl-2-28><a class=lnlinks href=#hl-2-28>28</a>
</span><span class=lnt id=hl-2-29><a class=lnlinks href=#hl-2-29>29</a>
</span><span class=lnt id=hl-2-30><a class=lnlinks href=#hl-2-30>30</a>
</span><span class=lnt id=hl-2-31><a class=lnlinks href=#hl-2-31>31</a>
</span><span class=lnt id=hl-2-32><a class=lnlinks href=#hl-2-32>32</a>
</span><span class=lnt id=hl-2-33><a class=lnlinks href=#hl-2-33>33</a>
</span><span class=lnt id=hl-2-34><a class=lnlinks href=#hl-2-34>34</a>
</span><span class=lnt id=hl-2-35><a class=lnlinks href=#hl-2-35>35</a>
</span><span class=lnt id=hl-2-36><a class=lnlinks href=#hl-2-36>36</a>
</span><span class=lnt id=hl-2-37><a class=lnlinks href=#hl-2-37>37</a>
</span><span class=lnt id=hl-2-38><a class=lnlinks href=#hl-2-38>38</a>
</span><span class=lnt id=hl-2-39><a class=lnlinks href=#hl-2-39>39</a>
</span><span class=lnt id=hl-2-40><a class=lnlinks href=#hl-2-40>40</a>
</span><span class=lnt id=hl-2-41><a class=lnlinks href=#hl-2-41>41</a>
</span><span class=lnt id=hl-2-42><a class=lnlinks href=#hl-2-42>42</a>
</span><span class=lnt id=hl-2-43><a class=lnlinks href=#hl-2-43>43</a>
</span><span class=lnt id=hl-2-44><a class=lnlinks href=#hl-2-44>44</a>
</span><span class=lnt id=hl-2-45><a class=lnlinks href=#hl-2-45>45</a>
</span><span class=lnt id=hl-2-46><a class=lnlinks href=#hl-2-46>46</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Asterisk&#39;s Primary Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>[directories](!)</span>
</span></span><span class=line><span class=cl>  <span class=na>astetcdir</span> <span class=o>=</span><span class=s>&gt; /etc/asterisk                ; The Asterisk configuration files
</span></span></span><span class=line><span class=cl><span class=s>  astmoddir =&gt; /usr/lib64/asterisk/modules  ; The loadable modules
</span></span></span><span class=line><span class=cl><span class=s>  astvarlibdir =&gt; /usr/share/asterisk       ; The base location for variable state information used by
</span></span></span><span class=line><span class=cl><span class=s>                                            ; various parts of Asterisk. This includes items that are
</span></span></span><span class=line><span class=cl><span class=s>                                            ; written out by Asterisk at runtime
</span></span></span><span class=line><span class=cl><span class=s>  astdbdir =&gt; /var/spool/asterisk           ; Asterisk will store its internal database in this directory
</span></span></span><span class=line><span class=cl><span class=s>                                            ; as a file called astdb
</span></span></span><span class=line><span class=cl><span class=s>  astkeydir =&gt; /var/lib/asterisk            ; Asterisk will use a subdirectory called keys in this
</span></span></span><span class=line><span class=cl><span class=s>                                            ; directory as the default location for loading keys for
</span></span></span><span class=line><span class=cl><span class=s>                                            ; encryption
</span></span></span><span class=line><span class=cl><span class=s>  astdatadir =&gt; /usr/share/asterisk         ; This is the base directory for system-provided data, such as
</span></span></span><span class=line><span class=cl><span class=s>                                            ; the sound files that come with Asterisk
</span></span></span><span class=line><span class=cl><span class=s>  astagidir =&gt; /usr/share/asterisk/agi-bin  ; Asterisk will use a subdirectory called agi-bin in this
</span></span></span><span class=line><span class=cl><span class=s>                                            ; directory as the default location for loading AGI scripts
</span></span></span><span class=line><span class=cl><span class=s>  astspooldir =&gt; /var/spool/asterisk        ; The Asterisk spool directory, where voicemail, call
</span></span></span><span class=line><span class=cl><span class=s>                                            ; recordings, and the call origination spool are stored.
</span></span></span><span class=line><span class=cl><span class=s>  astrundir =&gt; /var/run/asterisk            ; The location where Asterisk will write out it&#39;s unix control
</span></span></span><span class=line><span class=cl><span class=s>                                            ; socket as well as it PID file
</span></span></span><span class=line><span class=cl><span class=s>  astlogdir =&gt; /var/log/asterisk            ; The asterisk log directory</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[options]</span>
</span></span><span class=line><span class=cl>  <span class=na>verbose</span> <span class=o>=</span> <span class=s>3                     ; Sets the default verbose setting for the Asterisk logger
</span></span></span><span class=line><span class=cl><span class=s>  timestamp = yes                 ; Adds timestamps to all output except output from a CLI command
</span></span></span><span class=line><span class=cl><span class=s>  initcrypto = yes                ; Load keys from the astkeydir at startup
</span></span></span><span class=line><span class=cl><span class=s>  systemname = jeeves             ; The name of the PBX, yeah ours is called Jeeves, what you going to do about
</span></span></span><span class=line><span class=cl><span class=s>                                  ; it?
</span></span></span><span class=line><span class=cl><span class=s>  maxload = 0.8                   ; Sets a maximum load average. If the load average is at or above this
</span></span></span><span class=line><span class=cl><span class=s>                                  ; threshold, Asterisk will not accept new calls.
</span></span></span><span class=line><span class=cl><span class=s>  minmemfree = 10                 ; Sets the minimum number of megabytes of free memory required for Asterisk to
</span></span></span><span class=line><span class=cl><span class=s>                                  ; continue accepting calls.
</span></span></span><span class=line><span class=cl><span class=s>  cache_record_files = yes        ; When doing recording, stores the file in record_cache_dir until recording is
</span></span></span><span class=line><span class=cl><span class=s>                                  ; complete.
</span></span></span><span class=line><span class=cl><span class=s>  runuser = asterisk              ; Run Asterisk under the user specified
</span></span></span><span class=line><span class=cl><span class=s>  rungroup = asterisk             ; Run Asterisk under the group specified
</span></span></span><span class=line><span class=cl><span class=s>  defaultlanguage = en            ; Set the default language
</span></span></span><span class=line><span class=cl><span class=s>  documentation_language = en_US  ; Set the preferred language for the command help</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[files]</span>
</span></span><span class=line><span class=cl>  <span class=na>astctlpermissions</span> <span class=o>=</span> <span class=s>0660  ; Sets the permissions for the Asterisk control socket
</span></span></span><span class=line><span class=cl><span class=s>  astctlowner = root        ; Sets the owner for the Asterisk control socket
</span></span></span><span class=line><span class=cl><span class=s>  astctlgroup = asterisk    ; Sets the group for the Asterisk control socket
</span></span></span><span class=line><span class=cl><span class=s>  astctl = asterisk.ctl     ; Sets the filename for the Asterisk control socket</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskccssconf>/etc/asterisk/ccss.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Call Completion Supplementary Services ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=na>cc_max_requests</span> <span class=o>=</span> <span class=s>20  ; Global limit on the number of CC requests that may be in the Asterisk
</span></span></span><span class=line><span class=cl><span class=s>                        ; system at any one time.</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskcdr_adaptive_odbcconf>/etc/asterisk/cdr_adaptive_odbc.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- ODBC Database CDR storage ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[default]</span>
</span></span><span class=line><span class=cl>  <span class=na>connection</span> <span class=o>=</span> <span class=s>gentlemen  ; Name of the connections (references res_odbc.conf)
</span></span></span><span class=line><span class=cl><span class=s>  table = asterisk        ; Name of the table in the database
</span></span></span><span class=line><span class=cl><span class=s>  usegmtime = yes         ; Use Greenwich Mean Time in the database</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskcdrconf>/etc/asterisk/cdr.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Asterisk Call Detail Record Engine Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=na>batch</span> <span class=o>=</span> <span class=s>yes
</span></span></span><span class=line><span class=cl><span class=s>  enable = yes
</span></span></span><span class=line><span class=cl><span class=s>  safeshutdown = yes
</span></span></span><span class=line><span class=cl><span class=s>  scheduleronly = no
</span></span></span><span class=line><span class=cl><span class=s>  size = 100
</span></span></span><span class=line><span class=cl><span class=s>  time = 300
</span></span></span><span class=line><span class=cl><span class=s>  unanswered = yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[csv]</span>
</span></span><span class=line><span class=cl>  <span class=na>accountlogs</span> <span class=o>=</span> <span class=s>yes   ; Create separate log file for each account code
</span></span></span><span class=line><span class=cl><span class=s>  loguniqueid = yes   ; Log uniqueid for the call
</span></span></span><span class=line><span class=cl><span class=s>  loguserfield = yes  ; Log user field
</span></span></span><span class=line><span class=cl><span class=s>  usegmtime = yes     ; Log date and time in GMT</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskcdr_syslogconf>/etc/asterisk/cdr_syslog.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Asterisk Call Detail Records (CDR) - Syslog Backend ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This line needs to be added to /etc/rsyslog.conf:</span>
</span></span><span class=line><span class=cl><span class=c1>; local4.info                   /var/log/asterisk-cdr.log</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[cdr]</span>
</span></span><span class=line><span class=cl>  <span class=na>facility</span><span class=o>=</span><span class=s>local4
</span></span></span><span class=line><span class=cl><span class=s>  priority=info</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; High Resolution Time for billsec and duration fields</span>
</span></span><span class=line><span class=cl>  <span class=na>template</span> <span class=o>=</span> <span class=s>&#39;${CDR(clid)}&#39;,&#39;${CDR(src)}&#39;,&#39;${CDR(dst)}&#39;,&#39;${CDR(dcontext)}&#39;,&#39;${CDR(channel)}&#39;,&#39;${CDR(dstchannel)}&#39;,&#39;${CDR(lastapp)}&#39;,&#39;${CDR(lastdata)}&#39;,&#39;${CDR(start)}&#39;,&#39;${CDR(answer)}&#39;,&#39;${CDR(end)}&#39;,&#39;${CDR(duration,f)}&#39;,&#39;${CDR(billsec,f)}&#39;,&#39;${CDR(disposition)}&#39;,&#39;${CDR(amaflags)}&#39;,&#39;${CDR(accountcode)}&#39;,&#39;${CDR(uniqueid)}&#39;,&#39;${CDR(userfield)}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskextensionsconf>/etc/asterisk/extensions.conf</h3><p>The only thing that I have changed in the below configuration is that where it says 'SPA3000' in the variables I used the MAC address of the actual SPA3000 device as it is defined in sip.conf (this has also been changed there). This will allow it to remain unique even if another is added.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>  1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>  2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>  3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>  4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>  5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>  6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>  7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8>  8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9>  9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10> 10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11> 11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12> 12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13> 13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14> 14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15> 15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16> 16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17> 17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18> 18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19> 19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20> 20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21> 21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22> 22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23> 23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24> 24</a>
</span><span class=lnt id=hl-7-25><a class=lnlinks href=#hl-7-25> 25</a>
</span><span class=lnt id=hl-7-26><a class=lnlinks href=#hl-7-26> 26</a>
</span><span class=lnt id=hl-7-27><a class=lnlinks href=#hl-7-27> 27</a>
</span><span class=lnt id=hl-7-28><a class=lnlinks href=#hl-7-28> 28</a>
</span><span class=lnt id=hl-7-29><a class=lnlinks href=#hl-7-29> 29</a>
</span><span class=lnt id=hl-7-30><a class=lnlinks href=#hl-7-30> 30</a>
</span><span class=lnt id=hl-7-31><a class=lnlinks href=#hl-7-31> 31</a>
</span><span class=lnt id=hl-7-32><a class=lnlinks href=#hl-7-32> 32</a>
</span><span class=lnt id=hl-7-33><a class=lnlinks href=#hl-7-33> 33</a>
</span><span class=lnt id=hl-7-34><a class=lnlinks href=#hl-7-34> 34</a>
</span><span class=lnt id=hl-7-35><a class=lnlinks href=#hl-7-35> 35</a>
</span><span class=lnt id=hl-7-36><a class=lnlinks href=#hl-7-36> 36</a>
</span><span class=lnt id=hl-7-37><a class=lnlinks href=#hl-7-37> 37</a>
</span><span class=lnt id=hl-7-38><a class=lnlinks href=#hl-7-38> 38</a>
</span><span class=lnt id=hl-7-39><a class=lnlinks href=#hl-7-39> 39</a>
</span><span class=lnt id=hl-7-40><a class=lnlinks href=#hl-7-40> 40</a>
</span><span class=lnt id=hl-7-41><a class=lnlinks href=#hl-7-41> 41</a>
</span><span class=lnt id=hl-7-42><a class=lnlinks href=#hl-7-42> 42</a>
</span><span class=lnt id=hl-7-43><a class=lnlinks href=#hl-7-43> 43</a>
</span><span class=lnt id=hl-7-44><a class=lnlinks href=#hl-7-44> 44</a>
</span><span class=lnt id=hl-7-45><a class=lnlinks href=#hl-7-45> 45</a>
</span><span class=lnt id=hl-7-46><a class=lnlinks href=#hl-7-46> 46</a>
</span><span class=lnt id=hl-7-47><a class=lnlinks href=#hl-7-47> 47</a>
</span><span class=lnt id=hl-7-48><a class=lnlinks href=#hl-7-48> 48</a>
</span><span class=lnt id=hl-7-49><a class=lnlinks href=#hl-7-49> 49</a>
</span><span class=lnt id=hl-7-50><a class=lnlinks href=#hl-7-50> 50</a>
</span><span class=lnt id=hl-7-51><a class=lnlinks href=#hl-7-51> 51</a>
</span><span class=lnt id=hl-7-52><a class=lnlinks href=#hl-7-52> 52</a>
</span><span class=lnt id=hl-7-53><a class=lnlinks href=#hl-7-53> 53</a>
</span><span class=lnt id=hl-7-54><a class=lnlinks href=#hl-7-54> 54</a>
</span><span class=lnt id=hl-7-55><a class=lnlinks href=#hl-7-55> 55</a>
</span><span class=lnt id=hl-7-56><a class=lnlinks href=#hl-7-56> 56</a>
</span><span class=lnt id=hl-7-57><a class=lnlinks href=#hl-7-57> 57</a>
</span><span class=lnt id=hl-7-58><a class=lnlinks href=#hl-7-58> 58</a>
</span><span class=lnt id=hl-7-59><a class=lnlinks href=#hl-7-59> 59</a>
</span><span class=lnt id=hl-7-60><a class=lnlinks href=#hl-7-60> 60</a>
</span><span class=lnt id=hl-7-61><a class=lnlinks href=#hl-7-61> 61</a>
</span><span class=lnt id=hl-7-62><a class=lnlinks href=#hl-7-62> 62</a>
</span><span class=lnt id=hl-7-63><a class=lnlinks href=#hl-7-63> 63</a>
</span><span class=lnt id=hl-7-64><a class=lnlinks href=#hl-7-64> 64</a>
</span><span class=lnt id=hl-7-65><a class=lnlinks href=#hl-7-65> 65</a>
</span><span class=lnt id=hl-7-66><a class=lnlinks href=#hl-7-66> 66</a>
</span><span class=lnt id=hl-7-67><a class=lnlinks href=#hl-7-67> 67</a>
</span><span class=lnt id=hl-7-68><a class=lnlinks href=#hl-7-68> 68</a>
</span><span class=lnt id=hl-7-69><a class=lnlinks href=#hl-7-69> 69</a>
</span><span class=lnt id=hl-7-70><a class=lnlinks href=#hl-7-70> 70</a>
</span><span class=lnt id=hl-7-71><a class=lnlinks href=#hl-7-71> 71</a>
</span><span class=lnt id=hl-7-72><a class=lnlinks href=#hl-7-72> 72</a>
</span><span class=lnt id=hl-7-73><a class=lnlinks href=#hl-7-73> 73</a>
</span><span class=lnt id=hl-7-74><a class=lnlinks href=#hl-7-74> 74</a>
</span><span class=lnt id=hl-7-75><a class=lnlinks href=#hl-7-75> 75</a>
</span><span class=lnt id=hl-7-76><a class=lnlinks href=#hl-7-76> 76</a>
</span><span class=lnt id=hl-7-77><a class=lnlinks href=#hl-7-77> 77</a>
</span><span class=lnt id=hl-7-78><a class=lnlinks href=#hl-7-78> 78</a>
</span><span class=lnt id=hl-7-79><a class=lnlinks href=#hl-7-79> 79</a>
</span><span class=lnt id=hl-7-80><a class=lnlinks href=#hl-7-80> 80</a>
</span><span class=lnt id=hl-7-81><a class=lnlinks href=#hl-7-81> 81</a>
</span><span class=lnt id=hl-7-82><a class=lnlinks href=#hl-7-82> 82</a>
</span><span class=lnt id=hl-7-83><a class=lnlinks href=#hl-7-83> 83</a>
</span><span class=lnt id=hl-7-84><a class=lnlinks href=#hl-7-84> 84</a>
</span><span class=lnt id=hl-7-85><a class=lnlinks href=#hl-7-85> 85</a>
</span><span class=lnt id=hl-7-86><a class=lnlinks href=#hl-7-86> 86</a>
</span><span class=lnt id=hl-7-87><a class=lnlinks href=#hl-7-87> 87</a>
</span><span class=lnt id=hl-7-88><a class=lnlinks href=#hl-7-88> 88</a>
</span><span class=lnt id=hl-7-89><a class=lnlinks href=#hl-7-89> 89</a>
</span><span class=lnt id=hl-7-90><a class=lnlinks href=#hl-7-90> 90</a>
</span><span class=lnt id=hl-7-91><a class=lnlinks href=#hl-7-91> 91</a>
</span><span class=lnt id=hl-7-92><a class=lnlinks href=#hl-7-92> 92</a>
</span><span class=lnt id=hl-7-93><a class=lnlinks href=#hl-7-93> 93</a>
</span><span class=lnt id=hl-7-94><a class=lnlinks href=#hl-7-94> 94</a>
</span><span class=lnt id=hl-7-95><a class=lnlinks href=#hl-7-95> 95</a>
</span><span class=lnt id=hl-7-96><a class=lnlinks href=#hl-7-96> 96</a>
</span><span class=lnt id=hl-7-97><a class=lnlinks href=#hl-7-97> 97</a>
</span><span class=lnt id=hl-7-98><a class=lnlinks href=#hl-7-98> 98</a>
</span><span class=lnt id=hl-7-99><a class=lnlinks href=#hl-7-99> 99</a>
</span><span class=lnt id=hl-7-100><a class=lnlinks href=#hl-7-100>100</a>
</span><span class=lnt id=hl-7-101><a class=lnlinks href=#hl-7-101>101</a>
</span><span class=lnt id=hl-7-102><a class=lnlinks href=#hl-7-102>102</a>
</span><span class=lnt id=hl-7-103><a class=lnlinks href=#hl-7-103>103</a>
</span><span class=lnt id=hl-7-104><a class=lnlinks href=#hl-7-104>104</a>
</span><span class=lnt id=hl-7-105><a class=lnlinks href=#hl-7-105>105</a>
</span><span class=lnt id=hl-7-106><a class=lnlinks href=#hl-7-106>106</a>
</span><span class=lnt id=hl-7-107><a class=lnlinks href=#hl-7-107>107</a>
</span><span class=lnt id=hl-7-108><a class=lnlinks href=#hl-7-108>108</a>
</span><span class=lnt id=hl-7-109><a class=lnlinks href=#hl-7-109>109</a>
</span><span class=lnt id=hl-7-110><a class=lnlinks href=#hl-7-110>110</a>
</span><span class=lnt id=hl-7-111><a class=lnlinks href=#hl-7-111>111</a>
</span><span class=lnt id=hl-7-112><a class=lnlinks href=#hl-7-112>112</a>
</span><span class=lnt id=hl-7-113><a class=lnlinks href=#hl-7-113>113</a>
</span><span class=lnt id=hl-7-114><a class=lnlinks href=#hl-7-114>114</a>
</span><span class=lnt id=hl-7-115><a class=lnlinks href=#hl-7-115>115</a>
</span><span class=lnt id=hl-7-116><a class=lnlinks href=#hl-7-116>116</a>
</span><span class=lnt id=hl-7-117><a class=lnlinks href=#hl-7-117>117</a>
</span><span class=lnt id=hl-7-118><a class=lnlinks href=#hl-7-118>118</a>
</span><span class=lnt id=hl-7-119><a class=lnlinks href=#hl-7-119>119</a>
</span><span class=lnt id=hl-7-120><a class=lnlinks href=#hl-7-120>120</a>
</span><span class=lnt id=hl-7-121><a class=lnlinks href=#hl-7-121>121</a>
</span><span class=lnt id=hl-7-122><a class=lnlinks href=#hl-7-122>122</a>
</span><span class=lnt id=hl-7-123><a class=lnlinks href=#hl-7-123>123</a>
</span><span class=lnt id=hl-7-124><a class=lnlinks href=#hl-7-124>124</a>
</span><span class=lnt id=hl-7-125><a class=lnlinks href=#hl-7-125>125</a>
</span><span class=lnt id=hl-7-126><a class=lnlinks href=#hl-7-126>126</a>
</span><span class=lnt id=hl-7-127><a class=lnlinks href=#hl-7-127>127</a>
</span><span class=lnt id=hl-7-128><a class=lnlinks href=#hl-7-128>128</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Asterisk Extension Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Global variables to be used in the rest of the dial plan</span>
</span></span><span class=line><span class=cl><span class=k>[globals]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Area information</span>
</span></span><span class=line><span class=cl>  <span class=na>LOCALAREACODE</span><span class=o>=</span><span class=s>802</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; User extensions</span>
</span></span><span class=line><span class=cl>  <span class=na>U1</span><span class=o>=</span><span class=s>SIP/user1
</span></span></span><span class=line><span class=cl><span class=s>  U2=SIP/user2
</span></span></span><span class=line><span class=cl><span class=s>  U3=SIP/user3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Device extensions</span>
</span></span><span class=line><span class=cl>  <span class=na>PSTNOUT</span><span class=o>=</span><span class=s>SIP/SPA3000_PSTNOUT
</span></span></span><span class=line><span class=cl><span class=s>  PSTNIN=SIP/SPA3000_PSTNIN
</span></span></span><span class=line><span class=cl><span class=s>  LANDLINE=SIP/SPA3000_LINE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This context contains the menu for callers coming in over the PSTN line</span>
</span></span><span class=line><span class=cl><span class=k>[pstnmenu]</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; s,1,Verbose(3,${CALLERID(all)})  ; Print the Caller ID to the console if it&#39;s available
</span></span></span><span class=line><span class=cl><span class=s>           same =&gt; n,GoTo(debug,echo,1)
</span></span></span><span class=line><span class=cl><span class=s>           same =&gt; n,Answer()
</span></span></span><span class=line><span class=cl><span class=s>           same =&gt; n,HangUp()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; i,1,GoTo(s,1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This context is where unauthenticated SIP clients from the internet are going</span>
</span></span><span class=line><span class=cl><span class=c1>; to end up This will provide a certain measure of spam and robot protection by</span>
</span></span><span class=line><span class=cl><span class=c1>; requiring the user to answer a simple math question generated on the fly</span>
</span></span><span class=line><span class=cl><span class=k>[unauthenticated]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; If we allow numeric extension calls from the internet:</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       exten =&gt; _XXX,1,GoTo(internal-public,1,${EXTEN})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; If we allow alpha extension calls from the internet (assumes all extensions are lower case)</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       exten =&gt; _X.,1,Set(SAFE_EXTEN=${FILTER(a-z,${EXTEN})})</span>
</span></span><span class=line><span class=cl>  <span class=c1>;               same =&gt; n,GoTo(internal-public,1,${SAFE_EXTEN})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Catch any unknown or unallowed extensions and give them a &#34;Network out of order&#34; response</span>
</span></span><span class=line><span class=cl>  <span class=c1>; This might trip up some brute force tools, and is better than not passing a reason</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; i,1,HangUp(38)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Our trunk lines should never be making calls into the system, by putting them into this context</span>
</span></span><span class=line><span class=cl><span class=c1>; if anyone manages to collect a valid username/password set from one of our trunk they will not be</span>
</span></span><span class=line><span class=cl><span class=c1>; able to make calls through our system. This trunk should never have any dialplan in it beyonds &#39;hang up&#39;</span>
</span></span><span class=line><span class=cl><span class=k>[from-trunk]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Catch any unknown or unallowed extensions and give them a &#34;Network out of order&#34; response</span>
</span></span><span class=line><span class=cl>  <span class=c1>; This might trip up some brute force tools, and is better than not passing a reason</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; i,1,HangUp(38)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This is by far the most dangerous context. This one makes outgoing calls from</span>
</span></span><span class=line><span class=cl><span class=k>[callout]</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; _NXXNXXXXXX,1,Dial(${PSTNOUT}/1${EXTEN})     ; 10-digit pattern match for NANP
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; _9NXXNXXXXXX,1,Dial(${PSTNOUT}/1${EXTEN:1})  ; 10-digit pattern match for NANP (9 first)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; _NXXXXXX,1,Dial(${PSTNOUT}/${LOCALAREACODE}${EXTEN})     ; 7-digit pattern match for NANP
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; _9NXXXXXX,1,Dial(${PSTNOUT}/${LOCALAREACODE}${EXTEN:1})  ; 7-digit pattern match for NANP
</span></span></span><span class=line><span class=cl><span class=s>                                                                    ; (9 first)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>;exten =&gt; _1NXXNXXXXXX,1,Dial(${PSTNOUT}/${EXTEN})     ; Long-distance pattern match for NANP</span>
</span></span><span class=line><span class=cl>  <span class=c1>;exten =&gt; _91NXXNXXXXXX,1,Dial(${PSTNOUT}/${EXTEN:1})  ; Long-distance pattern match for NANP (9 first)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>;exten =&gt; _011.,1,HangUp(63)   ; Deny the International pattern match for calls made from NANP</span>
</span></span><span class=line><span class=cl>                                 <span class=c1>; with &#39;Service or option unavailable&#39;</span>
</span></span><span class=line><span class=cl>  <span class=c1>;exten =&gt; _9011.,1,HangUp(63)  ; Deny the International pattern match for calls made from NANP</span>
</span></span><span class=line><span class=cl>                                 <span class=c1>; with &#39;Service or option unavailable&#39; (9 first)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; The number they&#39;re reaching doesn&#39;t match anything we know about, deny it</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; i,1,HangUp()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[internal]</span>
</span></span><span class=line><span class=cl>  <span class=na>include</span> <span class=o>=</span><span class=s>&gt; callout          ; Allow internal phones to call out
</span></span></span><span class=line><span class=cl><span class=s>  include =&gt; internal-public  ; Include public extensions (user extensions should only be defined once,
</span></span></span><span class=line><span class=cl><span class=s>                              ; either here or there)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; 600,1,GoTo(debug,echo,1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This context holds the private internal extensions that will be available publicly either</span>
</span></span><span class=line><span class=cl><span class=c1>; through a PSTN line or through anonymous SIP connections from the internet. These lines</span>
</span></span><span class=line><span class=cl><span class=c1>; will be directly dialable from the internal context</span>
</span></span><span class=line><span class=cl><span class=k>[internal-public]</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; 301,1,Dial(${U1})
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; user1,1,Dial(${U1})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; 302,1,Dial(${U2})
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; user2,1,Dial(${U2})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; 303,1,Dial(${U3})
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; user3,1,Dial(${U3})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; 304,1,Dial(${LANDLINE})
</span></span></span><span class=line><span class=cl><span class=s>  exten =&gt; landline,1,Dial(${LANDLINE})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Various extensions that can be used to debug troublesome clients</span>
</span></span><span class=line><span class=cl><span class=k>[debug]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; This channel will echo back whatever sounds this server receives from the client</span>
</span></span><span class=line><span class=cl>  <span class=c1>; including DTMF tones until they hangup or they press #</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; echo,1,Answer()
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Playback(silence/1)   ; Prevent the beginning of our audio from getting cut off
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Playback(demo-echotest)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Echo()
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Playback(demo-echodone)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Playback(vm-goodbye)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Playback(silence/1)   ; Prevent the end of our audio from getting cut off
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,HangUp()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; This can be used anywhere in any other dialplan through the GoSub() routine like so:</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       exten =&gt; example,1,GoSub(debug,log,1(1,[${CHANNEL}] This is the message))</span>
</span></span><span class=line><span class=cl>  <span class=c1>; By default all logging is off, to turn it on you need to execute the following commands</span>
</span></span><span class=line><span class=cl>  <span class=c1>; at the asterisk console:</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       *CLI&gt; core set verbose 0</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       *CLI&gt; database put Log all 1</span>
</span></span><span class=line><span class=cl>  <span class=c1>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>; You can optionally only turn on logging for a single channel by running the following</span>
</span></span><span class=line><span class=cl>  <span class=c1>; command in place of the latter command (this example is for the &#34;incoming&#34; channel)</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       *CLI&gt; database put Log/channel/incoming 1</span>
</span></span><span class=line><span class=cl>  <span class=c1>;</span>
</span></span><span class=line><span class=cl>  <span class=na>exten</span> <span class=o>=</span><span class=s>&gt; log,1,GotoIf($[${DB_EXISTS(Log/all)} = 0]?checkchan1)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,GotoIf($[${ARG1} &lt;= ${DB(Log/all)}]?log)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n(checkchan1),Set(KEY=Log/channel/${CHANNEL})
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,GotoIf($[${DB_EXISTS(${KEY})} = 0]?checkchan2)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,GotoIf($[${ARG1} &lt;= ${DB(${KEY})}]?log)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n(checkchan2),Set(KEY=Log/channel/${CUT(CHANNEL,-,1)})
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,GotoIf($[${DB_EXISTS(${KEY})} = 0]?return)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,GotoIf($[${ARG1} &lt;= ${DB(${KEY})}]?log)
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n(return),Return()              ; Logging is not turned on return without doing anything
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n(log),Verbose(0,${ARG2})       ; Log the message to the console
</span></span></span><span class=line><span class=cl><span class=s>    same =&gt; n,Return()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskfeaturesconf>/etc/asterisk/features.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; Asterisk Call Features (parking, transfer, etc) Configuration</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nothing has been configured yet</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskindicationsconf>/etc/asterisk/indications.conf</h3><p>I never got around to configuring this file, I left the section here as the default asterisk install adds this file in. For now you're on your own in configuring indications.</p><h3 id=etcasteriskloggerconf>/etc/asterisk/logger.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Logging Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=na>rotatestrategy</span> <span class=o>=</span> <span class=s>rotate
</span></span></span><span class=line><span class=cl><span class=s>  exec_after_rotate=gzip -9 ${filename}.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[logfiles]</span>
</span></span><span class=line><span class=cl>  <span class=na>console</span> <span class=o>=</span><span class=s>&gt; notice,warning,error,dtmf
</span></span></span><span class=line><span class=cl><span class=s>  ;full =&gt; notice,warning,error,debug,verbose,dtmf,fax
</span></span></span><span class=line><span class=cl><span class=s>  ;verbose =&gt; notice,warning,error,verbose
</span></span></span><span class=line><span class=cl><span class=s>  messages =&gt; notice,warning,error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=na>syslog.local4</span> <span class=o>=</span><span class=s>&gt; notice,warning,error</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskmanagerconf>/etc/asterisk/manager.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- AMI - The Asterisk Manager Interface Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=c1>;bindaddr = 10.13.37.17</span>
</span></span><span class=line><span class=cl>  <span class=na>enabled</span> <span class=o>=</span> <span class=s>no
</span></span></span><span class=line><span class=cl><span class=s>  ;port = 5038
</span></span></span><span class=line><span class=cl><span class=s>  webenabled = no</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskmodulesconf>/etc/asterisk/modules.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>  1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2>  2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3>  3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4>  4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5>  5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6>  6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7>  7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8>  8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9>  9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10> 10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11> 11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12> 12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13> 13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14> 14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15> 15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16> 16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17> 17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18> 18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19> 19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20> 20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21> 21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22> 22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23> 23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24> 24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25> 25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26> 26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27> 27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28> 28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29> 29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30> 30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31> 31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32> 32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33> 33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34> 34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35> 35</a>
</span><span class=lnt id=hl-11-36><a class=lnlinks href=#hl-11-36> 36</a>
</span><span class=lnt id=hl-11-37><a class=lnlinks href=#hl-11-37> 37</a>
</span><span class=lnt id=hl-11-38><a class=lnlinks href=#hl-11-38> 38</a>
</span><span class=lnt id=hl-11-39><a class=lnlinks href=#hl-11-39> 39</a>
</span><span class=lnt id=hl-11-40><a class=lnlinks href=#hl-11-40> 40</a>
</span><span class=lnt id=hl-11-41><a class=lnlinks href=#hl-11-41> 41</a>
</span><span class=lnt id=hl-11-42><a class=lnlinks href=#hl-11-42> 42</a>
</span><span class=lnt id=hl-11-43><a class=lnlinks href=#hl-11-43> 43</a>
</span><span class=lnt id=hl-11-44><a class=lnlinks href=#hl-11-44> 44</a>
</span><span class=lnt id=hl-11-45><a class=lnlinks href=#hl-11-45> 45</a>
</span><span class=lnt id=hl-11-46><a class=lnlinks href=#hl-11-46> 46</a>
</span><span class=lnt id=hl-11-47><a class=lnlinks href=#hl-11-47> 47</a>
</span><span class=lnt id=hl-11-48><a class=lnlinks href=#hl-11-48> 48</a>
</span><span class=lnt id=hl-11-49><a class=lnlinks href=#hl-11-49> 49</a>
</span><span class=lnt id=hl-11-50><a class=lnlinks href=#hl-11-50> 50</a>
</span><span class=lnt id=hl-11-51><a class=lnlinks href=#hl-11-51> 51</a>
</span><span class=lnt id=hl-11-52><a class=lnlinks href=#hl-11-52> 52</a>
</span><span class=lnt id=hl-11-53><a class=lnlinks href=#hl-11-53> 53</a>
</span><span class=lnt id=hl-11-54><a class=lnlinks href=#hl-11-54> 54</a>
</span><span class=lnt id=hl-11-55><a class=lnlinks href=#hl-11-55> 55</a>
</span><span class=lnt id=hl-11-56><a class=lnlinks href=#hl-11-56> 56</a>
</span><span class=lnt id=hl-11-57><a class=lnlinks href=#hl-11-57> 57</a>
</span><span class=lnt id=hl-11-58><a class=lnlinks href=#hl-11-58> 58</a>
</span><span class=lnt id=hl-11-59><a class=lnlinks href=#hl-11-59> 59</a>
</span><span class=lnt id=hl-11-60><a class=lnlinks href=#hl-11-60> 60</a>
</span><span class=lnt id=hl-11-61><a class=lnlinks href=#hl-11-61> 61</a>
</span><span class=lnt id=hl-11-62><a class=lnlinks href=#hl-11-62> 62</a>
</span><span class=lnt id=hl-11-63><a class=lnlinks href=#hl-11-63> 63</a>
</span><span class=lnt id=hl-11-64><a class=lnlinks href=#hl-11-64> 64</a>
</span><span class=lnt id=hl-11-65><a class=lnlinks href=#hl-11-65> 65</a>
</span><span class=lnt id=hl-11-66><a class=lnlinks href=#hl-11-66> 66</a>
</span><span class=lnt id=hl-11-67><a class=lnlinks href=#hl-11-67> 67</a>
</span><span class=lnt id=hl-11-68><a class=lnlinks href=#hl-11-68> 68</a>
</span><span class=lnt id=hl-11-69><a class=lnlinks href=#hl-11-69> 69</a>
</span><span class=lnt id=hl-11-70><a class=lnlinks href=#hl-11-70> 70</a>
</span><span class=lnt id=hl-11-71><a class=lnlinks href=#hl-11-71> 71</a>
</span><span class=lnt id=hl-11-72><a class=lnlinks href=#hl-11-72> 72</a>
</span><span class=lnt id=hl-11-73><a class=lnlinks href=#hl-11-73> 73</a>
</span><span class=lnt id=hl-11-74><a class=lnlinks href=#hl-11-74> 74</a>
</span><span class=lnt id=hl-11-75><a class=lnlinks href=#hl-11-75> 75</a>
</span><span class=lnt id=hl-11-76><a class=lnlinks href=#hl-11-76> 76</a>
</span><span class=lnt id=hl-11-77><a class=lnlinks href=#hl-11-77> 77</a>
</span><span class=lnt id=hl-11-78><a class=lnlinks href=#hl-11-78> 78</a>
</span><span class=lnt id=hl-11-79><a class=lnlinks href=#hl-11-79> 79</a>
</span><span class=lnt id=hl-11-80><a class=lnlinks href=#hl-11-80> 80</a>
</span><span class=lnt id=hl-11-81><a class=lnlinks href=#hl-11-81> 81</a>
</span><span class=lnt id=hl-11-82><a class=lnlinks href=#hl-11-82> 82</a>
</span><span class=lnt id=hl-11-83><a class=lnlinks href=#hl-11-83> 83</a>
</span><span class=lnt id=hl-11-84><a class=lnlinks href=#hl-11-84> 84</a>
</span><span class=lnt id=hl-11-85><a class=lnlinks href=#hl-11-85> 85</a>
</span><span class=lnt id=hl-11-86><a class=lnlinks href=#hl-11-86> 86</a>
</span><span class=lnt id=hl-11-87><a class=lnlinks href=#hl-11-87> 87</a>
</span><span class=lnt id=hl-11-88><a class=lnlinks href=#hl-11-88> 88</a>
</span><span class=lnt id=hl-11-89><a class=lnlinks href=#hl-11-89> 89</a>
</span><span class=lnt id=hl-11-90><a class=lnlinks href=#hl-11-90> 90</a>
</span><span class=lnt id=hl-11-91><a class=lnlinks href=#hl-11-91> 91</a>
</span><span class=lnt id=hl-11-92><a class=lnlinks href=#hl-11-92> 92</a>
</span><span class=lnt id=hl-11-93><a class=lnlinks href=#hl-11-93> 93</a>
</span><span class=lnt id=hl-11-94><a class=lnlinks href=#hl-11-94> 94</a>
</span><span class=lnt id=hl-11-95><a class=lnlinks href=#hl-11-95> 95</a>
</span><span class=lnt id=hl-11-96><a class=lnlinks href=#hl-11-96> 96</a>
</span><span class=lnt id=hl-11-97><a class=lnlinks href=#hl-11-97> 97</a>
</span><span class=lnt id=hl-11-98><a class=lnlinks href=#hl-11-98> 98</a>
</span><span class=lnt id=hl-11-99><a class=lnlinks href=#hl-11-99> 99</a>
</span><span class=lnt id=hl-11-100><a class=lnlinks href=#hl-11-100>100</a>
</span><span class=lnt id=hl-11-101><a class=lnlinks href=#hl-11-101>101</a>
</span><span class=lnt id=hl-11-102><a class=lnlinks href=#hl-11-102>102</a>
</span><span class=lnt id=hl-11-103><a class=lnlinks href=#hl-11-103>103</a>
</span><span class=lnt id=hl-11-104><a class=lnlinks href=#hl-11-104>104</a>
</span><span class=lnt id=hl-11-105><a class=lnlinks href=#hl-11-105>105</a>
</span><span class=lnt id=hl-11-106><a class=lnlinks href=#hl-11-106>106</a>
</span><span class=lnt id=hl-11-107><a class=lnlinks href=#hl-11-107>107</a>
</span><span class=lnt id=hl-11-108><a class=lnlinks href=#hl-11-108>108</a>
</span><span class=lnt id=hl-11-109><a class=lnlinks href=#hl-11-109>109</a>
</span><span class=lnt id=hl-11-110><a class=lnlinks href=#hl-11-110>110</a>
</span><span class=lnt id=hl-11-111><a class=lnlinks href=#hl-11-111>111</a>
</span><span class=lnt id=hl-11-112><a class=lnlinks href=#hl-11-112>112</a>
</span><span class=lnt id=hl-11-113><a class=lnlinks href=#hl-11-113>113</a>
</span><span class=lnt id=hl-11-114><a class=lnlinks href=#hl-11-114>114</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Module Loader configuration file ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[modules]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; I much prefer the whitelist approach of loading modules as I won&#39;t get anything that I don&#39;t need,</span>
</span></span><span class=line><span class=cl>  <span class=c1>; security through simplicity</span>
</span></span><span class=line><span class=cl>  <span class=na>autoload</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Uncomment the following if you wish to use the Speech Recognition API</span>
</span></span><span class=line><span class=cl>  <span class=c1>;preload =&gt; res_speech.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Essential modules needed for basic operations</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; app_dial.so           ; Used to connection channels together (i.e., make phone calls)
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; app_stack.so          ; Provides GoSub(), GoSubIf(), Return(), StackPop(), LOCAL(),
</span></span></span><span class=line><span class=cl><span class=s>                                ; and LOCAL_PEEK()
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; chan_sip.so           ; Session Initiation Protocol channel driver
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; pbx_config.so         ; This is the traditional, and most popular, dialplan language
</span></span></span><span class=line><span class=cl><span class=s>                                ; for Asterisk. Without this module, Asterisk cannot read
</span></span></span><span class=line><span class=cl><span class=s>                                ; extensions.conf
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; res_rtp_asterisk.so   ; Provides RTP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Security Modules</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; cdr_adaptive_odbc.so  ; Writes CDRs through ODBC framework to a database
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; cdr_csv.so            ; Write CDRs to a CSV file
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; cdr_syslog.so         ; Writes CDRs to syslog
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; res_security_log.so   ; Enables security logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Audio Codecs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Recommended Order:</span>
</span></span><span class=line><span class=cl>  <span class=c1>;       ulaw, alaw, gsm, g722, g726, speex</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Description:          A-law PCM codec used all over the world (except Canada/USA) on the PSTN</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                G.711 (alaw)</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    64 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:  0.125ms</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:   4.2</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          Yes</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_alaw.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Description:          Global System for Mobile Communications (GSM) codec</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                GSM-FR</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    13 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:   3.7</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          No</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_gsm.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Description:          Wideband audio codec</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                G.722</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    64 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          Maybe</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_g722.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Description:          Flavor of ADPCM</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                G.726</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    16-40 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:  0.125ms</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:   3.85</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          No</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_g726.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Open source speech codec</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                Speex</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    2.15-22.4 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:  30-34ms</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          No</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_speex.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Description:          Mu-law PCM codec used in Canada/USA on PSTN</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Codec:                G.711 (ulaw)</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Nominal Bandwidth:    64 kbit/s</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Algorithmic Latency:  0.125ms</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Mean Opinion Score:   4.2</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Fax Capable:          Yes</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Video Capable:        No</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_ulaw.so</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Audio Codec Converters</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; codec_resample.so  ; Re-samples between 8-bit and 16-bit signed linear
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; codec_a_mu.so      ; A-law to mu-law direct converter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Format Interpreters (used to read audio files from the disk)</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; format_ogg_vorbis.so  ; Play ogg vorbis files
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; format_wav.so         ; Play WAV files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Resources &amp; Function Modules</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; func_cdr.so         ; Used by cdr_syslog module to format it&#39;s output
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; func_strings.so     ; Used for security reasons on incoming calls from the PSTN lines
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; res_adsi.so         ; Used by voicemail
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; res_odbc.so         ; Used by the cdr_adaptive_odbc module
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; res_musiconhold.so  ; Provides music on hold resources</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Voicemail</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; app_voicemail_plain.so  ; Stores voicemails in files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Production Debug Tools</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; app_echo.so     ; Used in the echo channel to ensure two way audio is working
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; app_verbose.so  ; Used in the various channels to send messages to the console and logs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Used in various dialplans</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; app_playback.so  ; Plays back a pre-recorded audio file</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; For Caller ID information</span>
</span></span><span class=line><span class=cl>  <span class=na>load</span> <span class=o>=</span><span class=s>&gt; app_setcallerid.so
</span></span></span><span class=line><span class=cl><span class=s>  load =&gt; func_callerid.so</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskmusiconholdconf>/etc/asterisk/musiconhold.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- Music on Hold Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[default]</span>
</span></span><span class=line><span class=cl>  <span class=na>directory</span> <span class=o>=</span> <span class=s>moh  ; Directory relative to the astdatadir that has the music on hold files
</span></span></span><span class=line><span class=cl><span class=s>  mode = files     ; Read files from the configured directory
</span></span></span><span class=line><span class=cl><span class=s>  sort = random    ; Sort the files in random order</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskres_odbcconf>/etc/asterisk/res_odbc.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- ODBC Configuration File ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This &#39;context&#39; name is the name that other files will reference this by</span>
</span></span><span class=line><span class=cl><span class=k>[gentlemen]</span>
</span></span><span class=line><span class=cl>  <span class=na>enabled</span> <span class=o>=</span><span class=s>&gt; yes                    ; Not strictly necessary but a quick way to remind myself this can
</span></span></span><span class=line><span class=cl><span class=s>                                    ; be disabled without deleting or commenting out the whole thing
</span></span></span><span class=line><span class=cl><span class=s>  dsn =&gt; asterisk-gentlemen         ; This value should match an entry in /etc/odbc.ini
</span></span></span><span class=line><span class=cl><span class=s>  username =&gt; databaseuser          ; The username used to connect to the database
</span></span></span><span class=line><span class=cl><span class=s>  password =&gt; databasepass          ; Password for connecting to the database
</span></span></span><span class=line><span class=cl><span class=s>  pre-connect =&gt; yes                ; Open a connection as soon as asterisk starts
</span></span></span><span class=line><span class=cl><span class=s>  idlecheck =&gt; 3600                 ; How often should we check that the database connection is still
</span></span></span><span class=line><span class=cl><span class=s>                                    ; open? (in seconds)
</span></span></span><span class=line><span class=cl><span class=s>  share_connections =&gt; yes          ; Allow connections to be shared, this reduces overhead but doesn&#39;t
</span></span></span><span class=line><span class=cl><span class=s>                                    ; work on all databases
</span></span></span><span class=line><span class=cl><span class=s>  limit =&gt; 5                        ; What is the maximum number of database connections we can have open
</span></span></span><span class=line><span class=cl><span class=s>                                    ; at any one time?
</span></span></span><span class=line><span class=cl><span class=s>  connect_timeout =&gt; 5              ; How long should we attempt to connect before considering the
</span></span></span><span class=line><span class=cl><span class=s>                                    ; connection dead?
</span></span></span><span class=line><span class=cl><span class=s>  negative_connection_cache =&gt; 300  ; When a connection fails, how long should we cache that information
</span></span></span><span class=line><span class=cl><span class=s>                                    ; before we attempt another connection?</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasteriskrtpconf>/etc/asterisk/rtp.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- RTP Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=na>rtpstart</span><span class=o>=</span><span class=s>10000
</span></span></span><span class=line><span class=cl><span class=s>  rtpend=10100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>;rtpchecksums=no</span>
</span></span><span class=line><span class=cl>  <span class=c1>;dtmftimeout=3000</span>
</span></span><span class=line><span class=cl>  <span class=c1>;rtcpinterval = 5000    ; Milliseconds between rtcp reports</span>
</span></span><span class=line><span class=cl>                          <span class=c1>;(min 500, max 60000, default 5000)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Enable strict RTP protection. This will drop RTP packets that</span>
</span></span><span class=line><span class=cl>  <span class=c1>; do not come from the source of the RTP stream. This option is</span>
</span></span><span class=line><span class=cl>  <span class=c1>; disabled by default.</span>
</span></span><span class=line><span class=cl>  <span class=c1>;strictrtp=yes</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcasterisksipconf>/etc/asterisk/sip.conf</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>  1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>  2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>  3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>  4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5>  5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6>  6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7>  7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8>  8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9>  9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10> 10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11> 11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12> 12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13> 13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14> 14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15> 15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16> 16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17> 17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18> 18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19> 19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20> 20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21> 21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22> 22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23> 23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24> 24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25> 25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26> 26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27> 27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28> 28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29> 29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30> 30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31> 31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32> 32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33> 33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34> 34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35> 35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36> 36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37> 37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38> 38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39> 39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40> 40</a>
</span><span class=lnt id=hl-15-41><a class=lnlinks href=#hl-15-41> 41</a>
</span><span class=lnt id=hl-15-42><a class=lnlinks href=#hl-15-42> 42</a>
</span><span class=lnt id=hl-15-43><a class=lnlinks href=#hl-15-43> 43</a>
</span><span class=lnt id=hl-15-44><a class=lnlinks href=#hl-15-44> 44</a>
</span><span class=lnt id=hl-15-45><a class=lnlinks href=#hl-15-45> 45</a>
</span><span class=lnt id=hl-15-46><a class=lnlinks href=#hl-15-46> 46</a>
</span><span class=lnt id=hl-15-47><a class=lnlinks href=#hl-15-47> 47</a>
</span><span class=lnt id=hl-15-48><a class=lnlinks href=#hl-15-48> 48</a>
</span><span class=lnt id=hl-15-49><a class=lnlinks href=#hl-15-49> 49</a>
</span><span class=lnt id=hl-15-50><a class=lnlinks href=#hl-15-50> 50</a>
</span><span class=lnt id=hl-15-51><a class=lnlinks href=#hl-15-51> 51</a>
</span><span class=lnt id=hl-15-52><a class=lnlinks href=#hl-15-52> 52</a>
</span><span class=lnt id=hl-15-53><a class=lnlinks href=#hl-15-53> 53</a>
</span><span class=lnt id=hl-15-54><a class=lnlinks href=#hl-15-54> 54</a>
</span><span class=lnt id=hl-15-55><a class=lnlinks href=#hl-15-55> 55</a>
</span><span class=lnt id=hl-15-56><a class=lnlinks href=#hl-15-56> 56</a>
</span><span class=lnt id=hl-15-57><a class=lnlinks href=#hl-15-57> 57</a>
</span><span class=lnt id=hl-15-58><a class=lnlinks href=#hl-15-58> 58</a>
</span><span class=lnt id=hl-15-59><a class=lnlinks href=#hl-15-59> 59</a>
</span><span class=lnt id=hl-15-60><a class=lnlinks href=#hl-15-60> 60</a>
</span><span class=lnt id=hl-15-61><a class=lnlinks href=#hl-15-61> 61</a>
</span><span class=lnt id=hl-15-62><a class=lnlinks href=#hl-15-62> 62</a>
</span><span class=lnt id=hl-15-63><a class=lnlinks href=#hl-15-63> 63</a>
</span><span class=lnt id=hl-15-64><a class=lnlinks href=#hl-15-64> 64</a>
</span><span class=lnt id=hl-15-65><a class=lnlinks href=#hl-15-65> 65</a>
</span><span class=lnt id=hl-15-66><a class=lnlinks href=#hl-15-66> 66</a>
</span><span class=lnt id=hl-15-67><a class=lnlinks href=#hl-15-67> 67</a>
</span><span class=lnt id=hl-15-68><a class=lnlinks href=#hl-15-68> 68</a>
</span><span class=lnt id=hl-15-69><a class=lnlinks href=#hl-15-69> 69</a>
</span><span class=lnt id=hl-15-70><a class=lnlinks href=#hl-15-70> 70</a>
</span><span class=lnt id=hl-15-71><a class=lnlinks href=#hl-15-71> 71</a>
</span><span class=lnt id=hl-15-72><a class=lnlinks href=#hl-15-72> 72</a>
</span><span class=lnt id=hl-15-73><a class=lnlinks href=#hl-15-73> 73</a>
</span><span class=lnt id=hl-15-74><a class=lnlinks href=#hl-15-74> 74</a>
</span><span class=lnt id=hl-15-75><a class=lnlinks href=#hl-15-75> 75</a>
</span><span class=lnt id=hl-15-76><a class=lnlinks href=#hl-15-76> 76</a>
</span><span class=lnt id=hl-15-77><a class=lnlinks href=#hl-15-77> 77</a>
</span><span class=lnt id=hl-15-78><a class=lnlinks href=#hl-15-78> 78</a>
</span><span class=lnt id=hl-15-79><a class=lnlinks href=#hl-15-79> 79</a>
</span><span class=lnt id=hl-15-80><a class=lnlinks href=#hl-15-80> 80</a>
</span><span class=lnt id=hl-15-81><a class=lnlinks href=#hl-15-81> 81</a>
</span><span class=lnt id=hl-15-82><a class=lnlinks href=#hl-15-82> 82</a>
</span><span class=lnt id=hl-15-83><a class=lnlinks href=#hl-15-83> 83</a>
</span><span class=lnt id=hl-15-84><a class=lnlinks href=#hl-15-84> 84</a>
</span><span class=lnt id=hl-15-85><a class=lnlinks href=#hl-15-85> 85</a>
</span><span class=lnt id=hl-15-86><a class=lnlinks href=#hl-15-86> 86</a>
</span><span class=lnt id=hl-15-87><a class=lnlinks href=#hl-15-87> 87</a>
</span><span class=lnt id=hl-15-88><a class=lnlinks href=#hl-15-88> 88</a>
</span><span class=lnt id=hl-15-89><a class=lnlinks href=#hl-15-89> 89</a>
</span><span class=lnt id=hl-15-90><a class=lnlinks href=#hl-15-90> 90</a>
</span><span class=lnt id=hl-15-91><a class=lnlinks href=#hl-15-91> 91</a>
</span><span class=lnt id=hl-15-92><a class=lnlinks href=#hl-15-92> 92</a>
</span><span class=lnt id=hl-15-93><a class=lnlinks href=#hl-15-93> 93</a>
</span><span class=lnt id=hl-15-94><a class=lnlinks href=#hl-15-94> 94</a>
</span><span class=lnt id=hl-15-95><a class=lnlinks href=#hl-15-95> 95</a>
</span><span class=lnt id=hl-15-96><a class=lnlinks href=#hl-15-96> 96</a>
</span><span class=lnt id=hl-15-97><a class=lnlinks href=#hl-15-97> 97</a>
</span><span class=lnt id=hl-15-98><a class=lnlinks href=#hl-15-98> 98</a>
</span><span class=lnt id=hl-15-99><a class=lnlinks href=#hl-15-99> 99</a>
</span><span class=lnt id=hl-15-100><a class=lnlinks href=#hl-15-100>100</a>
</span><span class=lnt id=hl-15-101><a class=lnlinks href=#hl-15-101>101</a>
</span><span class=lnt id=hl-15-102><a class=lnlinks href=#hl-15-102>102</a>
</span><span class=lnt id=hl-15-103><a class=lnlinks href=#hl-15-103>103</a>
</span><span class=lnt id=hl-15-104><a class=lnlinks href=#hl-15-104>104</a>
</span><span class=lnt id=hl-15-105><a class=lnlinks href=#hl-15-105>105</a>
</span><span class=lnt id=hl-15-106><a class=lnlinks href=#hl-15-106>106</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>; --- SIP Configuration ---</span>
</span></span><span class=line><span class=cl><span class=c1>; Gentlemen</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[general]</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Features/SIP Defaults</span>
</span></span><span class=line><span class=cl>  <span class=na>allowguest</span> <span class=o>=</span> <span class=s>no            ; Disable unauthenticated call
</span></span></span><span class=line><span class=cl><span class=s>  alwaysauthreject = yes     ; Always respond as if every extension is valid, this makes brute force
</span></span></span><span class=line><span class=cl><span class=s>                             ; scanning of extensions pointless
</span></span></span><span class=line><span class=cl><span class=s>  canreinvite = no           ; Force all calls to be relayed through asterisk since SIP clients
</span></span></span><span class=line><span class=cl><span class=s>                             ; outside the firewall won&#39;t be able to directly talk to internal extensions
</span></span></span><span class=line><span class=cl><span class=s>  context = unauthenticated  ; Default context for incoming calls
</span></span></span><span class=line><span class=cl><span class=s>  dtmfmode = auto            ; Automatically detect the DTMF tranmission type
</span></span></span><span class=line><span class=cl><span class=s>  srvlookup = no             ; Disable DNS SRV record lookup on outbound calls
</span></span></span><span class=line><span class=cl><span class=s>  videosupport = yes         ; May be useful later when setting up video calls</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Network options</span>
</span></span><span class=line><span class=cl>  <span class=na>bindport</span> <span class=o>=</span> <span class=s>5060                      ; Explicitely bind to the default SIP port
</span></span></span><span class=line><span class=cl><span class=s>  externip = x.x.x.x                   ; The current external IP address of The Gentlemens Lounge
</span></span></span><span class=line><span class=cl><span class=s>  localnet = 10.13.37.0/255.255.255.0  ; Our internal subnet
</span></span></span><span class=line><span class=cl><span class=s>  tcpenable = yes                      ; We&#39;ll allow incoming connections via TCP as well
</span></span></span><span class=line><span class=cl><span class=s>  udpbindaddr = 10.13.37.xx            ; Listen for UDP requests on the primary interface</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Encryption settings</span>
</span></span><span class=line><span class=cl>  <span class=na>tlsenable</span> <span class=o>=</span> <span class=s>yes                          ; Turn encryption support on
</span></span></span><span class=line><span class=cl><span class=s>  tlsbindbindaddr = 10.13.37.xx            ; Listen for encrypted calls on the primary interface
</span></span></span><span class=line><span class=cl><span class=s>  tlscafile = /var/lib/asterisk/ca.crt     ; Certificate authority&#39;s cert
</span></span></span><span class=line><span class=cl><span class=s>  tlscertfile = /var/lib/asterisk/pbx.pem  ; This server&#39;s private key and certificate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Clear the list of codecs</span>
</span></span><span class=line><span class=cl>  <span class=na>disallow</span> <span class=o>=</span> <span class=s>all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>; Set a default order for our codecs, providing all of them will increase compatibility with other</span>
</span></span><span class=line><span class=cl>  <span class=c1>; internet clients. Notes on the quality tradeoff can be found in the module.conf file where these</span>
</span></span><span class=line><span class=cl>  <span class=c1>; codecs are loaded</span>
</span></span><span class=line><span class=cl>  <span class=na>allow</span> <span class=o>=</span> <span class=s>ulaw
</span></span></span><span class=line><span class=cl><span class=s>  allow = alaw
</span></span></span><span class=line><span class=cl><span class=s>  allow = gsm
</span></span></span><span class=line><span class=cl><span class=s>  allow = g722
</span></span></span><span class=line><span class=cl><span class=s>  allow = g726
</span></span></span><span class=line><span class=cl><span class=s>  allow = speex
</span></span></span><span class=line><span class=cl><span class=s>  allow = g729</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Template to restrict SIP users to only the local network</span>
</span></span><span class=line><span class=cl><span class=na>[localonly](!)</span>
</span></span><span class=line><span class=cl>  <span class=c1>; Start by denying everyone</span>
</span></span><span class=line><span class=cl>  <span class=na>deny</span> <span class=o>=</span> <span class=s>0.0.0.0/0.0.0.0
</span></span></span><span class=line><span class=cl><span class=s>  ; Allow connetion that originate from 10.13.37.X to attempt to authenticate against this account
</span></span></span><span class=line><span class=cl><span class=s>  permit = 10.13.37.0/255.255.255.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; A template for VoIP extensions that might connect from the outside</span>
</span></span><span class=line><span class=cl><span class=na>[sipclient](!)</span>
</span></span><span class=line><span class=cl>  <span class=na>context</span> <span class=o>=</span> <span class=s>internal  ; They should be in our internal context
</span></span></span><span class=line><span class=cl><span class=s>  host = dynamic      ; The clients will not be static (they could be anywhere)
</span></span></span><span class=line><span class=cl><span class=s>  type = friend       ; User type
</span></span></span><span class=line><span class=cl><span class=s>  qualify = yes       ; Talk to them frequently to make sure they&#39;re still there (and too hold
</span></span></span><span class=line><span class=cl><span class=s>                      ; firewall connections open)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Slight adjustment of the sipclient template to adjust that these extensions will be connecting from the outside</span>
</span></span><span class=line><span class=cl><span class=na>[roadwarrior](!,sipclient)</span>
</span></span><span class=line><span class=cl>  <span class=na>nat</span> <span class=o>=</span> <span class=s>yes  ; Yes, they&#39;re probably on the other side of our NAT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; This is specifically for my SPA-3000, I&#39;ve found that even though my device has a static addresses</span>
</span></span><span class=line><span class=cl><span class=c1>; I should leave the host type as dynamic as registrations cause errors in the asterisk log, I suppose it</span>
</span></span><span class=line><span class=cl><span class=c1>; would be possible to configure the LINE and PSTNIN as peers and turn off registrations in the Sipura&#39;s</span>
</span></span><span class=line><span class=cl><span class=c1>; configuration, which might be the better route to go. I will have to investigate this in the future but</span>
</span></span><span class=line><span class=cl><span class=c1>; this works for now.</span>
</span></span><span class=line><span class=cl><span class=na>[atadevice](!,sipclient,localonly)</span>
</span></span><span class=line><span class=cl>  <span class=na>nat</span> <span class=o>=</span> <span class=s>never  ; These devices should never be outside our NAT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Configuration for internal POTS line on the Linksys SPA-3000</span>
</span></span><span class=line><span class=cl><span class=na>[SPA3000_LINE](atadevice)</span>
</span></span><span class=line><span class=cl>  <span class=na>context</span> <span class=o>=</span> <span class=s>internal
</span></span></span><span class=line><span class=cl><span class=s>  port = 5060
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Configuration for incoming phone calls from the POTS line through the SPA-3000</span>
</span></span><span class=line><span class=cl><span class=na>[SPA3000_PSTNIN](atadevice)</span>
</span></span><span class=line><span class=cl>  <span class=na>context</span> <span class=o>=</span> <span class=s>pstnmenu
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; Configuration for incoming telephone line on the Linksys SPA-3000</span>
</span></span><span class=line><span class=cl><span class=na>[SPA3000_PSTNOUT](atadevice)</span>
</span></span><span class=line><span class=cl>  <span class=na>context</span> <span class=o>=</span> <span class=s>from-trunk
</span></span></span><span class=line><span class=cl><span class=s>  default-user = from-pbx
</span></span></span><span class=line><span class=cl><span class=s>  host = 10.13.37.xx
</span></span></span><span class=line><span class=cl><span class=s>  port = 5061
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>; SIP Users, these should have especially strong passwords. I use the following to generate</span>
</span></span><span class=line><span class=cl><span class=c1>; passwords for them:</span>
</span></span><span class=line><span class=cl><span class=c1>;      dd if=/dev/random count=2 bs=8 2&gt;/dev/null | base64 | sed -e &#39;s/=*$//&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>; It will create passwords like:</span>
</span></span><span class=line><span class=cl><span class=c1>;      9VkLRZz0s9GNFcAica0ONA</span>
</span></span><span class=line><span class=cl><span class=c1>;      SOhiPwA0pTupjFx/QCu7BA</span>
</span></span><span class=line><span class=cl><span class=c1>;      5Zw+5B8435lrMLKvsSNVpQ</span>
</span></span><span class=line><span class=cl><span class=na>[user1](roadwarrior)</span>
</span></span><span class=line><span class=cl>  <span class=na>callerid</span> <span class=o>=</span> <span class=s>&#34;User 1&#34;
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>[user2](roadwarrior)</span>
</span></span><span class=line><span class=cl>  <span class=na>callerid</span> <span class=o>=</span><span class=s>&#34;User 2&#34;
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>[user3](roadwarrior)</span>
</span></span><span class=line><span class=cl>  <span class=na>callerid</span> <span class=o>=</span> <span class=s>&#34;User 3&#34;
</span></span></span><span class=line><span class=cl><span class=s>  secret = setyourownpassword</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etcodbcini>/etc/odbc.ini</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5>5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6>6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7>7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[asterisk-gentlemen]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span> <span class=o>=</span> <span class=s>Database driver for Asterisk call logs</span>
</span></span><span class=line><span class=cl><span class=na>Trace</span>       <span class=o>=</span> <span class=s>Off</span>
</span></span><span class=line><span class=cl><span class=na>TraceFile</span>   <span class=o>=</span> <span class=s>stderr</span>
</span></span><span class=line><span class=cl><span class=na>Driver</span>      <span class=o>=</span> <span class=s>MySQL</span>
</span></span><span class=line><span class=cl><span class=na>SERVER</span>      <span class=o>=</span> <span class=s>mysqlserver.localhost</span>
</span></span><span class=line><span class=cl><span class=na>PORT</span>        <span class=o>=</span> <span class=s>3306</span>
</span></span><span class=line><span class=cl><span class=na>DATABASE</span>    <span class=o>=</span> <span class=s>gentlemen</span>
</span></span></code></pre></td></tr></table></div></div><p>Here is the schema for the table that I use:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1> 1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2> 2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3> 3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4> 4</a>
</span><span class=lnt id=hl-17-5><a class=lnlinks href=#hl-17-5> 5</a>
</span><span class=lnt id=hl-17-6><a class=lnlinks href=#hl-17-6> 6</a>
</span><span class=lnt id=hl-17-7><a class=lnlinks href=#hl-17-7> 7</a>
</span><span class=lnt id=hl-17-8><a class=lnlinks href=#hl-17-8> 8</a>
</span><span class=lnt id=hl-17-9><a class=lnlinks href=#hl-17-9> 9</a>
</span><span class=lnt id=hl-17-10><a class=lnlinks href=#hl-17-10>10</a>
</span><span class=lnt id=hl-17-11><a class=lnlinks href=#hl-17-11>11</a>
</span><span class=lnt id=hl-17-12><a class=lnlinks href=#hl-17-12>12</a>
</span><span class=lnt id=hl-17-13><a class=lnlinks href=#hl-17-13>13</a>
</span><span class=lnt id=hl-17-14><a class=lnlinks href=#hl-17-14>14</a>
</span><span class=lnt id=hl-17-15><a class=lnlinks href=#hl-17-15>15</a>
</span><span class=lnt id=hl-17-16><a class=lnlinks href=#hl-17-16>16</a>
</span><span class=lnt id=hl-17-17><a class=lnlinks href=#hl-17-17>17</a>
</span><span class=lnt id=hl-17-18><a class=lnlinks href=#hl-17-18>18</a>
</span><span class=lnt id=hl-17-19><a class=lnlinks href=#hl-17-19>19</a>
</span><span class=lnt id=hl-17-20><a class=lnlinks href=#hl-17-20>20</a>
</span><span class=lnt id=hl-17-21><a class=lnlinks href=#hl-17-21>21</a>
</span><span class=lnt id=hl-17-22><a class=lnlinks href=#hl-17-22>22</a>
</span><span class=lnt id=hl-17-23><a class=lnlinks href=#hl-17-23>23</a>
</span><span class=lnt id=hl-17-24><a class=lnlinks href=#hl-17-24>24</a>
</span><span class=lnt id=hl-17-25><a class=lnlinks href=#hl-17-25>25</a>
</span><span class=lnt id=hl-17-26><a class=lnlinks href=#hl-17-26>26</a>
</span><span class=lnt id=hl-17-27><a class=lnlinks href=#hl-17-27>27</a>
</span><span class=lnt id=hl-17-28><a class=lnlinks href=#hl-17-28>28</a>
</span><span class=lnt id=hl-17-29><a class=lnlinks href=#hl-17-29>29</a>
</span><span class=lnt id=hl-17-30><a class=lnlinks href=#hl-17-30>30</a>
</span><span class=lnt id=hl-17-31><a class=lnlinks href=#hl-17-31>31</a>
</span><span class=lnt id=hl-17-32><a class=lnlinks href=#hl-17-32>32</a>
</span><span class=lnt id=hl-17-33><a class=lnlinks href=#hl-17-33>33</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--
</span></span></span><span class=line><span class=cl><span class=c1>-- Database: `gentlemen`
</span></span></span><span class=line><span class=cl><span class=c1>--
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- --------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--
</span></span></span><span class=line><span class=cl><span class=c1>-- Table structure for table `asterisk`
</span></span></span><span class=line><span class=cl><span class=c1>--
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>asterisk</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>asterisk</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>call_id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>accountcode</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;An account ID. This field is user-defined and is empty by default.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>src</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The calling party’s caller ID number. It is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>dst</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The destination extension for the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>dcontext</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The destination context for the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>clid</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The full caller ID, including the name, of the calling party. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>channel</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The calling party’s channel. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>dstchannel</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The called party’s channel. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>lastapp</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The last dialplan application that was executed. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>lastdata</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The arguments passed to the lastapp. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=k>start</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The start time of the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>answer</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The answered time of the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=k>end</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The end time of the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>duration</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The number of seconds between the start and end times for the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>billsec</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The number of seconds between the answer and end times for the call. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>disposition</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;An indication of what happened to the call. This may be NO ANSWER, FAILED, BUSY, ANSWERED, or UNKNOWN.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>amaflags</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The Automatic Message Accounting (AMA) flag associated with this call. This may be one of the following: OMIT, BILLING, DOCUMENTATION, or Unknown.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>userfield</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;A general-purpose user field. This field is empty by default and can be set to a user-defined string.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>uniqueid</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;The unique ID for the src channel. This field is set automatically and is read-only.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>call_id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>MyISAM</span><span class=w>  </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>latin1</span><span class=w> </span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=music-on-hold>Music On Hold</h2><p>The way that music on hold is configured in the dial plan on this page it will look for files in the directory "/usr/share/asterisk/moh/". Files will be chosen at random from this directory as long as asterisk can read them (that is it has a codec for the audio file loaded). I strongly suggest the music be in "ogg" format.</p><h2 id=text-to-speech>Text to Speech</h2><p>Please refer to my notes on <a href=/notes/festival/>Festival</a> for more information on text to speech with asterisk.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/operations/>operations</a></span>
<span class=tag><a href=https://stelfox.net/tags/telephony/>telephony</a></span>
<span class=tag><a href=https://stelfox.net/tags/voip/>voip</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=fbd8ca38d421539154d91c5d7396464201f62ccb target=_blank rel=noopener>fbd8ca38</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>