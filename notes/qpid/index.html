<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Qpid is an open source AMQP broker, providing transaction management, queuing, distribution, security, management, clustering, and federation.
http://wiki.openstack.org/QpidSupport http://www.linuxjournal.com/magazine/advanced-message-queuing-protocol-amqp?page=0,1 InstallationFedora provides a package for qpid called qpid-cpp-server which can be installed like so:
yum install qpid-cpp-server qpid-cpp-server-ssl qpid-cpp-server-store \ qpid-cpp-server-ha -y Additional packages that may be of use:"><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/qpid/><title>Qpid :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Qpid"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Qpid is an open source AMQP broker, providing transaction management, queuing, distribution, security, management, clustering, and federation.
http://wiki.openstack.org/QpidSupport http://www.linuxjournal.com/magazine/advanced-message-queuing-protocol-amqp?page=0,1 InstallationFedora provides a package for qpid called qpid-cpp-server which can be installed like so:
yum install qpid-cpp-server qpid-cpp-server-ssl qpid-cpp-server-store \ qpid-cpp-server-ha -y Additional packages that may be of use:"><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="1588"><meta name=twitter:card content="summary"><meta name=twitter:title content="Qpid"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Qpid is an open source AMQP broker, providing transaction management, queuing, distribution, security, management, clustering, and federation.
http://wiki.openstack.org/QpidSupport http://www.linuxjournal.com/magazine/advanced-message-queuing-protocol-amqp?page=0,1 InstallationFedora provides a package for qpid called qpid-cpp-server which can be installed like so:
yum install qpid-cpp-server qpid-cpp-server-ssl qpid-cpp-server-store \ qpid-cpp-server-ha -y Additional packages that may be of use:"><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/qpid/>Qpid</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><p>Qpid is an open source AMQP broker, providing transaction management, queuing,
distribution, security, management, clustering, and federation.</p><ul><li><a href=http://wiki.openstack.org/QpidSupport>http://wiki.openstack.org/QpidSupport</a></li><li><a href="http://www.linuxjournal.com/magazine/advanced-message-queuing-protocol-amqp?page=0,1">http://www.linuxjournal.com/magazine/advanced-message-queuing-protocol-amqp?page=0,1</a></li></ul><h2 id=installation>Installation</h2><p>Fedora provides a package for qpid called <code>qpid-cpp-server</code> which can be
installed like so:</p><pre tabindex=0><code>yum install qpid-cpp-server qpid-cpp-server-ssl qpid-cpp-server-store \
  qpid-cpp-server-ha -y
</code></pre><p>Additional packages that may be of use:</p><ul><li>qpid-tools</li><li>qpid-qmf</li></ul><h2 id=configuration>Configuration</h2><p>The following configuration file assumes the rest of the configuration on this
page. You'll want to replace the existing configuration at <code>/etc/qpidd.conf</code>
with the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>  1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>  2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>  3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>  4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>  5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>  6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>  7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>  8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>  9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10> 10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11> 11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12> 12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13> 13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14> 14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15> 15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16> 16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17> 17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18> 18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19> 19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20> 20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21> 21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22> 22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23> 23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24> 24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25> 25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26> 26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27> 27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28> 28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29> 29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30> 30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31> 31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32> 32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33> 33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34> 34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35> 35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36> 36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37> 37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38> 38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39> 39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40> 40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41> 41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42> 42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43> 43</a>
</span><span class=lnt id=hl-1-44><a class=lnlinks href=#hl-1-44> 44</a>
</span><span class=lnt id=hl-1-45><a class=lnlinks href=#hl-1-45> 45</a>
</span><span class=lnt id=hl-1-46><a class=lnlinks href=#hl-1-46> 46</a>
</span><span class=lnt id=hl-1-47><a class=lnlinks href=#hl-1-47> 47</a>
</span><span class=lnt id=hl-1-48><a class=lnlinks href=#hl-1-48> 48</a>
</span><span class=lnt id=hl-1-49><a class=lnlinks href=#hl-1-49> 49</a>
</span><span class=lnt id=hl-1-50><a class=lnlinks href=#hl-1-50> 50</a>
</span><span class=lnt id=hl-1-51><a class=lnlinks href=#hl-1-51> 51</a>
</span><span class=lnt id=hl-1-52><a class=lnlinks href=#hl-1-52> 52</a>
</span><span class=lnt id=hl-1-53><a class=lnlinks href=#hl-1-53> 53</a>
</span><span class=lnt id=hl-1-54><a class=lnlinks href=#hl-1-54> 54</a>
</span><span class=lnt id=hl-1-55><a class=lnlinks href=#hl-1-55> 55</a>
</span><span class=lnt id=hl-1-56><a class=lnlinks href=#hl-1-56> 56</a>
</span><span class=lnt id=hl-1-57><a class=lnlinks href=#hl-1-57> 57</a>
</span><span class=lnt id=hl-1-58><a class=lnlinks href=#hl-1-58> 58</a>
</span><span class=lnt id=hl-1-59><a class=lnlinks href=#hl-1-59> 59</a>
</span><span class=lnt id=hl-1-60><a class=lnlinks href=#hl-1-60> 60</a>
</span><span class=lnt id=hl-1-61><a class=lnlinks href=#hl-1-61> 61</a>
</span><span class=lnt id=hl-1-62><a class=lnlinks href=#hl-1-62> 62</a>
</span><span class=lnt id=hl-1-63><a class=lnlinks href=#hl-1-63> 63</a>
</span><span class=lnt id=hl-1-64><a class=lnlinks href=#hl-1-64> 64</a>
</span><span class=lnt id=hl-1-65><a class=lnlinks href=#hl-1-65> 65</a>
</span><span class=lnt id=hl-1-66><a class=lnlinks href=#hl-1-66> 66</a>
</span><span class=lnt id=hl-1-67><a class=lnlinks href=#hl-1-67> 67</a>
</span><span class=lnt id=hl-1-68><a class=lnlinks href=#hl-1-68> 68</a>
</span><span class=lnt id=hl-1-69><a class=lnlinks href=#hl-1-69> 69</a>
</span><span class=lnt id=hl-1-70><a class=lnlinks href=#hl-1-70> 70</a>
</span><span class=lnt id=hl-1-71><a class=lnlinks href=#hl-1-71> 71</a>
</span><span class=lnt id=hl-1-72><a class=lnlinks href=#hl-1-72> 72</a>
</span><span class=lnt id=hl-1-73><a class=lnlinks href=#hl-1-73> 73</a>
</span><span class=lnt id=hl-1-74><a class=lnlinks href=#hl-1-74> 74</a>
</span><span class=lnt id=hl-1-75><a class=lnlinks href=#hl-1-75> 75</a>
</span><span class=lnt id=hl-1-76><a class=lnlinks href=#hl-1-76> 76</a>
</span><span class=lnt id=hl-1-77><a class=lnlinks href=#hl-1-77> 77</a>
</span><span class=lnt id=hl-1-78><a class=lnlinks href=#hl-1-78> 78</a>
</span><span class=lnt id=hl-1-79><a class=lnlinks href=#hl-1-79> 79</a>
</span><span class=lnt id=hl-1-80><a class=lnlinks href=#hl-1-80> 80</a>
</span><span class=lnt id=hl-1-81><a class=lnlinks href=#hl-1-81> 81</a>
</span><span class=lnt id=hl-1-82><a class=lnlinks href=#hl-1-82> 82</a>
</span><span class=lnt id=hl-1-83><a class=lnlinks href=#hl-1-83> 83</a>
</span><span class=lnt id=hl-1-84><a class=lnlinks href=#hl-1-84> 84</a>
</span><span class=lnt id=hl-1-85><a class=lnlinks href=#hl-1-85> 85</a>
</span><span class=lnt id=hl-1-86><a class=lnlinks href=#hl-1-86> 86</a>
</span><span class=lnt id=hl-1-87><a class=lnlinks href=#hl-1-87> 87</a>
</span><span class=lnt id=hl-1-88><a class=lnlinks href=#hl-1-88> 88</a>
</span><span class=lnt id=hl-1-89><a class=lnlinks href=#hl-1-89> 89</a>
</span><span class=lnt id=hl-1-90><a class=lnlinks href=#hl-1-90> 90</a>
</span><span class=lnt id=hl-1-91><a class=lnlinks href=#hl-1-91> 91</a>
</span><span class=lnt id=hl-1-92><a class=lnlinks href=#hl-1-92> 92</a>
</span><span class=lnt id=hl-1-93><a class=lnlinks href=#hl-1-93> 93</a>
</span><span class=lnt id=hl-1-94><a class=lnlinks href=#hl-1-94> 94</a>
</span><span class=lnt id=hl-1-95><a class=lnlinks href=#hl-1-95> 95</a>
</span><span class=lnt id=hl-1-96><a class=lnlinks href=#hl-1-96> 96</a>
</span><span class=lnt id=hl-1-97><a class=lnlinks href=#hl-1-97> 97</a>
</span><span class=lnt id=hl-1-98><a class=lnlinks href=#hl-1-98> 98</a>
</span><span class=lnt id=hl-1-99><a class=lnlinks href=#hl-1-99> 99</a>
</span><span class=lnt id=hl-1-100><a class=lnlinks href=#hl-1-100>100</a>
</span><span class=lnt id=hl-1-101><a class=lnlinks href=#hl-1-101>101</a>
</span><span class=lnt id=hl-1-102><a class=lnlinks href=#hl-1-102>102</a>
</span><span class=lnt id=hl-1-103><a class=lnlinks href=#hl-1-103>103</a>
</span><span class=lnt id=hl-1-104><a class=lnlinks href=#hl-1-104>104</a>
</span><span class=lnt id=hl-1-105><a class=lnlinks href=#hl-1-105>105</a>
</span><span class=lnt id=hl-1-106><a class=lnlinks href=#hl-1-106>106</a>
</span><span class=lnt id=hl-1-107><a class=lnlinks href=#hl-1-107>107</a>
</span><span class=lnt id=hl-1-108><a class=lnlinks href=#hl-1-108>108</a>
</span><span class=lnt id=hl-1-109><a class=lnlinks href=#hl-1-109>109</a>
</span><span class=lnt id=hl-1-110><a class=lnlinks href=#hl-1-110>110</a>
</span><span class=lnt id=hl-1-111><a class=lnlinks href=#hl-1-111>111</a>
</span><span class=lnt id=hl-1-112><a class=lnlinks href=#hl-1-112>112</a>
</span><span class=lnt id=hl-1-113><a class=lnlinks href=#hl-1-113>113</a>
</span><span class=lnt id=hl-1-114><a class=lnlinks href=#hl-1-114>114</a>
</span><span class=lnt id=hl-1-115><a class=lnlinks href=#hl-1-115>115</a>
</span><span class=lnt id=hl-1-116><a class=lnlinks href=#hl-1-116>116</a>
</span><span class=lnt id=hl-1-117><a class=lnlinks href=#hl-1-117>117</a>
</span><span class=lnt id=hl-1-118><a class=lnlinks href=#hl-1-118>118</a>
</span><span class=lnt id=hl-1-119><a class=lnlinks href=#hl-1-119>119</a>
</span><span class=lnt id=hl-1-120><a class=lnlinks href=#hl-1-120>120</a>
</span><span class=lnt id=hl-1-121><a class=lnlinks href=#hl-1-121>121</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>##### General Configuration #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Directory to contain persistent data</span>
</span></span><span class=line><span class=cl><span class=na>data-dir</span><span class=o>=</span><span class=s>/var/lib/qpidd/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>worker-threads</span><span class=o>=</span><span class=s>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Queue Configuration #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set queue events async, used for services like replication</span>
</span></span><span class=line><span class=cl><span class=na>async-queue-events</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># How often to attempt purging expired messages from the queues</span>
</span></span><span class=line><span class=cl><span class=na>queue-purge-interval</span><span class=o>=</span><span class=s>600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Default storage limit of any given queue</span>
</span></span><span class=line><span class=cl><span class=na>default-queue-limit</span><span class=o>=</span><span class=s>104857600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The ratio of any specified queue limit at which an event will be raised</span>
</span></span><span class=line><span class=cl><span class=na>default-event-threshold-ratio</span><span class=o>=</span><span class=s>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Percent of queues maximum capacity at which flow control is activated and</span>
</span></span><span class=line><span class=cl><span class=c1># deactivated.</span>
</span></span><span class=line><span class=cl><span class=na>default-flow-stop-threshold</span><span class=o>=</span><span class=s>80</span>
</span></span><span class=line><span class=cl><span class=na>default-flow-resume-threshold</span><span class=o>=</span><span class=s>70</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Group identifier to assign to messages delivered to a message group queue that</span>
</span></span><span class=line><span class=cl><span class=c1># do not contain an identifier.</span>
</span></span><span class=line><span class=cl><span class=na>default-message-group</span><span class=o>=</span><span class=s>qpid.no-group</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Add current time to each received message</span>
</span></span><span class=line><span class=cl><span class=na>enable-timestamp</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Management Options #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Enable management, publishing data every 10 seconds, with QMF protocol 1 and</span>
</span></span><span class=line><span class=cl><span class=c1># 2</span>
</span></span><span class=line><span class=cl><span class=na>mgmt-enable</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>mgmt-publish</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>mgmt-pub-interval</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl><span class=na>mgmt-qmf1</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>mgmt-qmf2</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Networking Configuration #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>connection-backlog</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>link-heartbeat-interval</span><span class=o>=</span><span class=s>120</span>
</span></span><span class=line><span class=cl><span class=na>link-maintenace-interval</span><span class=o>=</span><span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Maximum time a connection can take to send the initial protocol negotiation</span>
</span></span><span class=line><span class=cl><span class=c1># (in milliseconds).</span>
</span></span><span class=line><span class=cl><span class=na>max-negotiate-time</span><span class=o>=</span><span class=s>2000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Port to listen on for unencrypted connections</span>
</span></span><span class=line><span class=cl><span class=na>port</span><span class=o>=</span><span class=s>5672</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set TCP_NODELAY on TCP connections</span>
</span></span><span class=line><span class=cl><span class=na>tcp-nodelay</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Logging Options #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>log-enable</span><span class=o>=</span><span class=s>info+</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>log-category</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>log-level</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>log-time</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>log-to-stderr</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>log-to-stdout</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>log-to-syslog</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Persistent Storage Options #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Number of pages in each journal (1 page is 64Kb)</span>
</span></span><span class=line><span class=cl><span class=na>jfile-size-pgs</span><span class=o>=</span><span class=s>24</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Default number of files for each journal instance (queue)</span>
</span></span><span class=line><span class=cl><span class=na>num-jfiles</span><span class=o>=</span><span class=s>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>truncate</span><span class=o>=</span><span class=s>no</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Size of the pages in the write page cache in Kb, allowable values are powers</span>
</span></span><span class=line><span class=cl><span class=c1># of 2</span>
</span></span><span class=line><span class=cl><span class=na>wcache-page-size</span><span class=o>=</span><span class=s>32</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### Authentication &amp; Authorization Configurations #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Enable authentication, and configured to use the QPID realm</span>
</span></span><span class=line><span class=cl><span class=na>auth</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>realm</span><span class=o>=</span><span class=s>QPID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get SASL configuration from standard redhat location</span>
</span></span><span class=line><span class=cl><span class=na>sasl-config</span><span class=o>=</span><span class=s>/etc/sasl2/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The policy file to load from, loaded from the data dir</span>
</span></span><span class=line><span class=cl><span class=na>acl-file</span><span class=o>=</span><span class=s>qpid.acl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Maximum combined number of connections allowed (0 is no limit)</span>
</span></span><span class=line><span class=cl><span class=na>max-connections</span><span class=o>=</span><span class=s>500</span>
</span></span><span class=line><span class=cl><span class=na>max-connections-per-user</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl><span class=na>max-connections-per-ip</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##### SSL Settings #####</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ssl-port</span><span class=o>=</span><span class=s>5671</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># File containing password to use for accessing the certificate database</span>
</span></span><span class=line><span class=cl><span class=na>ssl-cert-password-file</span><span class=o>=</span><span class=s>/var/lib/qpidd/ssl-db-pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Where the cert database is stored, the data directory is as good as any</span>
</span></span><span class=line><span class=cl><span class=na>ssl-cert-db</span><span class=o>=</span><span class=s>/var/lib/qpidd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Name of the cerificate to use (usually the hostname)</span>
</span></span><span class=line><span class=cl><span class=na>ssl-cert-name</span><span class=o>=</span><span class=s>agni</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Whether or not the server will accept unencrypted connections, there is of</span>
</span></span><span class=line><span class=cl><span class=c1># course overhead to encrypted connections and if the only services that will</span>
</span></span><span class=line><span class=cl><span class=c1># be talking to it will be the localhost then there is no need to require it...</span>
</span></span><span class=line><span class=cl><span class=c1># External connections should of course be encrypted wherever possible.</span>
</span></span><span class=line><span class=cl><span class=na>require-encryption</span><span class=o>=</span><span class=s>no</span>
</span></span></code></pre></td></tr></table></div></div><p>You'll want to enable and start the service once the configuration is complete.</p><pre tabindex=0><code>systemctl enable qpidd.service
systemctl start qpidd.service
</code></pre><h3 id=enabling-userpass-authentication>Enabling User/Pass Authentication</h3><p>By default only ANONYMOUS authentication is enabled which isn't good for any
production systems... Qpid uses SASL for user authentication and that is how we
need to configure what system to make use of. Open up the file
<code>/etc/sasl2/qpidd.conf</code> and replace it's contents with the following:</p><pre tabindex=0><code>auxprop_plugin: sasldb
mech_list: DIGEST-MD5 PLAIN+SSL
pwcheck_method: auxprop
sasldb_path: /var/lib/qpidd/qpidd.sasldb
sql_select: dummy select
</code></pre><h3 id=creating-users>Creating Users</h3><p>I've named the SASL authentication realm after the service that uses it, in
this case Qpid (makes sense no?). You'll need to create at least one user to
make use of authentication, I chose to make one user for administration tasks
(admin), and one per server named after the server (in this case the server is
named openstack after the service I mainly use Qpid for).</p><p>Create the user's as root:</p><pre tabindex=0><code>saslpasswd2 -f /var/lib/qpidd/qpidd.sasldb -u QPID admin
saslpasswd2 -f /var/lib/qpidd/qpidd.sasldb -u QPID openstack
</code></pre><p>Set STRONG passwords for both as arbitrary instructions can be provided to
various openstack services through this service.</p><p>The saslpasswd2 command will additionally create the password file, but with
incorrect permissions. Set the ownership and strengthen the permissions like
so:</p><pre tabindex=0><code>chown qpidd:qpidd /var/lib/qpidd/qpidd.sasldb
chmod 0640 /var/lib/qpidd/qpidd.sasldb
</code></pre><p>If you have started Qpid with <code>auth=yes</code> configured before creating the account
it will automatically create this file and add a user with the username and
password 'guest'.</p><h3 id=listing-users>Listing Users</h3><p>You can list all the configured realm / username combinations with the
following command:</p><pre tabindex=0><code>sasldblistusers2 -f /var/lib/qpidd/qpidd.sasldb
</code></pre><h3 id=user-acls>User ACLs</h3><p>The ACL files are pretty straight-forward and plain text. The file lives at
<code>/var/lib/qpidd/qpid.acl</code> which doesn't exist initially and will need to be
created. This is a solid initial ACL allowing the admin and openstack access to
any permissions they need while preventing anything else.</p><p>In the future I'll need to make this more fine-grained. This is more useful
when using Kerberos as the back end which would have more users you wouldn't
want to have access.</p><pre tabindex=0><code># Define the admins and let them do whatever they want
group admins admin@Qpid
acl allow admins all all

# Define the server accounts and set their permissions
group servers openstack@Qpid
acl allow servers all all

# Default deny with logging on any other attempts
acl deny-log all all
</code></pre><p>Ensure the ownership and permissions on the file are appropriate:</p><pre tabindex=0><code>chown qpidd:qpidd /var/lib/qpidd/qpid.acl
chmod 0640 /var/lib/qpidd/qpid.acl
</code></pre><h4 id=acl-bml-syntax>ACL BML Syntax</h4><p>ACLs are case-insensitve, all white space is essentially ignored except when
delimiting between syntax types. Lines can be wrapped by ending the line with a
backslash.</p><pre tabindex=0><code>user = username[/domain[@realm]]
user-list = user1 user2 user3 ...
group-name-list = group1 group2 group3 ...

group &lt;group-name&gt; = [user-list] [group-name-list]

permission = [allow|allow-log|deny|deny-log]
action = [consume|publish|create|access|bind|unbind|delete|purge|update]
object = [virtualhost|queue|exchange|broker|link|route|method]
property = [name|durable|owner|routingkey|autodelete|exclusive|
            type|alternate|queuename|schemapackage|schemaclass|
            queuemaxsizelowerlimit|queuemaxsizeupperlimit|
            queuemaxcountlowerlimit|queuemaxcountupperlimit]

acl permission {&lt;group-name&gt;|&lt;user-name&gt;|&#34;all&#34;} {action|&#34;all&#34;} [object|&#34;all&#34; 
            [property=&lt;property-value&gt; ...]]
</code></pre><h4 id=action-listing>Action Listing</h4><table><thead><tr><th>Action</th><th>Description</th></tr></thead><tbody><tr><td>consume</td><td>Applied when subscriptions are created</td></tr><tr><td>publish</td><td>Applied on a per message basis on publish message transfers, this rule consumes the most resources</td></tr><tr><td>create</td><td>Applied when an object is created, such as bindings, queues, exchanges, links</td></tr><tr><td>access</td><td>Applied when an object is read or accessed</td></tr><tr><td>bind</td><td>Applied when objects are bound together</td></tr><tr><td>unbind</td><td>Applied when objects are unbound</td></tr><tr><td>delete</td><td>Applied when objects are deleted</td></tr><tr><td>purge</td><td>Similar to delete but the action is performed on more than one object</td></tr><tr><td>update</td><td>Applied when an object is updated</td></tr></tbody></table><h4 id=object-listing>Object Listing</h4><table><thead><tr><th>Object</th><th>Description</th></tr></thead><tbody><tr><td>queue</td><td>A queue</td></tr><tr><td>exchange</td><td>An exchange</td></tr><tr><td>broker</td><td>The broker</td></tr><tr><td>link</td><td>A federation or inter-broker link</td></tr><tr><td>method</td><td>Management or agent or broker method</td></tr></tbody></table><h4 id=property-listing>Property Listing</h4><table><thead><tr><th>Property</th><th>Type</th><th>Description</th><th>Usage</th></tr></thead><tbody><tr><td>name</td><td>String</td><td>Object name, such as a queue name or exchange name.</td><td></td></tr><tr><td>durable</td><td>Boolean</td><td>Indicates the object is durable</td><td>CREATE QUEUE, CREATE EXCHANGE</td></tr><tr><td>routingkey</td><td>String</td><td>Specifies routing key</td><td>BIND EXCHANGE, UNBIND EXCHANGE, ACCESS EXCHANGE</td></tr><tr><td>autodelete</td><td>Boolean</td><td>Indicates whether or not the object gets deleted when the connection is closed</td><td>CREATE QUEUE</td></tr><tr><td>exclusive</td><td>Boolean</td><td>Indicates the presence of an exclusive flag</td><td>CREATE QUEUE</td></tr><tr><td>type</td><td>String</td><td>Type of exchange, such as topic, fanout, or xml</td><td>CREATE EXCHANGE</td></tr><tr><td>alternate</td><td>String</td><td>Name of the alternate exchange</td><td>CREATE EXCHANGE, CREATE QUEUE</td></tr><tr><td>queuename</td><td>String</td><td>Name of the queue</td><td>ACCESS EXCHANGE</td></tr><tr><td>schemapackage</td><td>String</td><td>QMF schema package name</td><td>ACCESS METHOD</td></tr><tr><td>schemaclass</td><td>String</td><td>QMF schema class name</td><td>ACCESS METHOD</td></tr><tr><td>queuemaxsizelowerlimit</td><td>Integer</td><td>Minimum value for queue.max_size</td><td>CREATE QUEUE</td></tr><tr><td>queuemaxsizeupperlimit</td><td>Integer</td><td>Maximum value for queue.max_size</td><td>CREATE QUEUE</td></tr><tr><td>queuemaxcountlowerlimit</td><td>Integer</td><td>Minimum value for queue.max_count</td><td>CREATE QUEUE</td></tr><tr><td>queuemaxcountupperlimit</td><td>Integer</td><td>Maximum value for queue.max_count</td><td>CREATE QUEUE</td></tr></tbody></table><h3 id=ssl>SSL</h3><p>Unfortunately SSL for Qpid isn't as easy as generating PEM certificates and
pointing the config at them. Qpid makes use of a Mozilla Network Security
Services database. These databases can be created using certutil.</p><p>First we'll need to initialize the database:</p><pre tabindex=0><code>certutil -N -d /var/lib/qpidd/
</code></pre><p>Provide a strong password to the database and put a copy in the file
<code>/var/lib/qpidd/ssl-db-pass</code> on it's own with no newline.</p><p>I already have PKI in place and a trusted <a href=https://stelfox.net/notes/certificate-authority/>Certificate Authority</a>, so I
just have to import my trusted certificate authority chain. Generate a
certificate for this server and import it's certificate and chain.</p><p>Import the CA cert:</p><pre tabindex=0><code>certutil -A -n cert-authority -t &#34;TC,,&#34; -i ca.crt -d /var/lib/qpidd
</code></pre><p>The server certificate is a bit trickier, before we can import an OpenSSL
generated PEM format key set we'll need to convert it to a pkcs12 file, luckily
OpenSSL plays well with others:</p><pre tabindex=0><code>openssl pkcs12 -export -out qpid.pfx -inkey qpid.key -in qpid.crt -certfile ca.crt
</code></pre><p>Import the newly generate pkcs12 file, it will firstly ask for the password for
the database, and then the password for the pkcs12 file:</p><pre tabindex=0><code>pk12util -d /var/lib/qpidd/ -i qpid.pfx
</code></pre><p>And be sure to clean up after yourself:</p><pre tabindex=0><code>rm qpid.pfx
</code></pre><p>Set the permissions on all of the files we just created:</p><pre tabindex=0><code>chown qpidd:qpidd /var/lib/qpidd/{cert8.db,key3.db,ssl-db-pass}
chmod 0640 /var/lib/qpidd/{cert8.db,key3.db,ssl-db-pass}
</code></pre><h3 id=firewall>Firewall</h3><pre tabindex=0><code># Encrypted Qpid connections (Unencrypted are 5672 but those shouldn&#39;t be
# accessed remotely)
-A SERVICE -m tcp -p tcp --dport 5671 -j ACCEPT
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>