<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/ http://gofedora.com/how-to-configure-squid-proxy-server/ http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos http://wiki.squid-cache.org/Features/NegotiateAuthentication http://www.squid-cache.org/Versions/v3/3.2/cfgman/ For URL filtering please refer to the SquidGuard page.
yum install squid -y Before configuring squid we mind as well get the authentication credentials in place. To do this we make use of the htpasswd utility which can be installed through the httpd-tools package."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/squid/><title>Squid :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Squid"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/ http://gofedora.com/how-to-configure-squid-proxy-server/ http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos http://wiki.squid-cache.org/Features/NegotiateAuthentication http://www.squid-cache.org/Versions/v3/3.2/cfgman/ For URL filtering please refer to the SquidGuard page.
yum install squid -y Before configuring squid we mind as well get the authentication credentials in place. To do this we make use of the htpasswd utility which can be installed through the httpd-tools package."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="2045"><meta name=twitter:card content="summary"><meta name=twitter:title content="Squid"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/ http://gofedora.com/how-to-configure-squid-proxy-server/ http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos http://wiki.squid-cache.org/Features/NegotiateAuthentication http://www.squid-cache.org/Versions/v3/3.2/cfgman/ For URL filtering please refer to the SquidGuard page.
yum install squid -y Before configuring squid we mind as well get the authentication credentials in place. To do this we make use of the htpasswd utility which can be installed through the httpd-tools package."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/squid/>Squid</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><ul><li><a href=http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/>http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/</a></li><li><a href=http://gofedora.com/how-to-configure-squid-proxy-server/>http://gofedora.com/how-to-configure-squid-proxy-server/</a></li><li><a href=http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html>http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html</a></li><li><a href=http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos>http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos</a></li><li><a href=http://wiki.squid-cache.org/Features/NegotiateAuthentication>http://wiki.squid-cache.org/Features/NegotiateAuthentication</a></li><li><a href=http://www.squid-cache.org/Versions/v3/3.2/cfgman/>http://www.squid-cache.org/Versions/v3/3.2/cfgman/</a></li></ul><p>For URL filtering please refer to the <a href=https://stelfox.net/notes/squid-guard/>SquidGuard</a> page.</p><pre tabindex=0><code>yum install squid -y
</code></pre><p>Before configuring squid we mind as well get the authentication credentials in
place. To do this we make use of the <code>htpasswd</code> utility which can be installed
through the <code>httpd-tools</code> package.</p><p>For the first account:</p><pre tabindex=0><code>htpasswd -b -c /etc/squid/accounts username password
</code></pre><p>And subsequent accounts:</p><pre tabindex=0><code>htpasswd -b /etc/squid/accounts username2 password2
</code></pre><p>Lets drop the config into place, this is fairly generic there are just a few IP
addresses, networks, and emails to change. It should live at
<code>/etc/squid/squid.conf</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>  1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>  2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>  3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>  4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>  5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>  6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7>  7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8>  8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9>  9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10> 10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11> 11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12> 12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13> 13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14> 14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15> 15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16> 16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17> 17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18> 18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19> 19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20> 20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21> 21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22> 22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23> 23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24> 24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25> 25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26> 26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27> 27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28> 28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29> 29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30> 30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31> 31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32> 32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33> 33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34> 34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35> 35</a>
</span><span class=lnt id=hl-3-36><a class=lnlinks href=#hl-3-36> 36</a>
</span><span class=lnt id=hl-3-37><a class=lnlinks href=#hl-3-37> 37</a>
</span><span class=lnt id=hl-3-38><a class=lnlinks href=#hl-3-38> 38</a>
</span><span class=lnt id=hl-3-39><a class=lnlinks href=#hl-3-39> 39</a>
</span><span class=lnt id=hl-3-40><a class=lnlinks href=#hl-3-40> 40</a>
</span><span class=lnt id=hl-3-41><a class=lnlinks href=#hl-3-41> 41</a>
</span><span class=lnt id=hl-3-42><a class=lnlinks href=#hl-3-42> 42</a>
</span><span class=lnt id=hl-3-43><a class=lnlinks href=#hl-3-43> 43</a>
</span><span class=lnt id=hl-3-44><a class=lnlinks href=#hl-3-44> 44</a>
</span><span class=lnt id=hl-3-45><a class=lnlinks href=#hl-3-45> 45</a>
</span><span class=lnt id=hl-3-46><a class=lnlinks href=#hl-3-46> 46</a>
</span><span class=lnt id=hl-3-47><a class=lnlinks href=#hl-3-47> 47</a>
</span><span class=lnt id=hl-3-48><a class=lnlinks href=#hl-3-48> 48</a>
</span><span class=lnt id=hl-3-49><a class=lnlinks href=#hl-3-49> 49</a>
</span><span class=lnt id=hl-3-50><a class=lnlinks href=#hl-3-50> 50</a>
</span><span class=lnt id=hl-3-51><a class=lnlinks href=#hl-3-51> 51</a>
</span><span class=lnt id=hl-3-52><a class=lnlinks href=#hl-3-52> 52</a>
</span><span class=lnt id=hl-3-53><a class=lnlinks href=#hl-3-53> 53</a>
</span><span class=lnt id=hl-3-54><a class=lnlinks href=#hl-3-54> 54</a>
</span><span class=lnt id=hl-3-55><a class=lnlinks href=#hl-3-55> 55</a>
</span><span class=lnt id=hl-3-56><a class=lnlinks href=#hl-3-56> 56</a>
</span><span class=lnt id=hl-3-57><a class=lnlinks href=#hl-3-57> 57</a>
</span><span class=lnt id=hl-3-58><a class=lnlinks href=#hl-3-58> 58</a>
</span><span class=lnt id=hl-3-59><a class=lnlinks href=#hl-3-59> 59</a>
</span><span class=lnt id=hl-3-60><a class=lnlinks href=#hl-3-60> 60</a>
</span><span class=lnt id=hl-3-61><a class=lnlinks href=#hl-3-61> 61</a>
</span><span class=lnt id=hl-3-62><a class=lnlinks href=#hl-3-62> 62</a>
</span><span class=lnt id=hl-3-63><a class=lnlinks href=#hl-3-63> 63</a>
</span><span class=lnt id=hl-3-64><a class=lnlinks href=#hl-3-64> 64</a>
</span><span class=lnt id=hl-3-65><a class=lnlinks href=#hl-3-65> 65</a>
</span><span class=lnt id=hl-3-66><a class=lnlinks href=#hl-3-66> 66</a>
</span><span class=lnt id=hl-3-67><a class=lnlinks href=#hl-3-67> 67</a>
</span><span class=lnt id=hl-3-68><a class=lnlinks href=#hl-3-68> 68</a>
</span><span class=lnt id=hl-3-69><a class=lnlinks href=#hl-3-69> 69</a>
</span><span class=lnt id=hl-3-70><a class=lnlinks href=#hl-3-70> 70</a>
</span><span class=lnt id=hl-3-71><a class=lnlinks href=#hl-3-71> 71</a>
</span><span class=lnt id=hl-3-72><a class=lnlinks href=#hl-3-72> 72</a>
</span><span class=lnt id=hl-3-73><a class=lnlinks href=#hl-3-73> 73</a>
</span><span class=lnt id=hl-3-74><a class=lnlinks href=#hl-3-74> 74</a>
</span><span class=lnt id=hl-3-75><a class=lnlinks href=#hl-3-75> 75</a>
</span><span class=lnt id=hl-3-76><a class=lnlinks href=#hl-3-76> 76</a>
</span><span class=lnt id=hl-3-77><a class=lnlinks href=#hl-3-77> 77</a>
</span><span class=lnt id=hl-3-78><a class=lnlinks href=#hl-3-78> 78</a>
</span><span class=lnt id=hl-3-79><a class=lnlinks href=#hl-3-79> 79</a>
</span><span class=lnt id=hl-3-80><a class=lnlinks href=#hl-3-80> 80</a>
</span><span class=lnt id=hl-3-81><a class=lnlinks href=#hl-3-81> 81</a>
</span><span class=lnt id=hl-3-82><a class=lnlinks href=#hl-3-82> 82</a>
</span><span class=lnt id=hl-3-83><a class=lnlinks href=#hl-3-83> 83</a>
</span><span class=lnt id=hl-3-84><a class=lnlinks href=#hl-3-84> 84</a>
</span><span class=lnt id=hl-3-85><a class=lnlinks href=#hl-3-85> 85</a>
</span><span class=lnt id=hl-3-86><a class=lnlinks href=#hl-3-86> 86</a>
</span><span class=lnt id=hl-3-87><a class=lnlinks href=#hl-3-87> 87</a>
</span><span class=lnt id=hl-3-88><a class=lnlinks href=#hl-3-88> 88</a>
</span><span class=lnt id=hl-3-89><a class=lnlinks href=#hl-3-89> 89</a>
</span><span class=lnt id=hl-3-90><a class=lnlinks href=#hl-3-90> 90</a>
</span><span class=lnt id=hl-3-91><a class=lnlinks href=#hl-3-91> 91</a>
</span><span class=lnt id=hl-3-92><a class=lnlinks href=#hl-3-92> 92</a>
</span><span class=lnt id=hl-3-93><a class=lnlinks href=#hl-3-93> 93</a>
</span><span class=lnt id=hl-3-94><a class=lnlinks href=#hl-3-94> 94</a>
</span><span class=lnt id=hl-3-95><a class=lnlinks href=#hl-3-95> 95</a>
</span><span class=lnt id=hl-3-96><a class=lnlinks href=#hl-3-96> 96</a>
</span><span class=lnt id=hl-3-97><a class=lnlinks href=#hl-3-97> 97</a>
</span><span class=lnt id=hl-3-98><a class=lnlinks href=#hl-3-98> 98</a>
</span><span class=lnt id=hl-3-99><a class=lnlinks href=#hl-3-99> 99</a>
</span><span class=lnt id=hl-3-100><a class=lnlinks href=#hl-3-100>100</a>
</span><span class=lnt id=hl-3-101><a class=lnlinks href=#hl-3-101>101</a>
</span><span class=lnt id=hl-3-102><a class=lnlinks href=#hl-3-102>102</a>
</span><span class=lnt id=hl-3-103><a class=lnlinks href=#hl-3-103>103</a>
</span><span class=lnt id=hl-3-104><a class=lnlinks href=#hl-3-104>104</a>
</span><span class=lnt id=hl-3-105><a class=lnlinks href=#hl-3-105>105</a>
</span><span class=lnt id=hl-3-106><a class=lnlinks href=#hl-3-106>106</a>
</span><span class=lnt id=hl-3-107><a class=lnlinks href=#hl-3-107>107</a>
</span><span class=lnt id=hl-3-108><a class=lnlinks href=#hl-3-108>108</a>
</span><span class=lnt id=hl-3-109><a class=lnlinks href=#hl-3-109>109</a>
</span><span class=lnt id=hl-3-110><a class=lnlinks href=#hl-3-110>110</a>
</span><span class=lnt id=hl-3-111><a class=lnlinks href=#hl-3-111>111</a>
</span><span class=lnt id=hl-3-112><a class=lnlinks href=#hl-3-112>112</a>
</span><span class=lnt id=hl-3-113><a class=lnlinks href=#hl-3-113>113</a>
</span><span class=lnt id=hl-3-114><a class=lnlinks href=#hl-3-114>114</a>
</span><span class=lnt id=hl-3-115><a class=lnlinks href=#hl-3-115>115</a>
</span><span class=lnt id=hl-3-116><a class=lnlinks href=#hl-3-116>116</a>
</span><span class=lnt id=hl-3-117><a class=lnlinks href=#hl-3-117>117</a>
</span><span class=lnt id=hl-3-118><a class=lnlinks href=#hl-3-118>118</a>
</span><span class=lnt id=hl-3-119><a class=lnlinks href=#hl-3-119>119</a>
</span><span class=lnt id=hl-3-120><a class=lnlinks href=#hl-3-120>120</a>
</span><span class=lnt id=hl-3-121><a class=lnlinks href=#hl-3-121>121</a>
</span><span class=lnt id=hl-3-122><a class=lnlinks href=#hl-3-122>122</a>
</span><span class=lnt id=hl-3-123><a class=lnlinks href=#hl-3-123>123</a>
</span><span class=lnt id=hl-3-124><a class=lnlinks href=#hl-3-124>124</a>
</span><span class=lnt id=hl-3-125><a class=lnlinks href=#hl-3-125>125</a>
</span><span class=lnt id=hl-3-126><a class=lnlinks href=#hl-3-126>126</a>
</span><span class=lnt id=hl-3-127><a class=lnlinks href=#hl-3-127>127</a>
</span><span class=lnt id=hl-3-128><a class=lnlinks href=#hl-3-128>128</a>
</span><span class=lnt id=hl-3-129><a class=lnlinks href=#hl-3-129>129</a>
</span><span class=lnt id=hl-3-130><a class=lnlinks href=#hl-3-130>130</a>
</span><span class=lnt id=hl-3-131><a class=lnlinks href=#hl-3-131>131</a>
</span><span class=lnt id=hl-3-132><a class=lnlinks href=#hl-3-132>132</a>
</span><span class=lnt id=hl-3-133><a class=lnlinks href=#hl-3-133>133</a>
</span><span class=lnt id=hl-3-134><a class=lnlinks href=#hl-3-134>134</a>
</span><span class=lnt id=hl-3-135><a class=lnlinks href=#hl-3-135>135</a>
</span><span class=lnt id=hl-3-136><a class=lnlinks href=#hl-3-136>136</a>
</span><span class=lnt id=hl-3-137><a class=lnlinks href=#hl-3-137>137</a>
</span><span class=lnt id=hl-3-138><a class=lnlinks href=#hl-3-138>138</a>
</span><span class=lnt id=hl-3-139><a class=lnlinks href=#hl-3-139>139</a>
</span><span class=lnt id=hl-3-140><a class=lnlinks href=#hl-3-140>140</a>
</span><span class=lnt id=hl-3-141><a class=lnlinks href=#hl-3-141>141</a>
</span><span class=lnt id=hl-3-142><a class=lnlinks href=#hl-3-142>142</a>
</span><span class=lnt id=hl-3-143><a class=lnlinks href=#hl-3-143>143</a>
</span><span class=lnt id=hl-3-144><a class=lnlinks href=#hl-3-144>144</a>
</span><span class=lnt id=hl-3-145><a class=lnlinks href=#hl-3-145>145</a>
</span><span class=lnt id=hl-3-146><a class=lnlinks href=#hl-3-146>146</a>
</span><span class=lnt id=hl-3-147><a class=lnlinks href=#hl-3-147>147</a>
</span><span class=lnt id=hl-3-148><a class=lnlinks href=#hl-3-148>148</a>
</span><span class=lnt id=hl-3-149><a class=lnlinks href=#hl-3-149>149</a>
</span><span class=lnt id=hl-3-150><a class=lnlinks href=#hl-3-150>150</a>
</span><span class=lnt id=hl-3-151><a class=lnlinks href=#hl-3-151>151</a>
</span><span class=lnt id=hl-3-152><a class=lnlinks href=#hl-3-152>152</a>
</span><span class=lnt id=hl-3-153><a class=lnlinks href=#hl-3-153>153</a>
</span><span class=lnt id=hl-3-154><a class=lnlinks href=#hl-3-154>154</a>
</span><span class=lnt id=hl-3-155><a class=lnlinks href=#hl-3-155>155</a>
</span><span class=lnt id=hl-3-156><a class=lnlinks href=#hl-3-156>156</a>
</span><span class=lnt id=hl-3-157><a class=lnlinks href=#hl-3-157>157</a>
</span><span class=lnt id=hl-3-158><a class=lnlinks href=#hl-3-158>158</a>
</span><span class=lnt id=hl-3-159><a class=lnlinks href=#hl-3-159>159</a>
</span><span class=lnt id=hl-3-160><a class=lnlinks href=#hl-3-160>160</a>
</span><span class=lnt id=hl-3-161><a class=lnlinks href=#hl-3-161>161</a>
</span><span class=lnt id=hl-3-162><a class=lnlinks href=#hl-3-162>162</a>
</span><span class=lnt id=hl-3-163><a class=lnlinks href=#hl-3-163>163</a>
</span><span class=lnt id=hl-3-164><a class=lnlinks href=#hl-3-164>164</a>
</span><span class=lnt id=hl-3-165><a class=lnlinks href=#hl-3-165>165</a>
</span><span class=lnt id=hl-3-166><a class=lnlinks href=#hl-3-166>166</a>
</span><span class=lnt id=hl-3-167><a class=lnlinks href=#hl-3-167>167</a>
</span><span class=lnt id=hl-3-168><a class=lnlinks href=#hl-3-168>168</a>
</span><span class=lnt id=hl-3-169><a class=lnlinks href=#hl-3-169>169</a>
</span><span class=lnt id=hl-3-170><a class=lnlinks href=#hl-3-170>170</a>
</span><span class=lnt id=hl-3-171><a class=lnlinks href=#hl-3-171>171</a>
</span><span class=lnt id=hl-3-172><a class=lnlinks href=#hl-3-172>172</a>
</span><span class=lnt id=hl-3-173><a class=lnlinks href=#hl-3-173>173</a>
</span><span class=lnt id=hl-3-174><a class=lnlinks href=#hl-3-174>174</a>
</span><span class=lnt id=hl-3-175><a class=lnlinks href=#hl-3-175>175</a>
</span><span class=lnt id=hl-3-176><a class=lnlinks href=#hl-3-176>176</a>
</span><span class=lnt id=hl-3-177><a class=lnlinks href=#hl-3-177>177</a>
</span><span class=lnt id=hl-3-178><a class=lnlinks href=#hl-3-178>178</a>
</span><span class=lnt id=hl-3-179><a class=lnlinks href=#hl-3-179>179</a>
</span><span class=lnt id=hl-3-180><a class=lnlinks href=#hl-3-180>180</a>
</span><span class=lnt id=hl-3-181><a class=lnlinks href=#hl-3-181>181</a>
</span><span class=lnt id=hl-3-182><a class=lnlinks href=#hl-3-182>182</a>
</span><span class=lnt id=hl-3-183><a class=lnlinks href=#hl-3-183>183</a>
</span><span class=lnt id=hl-3-184><a class=lnlinks href=#hl-3-184>184</a>
</span><span class=lnt id=hl-3-185><a class=lnlinks href=#hl-3-185>185</a>
</span><span class=lnt id=hl-3-186><a class=lnlinks href=#hl-3-186>186</a>
</span><span class=lnt id=hl-3-187><a class=lnlinks href=#hl-3-187>187</a>
</span><span class=lnt id=hl-3-188><a class=lnlinks href=#hl-3-188>188</a>
</span><span class=lnt id=hl-3-189><a class=lnlinks href=#hl-3-189>189</a>
</span><span class=lnt id=hl-3-190><a class=lnlinks href=#hl-3-190>190</a>
</span><span class=lnt id=hl-3-191><a class=lnlinks href=#hl-3-191>191</a>
</span><span class=lnt id=hl-3-192><a class=lnlinks href=#hl-3-192>192</a>
</span><span class=lnt id=hl-3-193><a class=lnlinks href=#hl-3-193>193</a>
</span><span class=lnt id=hl-3-194><a class=lnlinks href=#hl-3-194>194</a>
</span><span class=lnt id=hl-3-195><a class=lnlinks href=#hl-3-195>195</a>
</span><span class=lnt id=hl-3-196><a class=lnlinks href=#hl-3-196>196</a>
</span><span class=lnt id=hl-3-197><a class=lnlinks href=#hl-3-197>197</a>
</span><span class=lnt id=hl-3-198><a class=lnlinks href=#hl-3-198>198</a>
</span><span class=lnt id=hl-3-199><a class=lnlinks href=#hl-3-199>199</a>
</span><span class=lnt id=hl-3-200><a class=lnlinks href=#hl-3-200>200</a>
</span><span class=lnt id=hl-3-201><a class=lnlinks href=#hl-3-201>201</a>
</span><span class=lnt id=hl-3-202><a class=lnlinks href=#hl-3-202>202</a>
</span><span class=lnt id=hl-3-203><a class=lnlinks href=#hl-3-203>203</a>
</span><span class=lnt id=hl-3-204><a class=lnlinks href=#hl-3-204>204</a>
</span><span class=lnt id=hl-3-205><a class=lnlinks href=#hl-3-205>205</a>
</span><span class=lnt id=hl-3-206><a class=lnlinks href=#hl-3-206>206</a>
</span><span class=lnt id=hl-3-207><a class=lnlinks href=#hl-3-207>207</a>
</span><span class=lnt id=hl-3-208><a class=lnlinks href=#hl-3-208>208</a>
</span><span class=lnt id=hl-3-209><a class=lnlinks href=#hl-3-209>209</a>
</span><span class=lnt id=hl-3-210><a class=lnlinks href=#hl-3-210>210</a>
</span><span class=lnt id=hl-3-211><a class=lnlinks href=#hl-3-211>211</a>
</span><span class=lnt id=hl-3-212><a class=lnlinks href=#hl-3-212>212</a>
</span><span class=lnt id=hl-3-213><a class=lnlinks href=#hl-3-213>213</a>
</span><span class=lnt id=hl-3-214><a class=lnlinks href=#hl-3-214>214</a>
</span><span class=lnt id=hl-3-215><a class=lnlinks href=#hl-3-215>215</a>
</span><span class=lnt id=hl-3-216><a class=lnlinks href=#hl-3-216>216</a>
</span><span class=lnt id=hl-3-217><a class=lnlinks href=#hl-3-217>217</a>
</span><span class=lnt id=hl-3-218><a class=lnlinks href=#hl-3-218>218</a>
</span><span class=lnt id=hl-3-219><a class=lnlinks href=#hl-3-219>219</a>
</span><span class=lnt id=hl-3-220><a class=lnlinks href=#hl-3-220>220</a>
</span><span class=lnt id=hl-3-221><a class=lnlinks href=#hl-3-221>221</a>
</span><span class=lnt id=hl-3-222><a class=lnlinks href=#hl-3-222>222</a>
</span><span class=lnt id=hl-3-223><a class=lnlinks href=#hl-3-223>223</a>
</span><span class=lnt id=hl-3-224><a class=lnlinks href=#hl-3-224>224</a>
</span><span class=lnt id=hl-3-225><a class=lnlinks href=#hl-3-225>225</a>
</span><span class=lnt id=hl-3-226><a class=lnlinks href=#hl-3-226>226</a>
</span><span class=lnt id=hl-3-227><a class=lnlinks href=#hl-3-227>227</a>
</span><span class=lnt id=hl-3-228><a class=lnlinks href=#hl-3-228>228</a>
</span><span class=lnt id=hl-3-229><a class=lnlinks href=#hl-3-229>229</a>
</span><span class=lnt id=hl-3-230><a class=lnlinks href=#hl-3-230>230</a>
</span><span class=lnt id=hl-3-231><a class=lnlinks href=#hl-3-231>231</a>
</span><span class=lnt id=hl-3-232><a class=lnlinks href=#hl-3-232>232</a>
</span><span class=lnt id=hl-3-233><a class=lnlinks href=#hl-3-233>233</a>
</span><span class=lnt id=hl-3-234><a class=lnlinks href=#hl-3-234>234</a>
</span><span class=lnt id=hl-3-235><a class=lnlinks href=#hl-3-235>235</a>
</span><span class=lnt id=hl-3-236><a class=lnlinks href=#hl-3-236>236</a>
</span><span class=lnt id=hl-3-237><a class=lnlinks href=#hl-3-237>237</a>
</span><span class=lnt id=hl-3-238><a class=lnlinks href=#hl-3-238>238</a>
</span><span class=lnt id=hl-3-239><a class=lnlinks href=#hl-3-239>239</a>
</span><span class=lnt id=hl-3-240><a class=lnlinks href=#hl-3-240>240</a>
</span><span class=lnt id=hl-3-241><a class=lnlinks href=#hl-3-241>241</a>
</span><span class=lnt id=hl-3-242><a class=lnlinks href=#hl-3-242>242</a>
</span><span class=lnt id=hl-3-243><a class=lnlinks href=#hl-3-243>243</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Configuration reference:</span>
</span></span><span class=line><span class=cl><span class=c1># http://www.squid-cache.org/Versions/v3/3.2/cfgman/</span>
</span></span><span class=line><span class=cl><span class=c1># https://calomel.org/squid.html</span>
</span></span><span class=line><span class=cl><span class=c1># Note to self search for &#34;TODO&#34; and &#34;TEST&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bind to the standard squid part (3128)</span>
</span></span><span class=line><span class=cl>http_port <span class=o>[</span>::<span class=o>]</span>:3128
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### GENERAL CONFIGURATION</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Email address of the local cache manager in case an issue crops up. This will</span>
</span></span><span class=line><span class=cl><span class=c1># also show up in error messages.</span>
</span></span><span class=line><span class=cl>cache_mgr cache-admin@proxy-01.i.0x378.net
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># For security and stability reasons Squid can check hostnames for Internet</span>
</span></span><span class=line><span class=cl><span class=c1># standard RFC compliance.</span>
</span></span><span class=line><span class=cl>check_hostnames on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Leave coredumps in the base cache directory</span>
</span></span><span class=line><span class=cl>coredump_dir /var/spool/squid
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Automatically close broken persistent connections</span>
</span></span><span class=line><span class=cl>detect_broken_pconn on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Using the transparent option prevent squid from manipulating this header,</span>
</span></span><span class=line><span class=cl><span class=c1># turning it off just sets the client&#39;s address do &#34;unknown&#34;.</span>
</span></span><span class=line><span class=cl>forwarded_for transparent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Prevent Squid from announcing it&#39;s version information</span>
</span></span><span class=line><span class=cl>httpd_suppress_version_string on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Minimum umask to be enforced for all written files, generally this should be</span>
</span></span><span class=line><span class=cl><span class=c1># public information (cached content) but it can&#39;t hurt to  restrict it.</span>
</span></span><span class=line><span class=cl><span class=nb>umask</span> <span class=m>027</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hostname that is visible in error messages, and if used in a cluster used to</span>
</span></span><span class=line><span class=cl><span class=c1># detect forwarding loops. If your cluster needs to use the same</span>
</span></span><span class=line><span class=cl><span class=c1># visible_hostname investigate the related option unique_hostname.</span>
</span></span><span class=line><span class=cl>visible_hostname proxy-01.internal.private.web
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### TIMEOUTS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># How long to wait for TCP connect to a requested server or peer to complete</span>
</span></span><span class=line><span class=cl><span class=c1># before Squid should attempt to find another path to forward the request.</span>
</span></span><span class=line><span class=cl>connect_timeout <span class=m>5</span> second
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># If no response is received to a DNS query within this time all DNS servers</span>
</span></span><span class=line><span class=cl><span class=c1># for the queried domain are assumed to be unavailable. This may cause</span>
</span></span><span class=line><span class=cl><span class=c1># transient resolution errors to be cached but I haven&#39;t verified that.</span>
</span></span><span class=line><span class=cl>dns_timeout <span class=m>5</span> second
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Max length of time Squid should attempt to find a forwarding path for a</span>
</span></span><span class=line><span class=cl><span class=c1># request before giving up.</span>
</span></span><span class=line><span class=cl>forward_timeout <span class=m>10</span> second
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># How long to wait for complete HTTP request headers after initial connection</span>
</span></span><span class=line><span class=cl><span class=c1># establishment.</span>
</span></span><span class=line><span class=cl>request_timeout <span class=m>10</span> second
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### AUTHENTICATION</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Ensure usernames are case sensitive</span>
</span></span><span class=line><span class=cl>auth_param basic casesensitive on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Length of time to consider credentials authenticated through the external</span>
</span></span><span class=line><span class=cl><span class=c1># program valid.</span>
</span></span><span class=line><span class=cl>auth_param basic credentialsttl <span class=m>2</span> hours
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Use basic htpasswd style files to handle authentication.</span>
</span></span><span class=line><span class=cl>auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/accounts
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The realm to display to any inquistive clients</span>
</span></span><span class=line><span class=cl>auth_param basic realm Proxy Access Requires Authentication
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### CACHE CONFIGURATION</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &lt;store type&gt; &lt;store location&gt; &lt;cache size in MB&gt; &lt;# of first level</span>
</span></span><span class=line><span class=cl><span class=c1># directories&gt; &lt;# of second level directories&gt; aufs is the non-blocking disk</span>
</span></span><span class=line><span class=cl><span class=c1># storage option</span>
</span></span><span class=line><span class=cl>cache_dir aufs /var/spool/squid <span class=m>1024</span> <span class=m>16</span> <span class=m>256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This represents the maximum amount of ram that squid will utilize to keep</span>
</span></span><span class=line><span class=cl><span class=c1># cached objects in memory. Squid requires about 100Mb of RAM per Gb of cache</span>
</span></span><span class=line><span class=cl><span class=c1># storage. If you have a 10gb cache, Squid will use ~1Gb just to handle that.</span>
</span></span><span class=line><span class=cl><span class=c1># Make sure that cache_mem + (cache_dir size limit * 100Mb) is less than your</span>
</span></span><span class=line><span class=cl><span class=c1># available RAM.</span>
</span></span><span class=line><span class=cl>cache_mem <span class=m>192</span> MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Least Frequently Used with Dynamic Aging (keeps popular objects in cache</span>
</span></span><span class=line><span class=cl><span class=c1># regardless of their size and thus optimizes byte hit rate at the expense of</span>
</span></span><span class=line><span class=cl><span class=c1># hit rate since one large, popular object will prevent many smaller, slightly</span>
</span></span><span class=line><span class=cl><span class=c1># less popular objects from being cached.</span>
</span></span><span class=line><span class=cl>cache_replacement_policy heap LFUDA
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Limit the size of file to hold in the cache, 10 MB is about the largest file</span>
</span></span><span class=line><span class=cl><span class=c1># I expect multiple of my client to pull down.</span>
</span></span><span class=line><span class=cl>maximum_object_size <span class=m>10</span> MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tell squid to release memory it&#39;s not using</span>
</span></span><span class=line><span class=cl>memory_pools off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Cacheing rules for content that doesn&#39;t have an explicit expire time.</span>
</span></span><span class=line><span class=cl>refresh_pattern ^ftp:             <span class=m>1440</span> 20%    <span class=m>10080</span>
</span></span><span class=line><span class=cl>refresh_pattern -i <span class=o>(</span>/cgi-bin/<span class=p>|</span><span class=se>\?</span><span class=o>)</span> <span class=m>0</span>    0%     <span class=m>0</span>
</span></span><span class=line><span class=cl>refresh_pattern .                 <span class=m>0</span>    20%    <span class=m>4320</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Specifies how long squid should wait when it&#39;s service is asked to stop.</span>
</span></span><span class=line><span class=cl><span class=c1># Generally this to allow client requests to complete, but I find it more</span>
</span></span><span class=line><span class=cl><span class=c1># useful to make this fast.</span>
</span></span><span class=line><span class=cl>shutdown_lifetime <span class=m>1</span> second
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This normally evaluate how much data is left in a transfer when a client</span>
</span></span><span class=line><span class=cl><span class=c1># disconnects before it&#39;s completed, and if the remaining data falls in the</span>
</span></span><span class=line><span class=cl><span class=c1># configured range, Squid will finish downloading the file and cache it anyway.</span>
</span></span><span class=line><span class=cl><span class=c1># This is cool but not useful in my environment.</span>
</span></span><span class=line><span class=cl>quick_abort_min <span class=m>0</span> KB
</span></span><span class=line><span class=cl>quick_abort_max <span class=m>0</span> KB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### SSL BUMP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TODO: This is exactly worst practices in most cases, however, for a highly</span>
</span></span><span class=line><span class=cl><span class=c1># restricted network of servers using this as their only means of accessing the</span>
</span></span><span class=line><span class=cl><span class=c1># internet... It can be an important security measure.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### CUSTOM ERROR MESSAGES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TODO: Useful for client facing servers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### SQUIDGUARD CONFIG</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#url_rewrite_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#url_rewrite_bypass off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### LOGGING</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &lt;Client IP&gt; &lt;Username&gt; [&lt;Local Time&gt;] &#34;&lt;Request Method&gt; &lt;Request URL&gt;</span>
</span></span><span class=line><span class=cl><span class=c1># HTTP/&lt;Protocol Version&gt; &lt;Response Status Code&gt; &lt;Sent reply size (with</span>
</span></span><span class=line><span class=cl><span class=c1># headers)&gt; &lt;Referer&gt; &lt;User Agent&gt; &lt;Squid Request Status&gt;:&lt;Squid Hierarchy</span>
</span></span><span class=line><span class=cl><span class=c1># Status&gt;</span>
</span></span><span class=line><span class=cl>logformat        combined %&gt;a %un <span class=o>[</span>%tl<span class=o>]</span> <span class=s2>&#34;%rm %ru HTTP/%rv&#34;</span> %&gt;Hs %&lt;st <span class=s2>&#34;%{Referer}&gt;h&#34;</span> <span class=s2>&#34;%{User-Agent}&gt;h&#34;</span> %Ss:%Sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &lt;Client IP&gt; &lt;Username&gt; [&lt;Local Time&gt;] &#34;&lt;Sent Headers&gt;&#34; &#34;&lt;Reply Headers&gt;&#34;</span>
</span></span><span class=line><span class=cl>logformat        debugheaders %&gt;a %un <span class=o>[</span>%tl<span class=o>]</span> <span class=s2>&#34;%&gt;h&#34;</span> <span class=s2>&#34;%&lt;h&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Send our neat logs through to the local syslog server</span>
</span></span><span class=line><span class=cl>access_log       syslog:local3.info combined
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Useful for debugging</span>
</span></span><span class=line><span class=cl><span class=c1>#access_log      syslog:local3.debug debugheaders</span>
</span></span><span class=line><span class=cl><span class=c1>#access_log      stdio:/var/log/squid/headers.log debugheaders</span>
</span></span><span class=line><span class=cl><span class=c1>#cache_store_log stdio:/var/log/squid/store.log</span>
</span></span><span class=line><span class=cl><span class=c1>#cache_log       stdio:/var/log/squid/cache.log</span>
</span></span><span class=line><span class=cl><span class=c1>#logfile_rotate  3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### BEGIN ACL ALIASES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>acl CONNECT method CONNECT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># An ACL to match authenticated users</span>
</span></span><span class=line><span class=cl>acl authenticated_user proxy_auth REQUIRED
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACL covering clients allowed to use this proxy</span>
</span></span><span class=line><span class=cl>acl allowed_hosts src 10.0.0.0/24
</span></span><span class=line><span class=cl>acl allowed_hosts src fc00::/7       <span class=c1># RFC 4193 local private network range</span>
</span></span><span class=line><span class=cl>acl allowed_hosts src fe80::/10      <span class=c1># RFC 4291 link-local (directly plugged) machines</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ACLs covering restricted destinations</span>
</span></span><span class=line><span class=cl>acl to_local_network dst 10.0.0.0/24
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Limit individual matching hosts to 500 connections</span>
</span></span><span class=line><span class=cl>acl proxy_connection_limit maxconn <span class=m>500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Which ports to allow raw connects too (For SSL mostly)</span>
</span></span><span class=line><span class=cl>acl SSL_ports port <span class=m>443</span> 	        <span class=c1># https</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Which ports to allow regular unencrypted procols to connect to</span>
</span></span><span class=line><span class=cl>acl allowed_ports port <span class=m>80</span>          <span class=c1># http</span>
</span></span><span class=line><span class=cl>acl allowed_ports port <span class=m>21</span>          <span class=c1># ftp</span>
</span></span><span class=line><span class=cl>acl allowed_ports port <span class=m>443</span>         <span class=c1># https</span>
</span></span><span class=line><span class=cl><span class=c1>#acl allowed_ports port 1025-65535  # unregistered ports</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### BEGIN ACLS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Only allow cachemgr access from localhost</span>
</span></span><span class=line><span class=cl>http_access allow manager localhost
</span></span><span class=line><span class=cl>http_access deny manager
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Access to local web based services should be explictely and directly allowed.</span>
</span></span><span class=line><span class=cl><span class=c1># Deny access to them through this proxy.</span>
</span></span><span class=line><span class=cl>http_access deny to_local_network
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Deny requests from clients that go over the connection limits</span>
</span></span><span class=line><span class=cl>http_access deny proxy_connection_limit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Allow CONNECT to only the explicitely allowed ports</span>
</span></span><span class=line><span class=cl>http_access allow CONNECT SSL_ports
</span></span><span class=line><span class=cl>http_access deny CONNECT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Deny requests to any port we haven&#39;t whitelisted</span>
</span></span><span class=line><span class=cl>http_access deny !allowed_ports
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Allow access to this squid server from our local whitelisted network... as</span>
</span></span><span class=line><span class=cl><span class=c1># long as they&#39;re authenticated.</span>
</span></span><span class=line><span class=cl>http_access allow allowed_hosts authenticated_user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Deny any requests we haven&#39;t allowed by this point</span>
</span></span><span class=line><span class=cl>http_access deny all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### PRIVACY / REQUEST MANGLING</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># TODO: Client information can leak out through headers including information</span>
</span></span><span class=line><span class=cl><span class=c1># about services and OS&#39;s running inside the network. Mangling the requests and</span>
</span></span><span class=line><span class=cl><span class=c1># responses and whitelisting the various headers of value can help mitigate</span>
</span></span><span class=line><span class=cl><span class=c1># this, and provide meaningful dis-information.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#request_header_replace User-Agent Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_replace Accept */*</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_replace Accept-Encoding gzip # May cause issues should TEST</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_replace Accept-Language en</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>## Some of these should be reply_header_access</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Accept allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Accept-Encoding allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Accept-Language allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Authorization allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Cache-Control allow all</span>
</span></span><span class=line><span class=cl><span class=c1>##request_header_access Content-Disposition allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Content-Encoding allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Content-Length allow all</span>
</span></span><span class=line><span class=cl><span class=c1>##request_header_access Content-Location allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Content-Range allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Content-Type allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Cookie allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Expires allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Host allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access If-Modified-Since allow all</span>
</span></span><span class=line><span class=cl><span class=c1>##request_header_access Location allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Range allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Referer allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access Set-Cookie allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access User-Agent deny all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access WWW-Authenticate allow all</span>
</span></span><span class=line><span class=cl><span class=c1>#request_header_access All deny all</span>
</span></span></code></pre></td></tr></table></div></div><p>To enable syslog logging we need to add the <code>-s</code> flag to <code>SQUID_OPTS</code> in
<code>/etc/sysconfig/squid</code>.</p><pre tabindex=0><code># Squid options (additionally log to syslog)
SQUID_OPTS=&#34;-s&#34;

# Time to wait for Squid to shut down when asked. Should not be necessary
# most of the time.
SQUID_SHUTDOWN_TIMEOUT=100

# default squid conf file
SQUID_CONF=&#34;/etc/squid/squid.conf&#34;
</code></pre><p>Enable and start the service:</p><pre tabindex=0><code>systemctl enable squid.service
systemctl start squid.service
</code></pre><h2 id=firewall>Firewall</h2><p>Allow access to the squid proxy from within the airlock, and the normal ports
outbound.</p><pre tabindex=0><code># Allow access to the local squid proxy server (mostly for updates)
-A INPUT  -m tcp -p tcp --dport 3128 -s 10.0.0.0/24 -j ACCEPT

# Allow squid to make FTP/HTTP(S) requests on behalf of the other machines in
# the network
-A OUTPUT -m tcp -p tcp --dport 21  -j ACCEPT
-A OUTPUT -m tcp -p tcp --dport 80  -j ACCEPT
-A OUTPUT -m tcp -p tcp --dport 443 -j ACCEPT
</code></pre><p>Other clients on the network will need to be able to talk to the squid port.</p><pre tabindex=0><code>-A OUTPUT -m tcp -p tcp --dport 3128 -d 10.0.0.170 -j ACCEPT
</code></pre><h2 id=a-note-on-non-standard-ports>A Note on Non-Standard Ports</h2><p>It is highly recommended to run squid on a non-standard port if it is going to
be exposed to the internet. The catch is that this will throw SELinux for a
loop. The following command will tell SELinux to be ok with squid running on
port 11637.</p><pre tabindex=0><code>[root@localhost ~]# semanage port -a -t http_cache_port_t -p tcp 11637
</code></pre><p>This may be necessary if squid needs to listen on multiple ports (for example
for dansGuardian with kerberos authentication).</p><h2 id=viewing-statistics>Viewing Statistics</h2><p>On the squid server you can run a report to see the status of squid with the
"squidclient" command like so:</p><pre tabindex=0><code>squidclient -h 127.0.0.1 mgr:info
</code></pre><h2 id=testing>Testing</h2><p>You can confirm the squid works like so:</p><pre tabindex=0><code>curl -x 10.0.0.170:3128 https://www.google.com/
</code></pre><p>With authentication:</p><pre tabindex=0><code>curl --proxy-basic --proxy-user user:pass -x 10.0.0.170:3128 https://www.google.com/
</code></pre><p>To get yum working with the proxy add the following line to the <code>[main]</code>
section of /etc/yum.conf file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>proxy</span><span class=o>=</span><span class=s>http://10.0.0.170:3128</span>
</span></span></code></pre></td></tr></table></div></div><p>If authentication is required the two following lines can always be added:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>proxy_username</span><span class=o>=</span><span class=s>username</span>
</span></span><span class=line><span class=cl><span class=na>proxy_password</span><span class=o>=</span><span class=s>password</span>
</span></span></code></pre></td></tr></table></div></div><p>To setup general proxy use on the system for various command line utilities
like <code>wget</code>, <code>curl</code>, and <code>lynx</code>, there are a set of common environment variable
to set. I created a file <code>/etc/profile.d/proxy.sh</code> with the following contents
and make it executable.</p><pre tabindex=0><code># General proxy configuration for system tools
export http_proxy=squid.local.tld:3128
export https_proxy=squid.local.tld:3128
export ftp_proxy=squid.local.tld:3128
export ALL_PROXY=squid.local.tld:3128
export no_proxy=.i.0x378.net
export NO_PROXY=.i.0x378.net
</code></pre><p>You can include credentials by prepending the <code>user:pass@</code> to the hosts of the
protocols above.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>