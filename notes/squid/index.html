<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
 http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/ http://gofedora.com/how-to-configure-squid-proxy-server/ http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos http://wiki.squid-cache.org/Features/NegotiateAuthentication http://www.squid-cache.org/Versions/v3/3.2/cfgman/  For URL filtering please refer to the SquidGuard page.
yum install squid -y  Before configuring squid we mind as well get the authentication credentials in place.'>
<meta property='og:title' content='Squid • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
 http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/ http://gofedora.com/how-to-configure-squid-proxy-server/ http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos http://wiki.squid-cache.org/Features/NegotiateAuthentication http://www.squid-cache.org/Versions/v3/3.2/cfgman/  For URL filtering please refer to the SquidGuard page.
yum install squid -y  Before configuring squid we mind as well get the authentication credentials in place.'>
<meta property='og:url' content='https://stelfox.net/notes/squid/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='Notes'>

  <title>Squid • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/squid/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Ubuntu:400,400i,700&subset=latin'>
<link rel='stylesheet' href='/assets/css/main.77da63e1.css'>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>


<body class='page type-notes'>
  <div class='site'>
    <a class='screen-reader' href='#main'>Skip to Content</a>
    <header id='header' class='header-container'>
      <div class='header site-header'>
        <nav id='main-menu' class='main-menu-container' aria-label='Main Menu'>
  <ul class='main-menu'>
  <li>
      <a href='/'>Home</a>
    </li>
  <li>
      <a href='/about/'>About</a>
    </li>
  <li>
      <a href='/blog/'>Blog Posts</a>
    </li>
  <li>
      <a href='/notes/'>Various Notes</a>
    </li>
  
  </ul>
</nav>

        <div class='header-info'>
          
          <p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p>
          
          <p class='site-description subtitle'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
        </div>
      </div>
    </header>


<main id='main' class='main'>
  <article lang='en' class='entry'>
    <header class='header-container'>
  <div class='header entry-header'>
    <div class='header-info'>
      <h1 class='title'>Squid</h1>
      

    </div>
    

  </div>
</header>

    
    

    <div class='entry-content'>
  

<p><strong><em>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</em></strong></p>

<ul>
<li><a href="http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/">http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/</a></li>
<li><a href="http://gofedora.com/how-to-configure-squid-proxy-server/">http://gofedora.com/how-to-configure-squid-proxy-server/</a></li>
<li><a href="http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html">http://rosincore.blogspot.com/2010/01/dansguardian-content-filtering-with-ad.html</a></li>
<li><a href="http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos">http://eu.squid-cache.org/ConfigExamples/Authenticate/Kerberos</a></li>
<li><a href="http://wiki.squid-cache.org/Features/NegotiateAuthentication">http://wiki.squid-cache.org/Features/NegotiateAuthentication</a></li>
<li><a href="http://www.squid-cache.org/Versions/v3/3.2/cfgman/">http://www.squid-cache.org/Versions/v3/3.2/cfgman/</a></li>
</ul>

<p>For URL filtering please refer to the <a href="/notes/squid-guard/">SquidGuard</a> page.</p>

<pre><code>yum install squid -y
</code></pre>

<p>Before configuring squid we mind as well get the authentication credentials in
place. To do this we make use of the <code>htpasswd</code> utility which can be installed
through the <code>httpd-tools</code> package.</p>

<p>For the first account:</p>

<pre><code>htpasswd -b -c /etc/squid/accounts username password
</code></pre>

<p>And subsequent accounts:</p>

<pre><code>htpasswd -b /etc/squid/accounts username2 password2
</code></pre>

<p>Lets drop the config into place, this is fairly generic there are just a few IP
addresses, networks, and emails to change. It should live at
<code>/etc/squid/squid.conf</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Configuration reference:
</span><span style="color:#75715e"># http://www.squid-cache.org/Versions/v3/3.2/cfgman/
</span><span style="color:#75715e"># https://calomel.org/squid.html
</span><span style="color:#75715e"># Note to self search for &#34;TODO&#34; and &#34;TEST&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Bind to the standard squid part (3128)
</span><span style="color:#75715e"></span>http_port <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:3128

<span style="color:#75715e">### GENERAL CONFIGURATION
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Email address of the local cache manager in case an issue crops up. This will
</span><span style="color:#75715e"># also show up in error messages.
</span><span style="color:#75715e"></span>cache_mgr cache-admin@proxy-01.i.0x378.net

<span style="color:#75715e"># For security and stability reasons Squid can check hostnames for Internet
</span><span style="color:#75715e"># standard RFC compliance.
</span><span style="color:#75715e"></span>check_hostnames on

<span style="color:#75715e"># Leave coredumps in the base cache directory
</span><span style="color:#75715e"></span>coredump_dir /var/spool/squid

<span style="color:#75715e"># Automatically close broken persistent connections
</span><span style="color:#75715e"></span>detect_broken_pconn on

<span style="color:#75715e"># Using the transparent option prevent squid from manipulating this header,
</span><span style="color:#75715e"># turning it off just sets the client&#39;s address do &#34;unknown&#34;.
</span><span style="color:#75715e"></span>forwarded_for transparent

<span style="color:#75715e"># Prevent Squid from announcing it&#39;s version information
</span><span style="color:#75715e"></span>httpd_suppress_version_string on

<span style="color:#75715e"># Minimum umask to be enforced for all written files, generally this should be
</span><span style="color:#75715e"># public information (cached content) but it can&#39;t hurt to  restrict it.
</span><span style="color:#75715e"></span>umask <span style="color:#ae81ff">027</span>

<span style="color:#75715e"># Hostname that is visible in error messages, and if used in a cluster used to
</span><span style="color:#75715e"># detect forwarding loops. If your cluster needs to use the same
</span><span style="color:#75715e"># visible_hostname investigate the related option unique_hostname.
</span><span style="color:#75715e"></span>visible_hostname proxy-01.internal.private.web

<span style="color:#75715e">### TIMEOUTS
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># How long to wait for TCP connect to a requested server or peer to complete
</span><span style="color:#75715e"># before Squid should attempt to find another path to forward the request.
</span><span style="color:#75715e"></span>connect_timeout <span style="color:#ae81ff">5</span> second

<span style="color:#75715e"># If no response is received to a DNS query within this time all DNS servers
</span><span style="color:#75715e"># for the queried domain are assumed to be unavailable. This may cause
</span><span style="color:#75715e"># transient resolution errors to be cached but I haven&#39;t verified that.
</span><span style="color:#75715e"></span>dns_timeout <span style="color:#ae81ff">5</span> second

<span style="color:#75715e"># Max length of time Squid should attempt to find a forwarding path for a
</span><span style="color:#75715e"># request before giving up.
</span><span style="color:#75715e"></span>forward_timeout <span style="color:#ae81ff">10</span> second

<span style="color:#75715e"># How long to wait for complete HTTP request headers after initial connection
</span><span style="color:#75715e"># establishment.
</span><span style="color:#75715e"></span>request_timeout <span style="color:#ae81ff">10</span> second

<span style="color:#75715e">### AUTHENTICATION
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Ensure usernames are case sensitive
</span><span style="color:#75715e"></span>auth_param basic casesensitive on

<span style="color:#75715e"># Length of time to consider credentials authenticated through the external
</span><span style="color:#75715e"># program valid.
</span><span style="color:#75715e"></span>auth_param basic credentialsttl <span style="color:#ae81ff">2</span> hours

<span style="color:#75715e"># Use basic htpasswd style files to handle authentication.
</span><span style="color:#75715e"></span>auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/accounts

<span style="color:#75715e"># The realm to display to any inquistive clients
</span><span style="color:#75715e"></span>auth_param basic realm Proxy Access Requires Authentication

<span style="color:#75715e">### CACHE CONFIGURATION
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># &lt;store type&gt; &lt;store location&gt; &lt;cache size in MB&gt; &lt;# of first level
</span><span style="color:#75715e"># directories&gt; &lt;# of second level directories&gt; aufs is the non-blocking disk
</span><span style="color:#75715e"># storage option
</span><span style="color:#75715e"></span>cache_dir aufs /var/spool/squid <span style="color:#ae81ff">1024</span> <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">256</span>

<span style="color:#75715e"># This represents the maximum amount of ram that squid will utilize to keep
</span><span style="color:#75715e"># cached objects in memory. Squid requires about 100Mb of RAM per Gb of cache
</span><span style="color:#75715e"># storage. If you have a 10gb cache, Squid will use ~1Gb just to handle that.
</span><span style="color:#75715e"># Make sure that cache_mem + (cache_dir size limit * 100Mb) is less than your
</span><span style="color:#75715e"># available RAM.
</span><span style="color:#75715e"></span>cache_mem <span style="color:#ae81ff">192</span> MB

<span style="color:#75715e"># Least Frequently Used with Dynamic Aging (keeps popular objects in cache
</span><span style="color:#75715e"># regardless of their size and thus optimizes byte hit rate at the expense of
</span><span style="color:#75715e"># hit rate since one large, popular object will prevent many smaller, slightly
</span><span style="color:#75715e"># less popular objects from being cached.
</span><span style="color:#75715e"></span>cache_replacement_policy heap LFUDA

<span style="color:#75715e"># Limit the size of file to hold in the cache, 10 MB is about the largest file
</span><span style="color:#75715e"># I expect multiple of my client to pull down.
</span><span style="color:#75715e"></span>maximum_object_size <span style="color:#ae81ff">10</span> MB

<span style="color:#75715e"># Tell squid to release memory it&#39;s not using
</span><span style="color:#75715e"></span>memory_pools off

<span style="color:#75715e"># Cacheing rules for content that doesn&#39;t have an explicit expire time.
</span><span style="color:#75715e"></span>refresh_pattern ^ftp:             <span style="color:#ae81ff">1440</span> <span style="color:#ae81ff">20</span>%    <span style="color:#ae81ff">10080</span>
refresh_pattern -i <span style="color:#f92672">(</span>/cgi-bin/|<span style="color:#ae81ff">\?</span><span style="color:#f92672">)</span> <span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">0</span>%     <span style="color:#ae81ff">0</span>
refresh_pattern .                 <span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">20</span>%    <span style="color:#ae81ff">4320</span>

<span style="color:#75715e"># Specifies how long squid should wait when it&#39;s service is asked to stop.
</span><span style="color:#75715e"># Generally this to allow client requests to complete, but I find it more
</span><span style="color:#75715e"># useful to make this fast.
</span><span style="color:#75715e"></span>shutdown_lifetime <span style="color:#ae81ff">1</span> second

<span style="color:#75715e"># This normally evaluate how much data is left in a transfer when a client
</span><span style="color:#75715e"># disconnects before it&#39;s completed, and if the remaining data falls in the
</span><span style="color:#75715e"># configured range, Squid will finish downloading the file and cache it anyway.
</span><span style="color:#75715e"># This is cool but not useful in my environment.
</span><span style="color:#75715e"></span>quick_abort_min <span style="color:#ae81ff">0</span> KB
quick_abort_max <span style="color:#ae81ff">0</span> KB

<span style="color:#75715e">### SSL BUMP
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># TODO: This is exactly worst practices in most cases, however, for a highly
</span><span style="color:#75715e"># restricted network of servers using this as their only means of accessing the
</span><span style="color:#75715e"># internet... It can be an important security measure.
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### CUSTOM ERROR MESSAGES
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># TODO: Useful for client facing servers
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### SQUIDGUARD CONFIG
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#url_rewrite_program /usr/bin/squidGuard -c /etc/squid/squidGuard.conf
</span><span style="color:#75715e">#url_rewrite_bypass off
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### LOGGING
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># &lt;Client IP&gt; &lt;Username&gt; [&lt;Local Time&gt;] &#34;&lt;Request Method&gt; &lt;Request URL&gt;
</span><span style="color:#75715e"># HTTP/&lt;Protocol Version&gt; &lt;Response Status Code&gt; &lt;Sent reply size (with
</span><span style="color:#75715e"># headers)&gt; &lt;Referer&gt; &lt;User Agent&gt; &lt;Squid Request Status&gt;:&lt;Squid Hierarchy
</span><span style="color:#75715e"># Status&gt;
</span><span style="color:#75715e"></span>logformat        combined %&gt;a %un <span style="color:#f92672">[</span>%tl<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;%rm %ru HTTP/%rv&#34;</span> %&gt;Hs %&lt;st <span style="color:#e6db74">&#34;%{Referer}&gt;h&#34;</span> <span style="color:#e6db74">&#34;%{User-Agent}&gt;h&#34;</span> %Ss:%Sh

<span style="color:#75715e"># &lt;Client IP&gt; &lt;Username&gt; [&lt;Local Time&gt;] &#34;&lt;Sent Headers&gt;&#34; &#34;&lt;Reply Headers&gt;&#34;
</span><span style="color:#75715e"></span>logformat        debugheaders %&gt;a %un <span style="color:#f92672">[</span>%tl<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;%&gt;h&#34;</span> <span style="color:#e6db74">&#34;%&lt;h&#34;</span>

<span style="color:#75715e"># Send our neat logs through to the local syslog server
</span><span style="color:#75715e"></span>access_log       syslog:local3.info combined

<span style="color:#75715e"># Useful for debugging
</span><span style="color:#75715e">#access_log      syslog:local3.debug debugheaders
</span><span style="color:#75715e">#access_log      stdio:/var/log/squid/headers.log debugheaders
</span><span style="color:#75715e">#cache_store_log stdio:/var/log/squid/store.log
</span><span style="color:#75715e">#cache_log       stdio:/var/log/squid/cache.log
</span><span style="color:#75715e">#logfile_rotate  3
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### BEGIN ACL ALIASES
</span><span style="color:#75715e"></span>
acl CONNECT method CONNECT

<span style="color:#75715e"># An ACL to match authenticated users
</span><span style="color:#75715e"></span>acl authenticated_user proxy_auth REQUIRED

<span style="color:#75715e"># ACL covering clients allowed to use this proxy
</span><span style="color:#75715e"></span>acl allowed_hosts src <span style="color:#ae81ff">10</span>.0.0.0/24
acl allowed_hosts src fc00::/7       <span style="color:#75715e"># RFC 4193 local private network range
</span><span style="color:#75715e"></span>acl allowed_hosts src fe80::/10      <span style="color:#75715e"># RFC 4291 link-local (directly plugged) machines
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># ACLs covering restricted destinations
</span><span style="color:#75715e"></span>acl to_local_network dst <span style="color:#ae81ff">10</span>.0.0.0/24

<span style="color:#75715e"># Limit individual matching hosts to 500 connections
</span><span style="color:#75715e"></span>acl proxy_connection_limit maxconn <span style="color:#ae81ff">500</span>

<span style="color:#75715e"># Which ports to allow raw connects too (For SSL mostly)
</span><span style="color:#75715e"></span>acl SSL_ports port <span style="color:#ae81ff">443</span> 	        <span style="color:#75715e"># https
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Which ports to allow regular unencrypted procols to connect to
</span><span style="color:#75715e"></span>acl allowed_ports port <span style="color:#ae81ff">80</span>          <span style="color:#75715e"># http
</span><span style="color:#75715e"></span>acl allowed_ports port <span style="color:#ae81ff">21</span>          <span style="color:#75715e"># ftp
</span><span style="color:#75715e"></span>acl allowed_ports port <span style="color:#ae81ff">443</span>         <span style="color:#75715e"># https
</span><span style="color:#75715e">#acl allowed_ports port 1025-65535  # unregistered ports
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### BEGIN ACLS
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Only allow cachemgr access from localhost
</span><span style="color:#75715e"></span>http_access allow manager localhost
http_access deny manager

<span style="color:#75715e"># Access to local web based services should be explictely and directly allowed.
</span><span style="color:#75715e"># Deny access to them through this proxy.
</span><span style="color:#75715e"></span>http_access deny to_local_network

<span style="color:#75715e"># Deny requests from clients that go over the connection limits
</span><span style="color:#75715e"></span>http_access deny proxy_connection_limit

<span style="color:#75715e"># Allow CONNECT to only the explicitely allowed ports
</span><span style="color:#75715e"></span>http_access allow CONNECT SSL_ports
http_access deny CONNECT

<span style="color:#75715e"># Deny requests to any port we haven&#39;t whitelisted
</span><span style="color:#75715e"></span>http_access deny !allowed_ports

<span style="color:#75715e"># Allow access to this squid server from our local whitelisted network... as
</span><span style="color:#75715e"># long as they&#39;re authenticated.
</span><span style="color:#75715e"></span>http_access allow allowed_hosts authenticated_user

<span style="color:#75715e"># Deny any requests we haven&#39;t allowed by this point
</span><span style="color:#75715e"></span>http_access deny all

<span style="color:#75715e">### PRIVACY / REQUEST MANGLING
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># TODO: Client information can leak out through headers including information
</span><span style="color:#75715e"># about services and OS&#39;s running inside the network. Mangling the requests and
</span><span style="color:#75715e"># responses and whitelisting the various headers of value can help mitigate
</span><span style="color:#75715e"># this, and provide meaningful dis-information.
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#request_header_replace User-Agent Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)
</span><span style="color:#75715e">#request_header_replace Accept */*
</span><span style="color:#75715e">#request_header_replace Accept-Encoding gzip # May cause issues should TEST
</span><span style="color:#75715e">#request_header_replace Accept-Language en
</span><span style="color:#75715e">#
</span><span style="color:#75715e">## Some of these should be reply_header_access
</span><span style="color:#75715e">#request_header_access Accept allow all
</span><span style="color:#75715e">#request_header_access Accept-Encoding allow all
</span><span style="color:#75715e">#request_header_access Accept-Language allow all
</span><span style="color:#75715e">#request_header_access Authorization allow all
</span><span style="color:#75715e">#request_header_access Cache-Control allow all
</span><span style="color:#75715e">##request_header_access Content-Disposition allow all
</span><span style="color:#75715e">#request_header_access Content-Encoding allow all
</span><span style="color:#75715e">#request_header_access Content-Length allow all
</span><span style="color:#75715e">##request_header_access Content-Location allow all
</span><span style="color:#75715e">#request_header_access Content-Range allow all
</span><span style="color:#75715e">#request_header_access Content-Type allow all
</span><span style="color:#75715e">#request_header_access Cookie allow all
</span><span style="color:#75715e">#request_header_access Expires allow all
</span><span style="color:#75715e">#request_header_access Host allow all
</span><span style="color:#75715e">#request_header_access If-Modified-Since allow all
</span><span style="color:#75715e">##request_header_access Location allow all
</span><span style="color:#75715e">#request_header_access Range allow all
</span><span style="color:#75715e">#request_header_access Referer allow all
</span><span style="color:#75715e">#request_header_access Set-Cookie allow all
</span><span style="color:#75715e">#request_header_access User-Agent deny all
</span><span style="color:#75715e">#request_header_access WWW-Authenticate allow all
</span><span style="color:#75715e"></span>#request_header_access All deny all</code></pre></div>
<p>To enable syslog logging we need to add the <code>-s</code> flag to <code>SQUID_OPTS</code> in
<code>/etc/sysconfig/squid</code>.</p>

<pre><code># Squid options (additionally log to syslog)
SQUID_OPTS=&quot;-s&quot;

# Time to wait for Squid to shut down when asked. Should not be necessary
# most of the time.
SQUID_SHUTDOWN_TIMEOUT=100

# default squid conf file
SQUID_CONF=&quot;/etc/squid/squid.conf&quot;
</code></pre>

<p>Enable and start the service:</p>

<pre><code>systemctl enable squid.service
systemctl start squid.service
</code></pre>

<h2 id="firewall">Firewall</h2>

<p>Allow access to the squid proxy from within the airlock, and the normal ports
outbound.</p>

<pre><code># Allow access to the local squid proxy server (mostly for updates)
-A INPUT  -m tcp -p tcp --dport 3128 -s 10.0.0.0/24 -j ACCEPT

# Allow squid to make FTP/HTTP(S) requests on behalf of the other machines in
# the network
-A OUTPUT -m tcp -p tcp --dport 21  -j ACCEPT
-A OUTPUT -m tcp -p tcp --dport 80  -j ACCEPT
-A OUTPUT -m tcp -p tcp --dport 443 -j ACCEPT
</code></pre>

<p>Other clients on the network will need to be able to talk to the squid port.</p>

<pre><code>-A OUTPUT -m tcp -p tcp --dport 3128 -d 10.0.0.170 -j ACCEPT
</code></pre>

<h2 id="a-note-on-non-standard-ports">A Note on Non-Standard Ports</h2>

<p>It is highly recommended to run squid on a non-standard port if it is going to
be exposed to the internet. The catch is that this will throw SELinux for a
loop. The following command will tell SELinux to be ok with squid running on
port 11637.</p>

<pre><code>[root@localhost ~]# semanage port -a -t http_cache_port_t -p tcp 11637
</code></pre>

<p>This may be necessary if squid needs to listen on multiple ports (for example
for dansGuardian with kerberos authentication).</p>

<h2 id="viewing-statistics">Viewing Statistics</h2>

<p>On the squid server you can run a report to see the status of squid with the
&ldquo;squidclient&rdquo; command like so:</p>

<pre><code>squidclient -h 127.0.0.1 mgr:info
</code></pre>

<h2 id="testing">Testing</h2>

<p>You can confirm the squid works like so:</p>

<pre><code>curl -x 10.0.0.170:3128 https://www.google.com/
</code></pre>

<p>With authentication:</p>

<pre><code>curl --proxy-basic --proxy-user user:pass -x 10.0.0.170:3128 https://www.google.com/
</code></pre>

<p>To get yum working with the proxy add the following line to the <code>[main]</code>
section of /etc/yum.conf file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">proxy</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://10.0.0.170:3128</span></code></pre></div>
<p>If authentication is required the two following lines can always be added:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">proxy_username</span><span style="color:#f92672">=</span><span style="color:#e6db74">username</span>
<span style="color:#a6e22e">proxy_password</span><span style="color:#f92672">=</span><span style="color:#e6db74">password</span></code></pre></div>
<p>To setup general proxy use on the system for various command line utilities
like <code>wget</code>, <code>curl</code>, and <code>lynx</code>, there are a set of common environment variable
to set. I created a file <code>/etc/profile.d/proxy.sh</code> with the following contents
and make it executable.</p>

<pre><code># General proxy configuration for system tools
export http_proxy=squid.local.tld:3128
export https_proxy=squid.local.tld:3128
export ftp_proxy=squid.local.tld:3128
export ALL_PROXY=squid.local.tld:3128
export no_proxy=.i.0x378.net
export NO_PROXY=.i.0x378.net
</code></pre>

<p>You can include credentials by prepending the <code>user:pass@</code> to the hosts of the
protocols above.</p>

</div>

    
<footer class='entry-footer-container'>
  <div class='entry-footer'>
  
  </div>
</footer>


  </article>
</main>

    <footer id='footer' class='footer-container'>
      <div class='footer'>
        <div class='social-menu-container'>
  <nav aria-label='Social Menu'>
    <ul class='social-menu'><li>
        <a href='mailto:sam@stelfox.net' target='_blank' rel='noopener'>
          <span class='screen-reader'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li><li>
        <a href='https://github.com/sstelfox' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/SamStelfox' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://keybase.io/sstelfox' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Keybase account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <g transform="matrix(0.5, 0, 0, 0.5, -120,-205)">
    <path d="M247.8,451.8c-0.6-1.3-1.4-3.1-1.8-4l-0.6-1.7l-2,2.2l-2,2.2 l-0.2-4.2c-0.3-6,0.2-12.2,1.2-16.6c2.3-9.8,9.5-18.7,18.8-23.4l2.1-1l-0.5-1.5c-0.3-0.8-0.6-2.5-0.7-3.6l-0.2-2.1l-2.1-0.2 c-3.2-0.3-4.9-1.2-6-3.5c-0.6-1.2-0.6-1.4-0.4-4.6c0.2-4.2,0.5-5.1,1.8-6.5c1.6-1.8,2.7-2.1,6.7-1.9c2.9,0.2,3.5,0.3,4.8,0.9 c0.8,0.4,1.5,0.8,1.6,0.8c0.1,0,1-1.1,2.1-2.6l1.9-2.7l1.2,0.7c0.7,0.4,1.5,0.9,1.9,1.1l0.7,0.4l-0.6,1.5c-0.3,0.8-0.7,2.2-0.8,2.9 l-0.2,1.4l1.7,0.2c6.1,0.6,10.7,4.3,12.4,9.9c0.5,1.8,0.5,5.3,0,7c-0.5,1.6-0.5,1.7-0.1,1.7c0.7,0,5.4,2.3,7.3,3.5 c3.7,2.4,8,6.6,10.4,10.2c4.5,6.7,6.4,14,5.6,22c-0.4,4.8-1.3,8.6-2.9,12.3l-0.6,1.4l-2.5,0l-2.5,0l1.2-2.4 c1.3-2.6,2.3-6.2,2.8-9.4c0.3-2.2,0.4-8.2,0.1-9.3l-0.2-0.7l-1.3,1.4c-3.2,3.5-7.9,4.5-14.2,2.8c-5.4-1.4-7.6-1.7-12.7-1.7 c-3.9,0-5.2,0.1-7.3,0.6c-5.8,1.3-9.9,3.2-15.6,7.3c-2.1,1.5-3.8,2.7-3.9,2.7c-0.1,0,0.2-1,0.6-2.3c0.4-1.3,1.1-3.4,1.5-4.8 l0.8-2.5l-0.9,0.9c-0.5,0.5-1.9,1.9-3.1,3.2l-2.1,2.3l0.5,1.9c0.6,2.5,2,5.6,3.5,7.9c0.6,1,1.1,1.8,1.1,1.9s-1.2,0.1-2.6,0.1h-2.6 L247.8,451.8L247.8,451.8z M256.6,427.6c4.8-5.1,8.7-9.2,8.8-9.2c0.1,0.1-0.4,1.6-0.9,3.3c-3.3,10.4-4,12.4-3.9,12.5 c0,0,1.2-0.4,2.5-0.9c8.5-3.7,18.4-4.2,28.9-1.4c4.7,1.2,6.5,1.2,8.8,0c1.3-0.7,1.8-1.1,2.4-2.1c1.1-1.7,1.2-4.1,0.5-6.3 c-1.7-4.8-8.3-11-14.5-13.7c-3.2-1.4-3.4-1.4-4.1-0.7l-0.6,0.6l2.6,3.2c1.4,1.7,2.9,3.6,3.1,4.1c0.6,1.2,0.7,3.1,0.1,4.3 c-0.8,1.7-3.2,2.9-5.1,2.5c-0.8-0.2-1.1-0.1-1.9,0.5c-2.2,1.6-4.6,1.2-6.6-1.2c-1.6-1.8-2-2.7-2.1-4.5c0-0.9-0.3-2-0.5-2.4 c-0.3-0.6-0.4-1.3-0.4-2.2l0.1-1.4l-1.3-0.3c-1.8-0.5-3.9-1.5-5.1-2.4c-0.6-0.4-1.1-0.8-1.3-0.8s-1.5,0.6-2.9,1.3 c-9.7,5-16,14.3-17,24.8c-0.1,1-0.2,2.3-0.3,2.8l-0.1,0.9l1.1-1.1C247.4,437.3,251.8,432.7,256.6,427.6L256.6,427.6z M282.5,420.2 c0.9-0.7,1.7-1.3,1.9-1.3c0.1,0,0.4,0.3,0.7,0.7c0.5,0.8,1.4,0.8,1.8,0.1c0.3-0.5,0.3-0.6-5.6-7.8c-3.5-4.3-4.2-5-4.7-5 c-1.2,0.1-0.9,1,1,3.3l1.8,2.2l-1,0.8c-1.1,1-1.2,1.2-0.5,1.8c0.5,0.5,0.6,0.4,1.6-0.3l1.1-0.7l0.7,0.6c0.4,0.3,0.6,0.8,0.6,0.9 c0,0.2-0.8,0.9-1.7,1.7c-0.9,0.7-1.6,1.5-1.6,1.7c0,0.3,0.5,1.1,1.4,2.2C280.3,421.7,280.8,421.5,282.5,420.2L282.5,420.2z  M272.2,406c0.6-1.8,2.6-3.2,4.6-3.2c1.1,0,2.7,0.9,3.8,2.1l1,1.2l0.9-1.1c2.5-2.8,2.8-6.7,0.8-10.1c-1.5-2.5-4.3-4-8.2-4.4 c-2.1-0.2-2.6-0.4-3.7-1.5l-0.8-0.8l-0.4,0.6c-0.8,1.2-2.5,5.1-3,6.6c-0.7,2.3-0.4,5.9,0.5,7.7c0.9,1.7,3.3,4,4,3.7 C271.8,406.9,272,406.5,272.2,406L272.2,406z M263.3,392.4c0.2-0.5,0.7-1.8,1.2-2.8c0.5-1,0.9-2,0.9-2.3c0-0.9-1-1.3-3.7-1.5 c-2.4-0.2-2.6-0.1-3.1,0.4c-0.4,0.4-0.6,0.9-0.6,1.6c0,0.6-0.1,1.7-0.2,2.6c-0.2,2.1,0.1,2.5,2.2,2.8 C263.1,393.4,263,393.4,263.3,392.4z M260.2,390c0-1.7,0.2-1.9,1.6-1.9h1.3v1.4v1.4h-1.4h-1.4V390z M266.5,448.3 c-0.6-0.6-0.8-1-0.8-2c0-1.9,1.1-3,2.9-3c1.7,0,2.9,1.2,2.9,2.9c0,1.8-1.1,2.8-3,2.9C267.5,449.1,267.1,448.9,266.5,448.3 L266.5,448.3z M285.8,448.6c-2.3-1.8-1.1-5.3,1.8-5.3c1.8,0,2.8,1.1,2.9,3c0,1.1-0.1,1.4-0.8,2s-1,0.8-2,0.8 C286.8,449.1,286.2,448.9,285.8,448.6L285.8,448.6z"/>
  </g>
  
</svg>
</a>
      </li><li>
        <a href='https://facebook.com/sstelfox' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Facebook account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/samstelfox' target='_blank' rel='noopener'>
          <span class='screen-reader'>Open Linkedin account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</div>
        <div class='copyright'>
  <p>
        
          
        
      
       &copy; 2011-2018 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a>
  </p>
</div>

      </div>
    </footer>
  </div><script src='/assets/js/main.f29c93b9.js'></script></body>
</html>

