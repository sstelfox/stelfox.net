<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Configuration First install the transmission-daemon like so:
[root@localhost ~]# yum install transmission-daemon -y  The init script that comes with transmission-daemon uses the utility which which is not in the minimal install. As such you&rsquo;ll need to edit the init file to point at the binary as it should be doing in the first place.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Transmission Daemon • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Configuration First install the transmission-daemon like so:
[root@localhost ~]# yum install transmission-daemon -y  The init script that comes with transmission-daemon uses the utility which which is not in the minimal install. As such you&rsquo;ll need to edit the init file to point at the binary as it should be doing in the first place.'>
<meta property='og:url' content='https://stelfox.net/notes/transmission-daemon/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.51-DEV" />

  <title>Transmission Daemon • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/transmission-daemon/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4a10984a.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-notes'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Transmission Daemon</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='0001-01-01T00:00:00Z'>0001, Jan 01</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
6 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p><strong><em>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</em></strong></p>

<h2 id="configuration">Configuration</h2>

<p>First install the transmission-daemon like so:</p>

<pre><code>[root@localhost ~]# yum install transmission-daemon -y
</code></pre>

<p>The init script that comes with transmission-daemon uses the utility <code>which</code>
which is not in the minimal install. As such you&rsquo;ll need to edit the init file
to point at the binary as it should be doing in the first place. Find the
following line:</p>

<pre><code>DAEMON=$(which $NAME)
</code></pre>

<p>Replace it with:</p>

<pre><code>DAEMON=/usr/bin/transmission-daemon
</code></pre>

<p>Open up <code>/etc/sysconfig/transmission-daemon</code>. We&rsquo;re going to make a few changes
here. First off the defaults listed in this file are not actually the defaults
that the transmission-daemon will start up with. I don&rsquo;t like ambiguity so
we&rsquo;re going to replace them with the real values.</p>

<p>The tranmission-daemon runs as user &ldquo;tranmission&rdquo; and it&rsquo;s home directory is
<code>/var/lib/transmission</code>. We want to prefer encryption whenever it is available.</p>

<p>I don&rsquo;t like defining configuration information through the service startup
unless they don&rsquo;t have an equivalent setting (encryption preferred - you can
turn encryption support on in the config but not the &lsquo;prefer&rsquo; part) so we get
rid of the blacklist setting.</p>

<p>With those changes the file should look like the following:</p>

<pre><code>TRANSMISSION_HOME=/var/lib/transmission
DAEMON_USER=&quot;transmission&quot;
DAEMON_ARGS=&quot;-ep -g $TRANSMISSION_HOME/.config/transmission-daemon&quot;
</code></pre>

<p>The install doesn&rsquo;t set up a default configuration, so we need to quickly start
and stop the daemon so one is generated for us to edit like so:</p>

<pre><code>[root@localhost ~]# service transmission-daemon start
Starting transmission-daemon (via systemctl):              [  OK  ]
[root@localhost ~]# service transmission-daemon stop
Stopping transmission-daemon (via systemctl):              [  OK  ]
</code></pre>

<p>Alright now that we have a config lets open it up and make some changes, it can
be found at <code>/var/lib/transmission/.config/transmission-daemon/settings.json</code>.</p>

<p>Provided below is my configuration file AFTER I&rsquo;ve made changes to the
defaults.</p>

<p>Note to self: This isn&rsquo;t cleaned up and is not fit for public consumption. The
only change that has been made is the removal of the contents of rpc-password
hash.</p>

<p>After entering a password into the rpc-password field, start and stop the
service again to have it in hashed form. Also note that I&rsquo;ve picked a random
but static port in this case 37288. Make sure that it is allowed through the
firewall and forwarded.</p>

<pre><code>{
  &quot;alt-speed-down&quot;: 200, 
  &quot;alt-speed-enabled&quot;: false, 
  &quot;alt-speed-time-begin&quot;: 540, 
  &quot;alt-speed-time-day&quot;: 127, 
  &quot;alt-speed-time-enabled&quot;: false, 
  &quot;alt-speed-time-end&quot;: 1020, 
  &quot;alt-speed-up&quot;: 200, 
  &quot;bind-address-ipv4&quot;: &quot;0.0.0.0&quot;,
  &quot;bind-address-ipv6&quot;: &quot;::&quot;, 
  &quot;blocklist-enabled&quot;: true, 
  &quot;blocklist-url&quot;: &quot;http://list.iblocklist.com/?list=bt_level1&amp;fileformat=p2p&amp;archiveformat=gz&quot;, 
  &quot;cache-size-mb&quot;: 10, 
  &quot;dht-enabled&quot;: true, 
  &quot;download-dir&quot;: &quot;/media/storage/Torrents/Downloads/&quot;, 
  &quot;encryption&quot;: 1, 
  &quot;idle-seeding-limit&quot;: 30, 
  &quot;idle-seeding-limit-enabled&quot;: false, 
  &quot;incomplete-dir&quot;: &quot;/media/storage/Torrents/Incomplete&quot;, 
  &quot;incomplete-dir-enabled&quot;: true, 
  &quot;lazy-bitfield-enabled&quot;: true, 
  &quot;lpd-enabled&quot;: false, 
  &quot;message-level&quot;: 2, 
  &quot;open-file-limit&quot;: 32, 
  &quot;peer-congestion-algorithm&quot;: &quot;&quot;, 
  &quot;peer-limit-global&quot;: 240, 
  &quot;peer-limit-per-torrent&quot;: 60, 
  &quot;peer-port&quot;: 37288, 
  &quot;peer-port-random-high&quot;: 65535, 
  &quot;peer-port-random-low&quot;: 49152, 
  &quot;peer-port-random-on-start&quot;: false, 
  &quot;peer-socket-tos&quot;: &quot;default&quot;, 
  &quot;pex-enabled&quot;: true, 
  &quot;port-forwarding-enabled&quot;: true, 
  &quot;preallocation&quot;: 0, 
  &quot;prefetch-enabled&quot;: 1, 
  &quot;ratio-limit&quot;: 15, 
  &quot;ratio-limit-enabled&quot;: false, 
  &quot;rename-partial-files&quot;: true, 
  &quot;rpc-authentication-required&quot;: true, 
  &quot;rpc-bind-address&quot;: &quot;10.13.37.52&quot;, 
  &quot;rpc-enabled&quot;: true, 
  &quot;rpc-password&quot;: &quot;&quot;, 
  &quot;rpc-port&quot;: 9091, 
  &quot;rpc-url&quot;: &quot;/transmission/&quot;, 
  &quot;rpc-username&quot;: &quot;torrentadmin&quot;, 
  &quot;rpc-whitelist&quot;: &quot;127.0.0.1,10.13.37.*&quot;, 
  &quot;rpc-whitelist-enabled&quot;: true, 
  &quot;script-torrent-done-enabled&quot;: true,
  &quot;script-torrent-done-filename&quot;: &quot;/var/lib/transmission/.config/transmission-daemon/torrent-completed.sh&quot;,
  &quot;speed-limit-down&quot;: 100, 
  &quot;speed-limit-down-enabled&quot;: false, 
  &quot;speed-limit-up&quot;: 100, 
  &quot;speed-limit-up-enabled&quot;: false, 
  &quot;start-added-torrents&quot;: true, 
  &quot;trash-original-torrent-files&quot;: true, 
  &quot;umask&quot;: 18, 
  &quot;upload-slots-per-torrent&quot;: 14,
  &quot;watch-dir&quot;: &quot;/media/storage/Dropbox/TorrentDrop&quot;,
  &quot;watch-dir-enabled&quot;: true
}
</code></pre>

<p>With the config above I&rsquo;ve configured it too run a script
<code>/var/lib/transmission/.config/transmission-daemon/torrent-completed.sh</code>
whenever a torrent finishes downloading. This file needs to at least exist and
be executable if you don&rsquo;t turn it off above. You can do this with the
following commands:</p>

<pre><code>[root@localhost ~]# touch /var/lib/transmission/.config/transmission-daemon/torrent-completed.sh
[root@localhost ~]# chmod +x /var/lib/transmission/.config/transmission-daemon/torrent-completed.sh
</code></pre>

<p>I&rsquo;ve personally set it up to email me whenever a torrent completes by putting
the following script in that file:</p>

<pre><code>#!/bin/bash

# Transmission populates the following variables for use in the script:
# TR_APP_VERSION
# TR_TIME_LOCALTIME
# TR_TORRENT_DIR
# TR_TORRENT_HASH
# TR_TORRENT_ID
# TR_TORRENT_NAME

# Setup the message to be sent
TO_ADDR=admin@example.com
SUBJECT=&quot;Torrent Completed&quot;
FROM_ADDR=&quot;transmission@example.com&quot;
BODY=&quot;Transmission finished downloading \&quot;$TR_TORRENT_NAME\&quot; on $TR_TIME_LOCALTIME&quot;

# Send the email
echo $BODY | mailx -s &quot;$SUBJECT&quot; -r &quot;$FROM_ADDR&quot; $TO_ADDR
</code></pre>

<p>Alright now this part is strange. If for some reason transmission doesn&rsquo;t close
properly or some other funniness happens, it DELETES it&rsquo;s config file and
resets it back to the defaults. To prevent this we&rsquo;re going to remove
tranmissions ability to change it&rsquo;s config file. The catch with this is that it
starts up with root privileges and will just rewrite the config file with
read/write permissions so you need to make the file immutable like so:</p>

<pre><code>[root@localhost ~]# chattr +i /var/lib/transmission/.config/transmission-daemon/settings.json
</code></pre>

<p>Ensure that transmission&rsquo;s group has write privileges over it&rsquo;s Download,
Incomplete, and TorrentDrop directory.</p>

<p>Now lets start it up for real and make sure it starts up correctly on boot:</p>

<pre><code>[root@localhost ~]# chkconfig transmission-daemon on
[root@localhost ~]# service transmission-daemon start
</code></pre>

<p>You can then use the utility transmission-remote to check on the status of
transmission like so:</p>

<pre><code>[root@localhost ~]# transmission-remote transmission-server.example.com -l
ID     Done       Have  ETA           Up    Down  Ratio  Status       Name
Sum:           Unknown               0.0     0.0
</code></pre>

<h2 id="making-torrents-from-the-command-line">Making Torrents from the Command Line</h2>

<p>First you need to install the utility &ldquo;mktorrent&rdquo; like so:</p>

<pre><code>[root@localhost ~]# yum install mktorrent -y
</code></pre>

<p>I use a private tracker so these instructions are going to be specific for
them.</p>

<p>First things first we&rsquo;re going to figure out the best size for the pieces in
the torrent. Generally I default to 512Kb (2^19), if the torrent is around the
size of a DVD I&rsquo;ll increase the size of the pieces to 1Mb (2^20). Anything
larger than that probably doesn&rsquo;t belong in a single torrent. We need to know
this as the exponent is one of the flags passed (specifically -l) so for my
default I&rsquo;ll use the flag &ldquo;-l 19&rdquo;.</p>

<p>Since I use a private tracker I need to set the private flag (-p). You should
really give the torrent a meaningful name with the &ldquo;-n&rdquo; flag. Additionally a
comment on the torrent is usually welcome with &ldquo;-c&rdquo;.</p>

<p>With my current private tracker when creating a torrent you get a unique
tracker link that looks something like <code>http://tracker.&lt;site&gt;.org:34000/&lt;Your
private 32 character ID string&gt;/announce</code>, so you need to get that before you
can finish setting up the torrent. Pass it as an option to the &ldquo;-a&rdquo; flag</p>

<p>Make sure all the files you want in the torrent are in the same directory
(we&rsquo;re going to use <code>/media/example/MySpecialTorrent/</code>) in this example:</p>

<pre><code>[root@localhost ~]# mktorrent -l 19 -p -n &quot;My Special Torrent&quot; -c &quot;A very special torrent that I'm using as an example&quot; \
&gt; -a &quot;&lt;tracker address&gt;&quot; \
&gt; /media/example/MySpecialTorrent/*
mktorrent 1.0 (c) 2007, 2009 Emil Renner Berthing

Hashed 40 of 40 pieces.
Writing metainfo file... done.
</code></pre>

<p>You will then have a .torrent file in your current directory named after what
you gave mktorrent with the -n flag.</p>

<h2 id="security-notes">Security Notes</h2>

<ul>
<li>The transmission-daemon doesn&rsquo;t support multiple users, so either a shared
password needs to be provided, none configured or a reverse proxy needs to be
setup in front of it that has basic authentication.

<ul>
<li>A lot of the clients can support basic authentication by using the format:
<code>http://username:password@torrentbox.local/</code> for the &ldquo;host&rdquo;.</li>
<li>A reverse proxy can also be used to provide HTTPS access to the interface</li>
<li>A reverse proxy can safely make the interface available to the outside
world by putting restrictions on it</li>
</ul></li>
<li>The transmission daemon can restrict access to certain things based on IP
masks, these should be configured appropriately</li>
<li>Blocklists can be used to eliminate potential corporation spies that&rsquo;ll do
bad things to you</li>
<li>I strongly encourage preferring or enforcing encryption as it will reduce
what is visible to ISPs</li>
<li>All of the torrent traffic could potentially be pushed through an anonymising
VPN such as that provided by xerobank.com</li>
</ul>

<h2 id="firewall-adjustments">Firewall Adjustments</h2>

<pre><code># Allow other torrenter's to connect to us
-A SERVICE -m tcp -p tcp --dport 37288 -j ACCEPT
# Allow local access to the web interface
-A SERVICE -s 10.13.37.0/24 -m tcp -p tcp --dport 9091 -j ACCEPT
</code></pre>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/trim/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Trim</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/tmux/'>
        <span class='screen-reader-text'>Next post: </span>Tmux<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2018 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.fae8ed32.js'></script>

</body>

</html>

