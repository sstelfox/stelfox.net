<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Duplicity is a command line backup utility that makes use of the rsync libraries to perform incremental backups. It also can use GPG public/private keypairs to handle backing up and restoring files.
I personally want to use public / private key pairs for my backups and contrary with what I do most of the time I share a single public / private key pair for my backups, with a strong pass string on the private key.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Duplicity • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Duplicity is a command line backup utility that makes use of the rsync libraries to perform incremental backups. It also can use GPG public/private keypairs to handle backing up and restoring files.
I personally want to use public / private key pairs for my backups and contrary with what I do most of the time I share a single public / private key pair for my backups, with a strong pass string on the private key.'>
<meta property='og:url' content='https://stelfox.net/notes/duplicity/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>Duplicity • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/duplicity/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-notes'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Duplicity</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='0001-01-01T00:00:00Z'>0001, Jan 01</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
4 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p>
<p>Duplicity is a command line backup utility that makes use of the rsync
libraries to perform incremental backups. It also can use GPG public/private
keypairs to handle backing up and restoring files.</p>
<p>I personally want to use public / private key pairs for my backups and contrary
with what I do most of the time I share a single public / private key pair for
my backups, with a strong pass string on the private key.</p>
<p>This is an adequate level of security for me as the backups will all be
encrypted and can be decrypted and restored from any of the other machines as
needed.</p>
<p>The backups are performed to a remote system using SFTP and thus I handle
per-machine authentication using SSH keys.</p>
<p>Duplicity supports more than SFTP as a backend, however, it will just make my
scripts less relevant too you.</p>
<h2 id="installation">Installation</h2>
<p>Fedora happily has a package available so this is as easy as:</p>
<pre><code>sudo yum install duplicity python-paramiko -y
</code></pre><p>It also happily doesn't have a whole lot of dependencies.</p>
<p>You'll also need GPG installed if you want to make use of my scripts, this
won't trample on any GPG setup you may currently have. On Fedora this is
provided with the gpgme package and can be installed like so:</p>
<pre><code>sudo yum install gpgme -y
</code></pre><h3 id="gpg-key-creation">GPG Key Creation</h3>
<p>You'll only need to perform this process once, afterwards you'll have the
exported keys to move and backup as you please. I've chosen to use a 4096 bit
RSA and RSA key that doesn't expire and has the name &ldquo;System Backups&rdquo; without
an email address or a comment.</p>
<p>I've also set a very long pass string on the key as you'll be relying on this
to protect all the data on all your systems you'll be backing up with this.
These settings are of course personal preference and a 4096 bit key may be
overkill for most uses, though I really enjoy overkill when it comes to
security and peace of mind.</p>
<pre><code>gpg --keyring backup-pub.gpg --secret-keyring backup-sec.gpg \
  --no-default-keyring --gen-key
</code></pre><p>Now we need a way to securely move the generated keys around without worrying
about. I've chosen to export the public and private keys, encrypt them with a
symmetric pass string and move the resulting file between machines.</p>
<p>The private key should be encrypted anyway but it's one extra layer that can be
added on that allows me to feel comfortable enough to leave the whole blob in
the script without fear of compromising the private key in case that gets
cracked.</p>
<p>I refer to this password as the &ldquo;installation key&rdquo; as the script will use it to
decrypt and import the keys into the local GPG on other machines.</p>
<p>First you'll need to get the key ID of the key we just generated. This can be
done like so:</p>
<pre><code>gpg --keyring backup-pub.gpg --list-keys
/home/user/.gnupg/backup-pub.gpg
------------------------------------
pub   4096R/01234567 2012-09-24
uid                  System Backups
sub   4096R/89ABCDEF 2012-09-24
</code></pre><p>Given the output above our key ID is <code>01234567</code>, you'll want to replace that in
the following commands with your own key ID. First we'll export the public key,
there isn't any security concerns here:</p>
<pre><code>gpg --keyring backup-pub.gpg --output backup-pubkey.gpg --export 01234567
</code></pre><p>You now have the public key in the file <code>backup-pubkey.gpg</code>. Now we're going to
export the private key without saving it, combine it with the public key, and
encrypt the whole shebang into one file. Watch closely&hellip;</p>
<pre><code>gpg --secret-keyring backup-sec.gpg --export-secret-key 01234567 |
  cat backup-pubkey.gpg - | gpg --armor --symmetric --cipher-algo AES256 \
  --output backup-keys.asc
</code></pre><p>You now have a block of base64 encoded encrypted goodness in the
<code>backup-keys.asc</code> file which you can import later on.</p>
<h3 id="gpg-key-import">GPG Key Import</h3>
<pre><code>cat export.asc | gpg2 --decrypt --batch --passphrase &quot;PASSWORD&quot; | gpg2 \
  --keyring backup-pub.gpg --secret-keyring backup-sec.gpg --import
</code></pre>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/ezstream/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>EZStream</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/dhcpd/'>
        <span class='screen-reader-text'>Next post: </span>DHCPd<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script>

</body>

</html>

