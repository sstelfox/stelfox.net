<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt;  Module Interfaces There are only four module interfaces:'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='PAM • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt;  Module Interfaces There are only four module interfaces:'>
<meta property='og:url' content='https://stelfox.net/notes/pam/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.50-DEV" />

  <title>PAM • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/pam/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4267b3fa.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>


<body class='page type-notes'>

  <div class='site'>

    <a class='screen-reader-text' href='#content'>Skip to Content</a>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>PAM</h1>
      

    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='0001-01-01T00:00:00Z'>0001, Jan 01</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
5 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p><strong><em>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</em></strong></p>

<h2 id="overview">Overview</h2>

<p><code>/etc/pam.d/</code> directory contains the PAM configuration files for each PAM-aware
application. Each pam aware configuration file has lines in the format of:</p>

<pre><code>&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt;
</code></pre>

<h2 id="module-interfaces">Module Interfaces</h2>

<p>There are only four module interfaces:</p>

<ul>
<li>account - Verify access is allowed. Check if account has expired, time of day
checks, etc</li>
<li>auth - Authenticates use, verifies the validity of a password, set credentials
&amp; group memberships &amp; kerberos tickets</li>
<li>password - Used for updating credentials</li>
<li>session - Additional tasks performed after access has been granted, stuff like
mounting user directories and making users mailbox available.</li>
</ul>

<p>A module can provide any or all module interfaces.</p>

<p>Module interface directives can be &lsquo;stacked&rsquo; so that multiple modules are used
together for one purpose. The order of these directives. Commented out lines
start with &lsquo;#&rsquo;.</p>

<h2 id="control-flags">Control flags</h2>

<ul>
<li>include - The module name that is provided will not load a module, but rather
include another pam configuration file at this point in the config.</li>
<li>optional - The module result is ignored, this is only becomes necessary for
successful authentication when no other modules reference the interface.</li>
<li>required - The module result must be successful for authentication to
continue. If the test fails at this point, the user is not notified until the
results of all modules tests that reference that interface are complete.</li>
<li>requisite - The module result must be successful for authentication to
continue. If a test fails at this point, the uesr is notified immediately with
a message reflecting the first failed required or requisite module test.</li>
<li>sufficient - The module result is ignored if it fails. However, if the result
of a module flagged sufficient is successful and no previous modules flagged
required have failed, then no other results are required and the request
succeeds.</li>
</ul>

<h2 id="module">Module</h2>

<p>Available modules can be found in <code>/lib/security</code> or <code>/lib64/security</code>
depending on the system architecture.</p>

<h3 id="module-arguments">Module Arguments</h3>

<p>These are module dependent refer to the man page of the module.</p>

<h3 id="confusing-lines-i-don-t-understand">Confusing Lines I Don&rsquo;t Understand</h3>

<pre><code>account [default=bad success=ok user_unknown=ignore] pam_krb5.so
</code></pre>

<h2 id="pam-cracklib">pam_cracklib</h2>

<p><code>pam_cracklib</code> allows for quick quality control settings of passwords. It
allows minimum requirements of the number of different types of characters that
need to be used in a password before it can be used. It also checks the
password against a dictionary.</p>

<p>By default it checks against a dictionary but that really isn&rsquo;t enough for good
password security. Further password control can be accomplished using
<code>pam_passwdqc</code>.</p>

<p>Default:</p>

<pre><code>password  requisite  pam_cracklib.so try_first_pass retry=3 type=
</code></pre>

<p>Recommended (require one of each type, minimum length 14):</p>

<pre><code>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=14 dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1
</code></pre>

<p>Other (credit based):</p>

<pre><code>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=22 dcredit=2 ocredit=4
</code></pre>

<p>The credit based system requires a bit of explaining, it requires a 22
character password and treats numbers as 2 characters and symbols as 4
characters. This can be dangerous as you can have an 11 digit number as a
password which isn&rsquo;t secure&hellip;</p>

<h2 id="pam-passwdqc">pam_passwdqc</h2>

<p><code>pam_passwdqc</code> replaces <code>pam_cracklib</code> in checking the quality of the password.
To use it you need to comment out <code>pam_cracklib</code> in <code>/etc/pam.d/system-auth</code>.</p>

<p>You&rsquo;ll need to add this line to the <code>/etc/pam.d/system-auth</code>:</p>

<pre><code>password  requisite  pam_passwdqc.so retry=3 min=disabled,disabled,22,16,12 passphrase=4 similar=deny enforce=users
</code></pre>

<p>What this does is it prevent any passwords with one or two character types.
Requires a password with three character types to be a minimum of 16 characters
and one with four character types to be a minimum of 12 characters.</p>

<p>The middle option (22) is the minimum length of a passphrase (grouping of words
found in the dictionary file). The minimum number of words is controlled by the
passphrase option.</p>

<p>It denies similar passwords as previous ones and only enforces quality control
for root passwords (since they&rsquo;re sha512 hashes they only have two character
  classes and would thus be denied).</p>

<p>This is untested but to the best of my knowledge passphrases still need to be
at least three character classes (since one and two are disabled).</p>

<h2 id="pam-tally2">pam_tally2</h2>

<p><code>pam_tally2</code> comes with Fedora&rsquo;s pam package so it will be installed. It&rsquo;s very
useful to prevent bruteforce attempts BUT it can also used to lock access out
to a legitimate user. It is recommended to not turn this on for the entire
system but just remote login services that use pam (for example SSH).</p>

<p>To use it you need to add the following line to the services pam file. So for
SSH the file would be <code>/etc/pam.d/sshd</code>. The following is what needs to be
added:</p>

<pre><code>auth    required     pam_tally2.so deny=5 onerr=fail audit silent
account     required     pam_tally2.so
</code></pre>

<p>You&rsquo;ll also need to change:</p>

<pre><code>auth     sufficient     pam_unix.so nullok try_first_pass
</code></pre>

<p>To:</p>

<pre><code>auth     required     pam_unix.so nullok try_first_pass
</code></pre>

<p>And get rid of the following two lines as they will interfere with the rest of
the changes:</p>

<pre><code>auth     requisite    pam_succeed_if.so uid &gt;= 500 quiet
auth     required     pam_deny.so
</code></pre>

<h3 id="resetting-a-user-s-account">Resetting a User&rsquo;s Account</h3>

<p>Information about users password tally can be found in <code>/var/log/tallylog</code>.</p>

<pre><code>[root@localhost ~]# /sbin/pam_tally2 --user username --reset
</code></pre>

<h3 id="automatic-unlocking">Automatic Unlocking</h3>

<p>Additionally adding <code>unlock_time=1800</code>. This allows the user to log back in
half an hour after the account has been locked.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/partitioning/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Partitioning</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/openstack-keystone/'>
        <span class='screen-reader-text'>Next post: </span>Openstack Keystone<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2018 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.59f76c44.js'></script>

</body>

</html>

