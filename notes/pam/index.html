<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sam@stelfox.net Sam Stelfox ">
<meta name="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&amp;lt;module interface&amp;gt; &amp;lt;control flag&amp;gt; &amp;lt;module&amp;gt; &amp;lt;module arguments&amp;gt; Module Interfaces There are only four module interfaces:" />
<meta name="keywords" content="blog, programming, linux, systems, personal" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://stelfox.net/notes/pam/" />


    <title>
        
            PAM :: Sam Stelfox 
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css" integrity="sha256-KgZMRVsOy9axSBs7&#43;d8kQelYOGkQIvQKUzjCyxJE8HU=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="PAM">
<meta itemprop="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt; Module Interfaces There are only four module interfaces:">

<meta itemprop="wordCount" content="867">
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PAM"/>
<meta name="twitter:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt; Module Interfaces There are only four module interfaces:"/>



    <meta property="og:title" content="PAM" />
<meta property="og:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview /etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt; Module Interfaces There are only four module interfaces:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stelfox.net/notes/pam/" /><meta property="article:section" content="notes" />

















    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                ./Sam_Stelfox.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/blog/">Blog Posts</a></li><li><a href="/notes/">Various Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://stelfox.net/notes/pam/">PAM</a></h2>

            
            
            

            <div class="post-content">
                <p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p>
<h2 id="overview">Overview</h2>
<p><code>/etc/pam.d/</code> directory contains the PAM configuration files for each PAM-aware
application. Each pam aware configuration file has lines in the format of:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-v" data-lang="v"><span style="display:flex;"><span>&lt;<span style="color:#ff7b72">module</span> <span style="color:#ff7b72">interface</span>&gt; &lt;<span style="color:#79c0ff">control</span> <span style="color:#79c0ff">flag</span>&gt; &lt;<span style="color:#ff7b72">module</span>&gt; &lt;<span style="color:#ff7b72">module</span> <span style="color:#79c0ff">arguments</span>&gt;
</span></span></code></pre></div><h2 id="module-interfaces">Module Interfaces</h2>
<p>There are only four module interfaces:</p>
<ul>
<li>account - Verify access is allowed. Check if account has expired, time of day
checks, etc</li>
<li>auth - Authenticates use, verifies the validity of a password, set credentials
&amp; group memberships &amp; kerberos tickets</li>
<li>password - Used for updating credentials</li>
<li>session - Additional tasks performed after access has been granted, stuff like
mounting user directories and making users mailbox available.</li>
</ul>
<p>A module can provide any or all module interfaces.</p>
<p>Module interface directives can be &lsquo;stacked&rsquo; so that multiple modules are used
together for one purpose. The order of these directives. Commented out lines
start with &lsquo;#&rsquo;.</p>
<h2 id="control-flags">Control flags</h2>
<ul>
<li>include - The module name that is provided will not load a module, but rather
include another pam configuration file at this point in the config.</li>
<li>optional - The module result is ignored, this is only becomes necessary for
successful authentication when no other modules reference the interface.</li>
<li>required - The module result must be successful for authentication to
continue. If the test fails at this point, the user is not notified until the
results of all modules tests that reference that interface are complete.</li>
<li>requisite - The module result must be successful for authentication to
continue. If a test fails at this point, the uesr is notified immediately with
a message reflecting the first failed required or requisite module test.</li>
<li>sufficient - The module result is ignored if it fails. However, if the result
of a module flagged sufficient is successful and no previous modules flagged
required have failed, then no other results are required and the request
succeeds.</li>
</ul>
<h2 id="module">Module</h2>
<p>Available modules can be found in <code>/lib/security</code> or <code>/lib64/security</code>
depending on the system architecture.</p>
<h3 id="module-arguments">Module Arguments</h3>
<p>These are module dependent refer to the man page of the module.</p>
<h3 id="confusing-lines-i-dont-understand">Confusing Lines I Don&rsquo;t Understand</h3>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>account [default=bad success=ok user_unknown=ignore] pam_krb5.so
</span></span></code></pre></div><h2 id="pam_cracklib">pam_cracklib</h2>
<p><code>pam_cracklib</code> allows for quick quality control settings of passwords. It
allows minimum requirements of the number of different types of characters that
need to be used in a password before it can be used. It also checks the
password against a dictionary.</p>
<p>By default it checks against a dictionary but that really isn&rsquo;t enough for good
password security. Further password control can be accomplished using
<code>pam_passwdqc</code>.</p>
<p>Default:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>password  requisite  pam_cracklib.so try_first_pass retry=3 type=
</span></span></code></pre></div><p>Recommended (require one of each type, minimum length 14):</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=14 dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1
</span></span></code></pre></div><p>Other (credit based):</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=22 dcredit=2 ocredit=4
</span></span></code></pre></div><p>The credit based system requires a bit of explaining, it requires a 22
character password and treats numbers as 2 characters and symbols as 4
characters. This can be dangerous as you can have an 11 digit number as a
password which isn&rsquo;t secure&hellip;</p>
<h2 id="pam_passwdqc">pam_passwdqc</h2>
<p><code>pam_passwdqc</code> replaces <code>pam_cracklib</code> in checking the quality of the password.
To use it you need to comment out <code>pam_cracklib</code> in <code>/etc/pam.d/system-auth</code>.</p>
<p>You&rsquo;ll need to add this line to the <code>/etc/pam.d/system-auth</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>password  requisite  pam_passwdqc.so retry=3 min=disabled,disabled,22,16,12 passphrase=4 similar=deny enforce=users
</span></span></code></pre></div><p>What this does is it prevent any passwords with one or two character types.
Requires a password with three character types to be a minimum of 16 characters
and one with four character types to be a minimum of 12 characters.</p>
<p>The middle option (22) is the minimum length of a passphrase (grouping of words
found in the dictionary file). The minimum number of words is controlled by the
passphrase option.</p>
<p>It denies similar passwords as previous ones and only enforces quality control
for root passwords (since they&rsquo;re sha512 hashes they only have two character
classes and would thus be denied).</p>
<p>This is untested but to the best of my knowledge passphrases still need to be
at least three character classes (since one and two are disabled).</p>
<h2 id="pam_tally2">pam_tally2</h2>
<p><code>pam_tally2</code> comes with Fedora&rsquo;s pam package so it will be installed. It&rsquo;s very
useful to prevent bruteforce attempts BUT it can also used to lock access out
to a legitimate user. It is recommended to not turn this on for the entire
system but just remote login services that use pam (for example SSH).</p>
<p>To use it you need to add the following line to the services pam file. So for
SSH the file would be <code>/etc/pam.d/sshd</code>. The following is what needs to be
added:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>auth    required     pam_tally2.so deny=5 onerr=fail audit silent
</span></span><span style="display:flex;"><span>account     required     pam_tally2.so
</span></span></code></pre></div><p>You&rsquo;ll also need to change:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>auth     sufficient     pam_unix.so nullok try_first_pass
</span></span></code></pre></div><p>To:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>auth     required     pam_unix.so nullok try_first_pass
</span></span></code></pre></div><p>And get rid of the following two lines as they will interfere with the rest of
the changes:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>auth     requisite    pam_succeed_if.so uid &gt;= 500 quiet
</span></span><span style="display:flex;"><span>auth     required     pam_deny.so
</span></span></code></pre></div><h3 id="resetting-a-users-account">Resetting a User&rsquo;s Account</h3>
<p>Information about users password tally can be found in <code>/var/log/tallylog</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[root@localhost ~]# /sbin/pam_tally2 --user username --reset
</span></span></code></pre></div><h3 id="automatic-unlocking">Automatic Unlocking</h3>
<p>Additionally adding <code>unlock_time=1800</code>. This allows the user to log back in
half an hour after the account has been locked.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>



    </body>
</html>
