<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview/etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
&amp;lt;module interface&amp;gt; &amp;lt;control flag&amp;gt; &amp;lt;module&amp;gt; &amp;lt;module arguments&amp;gt; Module InterfacesThere are only four module interfaces:"><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/pam/><title>PAM :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="PAM"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview/etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
<module interface> <control flag> <module> <module arguments> Module InterfacesThere are only four module interfaces:"><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="857"><meta name=twitter:card content="summary"><meta name=twitter:title content="PAM"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Overview/etc/pam.d/ directory contains the PAM configuration files for each PAM-aware application. Each pam aware configuration file has lines in the format of:
<module interface> <control flag> <module> <module arguments> Module InterfacesThere are only four module interfaces:"><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/pam/>PAM</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><h2 id=overview>Overview</h2><p><code>/etc/pam.d/</code> directory contains the PAM configuration files for each PAM-aware
application. Each pam aware configuration file has lines in the format of:</p><pre tabindex=0><code>&lt;module interface&gt; &lt;control flag&gt; &lt;module&gt; &lt;module arguments&gt;
</code></pre><h2 id=module-interfaces>Module Interfaces</h2><p>There are only four module interfaces:</p><ul><li>account - Verify access is allowed. Check if account has expired, time of day
checks, etc</li><li>auth - Authenticates use, verifies the validity of a password, set credentials
& group memberships & kerberos tickets</li><li>password - Used for updating credentials</li><li>session - Additional tasks performed after access has been granted, stuff like
mounting user directories and making users mailbox available.</li></ul><p>A module can provide any or all module interfaces.</p><p>Module interface directives can be 'stacked' so that multiple modules are used
together for one purpose. The order of these directives. Commented out lines
start with '#'.</p><h2 id=control-flags>Control flags</h2><ul><li>include - The module name that is provided will not load a module, but rather
include another pam configuration file at this point in the config.</li><li>optional - The module result is ignored, this is only becomes necessary for
successful authentication when no other modules reference the interface.</li><li>required - The module result must be successful for authentication to
continue. If the test fails at this point, the user is not notified until the
results of all modules tests that reference that interface are complete.</li><li>requisite - The module result must be successful for authentication to
continue. If a test fails at this point, the uesr is notified immediately with
a message reflecting the first failed required or requisite module test.</li><li>sufficient - The module result is ignored if it fails. However, if the result
of a module flagged sufficient is successful and no previous modules flagged
required have failed, then no other results are required and the request
succeeds.</li></ul><h2 id=module>Module</h2><p>Available modules can be found in <code>/lib/security</code> or <code>/lib64/security</code>
depending on the system architecture.</p><h3 id=module-arguments>Module Arguments</h3><p>These are module dependent refer to the man page of the module.</p><h3 id=confusing-lines-i-dont-understand>Confusing Lines I Don't Understand</h3><pre tabindex=0><code>account [default=bad success=ok user_unknown=ignore] pam_krb5.so
</code></pre><h2 id=pam_cracklib>pam_cracklib</h2><p><code>pam_cracklib</code> allows for quick quality control settings of passwords. It
allows minimum requirements of the number of different types of characters that
need to be used in a password before it can be used. It also checks the
password against a dictionary.</p><p>By default it checks against a dictionary but that really isn't enough for good
password security. Further password control can be accomplished using
<code>pam_passwdqc</code>.</p><p>Default:</p><pre tabindex=0><code>password  requisite  pam_cracklib.so try_first_pass retry=3 type=
</code></pre><p>Recommended (require one of each type, minimum length 14):</p><pre tabindex=0><code>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=14 dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1
</code></pre><p>Other (credit based):</p><pre tabindex=0><code>password  requisite  pam_cracklib.so try_first_pass retry=3 minlen=22 dcredit=2 ocredit=4
</code></pre><p>The credit based system requires a bit of explaining, it requires a 22
character password and treats numbers as 2 characters and symbols as 4
characters. This can be dangerous as you can have an 11 digit number as a
password which isn't secure...</p><h2 id=pam_passwdqc>pam_passwdqc</h2><p><code>pam_passwdqc</code> replaces <code>pam_cracklib</code> in checking the quality of the password.
To use it you need to comment out <code>pam_cracklib</code> in <code>/etc/pam.d/system-auth</code>.</p><p>You'll need to add this line to the <code>/etc/pam.d/system-auth</code>:</p><pre tabindex=0><code>password  requisite  pam_passwdqc.so retry=3 min=disabled,disabled,22,16,12 passphrase=4 similar=deny enforce=users
</code></pre><p>What this does is it prevent any passwords with one or two character types.
Requires a password with three character types to be a minimum of 16 characters
and one with four character types to be a minimum of 12 characters.</p><p>The middle option (22) is the minimum length of a passphrase (grouping of words
found in the dictionary file). The minimum number of words is controlled by the
passphrase option.</p><p>It denies similar passwords as previous ones and only enforces quality control
for root passwords (since they're sha512 hashes they only have two character
classes and would thus be denied).</p><p>This is untested but to the best of my knowledge passphrases still need to be
at least three character classes (since one and two are disabled).</p><h2 id=pam_tally2>pam_tally2</h2><p><code>pam_tally2</code> comes with Fedora's pam package so it will be installed. It's very
useful to prevent bruteforce attempts BUT it can also used to lock access out
to a legitimate user. It is recommended to not turn this on for the entire
system but just remote login services that use pam (for example SSH).</p><p>To use it you need to add the following line to the services pam file. So for
SSH the file would be <code>/etc/pam.d/sshd</code>. The following is what needs to be
added:</p><pre tabindex=0><code>auth    required     pam_tally2.so deny=5 onerr=fail audit silent
account     required     pam_tally2.so
</code></pre><p>You'll also need to change:</p><pre tabindex=0><code>auth     sufficient     pam_unix.so nullok try_first_pass
</code></pre><p>To:</p><pre tabindex=0><code>auth     required     pam_unix.so nullok try_first_pass
</code></pre><p>And get rid of the following two lines as they will interfere with the rest of
the changes:</p><pre tabindex=0><code>auth     requisite    pam_succeed_if.so uid &gt;= 500 quiet
auth     required     pam_deny.so
</code></pre><h3 id=resetting-a-users-account>Resetting a User's Account</h3><p>Information about users password tally can be found in <code>/var/log/tallylog</code>.</p><pre tabindex=0><code>[root@localhost ~]# /sbin/pam_tally2 --user username --reset
</code></pre><h3 id=automatic-unlocking>Automatic Unlocking</h3><p>Additionally adding <code>unlock_time=1800</code>. This allows the user to log back in
half an hour after the account has been locked.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>