<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install suricata -y ConfigurationNetwork Configuration for IPSI purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode. When connected these interfaces were reported to me as devices p1p1 and p2p1."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/notes/suricata/><title>Suricata :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Suricata"><meta itemprop=description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install suricata -y ConfigurationNetwork Configuration for IPSI purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode. When connected these interfaces were reported to me as devices p1p1 and p2p1."><meta itemprop=datePublished content="2013-01-01T00:00:01+00:00"><meta itemprop=dateModified content="2013-01-01T00:00:01+00:00"><meta itemprop=wordCount content="285"><meta name=twitter:card content="summary"><meta name=twitter:title content="Suricata"><meta name=twitter:description content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installationyum install suricata -y ConfigurationNetwork Configuration for IPSI purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode. When connected these interfaces were reported to me as devices p1p1 and p2p1."><meta property="article:published_time" content="2013-01-01 00:00:01 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/notes/suricata/>Suricata</a></h2><div class=post-content><p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p><h2 id=installation>Installation</h2><pre tabindex=0><code>yum install suricata -y
</code></pre><h2 id=configuration>Configuration</h2><h3 id=network-configuration-for-ips>Network Configuration for IPS</h3><p>I purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode.
When connected these interfaces were reported to me as devices p1p1 and p2p1. I
want the IPS to show up transparently, at no point should the IPS be
addressable on it's sniffing interfaces. The bridge interface that will handle
the filtering, sniffing etc will be br256. Here are the various configuration
files:</p><h4 id=etcsysconfignetwork-scriptsifcfg-p1p1>/etc/sysconfig/network-scripts/ifcfg-p1p1</h4><pre tabindex=0><code>DEVICE=&#34;p1p1&#34;
NM_CONTROLLED=&#34;no&#34;
HWADDR=&#34;00:0A:CD:20:86:EC&#34;
ONBOOT=&#34;yes&#34;
BOOTPROTO=&#34;none&#34;

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&#34;Transparent TAP&#34;
</code></pre><h4 id=etcsysconfignetwork-scriptsifcfg-p2p1>/etc/sysconfig/network-scripts/ifcfg-p2p1</h4><pre tabindex=0><code>DEVICE=&#34;p2p1&#34;
NM_CONTROLLED=&#34;no&#34;
HWADDR=&#34;00:0A:CD:20:86:ED&#34;
ONBOOT=&#34;yes&#34;
BOOTPROTO=&#34;none&#34;

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&#34;Transparent TAP&#34;
</code></pre><h4 id=etcsysconfignetwork-scriptsifcfg-br256>/etc/sysconfig/network-scripts/ifcfg-br256</h4><pre tabindex=0><code># br256 - No VLAN - Transparent Intercept Bridge
DEVICE=br256
NM_CONTROLLED=no
ONBOOT=yes
TYPE=Bridge

STP=off
DELAY=0

BOOTPROTO=none

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&#34;Transparent Intercept Bridge&#34;
</code></pre><h3 id=sysctl-configuration-options>Sysctl Configuration Options</h3><p>The following changes will need to be made to sysctl settings to allow
filtering of traffic across bridges:</p><pre tabindex=0><code># Ensure all traffic is forwarded where appropriate
net.ipv4.ip_forward = 1
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Enable netfilter on bridges.
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-arptables = 0
net.bridge.bridge-nf-filter-pppoe-tagged = 0
net.bridge.bridge-nf-filter-vlan-tagged = 0
net.bridge.bridge-nf-pass-vlan-input-dev = 1
</code></pre><h3 id=initial-firewall-rules>Initial Firewall Rules</h3><p>Initially we want to allow all the traffic across the bridges.</p><p>First iptables:</p><pre tabindex=0><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre><p>And then ip6tables:</p><pre tabindex=0><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre><p>After restarting the network, applying the sysctl file, connecting the card's
ports and bringing up the interfaces you can start watching traffic with
tshark:</p><pre tabindex=0><code>tshark -i br256
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=e0ae306a5897bc6892dbaa3e409f62aac8e8d735 target=_blank rel=noopener>e0ae306a</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>