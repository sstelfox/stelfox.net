<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installation yum install suricata -y Configuration Network Configuration for IPS I purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode. When connected these interfaces were reported to me as devices p1p1 and p2p1.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Suricata • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
Installation yum install suricata -y Configuration Network Configuration for IPS I purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode. When connected these interfaces were reported to me as devices p1p1 and p2p1.'>
<meta property='og:url' content='https://stelfox.net/notes/suricata/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='notes'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>Suricata • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/notes/suricata/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-notes'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Suricata</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='0001-01-01T00:00:00Z'>0001, Jan 01</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p>
<h2 id="installation">Installation</h2>
<pre><code>yum install suricata -y
</code></pre><h2 id="configuration">Configuration</h2>
<h3 id="network-configuration-for-ips">Network Configuration for IPS</h3>
<p>I purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode.
When connected these interfaces were reported to me as devices p1p1 and p2p1. I
want the IPS to show up transparently, at no point should the IPS be
addressable on it's sniffing interfaces. The bridge interface that will handle
the filtering, sniffing etc will be br256. Here are the various configuration
files:</p>
<h4 id="etcsysconfignetworkscriptsifcfgp1p1">/etc/sysconfig/network-scripts/ifcfg-p1p1</h4>
<pre><code>DEVICE=&quot;p1p1&quot;
NM_CONTROLLED=&quot;no&quot;
HWADDR=&quot;00:0A:CD:20:86:EC&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=&quot;none&quot;

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&quot;Transparent TAP&quot;
</code></pre><h4 id="etcsysconfignetworkscriptsifcfgp2p1">/etc/sysconfig/network-scripts/ifcfg-p2p1</h4>
<pre><code>DEVICE=&quot;p2p1&quot;
NM_CONTROLLED=&quot;no&quot;
HWADDR=&quot;00:0A:CD:20:86:ED&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=&quot;none&quot;

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&quot;Transparent TAP&quot;
</code></pre><h4 id="etcsysconfignetworkscriptsifcfgbr256">/etc/sysconfig/network-scripts/ifcfg-br256</h4>
<pre><code># br256 - No VLAN - Transparent Intercept Bridge
DEVICE=br256
NM_CONTROLLED=no
ONBOOT=yes
TYPE=Bridge

STP=off
DELAY=0

BOOTPROTO=none

IPV6INIT=no
IPV6_AUTOCONF=no

NAME=&quot;Transparent Intercept Bridge&quot;
</code></pre><h3 id="sysctl-configuration-options">Sysctl Configuration Options</h3>
<p>The following changes will need to be made to sysctl settings to allow
filtering of traffic across bridges:</p>
<pre><code># Ensure all traffic is forwarded where appropriate
net.ipv4.ip_forward = 1
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Enable netfilter on bridges.
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-arptables = 0
net.bridge.bridge-nf-filter-pppoe-tagged = 0
net.bridge.bridge-nf-filter-vlan-tagged = 0
net.bridge.bridge-nf-pass-vlan-input-dev = 1
</code></pre><h3 id="initial-firewall-rules">Initial Firewall Rules</h3>
<p>Initially we want to allow all the traffic across the bridges.</p>
<p>First iptables:</p>
<pre><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre><p>And then ip6tables:</p>
<pre><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre><p>After restarting the network, applying the sysctl file, connecting the card's
ports and bringing up the interfaces you can start watching traffic with
tshark:</p>
<pre><code>tshark -i br256
</code></pre>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/notes/swap/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Swap</a>
    </div><div class='next-entry sep-before'>
      <a href='/notes/sshd/'>
        <span class='screen-reader-text'>Next post: </span>SSHd<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2020 Sam Stelfox </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.c3bcf2df.js'></script>

</body>

</html>

