<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1>Suricata</h1><div class="post-content"><h2 id="installation">Installation</h2>
<pre><code>yum install suricata -y
</code></pre>
<h2 id="configuration">Configuration</h2>
<h3 id="network-configuration-for-ips">Network Configuration for IPS</h3>
<p>I purchased a dedicated two NIC PCIe card to make use of Suricata in IPS mode.
When connected these interfaces were reported to me as devices p1p1 and p2p1. I
want the IPS to show up transparently, at no point should the IPS be
addressable on it's sniffing interfaces. The bridge interface that will handle
the filtering, sniffing etc will be br256. Here are the various configuration
files:</p>
<h4 id="etc-sysconfig-network-scripts-ifcfg-p1p1">/etc/sysconfig/network-scripts/ifcfg-p1p1</h4>
<pre><code>DEVICE="p1p1"
NM_CONTROLLED="no"
HWADDR="00:0A:CD:20:86:EC"
ONBOOT="yes"
BOOTPROTO="none"

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME="Transparent TAP"
</code></pre>
<h4 id="etc-sysconfig-network-scripts-ifcfg-p2p1">/etc/sysconfig/network-scripts/ifcfg-p2p1</h4>
<pre><code>DEVICE="p2p1"
NM_CONTROLLED="no"
HWADDR="00:0A:CD:20:86:ED"
ONBOOT="yes"
BOOTPROTO="none"

BRIDGE=br256

IPV6INIT=no
IPV6_AUTOCONF=no

NAME="Transparent TAP"
</code></pre>
<h4 id="etc-sysconfig-network-scripts-ifcfg-br256">/etc/sysconfig/network-scripts/ifcfg-br256</h4>
<pre><code># br256 - No VLAN - Transparent Intercept Bridge
DEVICE=br256
NM_CONTROLLED=no
ONBOOT=yes
TYPE=Bridge

STP=off
DELAY=0

BOOTPROTO=none

IPV6INIT=no
IPV6_AUTOCONF=no

NAME="Transparent Intercept Bridge"
</code></pre>
<h3 id="sysctl-configuration-options">Sysctl Configuration Options</h3>
<p>The following changes will need to be made to sysctl settings to allow
filtering of traffic across bridges:</p>
<pre><code># Ensure all traffic is forwarded where appropriate
net.ipv4.ip_forward = 1
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1

# Enable netfilter on bridges.
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-arptables = 0
net.bridge.bridge-nf-filter-pppoe-tagged = 0
net.bridge.bridge-nf-filter-vlan-tagged = 0
net.bridge.bridge-nf-pass-vlan-input-dev = 1
</code></pre>
<h3 id="initial-firewall-rules">Initial Firewall Rules</h3>
<p>Initially we want to allow all the traffic across the bridges.</p>
<p>First iptables:</p>
<pre><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre>
<p>And then ip6tables:</p>
<pre><code># Traffic across the transparent bridge
-A FORWARD -i br256 -o br256 -j ACCEPT
</code></pre>
<p>After restarting the network, applying the sysctl file, connecting the card's
ports and bringing up the interfaces you can start watching traffic with
tshark:</p>
<pre><code>tshark -i br256
</code></pre>
</div>
</article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
