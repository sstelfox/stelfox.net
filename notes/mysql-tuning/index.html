<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sam@stelfox.net Sam Stelfox ">
<meta name="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
#!/bin/sh # MySQL performance tuning primer script # # Writen by: Matthew Montgomery # Modified by: Sam Stelfox # Report bugs to: https://bugs.launchpad.net/mysql-tuning-primer # Inspired by: MySQLARd (http://gert.sos.be/demo/mysqlar/) # Version: 1.6-r1 # Released: 2011-08-06 # Updated: 2013-05-23 # # Licenced under GPLv2." />
<meta name="keywords" content="blog, programming, linux, systems, personal" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://stelfox.net/notes/mysql-tuning/" />


    <title>
        
            MySQL Tuning :: Sam Stelfox 
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css" integrity="sha256-KgZMRVsOy9axSBs7&#43;d8kQelYOGkQIvQKUzjCyxJE8HU=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="MySQL Tuning">
<meta itemprop="description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
#!/bin/sh # MySQL performance tuning primer script # # Writen by: Matthew Montgomery # Modified by: Sam Stelfox # Report bugs to: https://bugs.launchpad.net/mysql-tuning-primer # Inspired by: MySQLARd (http://gert.sos.be/demo/mysqlar/) # Version: 1.6-r1 # Released: 2011-08-06 # Updated: 2013-05-23 # # Licenced under GPLv2.">

<meta itemprop="wordCount" content="5937">
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL Tuning"/>
<meta name="twitter:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
#!/bin/sh # MySQL performance tuning primer script # # Writen by: Matthew Montgomery # Modified by: Sam Stelfox # Report bugs to: https://bugs.launchpad.net/mysql-tuning-primer # Inspired by: MySQLARd (http://gert.sos.be/demo/mysqlar/) # Version: 1.6-r1 # Released: 2011-08-06 # Updated: 2013-05-23 # # Licenced under GPLv2."/>



    <meta property="og:title" content="MySQL Tuning" />
<meta property="og:description" content="Note: This page is quite old and is likely out of date. My opinions may have also changed dramatically since this was written. It is here as a reference until I get around to updating it.
#!/bin/sh # MySQL performance tuning primer script # # Writen by: Matthew Montgomery # Modified by: Sam Stelfox # Report bugs to: https://bugs.launchpad.net/mysql-tuning-primer # Inspired by: MySQLARd (http://gert.sos.be/demo/mysqlar/) # Version: 1.6-r1 # Released: 2011-08-06 # Updated: 2013-05-23 # # Licenced under GPLv2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stelfox.net/notes/mysql-tuning/" /><meta property="article:section" content="notes" />

















    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                ./Sam_Stelfox.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/blog/">Blog Posts</a></li><li><a href="/notes/">Various Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://stelfox.net/notes/mysql-tuning/">MySQL Tuning</a></h2>

            
            
            

            <div class="post-content">
                <p><em><strong>Note: This page is quite old and is likely out of date. My opinions may have
also changed dramatically since this was written. It is here as a reference
until I get around to updating it.</strong></em></p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#8b949e;font-weight:bold;font-style:italic">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># MySQL performance tuning primer script</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Writen by:      Matthew Montgomery</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Modified by:    Sam Stelfox</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Report bugs to: https://bugs.launchpad.net/mysql-tuning-primer</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Inspired by:    MySQLARd (http://gert.sos.be/demo/mysqlar/)</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Version:        1.6-r1</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Released:       2011-08-06</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Updated:        2013-05-23</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Licenced under GPLv2.</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Usage: ./tuning-primer.sh [mode]</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Available Modes:</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   all:         perform all checks (default)</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   prompt:      prompt for login credintials and socket and execution mode.</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   mem, memory: run checks for tunable options which effect memory usage.</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   disk, file:  run checks for options which effect i/o performance or file</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#                handle limits</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   innodb:      run InnoDB checks, to be improved</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   misc:        run checks for that don&#39;t categorise well slow queries, binary</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#                logs, used connections and worker threads.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Set this socket variable ONLY if you have multiple instances running or we</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># are unable to find your socket, and you don&#39;t want to to be prompted for</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># input each time you run this script.</span>
</span></span><span style="display:flex;"><span><span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Nice and easy names for the various colors</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">black</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[0m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldblack</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;0m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">red</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[31m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldred</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;31m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">green</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[32m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldgreen</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;32m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">yellow</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[33m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldyellow</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;33m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">blue</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[34m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldblue</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;34m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">magenta</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[35m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldmagenta</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;35m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">cyan</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[36m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldcyan</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;36m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">white</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[37m&#39;</span>
</span></span><span style="display:flex;"><span>export <span style="color:#79c0ff">boldwhite</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;\033[1;37m&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Function to easliy print colored text</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   Argument $1 = message</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   Argument $2 = color</span>
</span></span><span style="display:flex;"><span>cecho<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">default_msg</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;No message passed.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">message</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">${</span><span style="color:#79c0ff">1</span><span style="color:#ff7b72">:-</span><span style="color:#79c0ff">$default_msg</span><span style="color:#a5d6ff">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic"># Change it for fun, we use pure names. Defaults to black, if not specified.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">color</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">${</span><span style="color:#79c0ff">2</span><span style="color:#ff7b72">:-</span><span style="color:#79c0ff">black</span><span style="color:#a5d6ff">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$color</span> in
</span></span><span style="display:flex;"><span>    black<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$black</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldblack<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldblack</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    red<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$red</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldred<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldred</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    green<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$green</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldgreen<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldgreen</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    yellow<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$yellow</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldyellow<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldyellow</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    blue<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$blue</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldblue<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldblue</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    magenta<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$magenta</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldmagenta<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldmagenta</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    cyan<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$cyan</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldcyan<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldcyan</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    white<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$white</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldwhite<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldwhite</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#a5d6ff">&#34;%s&#34;</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$message</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  tput sgr0 <span style="color:#8b949e;font-style:italic"># Reset all the colors back to normal.</span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$black</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Function to easliy print colored text without a newline</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   Argument $1 = message</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#   Argument $2 = color</span>
</span></span><span style="display:flex;"><span>cechon<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">default_msg</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;No message passed.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">message</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">${</span><span style="color:#79c0ff">1</span><span style="color:#ff7b72">:-</span><span style="color:#79c0ff">$default_msg</span><span style="color:#a5d6ff">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">color</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">${</span><span style="color:#79c0ff">2</span><span style="color:#ff7b72">:-</span><span style="color:#79c0ff">black</span><span style="color:#a5d6ff">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$color</span> in
</span></span><span style="display:flex;"><span>    black<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$black</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldblack<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldblack</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    red<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$red</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldred<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldred</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    green<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$green</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldgreen<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldgreen</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    yellow<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$yellow</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldyellow<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldyellow</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    blue<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$blue</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldblue<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldblue</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    magenta<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$magenta</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldmagenta<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldmagenta</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    cyan<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$cyan</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldcyan<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldcyan</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    white<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$white</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>    boldwhite<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$boldwhite</span><span style="color:#a5d6ff">&#34;</span>;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#a5d6ff">&#34;%s&#34;</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$message</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  tput sgr0 <span style="color:#8b949e;font-style:italic"># Reset all the colors back to normal.</span>
</span></span><span style="display:flex;"><span>  printf <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$black</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Banner</span>
</span></span><span style="display:flex;"><span>print_banner<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34; -- MYSQL PERFORMANCE TUNING PRIMER --&#34;</span> boldblue
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;      - By: Matthew Montgomery -&#34;</span> black
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;   - Modifications By: Sam Stelfox -&#34;</span> black
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Find the location of the mysql.sock file</span>
</span></span><span style="display:flex;"><span>check_for_socket<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># Use ~/my.cnf version</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -f ~/.my.cnf <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">cnf_socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>grep ^socket ~/.my.cnf | awk -F <span style="color:#79c0ff">\=</span> <span style="color:#a5d6ff">&#39;{ print $2 }&#39;</span> | head -1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$cnf_socket</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$cnf_socket</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S /var/lib/mysql/mysql.sock <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S /var/run/mysqld/mysqld.sock <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span>/var/run/mysqld/mysqld.sock
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S /tmp/mysql.sock <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span>/tmp/mysql.sock
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$ps_socket</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$ps_socket</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -S <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    echo UP &gt; /dev/null
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#39;No valid socket file &#34;$socket&#34; found!&#39;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#39;The mysqld process is not running or it is installed in a custom location.&#39;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#39;If you are sure mysqld is running, execute script in &#34;prompt&#34; mode or set&#39;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#39;the socket= variable at the top of this script&#39;</span> red
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Check for the existance of plesk and login using it&#39;s credentials</span>
</span></span><span style="display:flex;"><span>check_for_plesk_passwords<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -f /etc/psa/.psa.shadow <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysql -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u admin -p</span><span style="color:#ff7b72">$(</span>cat /etc/psa/.psa.shadow<span style="color:#ff7b72">)</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysqladmin -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u admin -p</span><span style="color:#ff7b72">$(</span>cat /etc/psa/.psa.shadow<span style="color:#ff7b72">)</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysql&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysqladmin&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Test for running mysql</span>
</span></span><span style="display:flex;"><span>check_mysql_login<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">is_up</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysqladmin</span> ping 2&gt;&amp;1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$is_up</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;mysqld is alive&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    echo UP &gt; /dev/null
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$is_up</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;mysqld is alive&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#a5d6ff">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Using login values from ~/.my.cnf&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;- INITIAL LOGIN ATTEMPT FAILED -&#34;</span> boldred
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$prompted</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      find_webmin_passwords
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Unknow exit status&#34;</span> red
</span></span><span style="display:flex;"><span>    exit -1
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>final_login_attempt<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">is_up</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysqladmin</span> ping 2&gt;&amp;1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$is_up</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;mysqld is alive&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    echo UP &gt; /dev/null
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$is_up</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;mysqld is alive&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;- FINAL LOGIN ATTEMPT FAILED -&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Unable to log into socket: </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> boldred
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Create a ~/.my.cnf and exit when all else fails</span>
</span></span><span style="display:flex;"><span>second_login_failed<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Could not auto detect login info!&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Found potential sockets: </span><span style="color:#79c0ff">$found_socks</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Using: </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> red
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Would you like to provide a different socket?: [y/N] &#34;</span> REPLY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$REPLY</span> in
</span></span><span style="display:flex;"><span>    yes|y|Y|YES<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      read -p <span style="color:#a5d6ff">&#34;Socket: &#34;</span> socket ;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Do you have your login handy?: [y/N] &#34;</span> REPLY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$REPLY</span> in
</span></span><span style="display:flex;"><span>    yes|y|Y|YES<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">answer1</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;yes&#39;</span>
</span></span><span style="display:flex;"><span>      read -p <span style="color:#a5d6ff">&#34;User: &#34;</span> user
</span></span><span style="display:flex;"><span>      read -rp <span style="color:#a5d6ff">&#34;Password: &#34;</span> pass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$pass</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        export <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql</span><span style="color:#a5d6ff"> -S</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>        export <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysqladmin</span><span style="color:#a5d6ff"> -S</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>        export <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql</span><span style="color:#a5d6ff"> -S</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff"> -p</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>        export <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysqladmin</span><span style="color:#a5d6ff"> -S</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff"> -p</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    *<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Please create a valid login to MySQL&#34;</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Or, set correct values for  &#39;user=&#39; and &#39;password=&#39; in ~/.my.cnf&#34;</span>
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Would you like me to create a ~/.my.cnf file for you?: [y/N] &#34;</span> REPLY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$REPLY</span> in
</span></span><span style="display:flex;"><span>    yes|y|Y|YES<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">answer2</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;yes&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! -f ~/.my.cnf <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        umask <span style="color:#a5d6ff">077</span>
</span></span><span style="display:flex;"><span>        printf <span style="color:#a5d6ff">&#34;[client]\nuser=</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">\npassword=</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">\nsocket=</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> &gt; ~/.my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$answer1</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;yes&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>          exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>          final_login_attempt
</span></span><span style="display:flex;"><span>          <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>        printf <span style="color:#a5d6ff">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;~/.my.cnf already exists!&#34;</span> boldred
</span></span><span style="display:flex;"><span>        printf <span style="color:#a5d6ff">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>        read -p <span style="color:#a5d6ff">&#34;Replace?: [y/N] &#34;</span> REPLY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$REPLY</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;y&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$REPLY</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;Y&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>          printf <span style="color:#a5d6ff">&#34;[client]\nuser=</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">\npassword=</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">\socket=</span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff">&#34;</span> &gt; ~/.my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$answer1</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;yes&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>            exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>            final_login_attempt
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>          cecho <span style="color:#a5d6ff">&#34;Please set the &#39;user=&#39; and &#39;password=&#39; and &#39;socket=&#39; values in ~/.my.cnf&#34;</span>
</span></span><span style="display:flex;"><span>          exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    *<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$answer1</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;yes&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>        final_login_attempt
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Populate the .my.cnf file using values harvested from Webmin</span>
</span></span><span style="display:flex;"><span>find_webmin_passwords<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Testing for stored webmin passwords:&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -f /etc/webmin/mysql/config <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">user</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>grep ^login<span style="color:#ff7b72;font-weight:bold">=</span> /etc/webmin/mysql/config | cut -d <span style="color:#a5d6ff">&#34;=&#34;</span> -f 2<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">pass</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>grep ^pass<span style="color:#ff7b72;font-weight:bold">=</span> /etc/webmin/mysql/config | cut -d <span style="color:#a5d6ff">&#34;=&#34;</span> -f 2<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span>  <span style="color:#79c0ff">$user</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$pass</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! -f ~/.my.cnf  <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Setting login info as User: </span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff"> Password: </span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>      touch ~/.my.cnf
</span></span><span style="display:flex;"><span>      chmod <span style="color:#a5d6ff">600</span> ~/.my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;[client]\nuser=</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">\npassword=</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span> &gt; ~/.my.cnf 
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Retrying login&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">is_up</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysqladmin</span> ping 2&gt;&amp;1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$is_up</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;mysqld is alive&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        echo UP &gt; /dev/null
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>        second_login_failed
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      echo
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      second_login_failed
</span></span><span style="display:flex;"><span>      echo
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; None Found&#34;</span> boldred
</span></span><span style="display:flex;"><span>    second_login_failed
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Function to pull MySQL status variable</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Ex:</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#     mysql_status &#39;Mysql_status_variable&#39; bash_dest_variable</span>
</span></span><span style="display:flex;"><span>mysql_status<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">status</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;show /*!50000 global */ status like </span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> | awk <span style="color:#a5d6ff">&#39;{ print $2 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$status</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Function to pull MySQL server runtime variable</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Ex:</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#     mysql_variable &#39;Mysql_server_variable&#39; bash_dest_variable</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#     mysql_variableTSV &#39;Mysql_server_variable&#39; bash_dest_variable</span>
</span></span><span style="display:flex;"><span>mysql_variable<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">variable</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;show /*!50000 global */ variables like </span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> | awk <span style="color:#a5d6ff">&#39;{ print $2 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$variable</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql_variableTSV<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">variable</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;show /*!50000 global */ variables like </span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> | awk -F <span style="color:#79c0ff">\t</span> <span style="color:#a5d6ff">&#39;{ print $2 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$variable</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>float2int<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  local <span style="color:#79c0ff">variable</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff"> / 1&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$variable</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Divide two integers</span>
</span></span><span style="display:flex;"><span>divide<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">usage</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$0</span><span style="color:#a5d6ff"> dividend divisor &#39;</span><span style="color:#79c0ff">$variable</span><span style="color:#a5d6ff">&#39; scale&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$1</span> -ge <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">dividend</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Invalid Dividend&#34;</span> red
</span></span><span style="display:flex;"><span>    echo <span style="color:#79c0ff">$usage</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$2</span> -ge <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">divisor</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Invalid Divisor&#34;</span> red
</span></span><span style="display:flex;"><span>    echo <span style="color:#79c0ff">$usage</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! -n <span style="color:#79c0ff">$3</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Invalid variable name&#34;</span> red
</span></span><span style="display:flex;"><span>    echo <span style="color:#79c0ff">$usage</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$4</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$4</span> -ge <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Invalid scale&#34;</span> red
</span></span><span style="display:flex;"><span>    echo <span style="color:#79c0ff">$usage</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">$3</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=</span><span style="color:#79c0ff">$scale</span><span style="color:#a5d6ff">; </span><span style="color:#79c0ff">$dividend</span><span style="color:#a5d6ff"> / </span><span style="color:#79c0ff">$divisor</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Convert a value in to human readable size and populate a variable with the</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># result.</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># value=$1</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># variable=$2</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Ex:</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">#     human_readable $value &#39;variable name&#39; [places of precision]</span>
</span></span><span style="display:flex;"><span>human_readable<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$1</span> -ge <span style="color:#a5d6ff">1073741824</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$3</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    divide <span style="color:#79c0ff">$1</span> <span style="color:#a5d6ff">1073741824</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$scale</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">unit</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;G&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$1</span> -ge <span style="color:#a5d6ff">1048576</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$3</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    divide <span style="color:#79c0ff">$1</span> <span style="color:#a5d6ff">1048576</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$scale</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">unit</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;M&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$1</span> -ge <span style="color:#a5d6ff">1024</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$3</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">scale</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    divide <span style="color:#79c0ff">$1</span> <span style="color:#a5d6ff">1024</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$scale</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">unit</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;K&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$2</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">unit</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;bytes&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Function to produce human readable time</span>
</span></span><span style="display:flex;"><span>human_readable_time<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">usage</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$0</span><span style="color:#a5d6ff"> seconds &#39;variable&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$1</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$2</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#79c0ff">$usage</span> red
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">days</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff"> / 86400&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">remainder</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff"> % 86400&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">hours</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$remainder</span><span style="color:#a5d6ff"> / 3600&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">remainder</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$remainder</span><span style="color:#a5d6ff"> % 3600&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">minutes</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$remainder</span><span style="color:#a5d6ff"> / 60&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">seconds</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0 ; </span><span style="color:#79c0ff">$remainder</span><span style="color:#a5d6ff"> % 60&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">$2</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$days</span><span style="color:#a5d6ff"> days </span><span style="color:#79c0ff">$hours</span><span style="color:#a5d6ff"> hrs </span><span style="color:#79c0ff">$minutes</span><span style="color:#a5d6ff"> min </span><span style="color:#79c0ff">$seconds</span><span style="color:#a5d6ff"> sec&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Print version info</span>
</span></span><span style="display:flex;"><span>check_mysql_version<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>version<span style="color:#79c0ff">\&#39;</span> mysql_version
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>version_compile_machine<span style="color:#79c0ff">\&#39;</span> mysql_version_compile_machine
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050000</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;MySQL Version </span><span style="color:#79c0ff">$mysql_version</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$mysql_version_compile_machine</span><span style="color:#a5d6ff"> is EOL please upgrade to MySQL 4.1 or later&#34;</span> boldred
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;MySQL Version </span><span style="color:#79c0ff">$mysql_version</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$mysql_version_compile_machine</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Present a reminder that mysql must run for a couple of days to build up good</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># numbers in server status variables before these tuning suggestions should be</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># used.</span>
</span></span><span style="display:flex;"><span>post_uptime_warning<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Uptime<span style="color:#79c0ff">\&#39;</span> uptime
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Threads_connected<span style="color:#79c0ff">\&#39;</span> threads
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">queries_per_sec</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$questions</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$uptime</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  human_readable_time <span style="color:#79c0ff">$uptime</span> uptimeHR
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Uptime = </span><span style="color:#79c0ff">$uptimeHR</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Avg. qps = </span><span style="color:#79c0ff">$queries_per_sec</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Total Questions = </span><span style="color:#79c0ff">$questions</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Threads Connected = </span><span style="color:#79c0ff">$threads</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  echo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$uptime</span> -gt <span style="color:#a5d6ff">172800</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Server has been running for over 48hrs.&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;It should be safe to follow these recommendations&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;Warning: &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Server has not been running for at least 48hrs.&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;It may not be safe to use these recommendations&#34;</span> boldred
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#a5d6ff">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;To find out more information on how each of these&#34;</span> red
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;runtime variables effects performance visit:&#34;</span> red
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;3.23&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;4.0&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;4.1&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;http://dev.mysql.com/doc/refman/4.1/en/server-system-variables.html&#34;</span> boldblue
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;5.0&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -gt <span style="color:#a5d6ff">&#39;050100&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;http://dev.mysql.com/doc/refman/</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">/en/server-system-variables.html&#34;</span> boldblue
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;UNSUPPORTED MYSQL VERSION&#34;</span> boldred
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Visit http://www.mysql.com/products/enterprise/advisors.html&#34;</span> boldblue
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;for info about MySQL&#39;s Enterprise Monitoring and Advisory Service&#34;</span> boldblue
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Slow Queries</span>
</span></span><span style="display:flex;"><span>check_slow_queries <span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;SLOW QUERIES&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Slow_queries<span style="color:#79c0ff">\&#39;</span> slow_queries
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>long_query_time<span style="color:#79c0ff">\&#39;</span> long_query_time
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>log%queries<span style="color:#79c0ff">\&#39;</span> log_slow_queries
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">prefered_query_time</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -e /etc/my.cnf <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$log_slow_queries</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">log_slow_queries</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>grep log-slow-queries /etc/my.cnf<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$log_slow_queries</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;ON&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;The slow query log is enabled.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$log_slow_queries</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;OFF&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;The slow query log is &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;NOT&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; enabled.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$log_slow_queries</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;The slow query log is &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;NOT&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; enabled.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Error: </span><span style="color:#79c0ff">$log_slow_queries</span><span style="color:#a5d6ff">&#34;</span> boldred
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current long_query_time = </span><span style="color:#79c0ff">$long_query_time</span><span style="color:#a5d6ff"> sec.&#34;</span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;You have &#34;</span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$slow_queries</span><span style="color:#a5d6ff">&#34;</span> boldred 
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34; out of &#34;</span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$questions</span><span style="color:#a5d6ff">&#34;</span> boldred
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34; that take longer than </span><span style="color:#79c0ff">$long_query_time</span><span style="color:#a5d6ff"> sec. to complete&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  float2int long_query_time long_query_timeInt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$long_query_timeInt</span> -gt <span style="color:#79c0ff">$prefered_query_time</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your long_query_time may be too high, I typically set this under </span><span style="color:#79c0ff">$prefered_query_time</span><span style="color:#a5d6ff"> sec.&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your long_query_time seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Binary Log</span>
</span></span><span style="display:flex;"><span>check_binary_log<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;BINARY UPDATE LOG&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>log_bin<span style="color:#79c0ff">\&#39;</span> log_bin
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>max_binlog_size<span style="color:#79c0ff">\&#39;</span> max_binlog_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>expire_logs_days<span style="color:#79c0ff">\&#39;</span> expire_logs_days
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>sync_binlog<span style="color:#79c0ff">\&#39;</span> sync_binlog
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic">#mysql_variable \&#39;max_binlog_cache_size\&#39; max_binlog_cache_size</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$log_bin</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;ON&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;The binary update log is enabled&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$max_binlog_size</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;The max_binlog_size is not set. The binary log will rotate when it reaches 1GB.&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$expire_logs_days</span><span style="color:#a5d6ff">&#34;</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;The expire_logs_days is not set.&#34;</span> boldred
</span></span><span style="display:flex;"><span>      cechon <span style="color:#a5d6ff">&#34;The mysqld will retain the entire binary log until &#34;</span> red
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;RESET MASTER or PURGE MASTER LOGS commands are run manually&#34;</span> red
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Setting expire_logs_days will allow you to remove old binary logs automatically&#34;</span>  yellow
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;See http://dev.mysql.com/doc/refman/</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">/en/purge-master-logs.html&#34;</span> yellow
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$sync_binlog</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Binlog sync is not enabled, you could loose binlog records during a server crash&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;The binary update log is &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;NOT &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;enabled.&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You will not be able to do point in time recovery&#34;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;See http://dev.mysql.com/doc/refman/</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">/en/point-in-time-recovery.html&#34;</span> yellow
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Used Connections</span>
</span></span><span style="display:flex;"><span>check_used_connections<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>max_connections<span style="color:#79c0ff">\&#39;</span> max_connections
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Max_used_connections<span style="color:#79c0ff">\&#39;</span> max_used_connections
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Threads_connected<span style="color:#79c0ff">\&#39;</span> threads_connected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">connections_ratio</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$max_used_connections</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$max_connections</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;MAX CONNECTIONS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current max_connections = </span><span style="color:#79c0ff">$max_connections</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current threads_connected = </span><span style="color:#79c0ff">$threads_connected</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Historic max_used_connections = </span><span style="color:#79c0ff">$max_used_connections</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;The number of used connections is &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$connections_ratio</span> -ge <span style="color:#a5d6ff">85</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">txt_color</span><span style="color:#ff7b72;font-weight:bold">=</span>red
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$connections_ratio</span> -le <span style="color:#a5d6ff">10</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">txt_color</span><span style="color:#ff7b72;font-weight:bold">=</span>red
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">txt_color</span><span style="color:#ff7b72;font-weight:bold">=</span>green
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$connections_ratio</span><span style="color:#a5d6ff">% &#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;of the configured maximum.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$error</span> -eq <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should raise max_connections&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$error</span> -eq <span style="color:#a5d6ff">2</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You are using less than 10% of your configured max_connections.&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Lowering max_connections could help to avoid an over-allocation of memory&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;See \&#34;MEMORY USAGE\&#34; section to make sure you are not over-allocating&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your max_connections variable seems to be fine.&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  unset txt_color
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Worker Threads</span>
</span></span><span style="display:flex;"><span>check_threads<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;WORKER THREADS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Threads_created<span style="color:#79c0ff">\&#39;</span> threads_created1
</span></span><span style="display:flex;"><span>  sleep <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Threads_created<span style="color:#79c0ff">\&#39;</span> threads_created2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Threads_cached<span style="color:#79c0ff">\&#39;</span> threads_cached
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Uptime<span style="color:#79c0ff">\&#39;</span> uptime
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>thread_cache_size<span style="color:#79c0ff">\&#39;</span> thread_cache_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">historic_threads_per_sec</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$threads_created1</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$uptime</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">current_threads_per_sec</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$threads_created2</span><span style="color:#ff7b72;font-weight:bold">-</span><span style="color:#79c0ff">$threads_created1</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current thread_cache_size = </span><span style="color:#79c0ff">$thread_cache_size</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current threads_cached = </span><span style="color:#79c0ff">$threads_cached</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current threads_per_sec = </span><span style="color:#79c0ff">$current_threads_per_sec</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Historic threads_per_sec = </span><span style="color:#79c0ff">$historic_threads_per_sec</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$historic_threads_per_sec</span> -ge <span style="color:#a5d6ff">2</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$threads_cached</span> -le <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Threads created per/sec are overrunning threads cached&#34;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should raise thread_cache_size&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$current_threads_per_sec</span> -ge <span style="color:#a5d6ff">2</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Threads created per/sec are overrunning threads cached&#34;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should raise thread_cache_size&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your thread_cache_size is fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Key buffer Size</span>
</span></span><span style="display:flex;"><span>check_key_buffer_size<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;KEY BUFFER&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Key_read_requests<span style="color:#79c0ff">\&#39;</span> key_read_requests
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Key_reads<span style="color:#79c0ff">\&#39;</span> key_reads
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Key_blocks_used<span style="color:#79c0ff">\&#39;</span> key_blocks_used
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Key_blocks_unused<span style="color:#79c0ff">\&#39;</span> key_blocks_unused
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>key_cache_block_size<span style="color:#79c0ff">\&#39;</span> key_cache_block_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>key_buffer_size<span style="color:#79c0ff">\&#39;</span> key_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>datadir<span style="color:#79c0ff">\&#39;</span> datadir
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>version_compile_machine<span style="color:#79c0ff">\&#39;</span> mysql_version_compile_machine
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">myisam_indexes</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;/*!50000 SELECT IFNULL(SUM(INDEX_LENGTH),0) from information_schema.TABLES where ENGINE=&#39;MyISAM&#39; */&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$myisam_indexes</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">myisam_indexes</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>find <span style="color:#79c0ff">$datadir</span> -name <span style="color:#a5d6ff">&#39;*.MYI&#39;</span> -exec du <span style="color:#79c0ff">$duflags</span> <span style="color:#a5d6ff">&#39;{}&#39;</span> <span style="color:#79c0ff">\;</span> 2&gt;&amp;<span style="color:#a5d6ff">1</span> | awk <span style="color:#a5d6ff">&#39;{ s += $1 } END { printf(&#34;%.0f\n&#34;, s )}&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_reads</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;No key reads?!&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Seriously look into using some indexes&#34;</span> red
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">key_cache_miss_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">key_buffer_free</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$key_blocks_unused</span><span style="color:#a5d6ff"> * </span><span style="color:#79c0ff">$key_cache_block_size</span><span style="color:#a5d6ff"> / </span><span style="color:#79c0ff">$key_buffer_size</span><span style="color:#a5d6ff"> * 100&#34;</span> | bc -l <span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">key_buffer_freeRND</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0; </span><span style="color:#79c0ff">$key_buffer_free</span><span style="color:#a5d6ff"> / 1&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">key_cache_miss_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$key_read_requests</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$key_reads</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! -z <span style="color:#79c0ff">$key_blocks_unused</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">key_buffer_free</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$key_blocks_unused</span><span style="color:#a5d6ff"> * </span><span style="color:#79c0ff">$key_cache_block_size</span><span style="color:#a5d6ff"> / </span><span style="color:#79c0ff">$key_buffer_size</span><span style="color:#a5d6ff"> * 100&#34;</span> | bc -l <span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">key_buffer_freeRND</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0; </span><span style="color:#79c0ff">$key_buffer_free</span><span style="color:#a5d6ff"> / 1&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">key_buffer_free</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;Unknown&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">key_buffer_freeRND</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">75</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$myisam_indexes</span> myisam_indexesHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current MyISAM index space = </span><span style="color:#79c0ff">$myisam_indexesHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable  <span style="color:#79c0ff">$key_buffer_size</span> key_buffer_sizeHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current key_buffer_size = </span><span style="color:#79c0ff">$key_buffer_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Key cache miss rate is 1 : </span><span style="color:#79c0ff">$key_cache_miss_rate</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Key buffer free ratio = </span><span style="color:#79c0ff">$key_buffer_freeRND</span><span style="color:#a5d6ff"> %&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;5.1&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$mysql_version_num</span> -lt <span style="color:#a5d6ff">050123</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_size</span> -ge <span style="color:#a5d6ff">4294967296</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">(</span> echo <span style="color:#a5d6ff">&#34;x86_64 ppc64 ia64 sparc64 i686&#34;</span> | grep -q <span style="color:#79c0ff">$mysql_version_compile_machine</span> <span style="color:#ff7b72;font-weight:bold">)</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Using key_buffer_size &gt; 4GB will cause instability in versions prior to 5.1.23 &#34;</span> boldred
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;See Bug#5731, Bug#29419, Bug#29446&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;5.0&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$mysql_version_num</span> -lt <span style="color:#a5d6ff">050052</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_size</span> -ge <span style="color:#a5d6ff">4294967296</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">(</span> echo <span style="color:#a5d6ff">&#34;x86_64 ppc64 ia64 sparc64 i686&#34;</span> | grep -q <span style="color:#79c0ff">$mysql_version_compile_machine</span> <span style="color:#ff7b72;font-weight:bold">)</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Using key_buffer_size &gt; 4GB will cause instability in versions prior to 5.0.52 &#34;</span> boldred
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;See Bug#5731, Bug#29419, Bug#29446&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;4.1&#39;</span> -o <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;4.0&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_size</span> -ge <span style="color:#a5d6ff">4294967296</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">(</span> echo <span style="color:#a5d6ff">&#34;x86_64 ppc64 ia64 sparc64 i686&#34;</span> | grep -q <span style="color:#79c0ff">$mysql_version_compile_machine</span> <span style="color:#ff7b72;font-weight:bold">)</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Using key_buffer_size &gt; 4GB will cause instability in versions prior to 5.0.52 &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Reduce key_buffer_size to a safe value&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;See Bug#5731, Bug#29419, Bug#29446&#34;</span> boldred
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_cache_miss_rate</span> -le <span style="color:#a5d6ff">100</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_cache_miss_rate</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_freeRND</span> -le <span style="color:#a5d6ff">20</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You could increase key_buffer_size&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;It is safe to raise this up to 1/4 of total system memory;&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;assuming this is a dedicated database server.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_freeRND</span> -le <span style="color:#a5d6ff">20</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_size</span> -le <span style="color:#79c0ff">$myisam_indexes</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You could increase key_buffer_size&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;It is safe to raise this up to 1/4 of total system memory;&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;assuming this is a dedicated database server.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_cache_miss_rate</span> -ge <span style="color:#a5d6ff">10000</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$key_buffer_freeRND</span> -le <span style="color:#a5d6ff">50</span>  <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your key_buffer_size seems to be too high.&#34;</span> red 
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Perhaps you can use these resources elsewhere&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your key_buffer_size seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Query Cache</span>
</span></span><span style="display:flex;"><span>check_query_cache<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;QUERY CACHE&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>version<span style="color:#79c0ff">\&#39;</span> mysql_version
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>query_cache_size<span style="color:#79c0ff">\&#39;</span> query_cache_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>query_cache_limit<span style="color:#79c0ff">\&#39;</span> query_cache_limit
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>query_cache_min_res_unit<span style="color:#79c0ff">\&#39;</span> query_cache_min_res_unit
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Qcache_free_memory<span style="color:#79c0ff">\&#39;</span> qcache_free_memory
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Qcache_total_blocks<span style="color:#79c0ff">\&#39;</span> qcache_total_blocks
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Qcache_free_blocks<span style="color:#79c0ff">\&#39;</span> qcache_free_blocks
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Qcache_lowmem_prunes<span style="color:#79c0ff">\&#39;</span> qcache_lowmem_prunes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$query_cache_size</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You are using MySQL </span><span style="color:#79c0ff">$mysql_version</span><span style="color:#a5d6ff">, no query cache is supported.&#34;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;I recommend an upgrade to MySQL 4.1 or better&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$query_cache_size</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Query cache is supported but not enabled&#34;</span> red
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Perhaps you should set the query_cache_size&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">qcache_used_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$query_cache_size</span><span style="color:#ff7b72;font-weight:bold">-</span><span style="color:#79c0ff">$qcache_free_memory</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">qcache_mem_fill_ratio</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=2; </span><span style="color:#79c0ff">$qcache_used_memory</span><span style="color:#a5d6ff"> * 100 / </span><span style="color:#79c0ff">$query_cache_size</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">qcache_mem_fill_ratioHR</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0; </span><span style="color:#79c0ff">$qcache_mem_fill_ratio</span><span style="color:#a5d6ff"> / 1&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Query cache is enabled&#34;</span> green
</span></span><span style="display:flex;"><span>    human_readable <span style="color:#79c0ff">$query_cache_size</span> query_cache_sizeHR
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current query_cache_size = </span><span style="color:#79c0ff">$query_cache_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    human_readable <span style="color:#79c0ff">$qcache_used_memory</span> qcache_used_memoryHR
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current query_cache_used = </span><span style="color:#79c0ff">$qcache_used_memoryHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    human_readable <span style="color:#79c0ff">$query_cache_limit</span> query_cache_limitHR
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current query_cache_limit = </span><span style="color:#79c0ff">$query_cache_limitHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current Query cache Memory fill ratio = </span><span style="color:#79c0ff">$qcache_mem_fill_ratio</span><span style="color:#a5d6ff"> %&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$query_cache_min_res_unit</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;No query_cache_min_res_unit is defined.  Using MySQL &lt; 4.1 cache fragmentation can be inpredictable&#34;</span> %yellow
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      human_readable <span style="color:#79c0ff">$query_cache_min_res_unit</span> query_cache_min_res_unitHR 
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Current query_cache_min_res_unit = </span><span style="color:#79c0ff">$query_cache_min_res_unitHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_free_blocks</span> -gt <span style="color:#a5d6ff">2</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_total_blocks</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">qcache_percent_fragmented</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=2; </span><span style="color:#79c0ff">$qcache_free_blocks</span><span style="color:#a5d6ff"> * 100 / </span><span style="color:#79c0ff">$qcache_total_blocks</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">qcache_percent_fragmentedHR</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0; </span><span style="color:#79c0ff">$qcache_percent_fragmented</span><span style="color:#a5d6ff"> / 1&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_percent_fragmentedHR</span> -gt <span style="color:#a5d6ff">20</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;Query Cache is </span><span style="color:#79c0ff">$qcache_percent_fragmentedHR</span><span style="color:#a5d6ff"> % fragmented&#34;</span> red
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;Run \&#34;FLUSH QUERY CACHE\&#34; periodically to defragment the query cache memory&#34;</span> red 
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;If you have many small queries lower &#39;query_cache_min_res_unit&#39; to reduce fragmentation.&#34;</span> red
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_mem_fill_ratioHR</span> -le <span style="color:#a5d6ff">25</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Your query_cache_size seems to be too high.&#34;</span> red
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Perhaps you can use these resources elsewhere&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_lowmem_prunes</span> -ge <span style="color:#a5d6ff">50</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$qcache_mem_fill_ratioHR</span> -ge <span style="color:#a5d6ff">80</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cechon <span style="color:#a5d6ff">&#34;However, &#34;</span>
</span></span><span style="display:flex;"><span>      cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$qcache_lowmem_prunes</span><span style="color:#a5d6ff"> &#34;</span> boldred
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;queries have been removed from the query cache due to lack of memory&#34;</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Perhaps you should raise query_cache_size&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;MySQL won&#39;t cache query results that are larger than query_cache_limit in size&#34;</span> yellow
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Sort Operations</span>
</span></span><span style="display:flex;"><span>check_sort_operations<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;SORT OPERATIONS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Sort_merge_passes<span style="color:#79c0ff">\&#39;</span> sort_merge_passes
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Sort_scan<span style="color:#79c0ff">\&#39;</span> sort_scan
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Sort_range<span style="color:#79c0ff">\&#39;</span> sort_range
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>sort_buffer%<span style="color:#79c0ff">\&#39;</span> sort_buffer_size 
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>read_rnd_buffer_size<span style="color:#79c0ff">\&#39;</span> read_rnd_buffer_size 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">total_sorts</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$sort_scan</span><span style="color:#ff7b72;font-weight:bold">+</span><span style="color:#79c0ff">$sort_range</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$read_rnd_buffer_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>record_buffer<span style="color:#79c0ff">\&#39;</span> read_rnd_buffer_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic">## Correct for rounding error in mysqld where 512K != 524288 ##</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">sort_buffer_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$sort_buffer_size</span><span style="color:#ff7b72;font-weight:bold">+</span><span style="color:#a5d6ff">8</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">read_rnd_buffer_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$read_rnd_buffer_size</span><span style="color:#ff7b72;font-weight:bold">+</span><span style="color:#a5d6ff">8</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$sort_buffer_size</span> sort_buffer_sizeHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current sort_buffer_size = </span><span style="color:#79c0ff">$sort_buffer_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$read_rnd_buffer_size</span> read_rnd_buffer_sizeHR
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;Current &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;3.23&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;record_rnd_buffer &#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;read_rnd_buffer_size &#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;= </span><span style="color:#79c0ff">$read_rnd_buffer_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$total_sorts</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;No sort operations have been performed&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">passes_per_sort</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$sort_merge_passes</span> -ne <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">passes_per_sort</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$sort_merge_passes</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$total_sorts</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">passes_per_sort</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$passes_per_sort</span> -ge <span style="color:#a5d6ff">2</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;On average &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$passes_per_sort</span><span style="color:#a5d6ff"> &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;sort merge passes are made per sort operation&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should raise your sort_buffer_size&#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;You should also raise your &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;3.23&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;record_rnd_buffer_size&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;read_rnd_buffer_size&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Sort buffer seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Joins</span>
</span></span><span style="display:flex;"><span>check_join_operations<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;JOINS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Select_full_join<span style="color:#79c0ff">\&#39;</span> select_full_join
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Select_range_check<span style="color:#79c0ff">\&#39;</span> select_range_check
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>join_buffer%<span style="color:#79c0ff">\&#39;</span> join_buffer_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic"># Some 4K is dropped from join_buffer_size adding it back to make sane</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic"># handling of human-readable conversion</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">join_buffer_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$join_buffer_size</span><span style="color:#ff7b72;font-weight:bold">+</span><span style="color:#a5d6ff">4096</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$join_buffer_size</span> join_buffer_sizeHR <span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current join_buffer_size = </span><span style="color:#79c0ff">$join_buffer_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;You have had </span><span style="color:#79c0ff">$select_full_join</span><span style="color:#a5d6ff"> queries where a join could not use an index properly&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$select_range_check</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$select_full_join</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your joins seem to be using indexes properly&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$select_full_join</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">print_error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">raise_buffer</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$select_range_check</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You have had </span><span style="color:#79c0ff">$select_range_check</span><span style="color:#a5d6ff"> joins without keys that check for key usage after each row&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">print_error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">raise_buffer</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$join_buffer_size</span> -ge <span style="color:#a5d6ff">4194304</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;join_buffer_size &gt;= 4 M&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;This is not advised&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">raise_buffer</span><span style="color:#ff7b72;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$print_error</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;3.23&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;4.0&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You should enable \&#34;log-long-format\&#34; &#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -gt <span style="color:#a5d6ff">040100</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You should enable \&#34;log-queries-not-using-indexes\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Then look for non indexed joins in the slow query log.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$raise_buffer</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;If you are unable to optimize your queries you may want to increase your&#34;</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;join_buffer_size to accommodate larger joins in one pass.&#34;</span>
</span></span><span style="display:flex;"><span>      printf <span style="color:#a5d6ff">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Note! This script will still suggest raising the join_buffer_size when&#34;</span> boldred
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;ANY joins not using indexes are found.&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Temp Tables</span>
</span></span><span style="display:flex;"><span>check_tmp_tables<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;TEMP TABLES&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Created_tmp_tables<span style="color:#79c0ff">\&#39;</span> created_tmp_tables 
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Created_tmp_disk_tables<span style="color:#79c0ff">\&#39;</span> created_tmp_disk_tables
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>tmp_table_size<span style="color:#79c0ff">\&#39;</span> tmp_table_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>max_heap_table_size<span style="color:#79c0ff">\&#39;</span> max_heap_table_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$created_tmp_tables</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">tmp_disk_tables</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">tmp_disk_tables</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span>created_tmp_disk_tables*100/<span style="color:#ff7b72;font-weight:bold">(</span>created_tmp_tables+created_tmp_disk_tables<span style="color:#ff7b72">))</span><span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$max_heap_table_size</span> max_heap_table_sizeHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current max_heap_table_size = </span><span style="color:#79c0ff">$max_heap_table_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$tmp_table_size</span> tmp_table_sizeHR 
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current tmp_table_size = </span><span style="color:#79c0ff">$tmp_table_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Of </span><span style="color:#79c0ff">$created_tmp_tables</span><span style="color:#a5d6ff"> temp tables, </span><span style="color:#79c0ff">$tmp_disk_tables</span><span style="color:#a5d6ff">% were created on disk&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$tmp_table_size</span> -gt <span style="color:#79c0ff">$max_heap_table_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Effective in-memory tmp_table_size is limited to max_heap_table_size.&#34;</span> yellow
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$tmp_disk_tables</span> -ge <span style="color:#a5d6ff">25</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Perhaps you should increase your tmp_table_size and/or max_heap_table_size&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;to reduce the number of disk-based temporary tables&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Note! BLOB and TEXT columns are not allow in memory tables.&#34;</span> yellow
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;If you are using these columns raising these values might not impact your &#34;</span> yellow
</span></span><span style="display:flex;"><span>    cecho  <span style="color:#a5d6ff">&#34;ratio of on disk temp tables.&#34;</span> yellow
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Created disk tmp tables ratio seems fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Open Files Limit</span>
</span></span><span style="display:flex;"><span>check_open_files<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;OPEN FILES LIMIT&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>open_files_limit<span style="color:#79c0ff">\&#39;</span> open_files_limit
</span></span><span style="display:flex;"><span>  mysql_status   <span style="color:#79c0ff">\&#39;</span>Open_files<span style="color:#79c0ff">\&#39;</span> open_files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$open_files_limit</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$open_files_limit</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">open_files_limit</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>ulimit -n<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">cant_override</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">cant_override</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current open_files_limit = </span><span style="color:#79c0ff">$open_files_limit</span><span style="color:#a5d6ff"> files&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">open_files_ratio</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$open_files</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$open_files_limit</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;The open_files_limit should typically be set to at least 2x-3x&#34;</span> yellow
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;that of table_cache if you have heavy MyISAM usage.&#34;</span> yellow
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$open_files_ratio</span> -ge <span style="color:#a5d6ff">75</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You currently have open more than 75% of your open_files_limit&#34;</span> boldred
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$cant_override</span> -eq <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You should set a higer value for ulimit -u in the mysql startup script then restart mysqld&#34;</span> boldred
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;MySQL 3.23 users : This is just a guess based upon the current shell&#39;s ulimit -u value&#34;</span> yellow
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$cant_override</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You should set a higher value for open_files_limit in my.cnf&#34;</span> boldred
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;ERROR can&#39;t determine if mysqld override of ulimit is allowed&#34;</span> boldred
</span></span><span style="display:flex;"><span>      exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your open_files_limit value seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Table Cache</span>
</span></span><span style="display:flex;"><span>check_table_cache<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;TABLE CACHE&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>datadir<span style="color:#79c0ff">\&#39;</span> datadir
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>table_cache<span style="color:#79c0ff">\&#39;</span> table_cache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic"># MySQL +5.1 version of table_cache</span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>table_open_cache<span style="color:#79c0ff">\&#39;</span> table_open_cache
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>table_definition_cache<span style="color:#79c0ff">\&#39;</span> table_definition_cache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Open_tables<span style="color:#79c0ff">\&#39;</span> open_tables
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Opened_tables<span style="color:#79c0ff">\&#39;</span> opened_tables
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Open_table_definitions<span style="color:#79c0ff">\&#39;</span> open_table_definitions
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">table_count</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;/*!50000 SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE=&#39;BASE TABLE&#39; */&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$table_count</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$UID</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$socket_owner</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$UID</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;0&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You are not &#39;</span><span style="color:#79c0ff">$socket_owner</span><span style="color:#a5d6ff">&#39; or &#39;root&#39;&#34;</span> red
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;I am unable to determine the table_count!&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">table_count</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>find <span style="color:#79c0ff">$datadir</span> 2&gt;&amp;<span style="color:#a5d6ff">1</span> | grep -c .frm$<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_open_cache</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">table_cache</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$table_open_cache</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$opened_tables</span> -ne <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_cache</span> -ne <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">table_cache_hit_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$open_tables</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$opened_tables</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">table_cache_fill</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$open_tables</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$table_cache</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$opened_tables</span> -eq <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_cache</span> -ne <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">table_cache_hit_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">100</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">table_cache_fill</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$open_tables</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$table_cache</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;ERROR no table_cache ?!&#34;</span> boldred
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_cache</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! <span style="color:#79c0ff">$table_open_cache</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current table_cache value = </span><span style="color:#79c0ff">$table_cache</span><span style="color:#a5d6ff"> tables&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_open_cache</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current table_open_cache = </span><span style="color:#79c0ff">$table_open_cache</span><span style="color:#a5d6ff"> tables&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current table_definition_cache = </span><span style="color:#79c0ff">$table_definition_cache</span><span style="color:#a5d6ff"> tables&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_count</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You have a total of </span><span style="color:#79c0ff">$table_count</span><span style="color:#a5d6ff"> tables&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span>  <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_cache_fill</span> -lt <span style="color:#a5d6ff">95</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;You have &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$open_tables</span><span style="color:#a5d6ff"> &#34;</span> green
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;open tables.&#34;</span> 
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;The table_cache value seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_cache_hit_rate</span> -le <span style="color:#a5d6ff">85</span> -o  <span style="color:#79c0ff">$table_cache_fill</span> -ge <span style="color:#a5d6ff">95</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;You have &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$open_tables</span><span style="color:#a5d6ff"> &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;open tables.&#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;Current table_cache hit rate is &#34;</span> 
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$table_cache_hit_rate</span><span style="color:#a5d6ff">%&#34;</span> boldred
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;, while &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$table_cache_fill</span><span style="color:#a5d6ff">% &#34;</span> boldred
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;of your table cache is in use&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should probably increase your table_cache&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;Current table_cache hit rate is &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$table_cache_hit_rate</span><span style="color:#a5d6ff">%&#34;</span> green
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;, while &#34;</span>
</span></span><span style="display:flex;"><span>    cechon <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$table_cache_fill</span><span style="color:#a5d6ff">% &#34;</span> green
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;of your table cache is in use&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;The table cache value seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_definition_cache</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_definition_cache</span> -le <span style="color:#79c0ff">$table_count</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_count</span> -ge <span style="color:#a5d6ff">100</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You should probably increase your table_definition_cache value.&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Table Locking</span>
</span></span><span style="display:flex;"><span>check_table_locking<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;TABLE LOCKING&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Table_locks_waited<span style="color:#79c0ff">\&#39;</span> table_locks_waited
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Table_locks_immediate<span style="color:#79c0ff">\&#39;</span> table_locks_immediate
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>concurrent_insert<span style="color:#79c0ff">\&#39;</span> concurrent_insert
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>low_priority_updates<span style="color:#79c0ff">\&#39;</span> low_priority_updates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$concurrent_insert</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;ON&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">concurrent_insert</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$concurrent_insert</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;OFF&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">concurrent_insert</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  cechon <span style="color:#a5d6ff">&#34;Current Lock Wait ratio = &#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$table_locks_waited</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">immediate_locks_miss_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$table_locks_immediate</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$table_locks_waited</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;1 : </span><span style="color:#79c0ff">$immediate_locks_miss_rate</span><span style="color:#a5d6ff">&#34;</span> red
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">immediate_locks_miss_rate</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">99999</span> <span style="color:#8b949e;font-style:italic"># perfect</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;0 : </span><span style="color:#79c0ff">$questions</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$immediate_locks_miss_rate</span> -lt <span style="color:#a5d6ff">5000</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;You may benefit from selective use of InnoDB.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$low_priority_updates</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;OFF&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;If you have long running SELECT&#39;s against MyISAM tables and perform&#34;</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;frequent updates consider setting &#39;low_priority_updates=1&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -gt <span style="color:#a5d6ff">050000</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050500</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$concurrent_insert</span> -le <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;If you have a high concurrency of inserts on Dynamic row-length tables&#34;</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;consider setting &#39;concurrent_insert=2&#39;.&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -gt <span style="color:#a5d6ff">050500</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$concurrent_insert</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;AUTO&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$concurrent_insert</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;NEVER&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;If you have a high concurrency of inserts on Dynamic row-length tables&#34;</span>
</span></span><span style="display:flex;"><span>        cecho <span style="color:#a5d6ff">&#34;consider setting &#39;concurrent_insert=ALWAYS&#39;.&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Your table locking seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Table Scans</span>
</span></span><span style="display:flex;"><span>check_table_scans<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;TABLE SCANS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Com_select<span style="color:#79c0ff">\&#39;</span> com_select
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Handler_read_rnd_next<span style="color:#79c0ff">\&#39;</span> read_rnd_next
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>read_buffer_size<span style="color:#79c0ff">\&#39;</span> read_buffer_size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$read_buffer_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>record_buffer<span style="color:#79c0ff">\&#39;</span> read_buffer_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$read_buffer_size</span> read_buffer_sizeHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Current read_buffer_size = </span><span style="color:#79c0ff">$read_buffer_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$com_select</span> -gt <span style="color:#a5d6ff">0</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">full_table_scans</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$read_rnd_next</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$com_select</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current table scan ratio = </span><span style="color:#79c0ff">$full_table_scans</span><span style="color:#a5d6ff"> : 1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$full_table_scans</span> -ge <span style="color:#a5d6ff">4000</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$read_buffer_size</span> -le <span style="color:#a5d6ff">2097152</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;You have a high ratio of sequential access requests to SELECTs&#34;</span> red
</span></span><span style="display:flex;"><span>      cechon <span style="color:#a5d6ff">&#34;You may benefit from raising &#34;</span> red
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;3.23&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>        cechon <span style="color:#a5d6ff">&#34;record_buffer &#34;</span> red
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>        cechon <span style="color:#a5d6ff">&#34;read_buffer_size &#34;</span> red
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;and/or improving your use of indexes.&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$read_buffer_size</span> -gt <span style="color:#a5d6ff">8388608</span> <span style="color:#ff7b72;font-weight:bold">]</span> ; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      cechon <span style="color:#a5d6ff">&#34;read_buffer_size is over 8 MB &#34;</span> red
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;there is probably no need for such a large read_buffer&#34;</span> red
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;read_buffer_size seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;read_buffer_size seems to be fine&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># InnoDB</span>
</span></span><span style="display:flex;"><span>check_innodb_status <span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic">## See http://bugs.mysql.com/59393</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050603</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>have_innodb<span style="color:#79c0ff">\&#39;</span> have_innodb
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050500</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$have_innodb</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;YES&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -ge <span style="color:#a5d6ff">050500</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050512</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>ignore_builtin_innodb<span style="color:#79c0ff">\&#39;</span> ignore_builtin_innodb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$ignore_builtin_innodb</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;ON&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$have_innodb</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;NO&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span>  <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;5.5&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -ge <span style="color:#a5d6ff">050512</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>ignore_builtin_innodb<span style="color:#79c0ff">\&#39;</span> ignore_builtin_innodb
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$ignore_builtin_innodb</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;ON&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -ge <span style="color:#a5d6ff">050600</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -lt <span style="color:#a5d6ff">050603</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>ignore_builtin_innodb<span style="color:#79c0ff">\&#39;</span> ignore_builtin_innodb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$ignore_builtin_innodb</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;ON&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$have_innodb</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;NO&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;5.6&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$mysql_version_num</span><span style="color:#a5d6ff">&#34;</span> -ge <span style="color:#a5d6ff">050603</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>ignore_builtin_innodb<span style="color:#79c0ff">\&#39;</span> ignore_builtin_innodb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$ignore_builtin_innodb</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;ON&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">innodb_enabled</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$innodb_enabled</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_buffer_pool_size<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_additional_mem_pool_size<span style="color:#79c0ff">\&#39;</span> innodb_additional_mem_pool_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_fast_shutdown<span style="color:#79c0ff">\&#39;</span> innodb_fast_shutdown
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_flush_log_at_trx_commit<span style="color:#79c0ff">\&#39;</span> innodb_flush_log_at_trx_commit
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_locks_unsafe_for_binlog<span style="color:#79c0ff">\&#39;</span> innodb_locks_unsafe_for_binlog
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_log_buffer_size<span style="color:#79c0ff">\&#39;</span> innodb_log_buffer_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_log_file_size<span style="color:#79c0ff">\&#39;</span> innodb_log_file_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_log_files_in_group<span style="color:#79c0ff">\&#39;</span> innodb_log_files_in_group
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_safe_binlog<span style="color:#79c0ff">\&#39;</span> innodb_safe_binlog
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_thread_concurrency<span style="color:#79c0ff">\&#39;</span> innodb_thread_concurrency
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;INNODB STATUS&#34;</span> boldblue
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_indexes</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;/*!50000 SELECT IFNULL(SUM(INDEX_LENGTH),0) from information_schema.TABLES where ENGINE=&#39;InnoDB&#39; */&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_data</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;/*!50000 SELECT IFNULL(SUM(DATA_LENGTH),0) from information_schema.TABLES where ENGINE=&#39;InnoDB&#39; */&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> ! -z <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$innodb_indexes</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_pages_data<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_pages_data
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_pages_misc<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_pages_misc
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_pages_free<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_pages_free
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_pages_total<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_pages_total
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_read_ahead_seq<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_read_ahead_seq
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_buffer_pool_read_requests<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_read_requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_os_log_pending_fsyncs<span style="color:#79c0ff">\&#39;</span> innodb_os_log_pending_fsyncs
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_os_log_pending_writes<span style="color:#79c0ff">\&#39;</span> innodb_os_log_pending_writes
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_log_waits<span style="color:#79c0ff">\&#39;</span> innodb_log_waits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_row_lock_time<span style="color:#79c0ff">\&#39;</span> innodb_row_lock_time
</span></span><span style="display:flex;"><span>      mysql_status <span style="color:#79c0ff">\&#39;</span>Innodb_row_lock_waits<span style="color:#79c0ff">\&#39;</span> innodb_row_lock_waits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      human_readable <span style="color:#79c0ff">$innodb_indexes</span> innodb_indexesHR
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Current InnoDB index space = </span><span style="color:#79c0ff">$innodb_indexesHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>      human_readable <span style="color:#79c0ff">$innodb_data</span> innodb_dataHR
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Current InnoDB data space = </span><span style="color:#79c0ff">$innodb_dataHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">percent_innodb_buffer_pool_free</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$((</span><span style="color:#79c0ff">$innodb_buffer_pool_pages_free</span><span style="color:#ff7b72;font-weight:bold">*</span><span style="color:#a5d6ff">100</span><span style="color:#ff7b72;font-weight:bold">/</span><span style="color:#79c0ff">$innodb_buffer_pool_pages_total</span><span style="color:#ff7b72">))</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Current InnoDB buffer pool free = &#34;</span><span style="color:#79c0ff">$percent_innodb_buffer_pool_free</span><span style="color:#a5d6ff">&#34; %&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Cannot parse InnoDB stats prior to 5.0.x&#34;</span> red
</span></span><span style="display:flex;"><span>      <span style="color:#79c0ff">$mysql</span> -s -e <span style="color:#a5d6ff">&#34;SHOW /*!50000 ENGINE */ INNODB STATUS\G&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    human_readable <span style="color:#79c0ff">$innodb_buffer_pool_size</span> innodb_buffer_pool_sizeHR
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Current innodb_buffer_pool_size = </span><span style="color:#79c0ff">$innodb_buffer_pool_sizeHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Depending on how much space your innodb indexes take up it may be safe&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;to increase this value to up to 2 / 3 of total system memory&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;No InnoDB Support Enabled!&#34;</span> boldred
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Total Memory Usage</span>
</span></span><span style="display:flex;"><span>total_memory_used<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;MEMORY USAGE&#34;</span> boldblue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>read_buffer_size<span style="color:#79c0ff">\&#39;</span> read_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>read_rnd_buffer_size<span style="color:#79c0ff">\&#39;</span> read_rnd_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>sort_buffer_size<span style="color:#79c0ff">\&#39;</span> sort_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>thread_stack<span style="color:#79c0ff">\&#39;</span> thread_stack
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>max_connections<span style="color:#79c0ff">\&#39;</span> max_connections
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>join_buffer_size<span style="color:#79c0ff">\&#39;</span> join_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>tmp_table_size<span style="color:#79c0ff">\&#39;</span> tmp_table_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>max_heap_table_size<span style="color:#79c0ff">\&#39;</span> max_heap_table_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>log_bin<span style="color:#79c0ff">\&#39;</span> log_bin
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Max_used_connections<span style="color:#79c0ff">\&#39;</span> max_used_connections
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$major_version</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;3.23&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>record_buffer<span style="color:#79c0ff">\&#39;</span> read_buffer_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>record_rnd_buffer<span style="color:#79c0ff">\&#39;</span> read_rnd_buffer_size
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>sort_buffer<span style="color:#79c0ff">\&#39;</span> sort_buffer_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$log_bin</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;ON&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    mysql_variable <span style="color:#79c0ff">\&#39;</span>binlog_cache_size<span style="color:#79c0ff">\&#39;</span> binlog_cache_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">binlog_cache_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$max_heap_table_size</span> -le <span style="color:#79c0ff">$tmp_table_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">effective_tmp_table_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$max_heap_table_size</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">effective_tmp_table_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$tmp_table_size</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">per_thread_buffers</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;(</span><span style="color:#79c0ff">$read_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$read_rnd_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$sort_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$thread_stack</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$join_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$binlog_cache_size</span><span style="color:#a5d6ff">)*</span><span style="color:#79c0ff">$max_connections</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">per_thread_max_buffers</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;(</span><span style="color:#79c0ff">$read_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$read_rnd_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$sort_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$thread_stack</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$join_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$binlog_cache_size</span><span style="color:#a5d6ff">)*</span><span style="color:#79c0ff">$max_used_connections</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_buffer_pool_size<span style="color:#79c0ff">\&#39;</span> innodb_buffer_pool_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$innodb_buffer_pool_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_buffer_pool_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_additional_mem_pool_size<span style="color:#79c0ff">\&#39;</span> innodb_additional_mem_pool_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$innodb_additional_mem_pool_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_additional_mem_pool_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>innodb_log_buffer_size<span style="color:#79c0ff">\&#39;</span> innodb_log_buffer_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$innodb_log_buffer_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">innodb_log_buffer_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>key_buffer_size<span style="color:#79c0ff">\&#39;</span> key_buffer_size
</span></span><span style="display:flex;"><span>  mysql_variable <span style="color:#79c0ff">\&#39;</span>query_cache_size<span style="color:#79c0ff">\&#39;</span> query_cache_size
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$query_cache_size</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">query_cache_size</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">global_buffers</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$innodb_buffer_pool_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$innodb_additional_mem_pool_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$innodb_log_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$key_buffer_size</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$query_cache_size</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">max_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$global_buffers</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$per_thread_max_buffers</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">total_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$global_buffers</span><span style="color:#a5d6ff">+</span><span style="color:#79c0ff">$per_thread_buffers</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">pct_of_sys_mem</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>echo <span style="color:#a5d6ff">&#34;scale=0; </span><span style="color:#79c0ff">$total_memory</span><span style="color:#a5d6ff">*100/</span><span style="color:#79c0ff">$physical_memory</span><span style="color:#a5d6ff">&#34;</span> | bc -l<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$pct_of_sys_mem</span> -gt <span style="color:#a5d6ff">90</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">txt_color</span><span style="color:#ff7b72;font-weight:bold">=</span>boldred
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">txt_color</span><span style="color:#ff7b72;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">error</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$max_memory</span> max_memoryHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Max Memory Ever Allocated : </span><span style="color:#79c0ff">$max_memoryHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$per_thread_buffers</span> per_thread_buffersHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Configured Max Per-thread Buffers : </span><span style="color:#79c0ff">$per_thread_buffersHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$global_buffers</span> global_buffersHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Configured Max Global Buffers : </span><span style="color:#79c0ff">$global_buffersHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$total_memory</span> total_memoryHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Configured Max Memory Limit : </span><span style="color:#79c0ff">$total_memoryHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  human_readable <span style="color:#79c0ff">$physical_memory</span> physical_memoryHR
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34;Physical Memory : </span><span style="color:#79c0ff">$physical_memoryHR</span><span style="color:#a5d6ff"> </span><span style="color:#79c0ff">$unit</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$error</span> -eq <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#a5d6ff">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Max memory limit exceeds 90% of physical memory&#34;</span> <span style="color:#79c0ff">$txt_color</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;Max memory limit seem to be within acceptable norms&#34;</span> green
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>  unset txt_color
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Required Functions</span>
</span></span><span style="display:flex;"><span>login_validation<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  check_for_socket          <span style="color:#8b949e;font-style:italic"># determine the socket location -- 1st login</span>
</span></span><span style="display:flex;"><span>  check_for_plesk_passwords <span style="color:#8b949e;font-style:italic"># determine the login method -- 2nd login</span>
</span></span><span style="display:flex;"><span>  check_mysql_login         <span style="color:#8b949e;font-style:italic"># determine if mysql is accepting login -- 3rd login</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">major_version</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;SELECT SUBSTRING_INDEX(VERSION(), &#39;.&#39;, +2)&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">mysql_version_num</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;SELECT VERSION()&#34;</span> |
</span></span><span style="display:flex;"><span>    awk -F <span style="color:#79c0ff">\.</span> <span style="color:#a5d6ff">&#39;{ printf &#34;%02d&#34;, $1; printf &#34;%02d&#34;, $2; printf &#34;%02d&#34;, $3 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>shared_info<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">major_version</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;SELECT SUBSTRING_INDEX(VERSION(), &#39;.&#39;, +2)&#34;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">mysql_version_num</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span><span style="color:#79c0ff">$mysql</span> -Bse <span style="color:#a5d6ff">&#34;SELECT VERSION()&#34;</span> |
</span></span><span style="display:flex;"><span>    awk -F <span style="color:#79c0ff">\.</span> <span style="color:#a5d6ff">&#39;{ printf &#34;%02d&#34;, $1; printf &#34;%02d&#34;, $2; printf &#34;%02d&#34;, $3 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  mysql_status <span style="color:#79c0ff">\&#39;</span>Questions<span style="color:#79c0ff">\&#39;</span> questions
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">socket_owner</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>ls -nH <span style="color:#79c0ff">$socket</span> | awk <span style="color:#a5d6ff">&#39;{ print $3 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_system_info<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  export <span style="color:#79c0ff">OS</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>uname<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic"># Get information for various UNIXes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$OS</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;Darwin&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">ps_socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span> | head -1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">found_socks</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">physical_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>sysctl -n hw.memsize<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">duflags</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$OS</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;FreeBSD&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$OS</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;OpenBSD&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">## On FreeBSD must be root to locate sockets.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">ps_socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span> | head -1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">found_socks</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">physical_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>sysctl -n hw.realmem<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">duflags</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$OS</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;Linux&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">## Includes SWAP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">## export physical_memory=$(free -b | grep -v buffers |  awk &#39;{ s += $2 } END { printf(&#34;%.0f\n&#34;, s ) }&#39;)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">ps_socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span> | head -1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">found_socks</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -ln | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?\.sock/ { print $9 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">physical_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>awk <span style="color:#a5d6ff">&#39;/^MemTotal/ { printf(&#34;%.0f&#34;, $2*1024 ) }&#39;</span> &lt; /proc/meminfo<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">duflags</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;-b&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$OS</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;SunOS&#39;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">ps_socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -an | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?.sock/ { print $5 }&#39;</span> | head -1<span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">found_socks</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>netstat -an | awk <span style="color:#a5d6ff">&#39;/mysql(.*)?.sock/ { print $5 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">physical_memory</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#ff7b72">$(</span>prtconf | awk <span style="color:#a5d6ff">&#39;/^Memory\ size:/ { print $3*1048576 }&#39;</span><span style="color:#ff7b72">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#ff7b72">$(</span>which bc<span style="color:#ff7b72">)</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#a5d6ff">&#34;Error: Command line calculator &#39;bc&#39; not found!&#34;</span>
</span></span><span style="display:flex;"><span>    exit
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">## Optional Components Groups</span>
</span></span><span style="display:flex;"><span>banner_info<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  shared_info
</span></span><span style="display:flex;"><span>  print_banner; echo
</span></span><span style="display:flex;"><span>  check_mysql_version; echo
</span></span><span style="display:flex;"><span>  post_uptime_warning; echo
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>misc<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  shared_info
</span></span><span style="display:flex;"><span>  check_slow_queries; echo
</span></span><span style="display:flex;"><span>  check_binary_log; echo
</span></span><span style="display:flex;"><span>  check_threads; echo
</span></span><span style="display:flex;"><span>  check_used_connections; echo
</span></span><span style="display:flex;"><span>  check_innodb_status; echo
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>memory<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  shared_info
</span></span><span style="display:flex;"><span>  total_memory_used; echo
</span></span><span style="display:flex;"><span>  check_key_buffer_size; echo
</span></span><span style="display:flex;"><span>  check_query_cache; echo
</span></span><span style="display:flex;"><span>  check_sort_operations; echo
</span></span><span style="display:flex;"><span>  check_join_operations; echo
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  shared_info
</span></span><span style="display:flex;"><span>  check_open_files; echo
</span></span><span style="display:flex;"><span>  check_table_cache; echo
</span></span><span style="display:flex;"><span>  check_tmp_tables; echo
</span></span><span style="display:flex;"><span>  check_table_scans; echo
</span></span><span style="display:flex;"><span>  check_table_locking; echo
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>all<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  banner_info
</span></span><span style="display:flex;"><span>  misc
</span></span><span style="display:flex;"><span>  memory
</span></span><span style="display:flex;"><span>  file
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>prompt<span style="color:#ff7b72;font-weight:bold">()</span> <span style="color:#ff7b72;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">prompted</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;true&#39;</span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Username [anonymous] : &#34;</span> user
</span></span><span style="display:flex;"><span>  read -rp <span style="color:#a5d6ff">&#34;Password [&lt;none&gt;] : &#34;</span> pass
</span></span><span style="display:flex;"><span>  cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Socket [ /var/lib/mysql/mysql.sock ] : &#34;</span> socket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$socket</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">socket</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;/var/lib/mysql/mysql.sock&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$pass</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysql -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysqladmin -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">else</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">mysql</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysql -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff"> -p</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>    export <span style="color:#79c0ff">mysqladmin</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;mysqladmin -S </span><span style="color:#79c0ff">$socket</span><span style="color:#a5d6ff"> -u</span><span style="color:#79c0ff">$user</span><span style="color:#a5d6ff"> -p</span><span style="color:#79c0ff">$pass</span><span style="color:#a5d6ff">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  check_for_socket
</span></span><span style="display:flex;"><span>  check_mysql_login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#79c0ff">$?</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">1</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#a5d6ff">&#34;Mode to test - banner, file, misc, mem, innodb, [all] : &#34;</span> REPLY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#79c0ff">$REPLY</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#79c0ff">REPLY</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;all&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$REPLY</span> in
</span></span><span style="display:flex;"><span>    banner|BANNER|header|HEADER|head|HEAD<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      banner_info
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    misc|MISC|miscelaneous<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      misc
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    mem|memory|MEM|MEMORY<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      memory
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    file|FILE|disk|DISK<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      file
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    innodb|INNODB<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      innodb
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    all|ALL<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>      all
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>    *<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      cecho <span style="color:#a5d6ff">&#34;Invalid Mode!  Valid options are &#39;banner&#39;, &#39;misc&#39;, &#39;memory&#39;, &#39;file&#39;, &#39;innodb&#39; or &#39;all&#39;&#34;</span> boldred
</span></span><span style="display:flex;"><span>      exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>      ;;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">esac</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Address environmental differences</span>
</span></span><span style="display:flex;"><span>get_system_info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> <span style="color:#ff7b72;font-weight:bold">[</span> -z <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>  login_validation
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">mode</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#39;ALL&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;prompt&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;PROMPT&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">mode</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">elif</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;prompt&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span> <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72;font-weight:bold">[</span> <span style="color:#a5d6ff">&#34;</span><span style="color:#79c0ff">$1</span><span style="color:#a5d6ff">&#34;</span> !<span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#34;PROMPT&#34;</span> <span style="color:#ff7b72;font-weight:bold">]</span>; <span style="color:#ff7b72">then</span>
</span></span><span style="display:flex;"><span>  login_validation
</span></span><span style="display:flex;"><span>  <span style="color:#79c0ff">mode</span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#79c0ff">$1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">case</span> <span style="color:#79c0ff">$mode</span> in
</span></span><span style="display:flex;"><span>  all|ALL<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>    all
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  mem|memory|MEM|MEMORY<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>    memory
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  file|FILE|disk|DISK<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>    file
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  banner|BANNER|header|HEADER|head|HEAD<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    banner_info
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  misc|MISC|miscelaneous<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>    misc
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  innodb|INNOD <span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    banner_info
</span></span><span style="display:flex;"><span>    check_innodb_status; echo
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  prompt|PROMPT<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    prompt
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  *<span style="color:#ff7b72;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    cecho <span style="color:#a5d6ff">&#34;usage: </span><span style="color:#79c0ff">$0</span><span style="color:#a5d6ff"> [ all | banner | file | innodb | memory | misc | prompt ]&#34;</span> boldred
</span></span><span style="display:flex;"><span>    exit <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">esac</span>
</span></span></code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>



    </body>
</html>
