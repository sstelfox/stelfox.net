<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sam@stelfox.net Sam Stelfox ">
<meta name="description" content="At first glance GitHub&amp;rsquo;s API docs are fairly extensive, but they make a mistake I see very commonly in API documentation which is providing zero or no examples for values that are technically unformatted, but reference something very specific. In this case it&amp;rsquo;s the contexts key for required status checks. You can set these via the web interface with handy autocompletion, but that doesn&amp;rsquo;t show you what the value it uses behind the scenes actually is." />
<meta name="keywords" content="blog, programming, linux, systems, personal, automation, best-practices, github, github-actions, continuous-integration" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://stelfox.net/blog/2023/07/dealing-with-branch-protection-rules-using-githubs-settings-app/" />


    <title>
        
            Dealing with Branch Protection Rules Using GitHub&#39;s Settings App :: Sam Stelfox 
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css" integrity="sha256-KgZMRVsOy9axSBs7&#43;d8kQelYOGkQIvQKUzjCyxJE8HU=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Dealing with Branch Protection Rules Using GitHub&#39;s Settings App">
<meta itemprop="description" content="At first glance GitHub&rsquo;s API docs are fairly extensive, but they make a mistake I see very commonly in API documentation which is providing zero or no examples for values that are technically unformatted, but reference something very specific. In this case it&rsquo;s the contexts key for required status checks. You can set these via the web interface with handy autocompletion, but that doesn&rsquo;t show you what the value it uses behind the scenes actually is."><meta itemprop="datePublished" content="2023-07-05T20:11:29-04:00" />
<meta itemprop="dateModified" content="2023-07-05T20:11:29-04:00" />
<meta itemprop="wordCount" content="754">
<meta itemprop="keywords" content="automation,best-practices,github,github-actions,continuous-integration," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dealing with Branch Protection Rules Using GitHub&#39;s Settings App"/>
<meta name="twitter:description" content="At first glance GitHub&rsquo;s API docs are fairly extensive, but they make a mistake I see very commonly in API documentation which is providing zero or no examples for values that are technically unformatted, but reference something very specific. In this case it&rsquo;s the contexts key for required status checks. You can set these via the web interface with handy autocompletion, but that doesn&rsquo;t show you what the value it uses behind the scenes actually is."/>



    <meta property="og:title" content="Dealing with Branch Protection Rules Using GitHub&#39;s Settings App" />
<meta property="og:description" content="At first glance GitHub&rsquo;s API docs are fairly extensive, but they make a mistake I see very commonly in API documentation which is providing zero or no examples for values that are technically unformatted, but reference something very specific. In this case it&rsquo;s the contexts key for required status checks. You can set these via the web interface with handy autocompletion, but that doesn&rsquo;t show you what the value it uses behind the scenes actually is." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stelfox.net/blog/2023/07/dealing-with-branch-protection-rules-using-githubs-settings-app/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-07-05T20:11:29-04:00" />
<meta property="article:modified_time" content="2023-07-05T20:11:29-04:00" />






    <meta property="article:published_time" content="2023-07-05 20:11:29 -0400 EDT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                ./Sam_Stelfox.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/blog/">Blog Posts</a></li><li><a href="/notes/">Various Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://stelfox.net/blog/2023/07/dealing-with-branch-protection-rules-using-githubs-settings-app/">Dealing with Branch Protection Rules Using GitHub&rsquo;s Settings App</a></h2>

            
            
            

            <div class="post-content">
                <p>At first glance GitHub&rsquo;s API docs are fairly extensive, but they make a mistake I see very commonly in API documentation which is providing zero or no examples for values that are technically unformatted, but reference something very specific. In this case it&rsquo;s <a href="https://docs.github.com/en/rest/branches/branch-protection?apiVersion=2022-11-28#get-all-status-check-contexts">the <code>contexts</code> key</a> for required status checks. You can set these via the web interface with handy autocompletion, but that doesn&rsquo;t show you what the value it uses behind the scenes actually is. This is something that can be queried through the API <em>but only from a full GitHub app</em>, not personal API tokens dramatically increasing the friction in seeing what is currently set.</p>
<p>Best practices for managing infrastructure (and yes that includes your GitHub repository config) is via versioned config files. <a href="https://github.com/apps/settings">GitHub Settings App</a> allows you to do this inside the repository itself by creating a <code>.github/settings.yml</code> file in your repository. A current limitation of this approach is there isn&rsquo;t a way to test your changes within the repo you&rsquo;re making the change in (it only applies what is in your main branch). You can use other tools such as <a href="https://registry.terraform.io/providers/integrations/github/latest/docs/resources/branch_protection">Terraform</a> to manage your repositories, but this is convenient, simple, and keeps the config close to infrastructure you&rsquo;re managing.</p>
<p>I hit this annoying lack of documentation when I was trying to enforce GitHub workflows passing before allowing PRs to be merged (aka branch protection rules). Searching online for the solution led to a lot of complaints about the limitations of GitHub actions and similar issues without a published solution. Let&rsquo;s start with a concrete example of a workflow I want to enforce on a Rust repository, specifically checking for security advisories and validating license and dependencies match our configured policies before accepting changes into our codebase. This workflow file for me lives at <code>.github/workflows/audits.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">Dependency Security &amp; License Audit</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">on</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>- <span style="color:#a5d6ff">pull_request</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#7ee787">jobs</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">cargo-deny</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">runs-on</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">ubuntu-22.04</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">strategy</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">matrix</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">checks</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span>- <span style="color:#a5d6ff">advisories</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span>- <span style="color:#a5d6ff">bans licenses sources</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">continue-on-error</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">${{ matrix.checks == &#39;advisories&#39; }}</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">steps</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>- <span style="color:#7ee787">uses</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">actions/checkout@v3</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>- <span style="color:#7ee787">uses</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">EmbarkStudios/cargo-deny-action@v1</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">with</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">command</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">check ${{ matrix.checks }}</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">arguments</span>:<span style="color:#6e7681"> </span>--<span style="color:#a5d6ff">all-features</span><span style="color:#6e7681">
</span></span></span></code></pre></div><p>The only example given for status checks is the useful very string &ldquo;continuous-integration/travis-ci&rdquo;. In GitHub&rsquo;s defense, these status strings can be used from any third party app our utility and when used this way are entirely unformatted. With GitHub actions though, that string should be predictable and documented <em>somewhere</em>. It&rsquo;s probably the most common use case for required status checks and entirely ignored by their documentation. Based off various posted questions and issues I was able to find I gave the following strings a try:</p>
<ul>
<li><code>audits</code>, <code>audits.yml</code>: The filename of the workflow</li>
<li><code>Dependency Security &amp; License Audit</code>: The name of the workflow</li>
<li><code>cargo-deny</code>: The name of the job</li>
<li><code>audits/cargo-deny</code>: The workflow filename/job name.</li>
<li><code>github-actions-audits-cargo-deny</code>: A string that was uselessly recommended by ChatGPT</li>
<li><code>Dependency Security &amp; License Audit (advisories)</code>, <code>Dependency Security &amp; License Audit (bans licenses sources)</code>: The two titles that show up in PRs when the workflow (there is a 2 entry matrix for this workflow).</li>
</ul>
<p>I finally figured it out by inspecting an individual workflow run which had the job names <code>cargo-deny (advisories)</code> and <code>cargo-deny (bans licenses sources)</code>. If you&rsquo;re not using a matrix in your workflow, the name of the job appears to be the value you&rsquo;re looking for (<code>cargo-deny</code> in this case) but if you&rsquo;re also using matrixes you need to include their value in parens after the name. If this isn&rsquo;t working for you, they might be interacting with another feature in an unknown way but you should be able to figure out the correct value by following these steps:</p>
<ol>
<li>Allow the workflow job to run at least once</li>
<li>Navigate to your GitHub repository page</li>
<li>Click on the &ldquo;Actions&rdquo; tab</li>
<li>Select the relevant workflow from the left hand side (<code>Dependency Security &amp; License Audit</code> in my case)</li>
<li>Click into one of the workflow runs (success or failure of the run doesn&rsquo;t matter here)</li>
<li>Check the names on the left hand side under the <code>Jobs</code> section, these are what you&rsquo;re looking for</li>
</ol>
<p>For completeness, my final working example is:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#7ee787">branches</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>- <span style="color:#7ee787">name</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">master</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">protection</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">required_pull_request_reviews</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">required_approving_review_count</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">1</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">dismiss_stale_reviews</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">true</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">required_status_checks</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">strict</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">true</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">        </span><span style="color:#7ee787">contexts</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span>- <span style="color:#a5d6ff">&#34;cargo-deny (advisories)&#34;</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">          </span>- <span style="color:#a5d6ff">&#34;cargo-deny (bans licenses sources)&#34;</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">enforce_admins</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">true</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">restrictions</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#7ee787">required_linear_history</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">false</span><span style="color:#6e7681">
</span></span></span></code></pre></div><p>The <code>null</code> value on that <code>restrictions</code> key is due to <a href="https://github.com/repository-settings/app/issues/150">an unrelated bug</a> in the GitHub Settings App and how the GitHub.</p>
<p>Don&rsquo;t be like GitHub. Provide examples with your documentations, don&rsquo;t blindly trust API doc generation tools and assume the types alone are sufficient, especially if you&rsquo;re integrating with your own tools.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://stelfox.net/tags/automation/">automation</a></span>
        <span class="tag"><a href="https://stelfox.net/tags/best-practices/">best-practices</a></span>
        <span class="tag"><a href="https://stelfox.net/tags/github/">github</a></span>
        <span class="tag"><a href="https://stelfox.net/tags/github-actions/">github-actions</a></span>
        <span class="tag"><a href="https://stelfox.net/tags/continuous-integration/">continuous-integration</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>



    </body>
</html>
