<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I've been writing software to work against an OpenLDAP instance, with a highly customized schema. The operators of the existing system only had the schema files and searching around found several elaborate ways to convert the files which I tried with mixed success. After doing the research to figure this out, it became clear I could probably have used &amp;quot;slapcat&amp;quot; and have dumped the active schema directly to LDIF.
As a sample of how I converted these, I'll use the &amp;quot;rfc2307bis."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,openldap,linux,tips"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2018/03/converting-openldap-schemas-to-ldif/><title>Converting OpenLDAP Schemas to LDIF :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Converting OpenLDAP Schemas to LDIF"><meta itemprop=description content='I&#39;ve been writing software to work against an OpenLDAP instance, with a highly customized schema. The operators of the existing system only had the schema files and searching around found several elaborate ways to convert the files which I tried with mixed success. After doing the research to figure this out, it became clear I could probably have used "slapcat" and have dumped the active schema directly to LDIF.
As a sample of how I converted these, I&#39;ll use the "rfc2307bis.'><meta itemprop=datePublished content="2018-03-24T20:20:22-06:00"><meta itemprop=dateModified content="2018-03-24T20:20:22-06:00"><meta itemprop=wordCount content="336"><meta itemprop=keywords content="Openldap,Linux,Tips"><meta name=twitter:card content="summary"><meta name=twitter:title content="Converting OpenLDAP Schemas to LDIF"><meta name=twitter:description content='I&#39;ve been writing software to work against an OpenLDAP instance, with a highly customized schema. The operators of the existing system only had the schema files and searching around found several elaborate ways to convert the files which I tried with mixed success. After doing the research to figure this out, it became clear I could probably have used "slapcat" and have dumped the active schema directly to LDIF.
As a sample of how I converted these, I&#39;ll use the "rfc2307bis.'><meta property="article:published_time" content="2018-03-24 20:20:22 -0600 -0600"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2018/03/converting-openldap-schemas-to-ldif/>Converting OpenLDAP Schemas to LDIF</a></h2><div class=post-content><p>I've been writing software to work against an OpenLDAP instance, with a highly customized schema. The operators of the existing system only had the schema files and searching around found several elaborate ways to convert the files which I tried with mixed success. After doing the research to figure this out, it became clear I could probably have used "slapcat" and have dumped the active schema directly to LDIF.</p><p>As a sample of how I converted these, I'll use the "rfc2307bis.schema" file which didn't seem to come with a matching LDIF file in the source distribution. You'll need to identify the dependencies of the schema, which I've tended to just do with trial and error. If a dependency is missing you'll receive an error like the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>5ab6f5a6 /etc/openldap/schema/cosine.schema: line 1084 objectclass: ObjectClass not found: &#34;person&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>You can identify the requisite schema file by grep'ing for the missing object in the other schema files and adding it to the config. The "rfc2307.schema" file depends on the "core.schema" and "cosine.schema" files. With this in mind you can use the following script to convert the LDIF file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>SCHEMA_CONV_DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>mktemp -d<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> cat <span class=s>&lt;&lt; EOF &gt; ${SCHE</span>MA_CONV_DIR<span class=o>}</span>/convert.conf
</span></span><span class=line><span class=cl><span class=go>include /etc/openldap/schema/core.schema
</span></span></span><span class=line><span class=cl><span class=go>include /etc/openldap/schema/cosine.schema
</span></span></span><span class=line><span class=cl><span class=go>include /etc/openldap/schema/rfc2307bis.schema
</span></span></span><span class=line><span class=cl><span class=go>EOF
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> slapcat -f <span class=si>${</span><span class=nv>SCHEMA_CONV_DIR</span><span class=si>}</span>/convert.conf -F <span class=si>${</span><span class=nv>SCHEMA_CONV_DIR</span><span class=si>}</span> -n <span class=m>0</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=go>  -s &#34;cn={2}rfc2307bis,cn=schema,cn=config&#34; | sed -re &#39;s/\{[0-9]+\}//&#39; \
</span></span></span><span class=line><span class=cl><span class=go>  -e &#39;/^structuralObjectClass: /d&#39; -e &#39;/^entryUUID: /d&#39; -e &#39;/^creatorsName: /d&#39; \
</span></span></span><span class=line><span class=cl><span class=go>  -e &#39;/^createTimestamp: /d&#39; -e &#39;/^entryCSN: /d&#39; -e &#39;/^modifiersName: /d&#39; \
</span></span></span><span class=line><span class=cl><span class=go>  -e &#39;/^modifyTimestamp: /d&#39; -e &#39;/^$/d&#39; &gt; /etc/openldap/schema/rfc2307bis.ldif
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> rm -rf <span class=si>${</span><span class=nv>SCHEMA_CONV_DIR</span><span class=si>}</span>
</span></span></code></pre></td></tr></table></div></div><p>One important thing to note is the schema identifier in the slapcat command "cn={2}rfc2307bis,cn=schema,cn=config". The "{2}" there will be the line number from the "convert.conf" file counting from 0 and will likely be different for the schemas you're converting, and the name will be defined by the contents of the schema file.</p><p>You'll also want to pay attention to the file names and make sure the inputs and outputs match your expectations.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/openldap/>openldap</a></span>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/tips/>tips</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>