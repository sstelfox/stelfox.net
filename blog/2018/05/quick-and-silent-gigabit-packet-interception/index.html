<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='I regularly find myself inspecting traffic on Linux systems. Usually I&rsquo;m already on the client or server when doing this (such as when diagnosing weird low level app behavior, or unknown, or unusual traffic). It has been a while since I&rsquo;ve needed to silently be the wire between two black boxes.
While verifying link level information about bypassing my Google Fiber Network Box I needed to be that wire again. Before I connected any wires to anything I needed to be sure I wouldn&rsquo;t accidentally leak traffic as I wasn&rsquo;t sure what would impact the link.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Quick and Silent Gigabit Packet Interception • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='I regularly find myself inspecting traffic on Linux systems. Usually I&rsquo;m already on the client or server when doing this (such as when diagnosing weird low level app behavior, or unknown, or unusual traffic). It has been a while since I&rsquo;ve needed to silently be the wire between two black boxes.
While verifying link level information about bypassing my Google Fiber Network Box I needed to be that wire again. Before I connected any wires to anything I needed to be sure I wouldn&rsquo;t accidentally leak traffic as I wasn&rsquo;t sure what would impact the link.'>
<meta property='og:url' content='https://stelfox.net/blog/2018/05/quick-and-silent-gigabit-packet-interception/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='linux'><meta property='article:tag' content='network'><meta property='article:published_time' content='2018-05-13T00:55:09-06:00'/><meta property='article:modified_time' content='2018-05-13T00:55:09-06:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.51-DEV" />

  <title>Quick and Silent Gigabit Packet Interception • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2018/05/quick-and-silent-gigabit-packet-interception/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4a10984a.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Quick and Silent Gigabit Packet Interception</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2018-05-13T00:55:09-06:00'>2018, May 13</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>I regularly find myself inspecting traffic on Linux systems. Usually I&rsquo;m
already on the client or server when doing this (such as when diagnosing weird
low level app behavior, or unknown, or unusual traffic). It has been a while
since I&rsquo;ve needed to silently be the wire between two black boxes.</p>

<p>While verifying link level information about bypassing my Google Fiber Network
Box I needed to be that wire again. Before I connected any wires to anything I
needed to be sure I wouldn&rsquo;t accidentally leak traffic as I wasn&rsquo;t sure what
would impact the link.</p>

<p>You&rsquo;ll need a Linux computer with two gigabit ethernet ports. My last two
laptops haven&rsquo;t had any built in ethernet ports, but USB gigabit adapters are
cheap and I already had a bunch.</p>

<p>I went through and disabled the services that would configure network
interfaces (NetworkManager and ModemManager) as well as all of the networking
services on my system, and confirming your firewalls are all going to allow the
traffic through.</p>

<p>I double checked no packets were sent out up on link up by listening on each
respective interface, plugging in to a powered but otherwise disconnected
switch, and bringing the interface up.</p>

<p>Once I&rsquo;d verified everything in one root terminal I ran:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ip link set eth0 promisc on multicast off arp off
ip link set eth1 promisc on multicast off arp off

ip link add name intercept0 type bridge
ip link set intercept0 promisc on multicast off arp off up

ip link set eth0 master intercept0
ip link set eth1 master intercept0</code></pre></div>
<p>In another terminal either as root, or as a user in the <code>wireshark</code> group begin
recording the traffic of interest:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">tshark -i intercept0 -w recording.pcap</code></pre></div>
<p>At this point, connect the cables between the two boxes of interest. When ready
bring the links up:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ip link set eth0 up
ip link set eth1 up</code></pre></div>
<p>Welcome to being the wire.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a>, <a class='tag' href='/tags/network/'>network</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2018/03/converting-openldap-schemas-to-ldif/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Converting OpenLDAP Schemas to LDIF</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2018/05/parsing-http-responses-in-ruby/'>
        <span class='screen-reader-text'>Next post: </span>Parsing HTTP Responses in Ruby<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2018 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.fae8ed32.js'></script>

</body>

</html>

