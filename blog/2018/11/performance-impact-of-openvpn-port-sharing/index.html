<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I recently had cause to use OpenVPN on the standard HTTPS port to protect my traffic. This was done as a compromise with administrators who didn't want to change their egress filtering, but wanted to allow me to continue doing my normal work.
I already run several webservers, including this one, and didn't want to give up exclusive access to the precious TCP port 443. The recommended way to deal with this is to make use of the port-share option built into OpenVPN."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,openvpn,performance,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2018/11/performance-impact-of-openvpn-port-sharing/><title>Performance Impact of OpenVPN Port Sharing :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Performance Impact of OpenVPN Port Sharing"><meta itemprop=description content="I recently had cause to use OpenVPN on the standard HTTPS port to protect my traffic. This was done as a compromise with administrators who didn't want to change their egress filtering, but wanted to allow me to continue doing my normal work.
I already run several webservers, including this one, and didn't want to give up exclusive access to the precious TCP port 443. The recommended way to deal with this is to make use of the port-share option built into OpenVPN."><meta itemprop=datePublished content="2018-11-04T15:09:02-06:00"><meta itemprop=dateModified content="2018-11-04T15:09:02-06:00"><meta itemprop=wordCount content="286"><meta itemprop=keywords content="Linux,Openvpn,Performance,Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="Performance Impact of OpenVPN Port Sharing"><meta name=twitter:description content="I recently had cause to use OpenVPN on the standard HTTPS port to protect my traffic. This was done as a compromise with administrators who didn't want to change their egress filtering, but wanted to allow me to continue doing my normal work.
I already run several webservers, including this one, and didn't want to give up exclusive access to the precious TCP port 443. The recommended way to deal with this is to make use of the port-share option built into OpenVPN."><meta property="article:published_time" content="2018-11-04 15:09:02 -0600 -0600"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2018/11/performance-impact-of-openvpn-port-sharing/>Performance Impact of OpenVPN Port Sharing</a></h2><div class=post-content><p>I recently had cause to use OpenVPN on the standard HTTPS port to protect my
traffic. This was done as a compromise with administrators who didn't want to
change their egress filtering, but wanted to allow me to continue doing my
normal work.</p><p>I already run several webservers, including this one, and didn't want to give
up exclusive access to the precious TCP port 443. The recommended way to deal
with this is to make use of the <code>port-share</code> option built into OpenVPN. This
left me with two choices, run this on an existing server sharing the port with
existing websites, or setup a dedicated server just for this instance of
OpenVPN.</p><p>I couldn't find any other posts that took a look at how this port sharing
effects the performance of the HTTPS server so I felt like doing a quick
analysis for other curious parties.</p><p>I setup a fresh Nginx server with Let's Encrypt certificates that mimics my
production setup and used <code>ab</code> to bench the service for 30 seconds. The mean
measured rate was 288.70 +/- 14.39 requests per second. Mean request
fullfillment took 3.47 +/- 0.17 ms.</p><p>After enabling <code>port-share</code> on OpenVPN I reran the exact same test. The result
was 139.76 +/- 67.68 requests per second. Mean measured request fullfillment
7.44 +/- 4.16 ms.</p><p>That is a 51% peak request handling reduction, each request has an additional
4-8ms of latency, and an almost 40x increase of jitter. That is a massive
relative impact but the vast majority of the websites I run need won't be
terribly impacted by that additional latency.</p><p>I ultimately ended up setting up a seperate server for OpenVPN as I didn't want
to mess with known working systems.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/openvpn/>openvpn</a></span>
<span class=tag><a href=https://stelfox.net/tags/performance/>performance</a></span>
<span class=tag><a href=https://stelfox.net/tags/security/>security</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>