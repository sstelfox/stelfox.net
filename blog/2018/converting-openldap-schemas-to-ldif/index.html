<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2018&#x2F;converting-openldap-schemas-to-ldif&#x2F;">Converting OpenLDAP Schemas to LDIF</a></h1>

  <div class="post-content"><p>I've been writing software to work against an OpenLDAP instance, with a highly
customized schema. The operators of the existing system only had the schema
files and searching around found several elaborate ways to convert the files
which I tried with mixed success. After doing the research to figure this out,
it became clear I could probably have used <code>slapcat</code> and have dumped the active
schema directly to LDIF.</p>
<span id="continue-reading"></span>
<p>As a sample of how I converted these, I'll use the <code>rfc2307bis.schema</code> file
which didn't seem to come with a matching LDIF file in the source distribution.
You'll need to identify the dependencies of the schema, which I've tended to
just do with trial and error. If a dependency is missing you'll receive an
error like the following:</p>
<pre><code>5ab6f5a6 /etc/openldap/schema/cosine.schema: line 1084 objectclass: ObjectClass not found: "person"
</code></pre>
<p>You can identify the requisite schema file by grep'ing for the missing object
in the other schema files and adding it to the config. The <code>rfc2307.schema</code>
file depends on the <code>core.schema</code> and <code>cosine.schema</code> files. With this in mind
you can use the following script to convert the LDIF file:</p>
<pre><code>SCHEMA_CONV_DIR="$(mktemp -d)"

cat << EOF > ${SCHEMA_CONV_DIR}/convert.conf
include /etc/openldap/schema/core.schema
include /etc/openldap/schema/cosine.schema
include /etc/openldap/schema/rfc2307bis.schema
EOF

slapcat -f ${SCHEMA_CONV_DIR}/convert.conf -F ${SCHEMA_CONV_DIR} -n 0 \
  -s "cn={2}rfc2307bis,cn=schema,cn=config" | sed -re 's/\{[0-9]+\}//' \
  -e '/^structuralObjectClass: /d' -e '/^entryUUID: /d' -e '/^creatorsName: /d' \
  -e '/^createTimestamp: /d' -e '/^entryCSN: /d' -e '/^modifiersName: /d' \
  -e '/^modifyTimestamp: /d' -e '/^$/d' > /etc/openldap/schema/rfc2307bis.ldif

rm -rf ${SCHEMA_CONV_DIR}
</code></pre>
<p>One important thing to note is the schema identifier in the slapcat command
<code>cn={2}rfc2307bis,cn=schema,cn=config</code>. The '{2}' there will be the line number
from the <code>convert.conf</code> file counting from 0 and will likely be different for
the schemas you're converting, and the name will be defined by the contents of
the schema file.</p>
<p>You'll also want to pay attention to the file names and make sure the inputs
and outputs match your expectations.</p>
</div><p class="meta">Posted on <span class="postdate">2018-03-24</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
