<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2017&#x2F;downgrading-glibc-in-gentoo&#x2F;">Downgrading Glibc in Gentoo</a></h1>

  <div class="post-content"><p>While refining some automated setup scripts at some point I upgraded to a
testing/unstable version of glibc. When I attempted to get the box back on to
the stable version I hit a solid protection mechanism built into the portage
scripts that prevents downgrading glibc. Attempts will give you the following
error message:</p>
<span id="continue-reading"></span><pre><code> * Sanity check to keep you from breaking your system:
 *  Downgrading glibc is not supported and a sure way to destruction
 * ERROR: sys-libs/glibc-2.25-r9::gentoo failed (pretend phase):
 *   aborting to save your system
</code></pre>
<p>It is correct in that this is a very dangerous thing to do. For my use case
this was a non-production system that I was using to test various
configurations and hardening procedures so didn't particularly care if the
packages all became corrupt. I was also confident that my method would be
relatively safe (fully bootstrapping the system).</p>
<p>To disable this check (you should seriously understand what you're doing and/or
not care about the system you perform this on if you continue) you need to edit
the appropriate eclass file which exists at
<code>/usr/portage/eclass/toolchain-glibc.eclass</code>. Locate the following line and
disable it by prefixing it with a hash sign (#).</p>
<pre><code>die "aborting to save your system"
</code></pre>
<p>For the version I was editing it was line 507.</p>
<p>To do this downgrade safely I performed the following steps (this will take a
while as it fully boostraps your entire system):</p>
<ul>
<li>Review all use flags and accept keywords to ensure you'll be in the state you
want to</li>
<li>Sync the repository metadata (<code>emerge --sync</code>)</li>
<li>Disable the glibc safety check documented above</li>
<li>Run the following commands to re-bootstrap the system and undo the safety
check modification by resyncing:</li>
</ul>
<pre><code>/usr/portage/scripts/bootstrap.sh
emerge --emptytree --with-bdeps=y @world
emerge --depclean
emerge --sync
</code></pre>
<p>Reboot to ensure all running programs are on the correct versions and the
system should be back in a happy state.</p>
</div><p class="meta">Posted on <span class="postdate">2017-11-15</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
