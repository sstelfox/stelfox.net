<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH&#39;ing worked fine) but any attempt to sign new data resulted in an &lsquo;Unusuable secret key&rsquo; error. For git this resulted in the following message:'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Unusable Secret Key • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH&#39;ing worked fine) but any attempt to sign new data resulted in an &lsquo;Unusuable secret key&rsquo; error. For git this resulted in the following message:'>
<meta property='og:url' content='https://stelfox.net/blog/2017/12/unusable-secret-key/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='gpg'><meta property='article:tag' content='tips'><meta property='article:published_time' content='2017-12-04T11:38:01-05:00'/><meta property='article:modified_time' content='2017-12-04T11:38:01-05:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>Unusable Secret Key • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2017/12/unusable-secret-key/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Unusable Secret Key</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-12-04T11:38:01-05:00'>2017, Dec 04</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>I use a Yubikey NEO to store subkeys used for signing and authentication. I
started experiencing a weird issue with it. It coincided with me rebuilding my
system so diagnosing it ended up being harder than normal. The behavior I
experienced allowed me to use the key to authenticate (SSH'ing worked fine) but
any attempt to sign new data resulted in an &lsquo;Unusuable secret key&rsquo; error. For
git this resulted in the following message:</p>
<pre><code>gpg: skipped &quot;Sam Stelfox &lt;sstelfox@bedroomprogrammers.net&gt;&quot;: Unusable secret
key
gpg: signing failed: Unusable secret key
error: gpg failed to sign the data
fatal: failed to write commit object
</code></pre><p>There is a second Yubikey I use on occasion that contains my companies software
signing key. When reviewing my available secret keys, it seemed like GPG was
listing those private keys as available when they weren't. That was a red
herring and unrelated (though still likely a bug). After resetting my GPG
config as well as the agent, and re-importing my key the private keys were not
be listed at all.</p>
<p>Ultimate the issue was that all of my subkeys were expired and only became
visible when I used the following command:</p>
<pre><code>$ gpg2 --list-options show-unusable-subkeys --list-keys
/home/sstelfox/.gnupg/pubring.kbx
---------------------------------
pub   rsa4096/0x30856D4EA0FFBA8F 2016-04-26 [C] [expires: 2019-12-01]
      Key fingerprint = DC75 C8B8 7434 4360 FB30  3FC9 3085 6D4E A0FF BA8F
uid                   [ unknown] Sam Stelfox &lt;sstelfox@bedroomprogrammers.net&gt;
uid                   [ unknown] Sam Stelfox &lt;sam@stelfox.net&gt;
uid                   [ unknown] Sam Stelfox &lt;sam@pwnieexpress.com&gt;
uid                   [ unknown] [jpeg image of size 2803]
sub   rsa2048/0x5E2FD479ABDD395A 2016-04-26 [S] [expired: 2017-12-01]
sub   rsa2048/0xD87BD950C29A0FA2 2016-04-26 [E] [expired: 2017-12-01]
sub   rsa2048/0x4B218A4FB733A150 2016-04-26 [A] [expired: 2017-12-01]
</code></pre>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/gpg/'>gpg</a>, <a class='tag' href='/tags/tips/'>tips</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2017/11/xfce-failed-to-connect-to-socket/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>XFCE Failed to Connect to Socket</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2017/12/converting-cpio-files-to-tarballs/'>
        <span class='screen-reader-text'>Next post: </span>Converting CPIO Files to Tarballs<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script>

</body>

</html>

