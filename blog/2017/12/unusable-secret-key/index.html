<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH&amp;rsquo;ing worked fine) but any attempt to sign new data resulted in an &amp;lsquo;Unusuable secret key&amp;rsquo; error. For git this resulted in the following message:"><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,gpg,security,tips"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2017/12/unusable-secret-key/><title>Unusable Secret Key :: Sam Stelfox — A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.c8c76086c15b9d686ec1778dcf935d2ad37f3bb9c23165d2bd157ba7b18e5aec.css integrity="sha256-yMdghsFbnWhuwXeNz5NdKtN/O7nCMWXSvRV7p7GOWuw="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Unusable Secret Key"><meta itemprop=description content="I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH’ing worked fine) but any attempt to sign new data resulted in an ‘Unusuable secret key’ error. For git this resulted in the following message:"><meta itemprop=datePublished content="2017-12-04T11:38:01-05:00"><meta itemprop=dateModified content="2017-12-04T11:38:01-05:00"><meta itemprop=wordCount content="280"><meta itemprop=keywords content="Gpg,Security,Tips"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unusable Secret Key"><meta name=twitter:description content="I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH’ing worked fine) but any attempt to sign new data resulted in an ‘Unusuable secret key’ error. For git this resulted in the following message:"><meta property="article:published_time" content="2017-12-04 11:38:01 -0500 EST"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/>Posts</a></li><li><a href=/notes/>Notes</a></li><li><a href=/about/>About Me</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2017/12/unusable-secret-key/>Unusable Secret Key</a></h2><div class=post-content><p>I use a Yubikey NEO to store subkeys used for signing and authentication. I started experiencing a weird issue with it. It coincided with me rebuilding my system so diagnosing it ended up being harder than normal. The behavior I experienced allowed me to use the key to authenticate (SSH&rsquo;ing worked fine) but any attempt to sign new data resulted in an &lsquo;Unusuable secret key&rsquo; error. For git this resulted in the following message:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-df837a3-1><a style=outline:none;text-decoration:none;color:inherit href=#code-df837a3-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-df837a3-2><a style=outline:none;text-decoration:none;color:inherit href=#code-df837a3-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-df837a3-3><a style=outline:none;text-decoration:none;color:inherit href=#code-df837a3-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-df837a3-4><a style=outline:none;text-decoration:none;color:inherit href=#code-df837a3-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-df837a3-5><a style=outline:none;text-decoration:none;color:inherit href=#code-df837a3-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>gpg: skipped &#34;Sam Stelfox &lt;sstelfox@bedroomprogrammers.net&gt;&#34;: Unusable secret
</span></span><span style=display:flex><span>key
</span></span><span style=display:flex><span>gpg: signing failed: Unusable secret key
</span></span><span style=display:flex><span>error: gpg failed to sign the data
</span></span><span style=display:flex><span>fatal: failed to write commit object</span></span></code></pre></td></tr></table></div></div><p>There is a second Yubikey I use on occasion that contains my companies software signing key. When reviewing my available secret keys, it seemed like GPG was listing those private keys as available when they weren&rsquo;t. That was a red herring and unrelated (though still likely a bug). After resetting my GPG config as well as the agent, and re-importing my key the private keys were not be listed at all.</p><p>Ultimate the issue was that all of my subkeys were expired and only became visible when I used the following command:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-1><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-2><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-3><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-4><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-5><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-6><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-7><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-8><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-9><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-10><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-11><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-093fd40-12><a style=outline:none;text-decoration:none;color:inherit href=#code-093fd40-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8b949e>$</span> gpg2 --list-options show-unusable-subkeys --list-keys
</span></span><span style=display:flex><span><span style=color:#8b949e>/home/sstelfox/.gnupg/pubring.kbx
</span></span></span><span style=display:flex><span><span style=color:#8b949e>---------------------------------
</span></span></span><span style=display:flex><span><span style=color:#8b949e>pub   rsa4096/0x30856D4EA0FFBA8F 2016-04-26 [C] [expires: 2019-12-01]
</span></span></span><span style=display:flex><span><span style=color:#8b949e>      Key fingerprint = DC75 C8B8 7434 4360 FB30  3FC9 3085 6D4E A0FF BA8F
</span></span></span><span style=display:flex><span><span style=color:#8b949e>uid                   [ unknown] Sam Stelfox &lt;sstelfox@bedroomprogrammers.net&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e>uid                   [ unknown] Sam Stelfox &lt;sam@stelfox.net&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e>uid                   [ unknown] Sam Stelfox &lt;sam@pwnieexpress.com&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e>uid                   [ unknown] [jpeg image of size 2803]
</span></span></span><span style=display:flex><span><span style=color:#8b949e>sub   rsa2048/0x5E2FD479ABDD395A 2016-04-26 [S] [expired: 2017-12-01]
</span></span></span><span style=display:flex><span><span style=color:#8b949e>sub   rsa2048/0xD87BD950C29A0FA2 2016-04-26 [E] [expired: 2017-12-01]
</span></span></span><span style=display:flex><span><span style=color:#8b949e>sub   rsa2048/0x4B218A4FB733A150 2016-04-26 [A] [expired: 2017-12-01]
</span></span></span></code></pre></td></tr></table></div></div></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/gpg/>gpg</a></span>
<span class=tag><a href=https://stelfox.net/tags/security/>security</a></span>
<span class=tag><a href=https://stelfox.net/tags/tips/>tips</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>