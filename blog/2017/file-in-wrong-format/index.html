<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2017&#x2F;file-in-wrong-format&#x2F;">File in Wrong Format</a></h1>

  <div class="post-content"><p>I have been recently attempting to cross compile a custom Gentoo profile
targetting a Xilinx board as I found their distribution to be unmanageable
(PetaLinux as hacked together sub-distro of Yocto). I had several issues with
the default profile (embedded) conflicting with other critical packages. I'll
do a detailed post later on for building that entire root filesystem.</p>
<span id="continue-reading"></span>
<p>I came across one issue which didn't seem to have a well-documented solution.
While compiling several packages (most notably <a href="https://gmplib.org/">GMP</a> which is required for a
native GCC) I kept coming across a linker issue late in the compilation:</p>
<pre><code>libtool: link: g++ ...<snip>..../.libs/libgmp.so: error adding symbols: File in wrong format
</code></pre>
<p>Since it got so late in the compilation (this is pretty much the last link) I
assumed it was an issue with the linker itself. Digging through the ebuilds,
and wrappers around the developer environment I couldn't find anything suspect.</p>
<p>Ultimate I went back and read through the entire build log where I found this
in the configure output:</p>
<pre><code>checking for arm-xilinx-linux-gnueabi-g++... no
checking for arm-xilinx-linux-gnueabi-c++... no
checking for arm-xilinx-linux-gnueabi-gpp... no
checking for arm-xilinx-linux-gnueabi-aCC... no
checking for arm-xilinx-linux-gnueabi-CC... no
checking for arm-xilinx-linux-gnueabi-cxx... no
checking for arm-xilinx-linux-gnueabi-cc++... no
checking for arm-xilinx-linux-gnueabi-cl.exe... no
checking for arm-xilinx-linux-gnueabi-FCC... no
checking for arm-xilinx-linux-gnueabi-KCC... no
checking for arm-xilinx-linux-gnueabi-RCC... no
checking for arm-xilinx-linux-gnueabi-xlC_r... no
checking for arm-xilinx-linux-gnueabi-xlC... no
checking for g++... g++
configure.wrapped: WARNING: using cross tools not prefixed with host triplet
</code></pre>
<p>The configure script was unable to find a native g++ compiler for my target
environment and thus fell back on to the system's native compiler... which is
not compatible with my binaries. I had only performed a stage 3 crossdev setup.
Stage 4 is when a C++ compiler and libstdc++ becomes available. I was able to
upgrade my crossdev environment in Gentoo using the following command:</p>
<pre><code>crossdev --stable -s4 -v -t arm-xilinx-linux-gnueabi
</code></pre>
<p>You will likely want to replace my system triple with your target.</p>
</div><p class="meta">Posted on <span class="postdate">2017-11-13</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
