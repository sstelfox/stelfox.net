<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='I recently came across a short article written about a decade ago. It was a curious thing already as it was hosted in a user&#39;s home directory off a web server with the standard &lsquo;~&rsquo; showing up in the URL. The important part that caught my eye was this:
 The &ldquo;true&rdquo; program does nothing; it merely exits with a zero exit status. This can be done with an empty file that&#39;s marked executable, and that&#39;s what it was in the earliest unix system libraries.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='The Case of an Empty Executable • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='I recently came across a short article written about a decade ago. It was a curious thing already as it was hosted in a user&#39;s home directory off a web server with the standard &lsquo;~&rsquo; showing up in the URL. The important part that caught my eye was this:
 The &ldquo;true&rdquo; program does nothing; it merely exits with a zero exit status. This can be done with an empty file that&#39;s marked executable, and that&#39;s what it was in the earliest unix system libraries.'>
<meta property='og:url' content='https://stelfox.net/blog/2017/10/the-case-of-an-empty-executable/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='linux'><meta property='article:published_time' content='2017-10-12T23:09:01-04:00'/><meta property='article:modified_time' content='2017-10-12T23:09:01-04:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>The Case of an Empty Executable • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2017/10/the-case-of-an-empty-executable/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>The Case of an Empty Executable</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-10-12T23:09:01-04:00'>2017, Oct 12</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>I recently came across a <a href="http://trillian.mit.edu/~jc/humor/ATT_Copyright_true.html">short article</a> written about a decade ago. It was
a curious thing already as it was hosted in a user's home directory off a
web server with the standard &lsquo;~<!-- raw HTML omitted -->&rsquo; showing up in the URL. The important
part that caught my eye was this:</p>
<blockquote>
<p>The &ldquo;true&rdquo; program does nothing; it merely exits with a zero exit status.
This can be done with an empty file that's marked executable, and that's what
it was in the earliest unix system libraries.</p>
</blockquote>
<p>Being a curious sort, and presented with an old mystery, I had to try out this
little tidbit of information:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ echo -n &gt; test
$ chmod +x test
$ ./test
$ echo $?
<span style="color:#ae81ff">0</span>
</code></pre></div><p>Sure enough, an empty file can be successfully run. It obviously doesn't have a
known binary header, so it won't be interpretted as a valid executable on it's
own. Even scripts rely on the shebang header (<code>#!</code>) to be considered valid by
the kernel, so something else has to be executing this. We can confirm the
kernel isn't recognizing this by abusing <code>strace</code> into calling an explicit
execve on the file:</p>
<pre><code>$ strace ./test
execve(&quot;./test&quot;, [&quot;./test&quot;], 0x7ffe74e0a720 /* 70 vars */) = -1 ENOEXEC (Exec format error)
fstat(2, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 3), ...}) = 0
write(2, &quot;strace: exec: Exec format error\n&quot;, 32strace: exec: Exec format error
) = 32
getpid()                                = 24047
exit_group(1)                           = ?
+++ exited with 1 +++
</code></pre><p>This is exactly what I was expecting and the <a href="https://github.com/torvalds/linux/blob/c2315c187fa0d3ab363fdebe22718170b40473e3/fs/binfmt_script.c#L24">Kernel source</a> reflects
exactly what I'd expect. I'll leave it up to you test the results on an empty
but otherwise valid shell script. With the kernel cleared of any odd behavior I
was left with only one suspect. A little shell by the name of bash.</p>
<p>Bash is a coy devil with several different mechanisms built-in to execute a
program. Likely one of these culprits are being used behind the scenes when we
run a program. A quick trip the <a href="https://www.gnu.org/software/bash/manual/bash.txt">man page</a> and a late night cup of coffee
narrowed down my search to the following functions:</p>
<ul>
<li>command</li>
<li>eval</li>
<li>exec</li>
</ul>
<p>I decided it was time to talk to each of them one by one and see what was up.
Putting them under the bright light I was surprised that they all were telling
the same story:</p>
<pre><code>$ command ./test
$ echo $?
0
$ eval ./test
$ echo $?
0
$ exec ./test
-bash: /home/playground/test: Success
</code></pre><p>How sinister! Someone had gotten to them first, I have to go higher into their
organization. This calls for&hellip; The Source. I quickly traverse into the builtin
directory and identify the commonality <code>parse_and_execute</code>. This is where it
gets a little fuzzy as bash is a rather complicated code base and I didn't want
to spend to much time on this in the middle of the night.</p>
<p>After parsing the file, it does seem to treat it as a script (as expected).
There are two possibilities here and I didn't trace down which was true. Either
<code>parse_and_execute</code> is simply returning with a success or it is sending the
contents to <code>execute_command_internal</code>, which in turn defaults to a
successfully return value.</p>
<p>The motive remains unclear, but no harm seems to be getting done so I'm going
to call this one case closed. It'd be interesting to see how other shells
behave with empty files.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2016/09/hash-cash/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Hash Cash</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2017/10/a-krack-in-the-defenses/'>
        <span class='screen-reader-text'>Next post: </span>A KRACK In the Defenses<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox | <!-- raw HTML omitted -->Licensing<!-- raw HTML omitted --></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script>

</body>

</html>

