<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I recently came across a short article written about a decade ago. It was a curious thing already as it was hosted in a user's home directory off a web server with the standard ~&amp;lt;username&amp;gt; showing up in the URL. The important part that caught my eye was this:
The &amp;quot;true&amp;quot; program does nothing; it merely exits with a zero exit status. This can be done with an empty file that's marked executable, and that's what it was in the earliest unix system libraries."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2017/10/the-case-of-an-empty-executable/><title>The Case of an Empty Executable :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="The Case of an Empty Executable"><meta itemprop=description content="I recently came across a short article written about a decade ago. It was a curious thing already as it was hosted in a user's home directory off a web server with the standard ~<username> showing up in the URL. The important part that caught my eye was this:
The &#34;true&#34; program does nothing; it merely exits with a zero exit status. This can be done with an empty file that's marked executable, and that's what it was in the earliest unix system libraries."><meta itemprop=datePublished content="2017-10-12T23:09:01-04:00"><meta itemprop=dateModified content="2017-10-12T23:09:01-04:00"><meta itemprop=wordCount content="577"><meta itemprop=keywords content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="The Case of an Empty Executable"><meta name=twitter:description content="I recently came across a short article written about a decade ago. It was a curious thing already as it was hosted in a user's home directory off a web server with the standard ~<username> showing up in the URL. The important part that caught my eye was this:
The &#34;true&#34; program does nothing; it merely exits with a zero exit status. This can be done with an empty file that's marked executable, and that's what it was in the earliest unix system libraries."><meta property="article:published_time" content="2017-10-12 23:09:01 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2017/10/the-case-of-an-empty-executable/>The Case of an Empty Executable</a></h2><div class=post-content><p>I recently came across a <a href=http://trillian.mit.edu/~jc/humor/ATT_Copyright_true.html>short article</a> written about a decade ago. It was a curious thing already as it was hosted in a user's home directory off a web server with the standard <code>~&lt;username></code> showing up in the URL. The important part that caught my eye was this:</p><blockquote><p>The "true" program does nothing; it merely exits with a zero exit status. This can be done with an empty file that's marked executable, and that's what it was in the earliest unix system libraries.</p></blockquote><p>Being a curious sort, and presented with an old mystery, I had to try out this little tidbit of information:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> -n &gt; <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> chmod +x <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> ./test
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl><span class=go>0
</span></span></span></code></pre></td></tr></table></div></div><p>Sure enough, an empty file can be successfully run. It obviously doesn't have a known binary header, so it won't be interpreted as a valid executable on it's own. Even scripts rely on the shebang header ("#!") to be considered valid by the kernel, so something else has to be executing this. We can confirm the kernel isn't recognizing this by abusing "strace" into calling an explicit execve on the file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> strace ./test
</span></span><span class=line><span class=cl><span class=go>execve(&#34;./test&#34;, [&#34;./test&#34;], 0x7ffe74e0a720 /* 70 vars */) = -1 ENOEXEC (Exec format error)
</span></span></span><span class=line><span class=cl><span class=go>fstat(2, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 3), ...}) = 0
</span></span></span><span class=line><span class=cl><span class=go>write(2, &#34;strace: exec: Exec format error\n&#34;, 32strace: exec: Exec format error
</span></span></span><span class=line><span class=cl><span class=go>) = 32
</span></span></span><span class=line><span class=cl><span class=go>getpid()                                = 24047
</span></span></span><span class=line><span class=cl><span class=go>exit_group(1)                           = ?
</span></span></span><span class=line><span class=cl><span class=go>+++ exited with 1 +++
</span></span></span></code></pre></td></tr></table></div></div><p>This is exactly what I was expecting and the <a href=https://github.com/torvalds/linux/blob/c2315c187fa0d3ab363fdebe22718170b40473e3/fs/binfmt_script.c#L24>Kernel source</a> reflects exactly what I'd expect. I'll leave it up to you test the results on an empty but otherwise valid shell script. With the kernel cleared of any odd behavior I was left with only one suspect. A little shell by the name of bash.</p><p>Bash is a coy devil with several different mechanisms built-in to execute a program. Likely one of these culprits are being used behind the scenes when we run a program. A quick trip the <a href=https://www.gnu.org/software/bash/manual/bash.txt>man page</a> and a late night cup of coffee narrowed down my search to the following functions:</p><ul><li>command</li><li>eval</li><li>exec</li></ul><p>I decided it was time to talk to each of them one by one and see what was up. Putting them under the bright light I was surprised that they all were telling the same story:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7>7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>command</span> ./test
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl><span class=go>0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> <span class=nb>eval</span> ./test
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl><span class=go>0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> <span class=nb>exec</span> ./test
</span></span><span class=line><span class=cl><span class=go>-bash: /home/playground/test: Success
</span></span></span></code></pre></td></tr></table></div></div><p>How sinister! Someone had gotten to them first, I have to go higher into their organization. This calls for... The Source. I quickly traverse into the builtin directory and identify the commonality "parse_and_execute". This is where it gets a little fuzzy as bash is a rather complicated code base and I didn't want to spend to much time on this in the middle of the night.</p><p>After parsing the file, it does seem to treat it as a script (as expected). There are two possibilities here and I didn't trace down which was true. Either "parse_and_execute" is simply returning with a success or it is sending the contents to "execute_command_internal", which in turn defaults to a successfully return value.</p><p>The motive remains unclear, but no harm seems to be getting done so I'm going to call this one case closed. It'd be interesting to see how other shells behave with empty files.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>