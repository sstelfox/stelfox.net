<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2017&#x2F;linux-audit-rule-paths&#x2F;">Linux Audit Rule Paths</a></h1>

  <div class="post-content"><p>I encountered a little bit of confusion while rewriting my <a href="https://stelfox.net/notes/auditd/">auditd rules</a>
which some Googling did not help me solve.</p>
<span id="continue-reading"></span>
<p>When monitoring a file or directory there are two forms the rules can take.
They are effectively equivalent in their functionality. The simpler form is the
following format:</p>
<pre><code>-w /etc/shadow -p wa
-w /boot -p wa
-w /etc/dont_readme -p r
</code></pre>
<p>These three rules are all behaving slightly differently. The first will audit
any writes or attribute changes to the shadow file. The second, being a
directory, will be recursively watched for writes and attribute changes
(including the directory itself). The last line will create an audit record
whenever the file is read.</p>
<p>The second form is more consistent with the syscall rule types but more
verbose. Examples are given in the man page for converting between the two
forms. Before I show you an example of those rules, this is the part of the man
page that ultimately confused me:</p>
<blockquote>
<p>If you place a watch on a file, its the same as using the -F path option on a
syscall rule.</p>
</blockquote>
<p>Simple enough, this is what the first line of the first example would look like
in this style:</p>
<pre><code>-a always,exit -F path=/etc/shadow -F perm=wa
</code></pre>
<p>Before changing my rules over to this form I checked a couple to ensure they
were behaving correctly then migrated the rest. After applying the new rules I
found quite a few audit records I'd expect missing. If I had kept reading (the
next line from the last man page) I would have found this:</p>
<blockquote>
<p>If you place a watch on a directory, its the same as using the -F dir option
on a syscall rule.</p>
</blockquote>
<p>So the correct way to represent the second line in the first example would be
like this:</p>
<pre><code>-a always,exit -F dir=/boot -F perm=wa
</code></pre>
<p>The long and short of it, is that the watch flag (<code>-w</code>) has different behaviors
depending on what it is pointing at. Having only read the first sentence, I
assumed the <code>path=</code> argument would behave the same as a watch. Attempts to
Google whether or not <code>path=</code> was recursive didn't turn up anything. Now that
I've read the man page while writing up this point it is very clearly stated
that it is not.</p>
<p>If anyone else comes across this, <code>path=</code> is not recursive, <code>dir=</code> is. Be
careful when translating your rules.</p>
</div><p class="meta">Posted on <span class="postdate">2017-10-16</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
