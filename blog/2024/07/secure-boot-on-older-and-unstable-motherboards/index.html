<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Recently I found my desktop motherboard was vulnerable booting malicious payloads due to the use of a developer reference key in production firmware. I have a Gigabyte Aorus X570 Elite motherboard which is known to have a rather problematic UEFI BIOS.
Turning secure boot on, without the Microsoft keys present, would prevent any graphical output. The system was booting behind the scenes and I could SSH into it, only graphical output was affected."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,hardware,linux,secure-boot,security"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2024/07/secure-boot-on-older-and-unstable-motherboards/><title>Secure Boot on Older and Unstable Motherboards :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Secure Boot on Older and Unstable Motherboards"><meta itemprop=description content="Recently I found my desktop motherboard was vulnerable booting malicious payloads due to the use of a developer reference key in production firmware. I have a Gigabyte Aorus X570 Elite motherboard which is known to have a rather problematic UEFI BIOS.
Turning secure boot on, without the Microsoft keys present, would prevent any graphical output. The system was booting behind the scenes and I could SSH into it, only graphical output was affected."><meta itemprop=datePublished content="2024-07-26T15:27:46-04:00"><meta itemprop=dateModified content="2024-07-26T15:27:46-04:00"><meta itemprop=wordCount content="405"><meta itemprop=keywords content="Hardware,Linux,Secure-Boot,Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="Secure Boot on Older and Unstable Motherboards"><meta name=twitter:description content="Recently I found my desktop motherboard was vulnerable booting malicious payloads due to the use of a developer reference key in production firmware. I have a Gigabyte Aorus X570 Elite motherboard which is known to have a rather problematic UEFI BIOS.
Turning secure boot on, without the Microsoft keys present, would prevent any graphical output. The system was booting behind the scenes and I could SSH into it, only graphical output was affected."><meta property="article:published_time" content="2024-07-26 15:27:46 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2024/07/secure-boot-on-older-and-unstable-motherboards/>Secure Boot on Older and Unstable Motherboards</a></h2><div class=post-content><p>Recently I found my desktop motherboard was vulnerable booting malicious payloads due to <a href=https://www.tomshardware.com/software/security-software/secure-boot-key-compromised-in-2022-is-still-in-use-in-over-200-models>the use of a developer reference key in production firmware</a>. I have a Gigabyte Aorus X570 Elite motherboard which is known to have a rather problematic UEFI BIOS.</p><p>Turning secure boot on, without the Microsoft keys present, would prevent any graphical output. The system was booting behind the scenes and I could SSH into it, only graphical output was affected. This is something that has been on my todo list for a while and was low priority enough I never got around to resolving it. This fresh news article gave me the drive to solve it.</p><p>If you have the same motherboard, you can recover from this issue by resetting the BIOS CMOS settings. You do have to physically remove the inconveniently located battery, as the jumper was ineffective. You also have to fully switch off or unplug your power supply during the removal.</p><p>Once reset you need to disable the legacy boot (called CSM support) to allow secure boot to be turned on, enable the secure boot setup mode, turn on the fTPM device (explained later) and boot back into Linux. I already had my kernel images signed with a custom key I just needed to enroll it.</p><p>Now we get to the troublesome part. The issue is ultimately that some internal firmware blob is signed with the Microsoft 3rd party UEFI key. This isn't something you have access to or can sign independently. Microsoft has not had a great track record of security, and this particular key has signed many keys that are known to be compromised including this latest one.</p><p>As of last year, the <code>sbsign</code> utility has had the ability to harvest firmware payload identities using built-in TPM devices via its generated event log. You can enroll your custom key, and include signatures for the firmware on the board using the following command as root:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>#</span> sbctl enroll-keys --tpm-event-log --yes-this-might-brick-my-machine
</span></span></code></pre></td></tr></table></div></div><p>That scary CLI flag is no joke. If you can't reset the BIOS that might permanently brick your machine. On these motherboards, since we can reset the BIOS, its not that risky but your mileage may vary. I imagine this works for other motherboards that experience this kind of issue as well. I'm not sure when the option was added but it worked like a charm and I have a slightly more secure system thanks to it.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/hardware/>hardware</a></span>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/secure-boot/>secure-boot</a></span>
<span class=tag><a href=https://stelfox.net/tags/security/>security</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=30d8a39de343b939ef33cc09d6cb4f7b125c5e5c target=_blank rel=noopener>30d8a39d</a> @ 2024-07-26</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>