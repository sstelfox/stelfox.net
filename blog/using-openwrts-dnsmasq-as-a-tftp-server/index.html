<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I recently reflashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&amp;rsquo;t starting.
Looking into the logread output I finally saw that this was due too a permission issue. Combining this with the output of ps too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&amp;rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration."><meta name=keywords content=",linux"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/using-openwrts-dnsmasq-as-a-tftp-server/><title>Using OpenWRT's Dnsmasq as a TFTP Server :: Sam Stelfox
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta itemprop=description content="I recently reflashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&rsquo;t starting.
Looking into the logread output I finally saw that this was due too a permission issue. Combining this with the output of ps too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration."><meta itemprop=datePublished content="2014-07-01T21:26:45-04:00"><meta itemprop=dateModified content="2014-07-01T21:26:45-04:00"><meta itemprop=wordCount content="265"><meta itemprop=keywords content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta name=twitter:description content="I recently reflashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&rsquo;t starting.
Looking into the logread output I finally saw that this was due too a permission issue. Combining this with the output of ps too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration."><meta property="article:published_time" content="2014-07-01 21:26:45 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/blog/>Blog Posts</a></li><li><a href=/notes/>Various Notes</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/using-openwrts-dnsmasq-as-a-tftp-server/>Using OpenWRT&rsquo;s Dnsmasq as a TFTP Server</a></h2><div class=post-content><p>I recently reflashed my primary router to a newer version of OpenWRT and
attempted to follow <a href=/blog/using-dnsmasq-as-a-standalone-tftp-server/>my own directions</a> written in an earlier blog post to
add PXE booting to my local network using the dnsmasq service built in. After
following my advice I found that the dnsmasq service wasn&rsquo;t starting.</p><p>Looking into the <code>logread</code> output I finally saw that this was due too a
permission issue. Combining this with the output of <code>ps</code> too identify the user
that dnsmasq was running on I was able to both modify my instructions and use
OpenWRT&rsquo;s own configuration system to perform the configuration instead of
modifying the dnsmasq configuration.</p><p>First was solving the permissions issue. I created a dedicated directory at
<code>/var/tftp</code> and changed the ownership to &rsquo;nobody&rsquo; and &rsquo;nogroup&rsquo; and mode too
&lsquo;0755&rsquo;.</p><p>Previously I used <code>/var/lib/tftp</code>, however, the default permissions on the
<code>/var/lib</code> directory is too restrictive and I didn&rsquo;t want to reduce the rest of
that directories security posture simply too allow directory traversal.</p><p>Next up was getting the TFTP portion of dnsmasq configured and running. Open up
<code>/etc/config/dhcp</code> and under the <code>dnsmasq</code> section add the following lines (or
if these lines already exist adjust the values to match).</p><pre tabindex=0><code>option enable_tftp &#39;1&#39;
option tftp_root &#39;/var/tftp&#39;
option dhcp_boot &#39;pxelinux.0&#39;
</code></pre><p>Run <code>uci commit dhcp</code> too commit the changes and finally <code>/etc/init.d/dnsmasq restart</code> To apply the changes. You&rsquo;ll want too put the <code>pxelinux.0</code> and
associated configuration files into the <code>/var/tftp</code> directory too complete the
PXE booting configuration.</p><p>I&rsquo;ll probably write a blog post covering my PXE setup and configuration if I
don&rsquo;t get distracted by other projects.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span></p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>