<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="While working through a problem I found it would be immensely useful to be able to enumerate all of the current subclasses of a particular class. After thinking about this for a while I settled on a good old friend of mine, ObjectSpace.
For those not familiar with the ObjectSpace module, it is a means to inspect and access the items being tracked by Ruby's garbage collector. This means it has a hook into every living object, and more dangerously, every near-death object."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,ruby,tips"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2014/02/finding-ruby-subclasses/><title>Finding Ruby Subclasses :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Finding Ruby Subclasses"><meta itemprop=description content="While working through a problem I found it would be immensely useful to be able to enumerate all of the current subclasses of a particular class. After thinking about this for a while I settled on a good old friend of mine, ObjectSpace.
For those not familiar with the ObjectSpace module, it is a means to inspect and access the items being tracked by Ruby's garbage collector. This means it has a hook into every living object, and more dangerously, every near-death object."><meta itemprop=datePublished content="2014-02-20T07:48:24-05:00"><meta itemprop=dateModified content="2014-02-20T07:48:24-05:00"><meta itemprop=wordCount content="394"><meta itemprop=keywords content="Ruby,Tips"><meta name=twitter:card content="summary"><meta name=twitter:title content="Finding Ruby Subclasses"><meta name=twitter:description content="While working through a problem I found it would be immensely useful to be able to enumerate all of the current subclasses of a particular class. After thinking about this for a while I settled on a good old friend of mine, ObjectSpace.
For those not familiar with the ObjectSpace module, it is a means to inspect and access the items being tracked by Ruby's garbage collector. This means it has a hook into every living object, and more dangerously, every near-death object."><meta property="article:published_time" content="2014-02-20 07:48:24 -0500 EST"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2014/02/finding-ruby-subclasses/>Finding Ruby Subclasses</a></h2><div class=post-content><p>While working through a problem I found it would be immensely useful to be able
to enumerate all of the current subclasses of a particular class. After
thinking about this for a while I settled on a good old friend of mine,
<code>ObjectSpace</code>.</p><p>For those not familiar with the <code>ObjectSpace</code> module, it is a means to inspect
and access the items being tracked by Ruby's garbage collector. This means it
has a hook into every living object, and more dangerously, every near-death
object.</p><p><code>ObjectSpace</code> provides a method for enumerating instances of a specific class,
specifically named <code>each_object</code> which takes a class. With Ruby all classes are
in fact instances of the <code>Class</code> class. This allows us to enumerate every
available class by passing it to the enumerator like so:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>ObjectSpace</span><span class=o>.</span><span class=n>each_object</span><span class=p>(</span><span class=no>Class</span><span class=p>)</span><span class=o>.</span><span class=n>to_a</span>
</span></span></code></pre></td></tr></table></div></div><p>Alright so we now have an array of every single class that could possibly be
instantiated, how do we narrow it down to just the ones we're interested in?
Once again Ruby provides with the <code>ancestors</code> method, combine that with a
select and we can quickly narrow it down. You can see it in the following
example:</p><pre tabindex=0><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k.ancestors.include?(String) }
=&gt; [String, TargetSubclass]
</code></pre><p>Hmm, that's not quite right though. We have found all the subclasses but we've
also grabbed the parent class. With one small modification we eliminate that as
well.</p><pre tabindex=0><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k.ancestors.include?(String) &amp;&amp; k != String }
=&gt; [TargetSubclass]
</code></pre><p>That line is rather long though, and I generally like to avoid multiple tests
in a select block. There is a tad bit of syntactic sugar provided by Ruby
allowing us to accomplish the same thing, our final example is ultimately the
solution I went with:</p><pre tabindex=0><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k &lt; String }
=&gt; [TargetSubclass]
</code></pre><p>Putting this into a method:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>def</span> <span class=nf>subclasses</span><span class=p>(</span><span class=n>klass</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=no>ObjectSpace</span><span class=o>.</span><span class=n>each_object</span><span class=p>(</span><span class=no>Class</span><span class=p>)</span><span class=o>.</span><span class=n>select</span> <span class=p>{</span> <span class=o>|</span><span class=n>k</span><span class=o>|</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>klass</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>If you were so inclined you could extend the <code>Class</code> class with a method to
make this available anywhere like so:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>Class</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nc>self</span><span class=o>.</span><span class=nf>subclasses</span>
</span></span><span class=line><span class=cl>    <span class=no>ObjectSpace</span><span class=o>.</span><span class=n>each_object</span><span class=p>(</span><span class=no>Class</span><span class=p>)</span><span class=o>.</span><span class=n>select</span> <span class=p>{</span> <span class=o>|</span><span class=n>k</span><span class=o>|</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=nb>self</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>I'm personally not a fan of extending any of the core classes unless absolutely
necessary, but too each there own.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/ruby/>ruby</a></span>
<span class=tag><a href=https://stelfox.net/tags/tips/>tips</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>