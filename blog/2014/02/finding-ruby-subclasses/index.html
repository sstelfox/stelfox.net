<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='While working through a problem I found it would be immensely useful to be able to enumerate all of the current subclasses of a particular class. After thinking about this for a while I settled on a good old friend of mine, ObjectSpace.
For those not familiar with the ObjectSpace module, it is a means to inspect and access the items being tracked by Ruby&#39;s garbage collector. This means it has a hook into every living object, and more dangerously, every near-death object.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Finding Ruby Subclasses • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='While working through a problem I found it would be immensely useful to be able to enumerate all of the current subclasses of a particular class. After thinking about this for a while I settled on a good old friend of mine, ObjectSpace.
For those not familiar with the ObjectSpace module, it is a means to inspect and access the items being tracked by Ruby&#39;s garbage collector. This means it has a hook into every living object, and more dangerously, every near-death object.'>
<meta property='og:url' content='https://stelfox.net/blog/2014/02/finding-ruby-subclasses/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='ruby'><meta property='article:tag' content='tips'><meta property='article:published_time' content='2014-02-20T07:48:24-05:00'/><meta property='article:modified_time' content='2014-02-20T07:48:24-05:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>Finding Ruby Subclasses • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2014/02/finding-ruby-subclasses/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Finding Ruby Subclasses</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2014-02-20T07:48:24-05:00'>2014, Feb 20</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>While working through a problem I found it would be immensely useful to be able
to enumerate all of the current subclasses of a particular class. After
thinking about this for a while I settled on a good old friend of mine,
<code>ObjectSpace</code>.</p>
<p>For those not familiar with the <code>ObjectSpace</code> module, it is a means to inspect
and access the items being tracked by Ruby's garbage collector. This means it
has a hook into every living object, and more dangerously, every near-death
object.</p>
<p><code>ObjectSpace</code> provides a method for enumerating instances of a specific class,
specifically named <code>each_object</code> which takes a class. With Ruby all classes are
in fact instances of the <code>Class</code> class. This allows us to enumerate every
available class by passing it to the enumerator like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">ObjectSpace</span><span style="color:#f92672">.</span>each_object(<span style="color:#66d9ef">Class</span>)<span style="color:#f92672">.</span>to_a
</code></pre></div><p>Alright so we now have an array of every single class that could possibly be
instantiated, how do we narrow it down to just the ones we're interested in?
Once again Ruby provides with the <code>ancestors</code> method, combine that with a
select and we can quickly narrow it down. You can see it in the following
example:</p>
<pre><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k.ancestors.include?(String) }
=&gt; [String, TargetSubclass]
</code></pre><p>Hmm, that's not quite right though. We have found all the subclasses but we've
also grabbed the parent class. With one small modification we eliminate that as
well.</p>
<pre><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k.ancestors.include?(String) &amp;&amp; k != String }
=&gt; [TargetSubclass]
</code></pre><p>That line is rather long though, and I generally like to avoid multiple tests
in a select block. There is a tad bit of syntactic sugar provided by Ruby
allowing us to accomplish the same thing, our final example is ultimately the
solution I went with:</p>
<pre><code>[1] pry(main)&gt; TargetSubclass = Class.new(String)
=&gt; TargetSubclass
[2] pry(main)&gt; ObjectSpace.each_object(Class).select { |k| k &lt; String }
=&gt; [TargetSubclass]
</code></pre><p>Putting this into a method:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e"></span><span style="color:#f92672"></span><span style="color:#a6e22e">subclasses</span>(klass)
  <span style="color:#66d9ef">ObjectSpace</span><span style="color:#f92672">.</span>each_object(<span style="color:#66d9ef">Class</span>)<span style="color:#f92672">.</span>select { <span style="color:#f92672">|</span>k<span style="color:#f92672">|</span> k <span style="color:#f92672">&lt;</span> klass }
<span style="color:#66d9ef">end</span>
</code></pre></div><p>If you were so inclined you could extend the <code>Class</code> class with a method to
make this available anywhere like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Class</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">subclasses</span>
    <span style="color:#66d9ef">ObjectSpace</span><span style="color:#f92672">.</span>each_object(<span style="color:#66d9ef">Class</span>)<span style="color:#f92672">.</span>select { <span style="color:#f92672">|</span>k<span style="color:#f92672">|</span> k <span style="color:#f92672">&lt;</span> self }
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>I'm personally not a fan of extending any of the core classes unless absolutely
necessary, but too each there own.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/ruby/'>ruby</a>, <a class='tag' href='/tags/tips/'>tips</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2014/02/creating-crypt-style-sha512-passwords-with-ruby/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Creating Crypt Style SHA512 Passwords With Ruby</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2014/03/preventing-tmux-lockups/'>
        <span class='screen-reader-text'>Next post: </span>Preventing Tmux Lockups<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox | <!-- raw HTML omitted -->Licensing<!-- raw HTML omitted --></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script>

</body>

</html>

