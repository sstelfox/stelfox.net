<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I've been told handles this pretty well, but I don't yet trust its security model and it doesn't prevent the same thing from happening locally."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2014/03/preventing-tmux-lockups/><title>Preventing Tmux Lockups :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Preventing Tmux Lockups"><meta itemprop=description content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I've been told handles this pretty well, but I don't yet trust its security model and it doesn't prevent the same thing from happening locally."><meta itemprop=datePublished content="2014-03-28T12:56:12-04:00"><meta itemprop=dateModified content="2014-03-28T12:56:12-04:00"><meta itemprop=wordCount content="471"><meta itemprop=keywords content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Preventing Tmux Lockups"><meta name=twitter:description content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I've been told handles this pretty well, but I don't yet trust its security model and it doesn't prevent the same thing from happening locally."><meta property="article:published_time" content="2014-03-28 12:56:12 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2014/03/preventing-tmux-lockups/>Preventing Tmux Lockups</a></h2><div class=post-content><p>Anyone that has used SSH, Tmux or Screen for a while will have inevitably
dumped excessive output to their terminal. Depending on the size of the output
you may have experienced the dreaded lockup. That horrible realization seconds
after you hit the command where signals just stop working and you just have to
sit there and wait for your terminal to catch up.</p><p>There is a piece of remote connection software called Mosh that I've been told
handles this pretty well, but I don't yet trust its security model and it
doesn't prevent the same thing from happening locally.</p><p>This is especially bad if you're working in a multi-pane tmux window as it's
locks up all the terminals in the same window, and prevents you from changing
to the other windows.</p><p>I've had this issue happen to me one too many times but never thought of
looking for a solution until a friend of mine, <a href=http://gabekoss.com/>Gabe Koss</a>, made a passing
comment along the lines of "Too bad tmux can't rate limit the output of a
terminal".</p><p>A quick search through the doc and two relatively recent configuration options
popped out doing exactly what I was looking for (c0-change-internal, and
c0-change-trigger). Googling around for good values, left me wanting. A lot of
people were recommending setting the values to 100 and 250 respectively; These
are the defaults and since I still experience the issue are clearly not working
for me.</p><p>To set the variables to something more reasonable I had to understand what they
were doing. A 'C0' sequence is one that modifies the screen beyond a normal
character sequence, think newlines, carriage returns, backspaces. According to
the tmux man page, the trigger will catch if the number of c0 sequences per
<strong>millisecond</strong> exceeds the number in the configuration file, at which point it
will start displaying an update once every interval number of milliseconds.</p><p>I can't see faster than my eye's refresh rate so that seems like a decent
starting point. According to <a href=http://en.wikipedia.org/wiki/Frame_rate>Wikipedia</a> the human eye/brain interface can
process 10-12 images per second but we can notice 'choppiness' below 48 FPS.
Since I won't be reading anything flying by that fast I settled on a maximum
rate of 10 FPS updated in my shell, or an interval of '100ms'.</p><p>For the trigger I was significantly less scientific, I dropped the trigger by
50, reloaded my tmux configuration, <code>cat</code>'d a large file and tested whether I
could immediately kill the process and move between panes. I finally settled on
a value of '75' for the trigger rate. It does make the output seem a little
choppy but it is significantly nicer to not kill my terminal.</p><p>TL;DR Add the following lines to your <code>~/.tmux.conf</code> file and you'll be in a
much better shape:</p><pre tabindex=0><code>setw -g c0-change-interval 50
setw -g c0-change-trigger  75
</code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>