<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&rsquo;ve been told handles this pretty well, but I don&rsquo;t yet trust its security model and it doesn&rsquo;t prevent the same thing from happening locally.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Preventing Tmux Lockups • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&rsquo;ve been told handles this pretty well, but I don&rsquo;t yet trust its security model and it doesn&rsquo;t prevent the same thing from happening locally.'>
<meta property='og:url' content='https://stelfox.net/blog/2014/03/preventing-tmux-lockups/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='linux'><meta property='article:published_time' content='2014-03-28T12:56:12-04:00'/><meta property='article:modified_time' content='2014-03-28T12:56:12-04:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.51-DEV" />

  <title>Preventing Tmux Lockups • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2014/03/preventing-tmux-lockups/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4267b3fa.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>


<body class='page type-blog'>

  <div class='site'>

    <a class='screen-reader-text' href='#content'>Skip to Content</a>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Preventing Tmux Lockups</h1>
      

    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2014-03-28T12:56:12-04:00'>2014, Mar 28</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>Anyone that has used SSH, Tmux or Screen for a while will have inevitably
dumped excessive output to their terminal. Depending on the size of the output
you may have experienced the dreaded lockup. That horrible realization seconds
after you hit the command where signals just stop working and you just have to
sit there and wait for your terminal to catch up.</p>

<p>There is a piece of remote connection software called Mosh that I&rsquo;ve been told
handles this pretty well, but I don&rsquo;t yet trust its security model and it
doesn&rsquo;t prevent the same thing from happening locally.</p>

<p>This is especially bad if you&rsquo;re working in a multi-pane tmux window as it&rsquo;s
locks up all the terminals in the same window, and prevents you from changing
to the other windows.</p>

<p>I&rsquo;ve had this issue happen to me one too many times but never thought of
looking for a solution until a friend of mine, <a href="http://gabekoss.com/">Gabe Koss</a>, made a passing
comment along the lines of &ldquo;Too bad tmux can&rsquo;t rate limit the output of a
terminal&rdquo;.</p>

<p>A quick search through the doc and two relatively recent configuration options
popped out doing exactly what I was looking for (c0-change-internal, and
c0-change-trigger). Googling around for good values, left me wanting. A lot of
people were recommending setting the values to 100 and 250 respectively; These
are the defaults and since I still experience the issue are clearly not working
for me.</p>

<p>To set the variables to something more reasonable I had to understand what they
were doing. A &lsquo;C0&rsquo; sequence is one that modifies the screen beyond a normal
character sequence, think newlines, carriage returns, backspaces. According to
the tmux man page, the trigger will catch if the number of c0 sequences per
<strong>millisecond</strong> exceeds the number in the configuration file, at which point it
will start displaying an update once every interval number of milliseconds.</p>

<p>I can&rsquo;t see faster than my eye&rsquo;s refresh rate so that seems like a decent
starting point. According to <a href="http://en.wikipedia.org/wiki/Frame_rate">Wikipedia</a> the human eye/brain interface can
process 10-12 images per second but we can notice &lsquo;choppiness&rsquo; below 48 FPS.
Since I won&rsquo;t be reading anything flying by that fast I settled on a maximum
rate of 10 FPS updated in my shell, or an interval of &lsquo;100ms&rsquo;.</p>

<p>For the trigger I was significantly less scientific, I dropped the trigger by
50, reloaded my tmux configuration, <code>cat</code>&rsquo;d a large file and tested whether I
could immediately kill the process and move between panes. I finally settled on
a value of &lsquo;75&rsquo; for the trigger rate. It does make the output seem a little
choppy but it is significantly nicer to not kill my terminal.</p>

<p>TL;DR Add the following lines to your <code>~/.tmux.conf</code> file and you&rsquo;ll be in a
much better shape:</p>

<pre><code>setw -g c0-change-interval 50
setw -g c0-change-trigger  75
</code></pre>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2014/02/finding-ruby-subclasses/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Finding Ruby Subclasses</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2014/03/one-liner-ssl-certificate-generation/'>
        <span class='screen-reader-text'>Next post: </span>One-Liner SSL Certificate Generation<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2018 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.59f76c44.js'></script>

</body>

</html>

