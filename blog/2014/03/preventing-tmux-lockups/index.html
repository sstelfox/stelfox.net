<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="sam@stelfox.net Sam Stelfox ">
<meta name="description" content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&amp;rsquo;ve been told handles this pretty well, but I don&amp;rsquo;t yet trust its security model and it doesn&amp;rsquo;t prevent the same thing from happening locally." />
<meta name="keywords" content="blog, programming, linux, systems, personal, linux" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://stelfox.net/blog/2014/03/preventing-tmux-lockups/" />


    <title>
        
            Preventing Tmux Lockups :: Sam Stelfox 
        
    </title>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" referrerpolicy="no-referrer" />



<link rel="stylesheet" href="/main.2a064c455b0ecbd6b1481b3bf9df2441e95838691022f40a5338c2cb1244f075.css" integrity="sha256-KgZMRVsOy9axSBs7&#43;d8kQelYOGkQIvQKUzjCyxJE8HU=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Preventing Tmux Lockups">
<meta itemprop="description" content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&rsquo;ve been told handles this pretty well, but I don&rsquo;t yet trust its security model and it doesn&rsquo;t prevent the same thing from happening locally."><meta itemprop="datePublished" content="2014-03-28T12:56:12-04:00" />
<meta itemprop="dateModified" content="2014-03-28T12:56:12-04:00" />
<meta itemprop="wordCount" content="471">
<meta itemprop="keywords" content="linux," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Preventing Tmux Lockups"/>
<meta name="twitter:description" content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&rsquo;ve been told handles this pretty well, but I don&rsquo;t yet trust its security model and it doesn&rsquo;t prevent the same thing from happening locally."/>



    <meta property="og:title" content="Preventing Tmux Lockups" />
<meta property="og:description" content="Anyone that has used SSH, Tmux or Screen for a while will have inevitably dumped excessive output to their terminal. Depending on the size of the output you may have experienced the dreaded lockup. That horrible realization seconds after you hit the command where signals just stop working and you just have to sit there and wait for your terminal to catch up.
There is a piece of remote connection software called Mosh that I&rsquo;ve been told handles this pretty well, but I don&rsquo;t yet trust its security model and it doesn&rsquo;t prevent the same thing from happening locally." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stelfox.net/blog/2014/03/preventing-tmux-lockups/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2014-03-28T12:56:12-04:00" />
<meta property="article:modified_time" content="2014-03-28T12:56:12-04:00" />






    <meta property="article:published_time" content="2014-03-28 12:56:12 -0400 EDT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                ./Sam_Stelfox.sh</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/blog/">Blog Posts</a></li><li><a href="/notes/">Various Notes</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://stelfox.net/blog/2014/03/preventing-tmux-lockups/">Preventing Tmux Lockups</a></h2>

            
            
            

            <div class="post-content">
                <p>Anyone that has used SSH, Tmux or Screen for a while will have inevitably
dumped excessive output to their terminal. Depending on the size of the output
you may have experienced the dreaded lockup. That horrible realization seconds
after you hit the command where signals just stop working and you just have to
sit there and wait for your terminal to catch up.</p>
<p>There is a piece of remote connection software called Mosh that I&rsquo;ve been told
handles this pretty well, but I don&rsquo;t yet trust its security model and it
doesn&rsquo;t prevent the same thing from happening locally.</p>
<p>This is especially bad if you&rsquo;re working in a multi-pane tmux window as it&rsquo;s
locks up all the terminals in the same window, and prevents you from changing
to the other windows.</p>
<p>I&rsquo;ve had this issue happen to me one too many times but never thought of
looking for a solution until a friend of mine, <a href="http://gabekoss.com/">Gabe Koss</a>, made a passing
comment along the lines of &ldquo;Too bad tmux can&rsquo;t rate limit the output of a
terminal&rdquo;.</p>
<p>A quick search through the doc and two relatively recent configuration options
popped out doing exactly what I was looking for (c0-change-internal, and
c0-change-trigger). Googling around for good values, left me wanting. A lot of
people were recommending setting the values to 100 and 250 respectively; These
are the defaults and since I still experience the issue are clearly not working
for me.</p>
<p>To set the variables to something more reasonable I had to understand what they
were doing. A &lsquo;C0&rsquo; sequence is one that modifies the screen beyond a normal
character sequence, think newlines, carriage returns, backspaces. According to
the tmux man page, the trigger will catch if the number of c0 sequences per
<strong>millisecond</strong> exceeds the number in the configuration file, at which point it
will start displaying an update once every interval number of milliseconds.</p>
<p>I can&rsquo;t see faster than my eye&rsquo;s refresh rate so that seems like a decent
starting point. According to <a href="http://en.wikipedia.org/wiki/Frame_rate">Wikipedia</a> the human eye/brain interface can
process 10-12 images per second but we can notice &lsquo;choppiness&rsquo; below 48 FPS.
Since I won&rsquo;t be reading anything flying by that fast I settled on a maximum
rate of 10 FPS updated in my shell, or an interval of &lsquo;100ms&rsquo;.</p>
<p>For the trigger I was significantly less scientific, I dropped the trigger by
50, reloaded my tmux configuration, <code>cat</code>&rsquo;d a large file and tested whether I
could immediately kill the process and move between panes. I finally settled on
a value of &lsquo;75&rsquo; for the trigger rate. It does make the output seem a little
choppy but it is significantly nicer to not kill my terminal.</p>
<p>TL;DR Add the following lines to your <code>~/.tmux.conf</code> file and you&rsquo;ll be in a
much better shape:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>setw -g c0-change-interval 50
</span></span><span style="display:flex;"><span>setw -g c0-change-trigger  75
</span></span></code></pre></div>
            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://stelfox.net/tags/linux/">linux</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.c90b8161416b87c69a8e02683b54ddd6edb90aea699648bf655e6cbc45b419b8e465d196e715772463dba35a6faf5decb2eb247480d38680484d54645b434570.js" integrity="sha512-yQuBYUFrh8aajgJoO1Td1u25Cupplki/ZV5svEW0GbjkZdGW5xV3JGPbo1pvr13ssuskdIDThoBITVRkW0NFcA=="></script>



    </body>
</html>
