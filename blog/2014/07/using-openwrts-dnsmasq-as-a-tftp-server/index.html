<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='I recently reflashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&rsquo;t starting.
Looking into the logread output I finally saw that this was due too a permission issue. Combining this with the output of ps too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Using OpenWRT&#39;s Dnsmasq as a TFTP Server • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='I recently reflashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&rsquo;t starting.
Looking into the logread output I finally saw that this was due too a permission issue. Combining this with the output of ps too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration.'>
<meta property='og:url' content='https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='linux'><meta property='article:published_time' content='2014-07-01T21:26:45-04:00'/><meta property='article:modified_time' content='2014-07-01T21:26:45-04:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.50-DEV" />

  <title>Using OpenWRT&#39;s Dnsmasq as a TFTP Server • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4a10984a.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Using OpenWRT&#39;s Dnsmasq as a TFTP Server</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2014-07-01T21:26:45-04:00'>2014, Jul 01</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
2 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>I recently reflashed my primary router to a newer version of OpenWRT and
attempted to follow <a href="/blog/2013/12/using-dnsmasq-as-a-standalone-tftp-server/">my own directions</a> written in an earlier blog post to
add PXE booting to my local network using the dnsmasq service built in. After
following my advice I found that the dnsmasq service wasn&rsquo;t starting.</p>

<p>Looking into the <code>logread</code> output I finally saw that this was due too a
permission issue. Combining this with the output of <code>ps</code> too identify the user
that dnsmasq was running on I was able to both modify my instructions and use
OpenWRT&rsquo;s own configuration system to perform the configuration instead of
modifying the dnsmasq configuration.</p>

<p>First was solving the permissions issue. I created a dedicated directory at
<code>/var/tftp</code> and changed the ownership to &lsquo;nobody&rsquo; and &lsquo;nogroup&rsquo; and mode too
&lsquo;0755&rsquo;.</p>

<p>Previously I used <code>/var/lib/tftp</code>, however, the default permissions on the
<code>/var/lib</code> directory is too restrictive and I didn&rsquo;t want to reduce the rest of
that directories security posture simply too allow directory traversal.</p>

<p>Next up was getting the TFTP portion of dnsmasq configured and running. Open up
<code>/etc/config/dhcp</code> and under the <code>dnsmasq</code> section add the following lines (or
if these lines already exist adjust the values to match).</p>

<pre><code>option enable_tftp '1'
option tftp_root '/var/tftp'
option dhcp_boot 'pxelinux.0'
</code></pre>

<p>Run <code>uci commit dhcp</code> too commit the changes and finally <code>/etc/init.d/dnsmasq
restart</code> To apply the changes. You&rsquo;ll want too put the <code>pxelinux.0</code> and
associated configuration files into the <code>/var/tftp</code> directory too complete the
PXE booting configuration.</p>

<p>I&rsquo;ll probably write a blog post covering my PXE setup and configuration if I
don&rsquo;t get distracted by other projects.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/linux/'>linux</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2014/06/fixing-erratic-bmc-controller-on-poweredge-c6100/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Fixing Erratic BMC Controller on PowerEdge C6100</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2014/07/unregistering-from-whisperpush-after-flashing-a-new-rom/'>
        <span class='screen-reader-text'>Next post: </span>Unregistering From WhisperPush After Flashing a New ROM<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2019 Sam Stelfox | <a rel='license' href='/licenses/'>Licensing</a></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.fae8ed32.js'></script>

</body>

</html>

