<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn't starting.
Looking into the &amp;quot;logread&amp;quot; output I finally saw that this was due too a permission issue. Combining this with the output of &amp;quot;ps&amp;quot; too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT's own configuration system to perform the configuration instead of modifying the dnsmasq configuration."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,networking,operations"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/><title>Using OpenWRT's Dnsmasq as a TFTP Server :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta itemprop=description content='I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&#39;t starting.
Looking into the "logread" output I finally saw that this was due too a permission issue. Combining this with the output of "ps" too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&#39;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration.'><meta itemprop=datePublished content="2014-07-01T21:26:45-04:00"><meta itemprop=dateModified content="2014-07-01T21:26:45-04:00"><meta itemprop=wordCount content="273"><meta itemprop=keywords content="Linux,Networking,Operations"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta name=twitter:description content='I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&#39;t starting.
Looking into the "logread" output I finally saw that this was due too a permission issue. Combining this with the output of "ps" too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&#39;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration.'><meta property="article:published_time" content="2014-07-01 21:26:45 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/>Using OpenWRT's Dnsmasq as a TFTP Server</a></h2><div class=post-content><p>I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow <a href=/blog/2013/12/using-dnsmasq-as-a-standalone-tftp-server/>my own directions</a> written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn't starting.</p><p>Looking into the "logread" output I finally saw that this was due too a permission issue. Combining this with the output of "ps" too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT's own configuration system to perform the configuration instead of modifying the dnsmasq configuration.</p><p>First was solving the permissions issue. I created a dedicated directory at "/var/tftp" and changed the ownership to "nobody" and "nogroup" and mode too "0755".</p><p>Previously I used "/var/lib/tftp", however, the default permissions on the "/var/lib" directory is too restrictive and I didn't want to reduce the rest of that directories security posture simply too allow directory traversal.</p><p>Next up was getting the TFTP portion of dnsmasq configured and running. Open up "/etc/config/dhcp" and under the "dnsmasq" section add the following lines (or if these lines already exist adjust the values to match).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>option enable_tftp &#39;1&#39;
</span></span><span class=line><span class=cl>option tftp_root &#39;/var/tftp&#39;
</span></span><span class=line><span class=cl>option dhcp_boot &#39;pxelinux.0&#39;
</span></span></code></pre></td></tr></table></div></div><p>Commit the changes and restart the service for it to take effect:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> uci commit dhcp
</span></span><span class=line><span class=cl><span class=gp>$</span> /etc/init.d/dnsmasq restart
</span></span></code></pre></td></tr></table></div></div><p>You'll want to put the "pxelinux.0" and associated configuration files into the "/var/tftp" directory too complete the PXE booting configuration.</p><p>I'll probably write a blog post covering my PXE setup and configuration if I don't get distracted by other projects.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/networking/>networking</a></span>
<span class=tag><a href=https://stelfox.net/tags/operations/>operations</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=adbdd27b0c3e908cb1dca59e31b846a6a368cc76 target=_blank rel=noopener>adbdd27b</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>