<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="found top level header in &amp;#34;/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/&amp;#34; that didn&amp;#39;t match meta title (&amp;#34;Using OpenWRT&amp;amp;rsquo;s Dnsmasq as a TFTP Server&amp;#34; != &amp;#34;Using OpenWRT&amp;#39;s Dnsmasq as a TFTP Server&amp;#34;)I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&amp;rsquo;t starting."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,linux,networking,operations"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/><title>Using OpenWRT's Dnsmasq as a TFTP Server :: Sam Stelfox — A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.c8c76086c15b9d686ec1778dcf935d2ad37f3bb9c23165d2bd157ba7b18e5aec.css integrity="sha256-yMdghsFbnWhuwXeNz5NdKtN/O7nCMWXSvRV7p7GOWuw="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta itemprop=description content='found top level header in "/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/" that didn&#39;t match meta title ("Using OpenWRT&amp;rsquo;s Dnsmasq as a TFTP Server" != "Using OpenWRT&#39;s Dnsmasq as a TFTP Server")I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn’t starting.'><meta itemprop=datePublished content="2014-07-01T21:26:45-04:00"><meta itemprop=dateModified content="2014-07-01T21:26:45-04:00"><meta itemprop=wordCount content="298"><meta itemprop=keywords content="Linux,Networking,Operations"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using OpenWRT's Dnsmasq as a TFTP Server"><meta name=twitter:description content='found top level header in "/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/" that didn&#39;t match meta title ("Using OpenWRT&amp;rsquo;s Dnsmasq as a TFTP Server" != "Using OpenWRT&#39;s Dnsmasq as a TFTP Server")I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow my own directions written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn’t starting.'><meta property="article:published_time" content="2014-07-01 21:26:45 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/>Posts</a></li><li><a href=/notes/>Notes</a></li><li><a href=/about/>About Me</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/>Using OpenWRT&rsquo;s Dnsmasq as a TFTP Server</a></h2><div class=post-content>found top level header in "/blog/2014/07/using-openwrts-dnsmasq-as-a-tftp-server/" that didn't match meta title ("Using OpenWRT&amp;rsquo;s Dnsmasq as a TFTP Server" != "Using OpenWRT's Dnsmasq as a TFTP Server")<p>I recently re-flashed my primary router to a newer version of OpenWRT and attempted to follow <a href=/blog/2013/12/using-dnsmasq-as-a-standalone-tftp-server/>my own directions</a> written in an earlier blog post to add PXE booting to my local network using the dnsmasq service built in. After following my advice I found that the dnsmasq service wasn&rsquo;t starting.</p><p>Looking into the &ldquo;logread&rdquo; output I finally saw that this was due too a permission issue. Combining this with the output of &ldquo;ps&rdquo; too identify the user that dnsmasq was running on I was able to both modify my instructions and use OpenWRT&rsquo;s own configuration system to perform the configuration instead of modifying the dnsmasq configuration.</p><p>First was solving the permissions issue. I created a dedicated directory at &ldquo;/var/tftp&rdquo; and changed the ownership to &ldquo;nobody&rdquo; and &ldquo;nogroup&rdquo; and mode too &ldquo;0755&rdquo;.</p><p>Previously I used &ldquo;/var/lib/tftp&rdquo;, however, the default permissions on the &ldquo;/var/lib&rdquo; directory is too restrictive and I didn&rsquo;t want to reduce the rest of that directories security posture simply too allow directory traversal.</p><p>Next up was getting the TFTP portion of dnsmasq configured and running. Open up &ldquo;/etc/config/dhcp&rdquo; and under the &ldquo;dnsmasq&rdquo; section add the following lines (or if these lines already exist adjust the values to match).</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-e7542be-1><a style=outline:none;text-decoration:none;color:inherit href=#code-e7542be-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-e7542be-2><a style=outline:none;text-decoration:none;color:inherit href=#code-e7542be-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-e7542be-3><a style=outline:none;text-decoration:none;color:inherit href=#code-e7542be-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>option enable_tftp &#39;1&#39;
</span></span><span style=display:flex><span>option tftp_root &#39;/var/tftp&#39;
</span></span><span style=display:flex><span>option dhcp_boot &#39;pxelinux.0&#39;</span></span></code></pre></td></tr></table></div></div><p>Commit the changes and restart the service for it to take effect:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-90f9052-1><a style=outline:none;text-decoration:none;color:inherit href=#code-90f9052-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679" id=code-90f9052-2><a style=outline:none;text-decoration:none;color:inherit href=#code-90f9052-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#8b949e>$</span> uci commit dhcp
</span></span><span style=display:flex><span><span style=color:#8b949e>$</span> /etc/init.d/dnsmasq restart
</span></span></code></pre></td></tr></table></div></div><p>You&rsquo;ll want to put the &ldquo;pxelinux.0&rdquo; and associated configuration files into the &ldquo;/var/tftp&rdquo; directory too complete the PXE booting configuration.</p><p>I&rsquo;ll probably write a blog post covering my PXE setup and configuration if I don&rsquo;t get distracted by other projects.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/linux/>linux</a></span>
<span class=tag><a href=https://stelfox.net/tags/networking/>networking</a></span>
<span class=tag><a href=https://stelfox.net/tags/operations/>operations</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=adbdd27b0c3e908cb1dca59e31b846a6a368cc76 target=_blank rel=noopener>adbdd27b</a> @ 2024-07-15</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.85fad2de4f13fec3bcb3b3cb10430cdb44a7b4a9749b32938241a5c6e77718df7624f1002b880521fdc26e24ec1077fda214bf1cb36ee3045510760d09638cae.js integrity="sha512-hfrS3k8T/sO8s7PLEEMM20SntKl0mzKTgkGlxud3GN92JPEAK4gFIf3CbiTsEHf9ohS/HLNu4wRVEHYNCWOMrg=="></script></body></html>