<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2014&#x2F;using-openwrts-dnsmasq-as-a-tftp-server&#x2F;">Using OpenWRT&#x27;s Dnsmasq as a TFTP Server</a></h1>

  <div class="post-content"><p>I recently reflashed my primary router to a newer version of OpenWRT and
attempted to follow <a href="https://stelfox.net/blog/2013/using-dnsmasq-as-a-standalone-tftp-server/">my own directions</a> written in an earlier blog post to
add PXE booting to my local network using the dnsmasq service built in. After
following my advice I found that the dnsmasq service wasn't starting.</p>
<span id="continue-reading"></span>
<p>Looking into the <code>logread</code> output I finally saw that this was due too a
permission issue. Combining this with the output of <code>ps</code> too identify the user
that dnsmasq was running on I was able to both modify my instructions and use
OpenWRT's own configuration system to perform the configuration instead of
modifying the dnsmasq configuration.</p>
<p>First was solving the permissions issue. I created a dedicated directory at
<code>/var/tftp</code> and changed the ownership to 'nobody' and 'nogroup' and mode too
'0755'.</p>
<p>Previously I used <code>/var/lib/tftp</code>, however, the default permissions on the
<code>/var/lib</code> directory is too restrictive and I didn't want to reduce the rest of
that directories security posture simply too allow directory traversal.</p>
<p>Next up was getting the TFTP portion of dnsmasq configured and running. Open up
<code>/etc/config/dhcp</code> and under the <code>dnsmasq</code> section add the following lines (or
if these lines already exist adjust the values to match).</p>
<pre><code>option enable_tftp '1'
option tftp_root '/var/tftp'
option dhcp_boot 'pxelinux.0'
</code></pre>
<p>Run <code>uci commit dhcp</code> too commit the changes and finally <code>/etc/init.d/dnsmasq restart</code> To apply the changes. You'll want too put the <code>pxelinux.0</code> and
associated configuration files into the <code>/var/tftp</code> directory too complete the
PXE booting configuration.</p>
<p>I'll probably write a blog post covering my PXE setup and configuration if I
don't get distracted by other projects.</p>
</div><p class="meta">Posted on <span class="postdate">2014-07-01</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
