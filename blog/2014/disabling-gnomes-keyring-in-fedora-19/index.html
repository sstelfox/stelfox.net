<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2014&#x2F;disabling-gnomes-keyring-in-fedora-19&#x2F;">Disabling Gnome&#x27;s Keyring in Fedora 19</a></h1>

  <div class="post-content"><p>An update too Fedora a while ago started causing some unexpected behavior with
my dotfiles. Specifically the way I was handling my SSH agent. My SSH keys when
added to my agent automatically expire after a couple of hours.</p>
<span id="continue-reading"></span>
<p>After the update, when that expiration came I started receiving errors in my
shell that looked similar to the following (Since I fixed it I am not able to
get the exact working again):</p>
<pre><code>Warning: Unable to connect to SSH agent
</code></pre>
<p>I also noticed that periodically I got a Gnome keyring pop-up asking for my SSH
agent rather than my command-line client. I'm personally not a big fan of
Gnome, but I deal with because it's the default for Fedora, tends to stay out
of your way, and switching to something else is just not a project I've had
time for.</p>
<p>Now Gnome was very much getting in my way. I dealt with it for several months
now and finally got sick of it.</p>
<p>I tracked this down too the <code>gnome-keyring-daemon</code> which was starting up and
clobbering the contents of my <code>SSH_AUTH_SOCK</code> variable along with my
<code>GPG_AGENT_INFO</code> environment. Not very friendly.</p>
<p>There were a couple paths that I could've gone for for solving this situation.
The first, and easiest way to probably have dealt with this was too put some
logic into my <code>~/.bashrc</code> file that detected when the <code>gnome-keying-agent</code> was
running, kill it and clean up after it. It might look something like this:</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">if [ -n "${GNOME_KEYRING_PID}" ]; then
  if $(kill -0 ${GNOME_KEYRING_PID}); then
    kill -9 ${GNOME_KEYRING_PID}
  fi
fi

unset GNOME_KEYRING_CONTROL SSH_AUTH_SOCK GPG_AGENT_INFO GNOME_KEYRING_PID
</code></pre>
<p>I share my dotfiles along a lot of different systems and don't like
system-specific behavior getting in there. Instead I choose to find what was
starting up the keyring daemon and preventing it from doing so. Without a good
place to start and stubbornly refusing to Google this particular problem I took
the brute force approach of grep for the binary name in the <code>/etc</code> directory.</p>
<p>Sure enough in <code>/etc/xdg/autostart</code> I found a series of background daemons that
I definitely did not want nor need running. As root I ran the following command
to purge them from my system:</p>
<pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">cd /etc/xdg/autostart
rm -f gnome-keyring-{gpg,pkcs11,secrets,ssh}.desktop
</code></pre>
<p>The first solution will keep your system in a default state, but this will
permanently prevent the obnoxious behavior on your system for all users and
prevents you from adding hacks to your bashrc to work around misbehaving
software.</p>
<p>I hope this helps someone else!</p>
</div><p class="meta">Posted on <span class="postdate">2014-04-14</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
