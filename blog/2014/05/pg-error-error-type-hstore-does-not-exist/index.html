<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="I've been using the PostgreSQL's hstore extension in a Rails application lately and kept encountering the error that is this post's namesake. It would specifically happen when a database had been dropped, recreated and I freshly ran the migrations.
It seems that while Rails 4 supports the HStore datatype, it doesn't enable the extension itself. I've found two ways too solve this issue in wildly different ways.
First Solution: Enable HStore by DefaultThis is the common solution that is recommended too solve this issue."><meta name=keywords content="blog,programming,linux,systems,personal,rust,philosophy,postgres,ruby"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://stelfox.net/blog/2014/05/pg-error-error-type-hstore-does-not-exist/><title>PG::Error: ERROR: Type 'Hstore' Does Not Exist :: ./Sam_Stelfox.sh â€” A simple place for my collected thoughts and notes.
</title><link rel=stylesheet href=/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel="shortcut icon" href=/favicon.ico><meta itemprop=name content="PG::Error: ERROR: Type 'Hstore' Does Not Exist"><meta itemprop=description content="I've been using the PostgreSQL's hstore extension in a Rails application lately and kept encountering the error that is this post's namesake. It would specifically happen when a database had been dropped, recreated and I freshly ran the migrations.
It seems that while Rails 4 supports the HStore datatype, it doesn't enable the extension itself. I've found two ways too solve this issue in wildly different ways.
First Solution: Enable HStore by DefaultThis is the common solution that is recommended too solve this issue."><meta itemprop=datePublished content="2014-05-28T18:00:55-04:00"><meta itemprop=dateModified content="2014-05-28T18:00:55-04:00"><meta itemprop=wordCount content="444"><meta itemprop=keywords content="Postgres,Ruby"><meta name=twitter:card content="summary"><meta name=twitter:title content="PG::Error: ERROR: Type 'Hstore' Does Not Exist"><meta name=twitter:description content="I've been using the PostgreSQL's hstore extension in a Rails application lately and kept encountering the error that is this post's namesake. It would specifically happen when a database had been dropped, recreated and I freshly ran the migrations.
It seems that while Rails 4 supports the HStore datatype, it doesn't enable the extension itself. I've found two ways too solve this issue in wildly different ways.
First Solution: Enable HStore by DefaultThis is the common solution that is recommended too solve this issue."><meta property="article:published_time" content="2014-05-28 18:00:55 -0400 EDT"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>./Sam_Stelfox.sh</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/notes/>Notes</a></li><li><a href=/blog/>Posts</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://stelfox.net/blog/2014/05/pg-error-error-type-hstore-does-not-exist/>PG::Error: ERROR: Type 'Hstore' Does Not Exist</a></h2><div class=post-content><p>I've been using the PostgreSQL's hstore extension in a Rails application lately
and kept encountering the error that is this post's namesake. It would
specifically happen when a database had been dropped, recreated and I freshly
ran the migrations.</p><p>It seems that while Rails 4 supports the HStore datatype, it doesn't enable the
extension itself. I've found two ways too solve this issue in wildly different
ways.</p><h2 id=first-solution-enable-hstore-by-default>First Solution: Enable HStore by Default</h2><p>This is the common solution that is recommended too solve this issue. It
enables the HStore extension by default on all newly created databases. Too
understand this you need to know a bit about PostgreSQL's behavior.</p><p>When a new database is created, PostgreSQL creates a copy of a special
pre-existing database named <code>template1</code> by default. Anything done too this
database will be reflected in all new databases, including enabling extensions.</p><p>Too enable the HStore extension on the <code>template1</code> database you can execute the
following command (generally as the <code>postgres</code> user or with your authentication
of choice).</p><pre tabindex=0><code>psql -d template1 -c &#39;CREATE EXTENSION hstore;&#39;
</code></pre><h2 id=second-solution-rails-migration>Second Solution: Rails Migration</h2><p>The above solution doesn't sit well with me. While it's uncommon for any
individual PostgreSQL server to be shared among different applications with
different databases, the possibility is there. Perhaps the application will get
decommissioned and the DBA will simply drop the associated database and roles
instead of setting up a new one.</p><p>Disconnecting the requirements of the application from the application itself
always seems to lead too trouble.</p><p>Rails already has a mechanism too handle modifications too the database
overtime, migrations. They're solid, well tested, and encapsulate not only how
to get the database to a particular state but also how to return it back to
it's prior state (generally).</p><p>We can also do this without using raw SQL which now also seems a bit... Off to
me. The following is a sample Rails migration that will both enable and disable
the extension:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>ManageHstore</span> <span class=o>&lt;</span> <span class=no>ActiveRecord</span><span class=o>::</span><span class=no>Migration</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>change</span>
</span></span><span class=line><span class=cl>    <span class=n>reversible</span> <span class=k>do</span> <span class=o>|</span><span class=n>op</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=n>op</span><span class=o>.</span><span class=n>up</span> <span class=p>{</span> <span class=n>enable_extension</span> <span class=s1>&#39;hstore&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>op</span><span class=o>.</span><span class=n>down</span> <span class=p>{</span> <span class=n>disable_extension</span> <span class=s1>&#39;hstore&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Now the biggest problem with this migration is that too use it, you need too
plan ahead of time too use the extension or not worry about freshly running all
the migrations (generally because you dropped and created the database). This
migration needs to be named so it alphabetically comes before any migration in
your application that makes use of the HStore datatype.</p><p>ActiveRecord uses timestamps at the beginning of the migration names to handle
this alphabetic sorting, and such you'll want to fake this in before you used
the HStore datatype.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://stelfox.net/tags/postgres/>postgres</a></span>
<span class=tag><a href=https://stelfox.net/tags/ruby/>ruby</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=bd9e1ab3269fdee0856f80854c902432ef10f201 target=_blank rel=noopener>bd9e1ab3</a> @ 2024-07-14</p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc+cxaJzDdCYbAW0X1G+DgZYvtKFXe6MBex8jUJ2JT25mQx+YjACIng=="></script></body></html>