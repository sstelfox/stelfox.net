<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='I&#39;ve been using the PostgreSQL&#39;s hstore extension in a Rails application lately and kept encountering the error that is this post&#39;s namesake. It would specifically happen when a database had been dropped, recreated and I freshly ran the migrations.
It seems that while Rails 4 supports the HStore datatype, it doesn&#39;t enable the extension itself. I&#39;ve found two ways too solve this issue in wildly different ways.
First Solution: Enable HStore by Default This is the common solution that is recommended too solve this issue.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='PG::Error: ERROR: Type &#39;Hstore&#39; Does Not Exist • Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:description' content='I&#39;ve been using the PostgreSQL&#39;s hstore extension in a Rails application lately and kept encountering the error that is this post&#39;s namesake. It would specifically happen when a database had been dropped, recreated and I freshly ran the migrations.
It seems that while Rails 4 supports the HStore datatype, it doesn&#39;t enable the extension itself. I&#39;ve found two ways too solve this issue in wildly different ways.
First Solution: Enable HStore by Default This is the common solution that is recommended too solve this issue.'>
<meta property='og:url' content='https://stelfox.net/blog/2014/05/pg-error-error-type-hstore-does-not-exist/'>
<meta property='og:site_name' content='Sam Stelfox&#39;s Thoughts &amp; Notes'>
<meta property='og:type' content='article'><meta property='article:section' content='blog'><meta property='article:tag' content='postgres'><meta property='article:tag' content='ruby'><meta property='article:published_time' content='2014-05-28T18:00:55-04:00'/><meta property='article:modified_time' content='2014-05-28T18:00:55-04:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.61.0-DEV" />

  <title>PG::Error: ERROR: Type &#39;Hstore&#39; Does Not Exist • Sam Stelfox&#39;s Thoughts &amp; Notes</title>
  <link rel='canonical' href='https://stelfox.net/blog/2014/05/pg-error-error-type-hstore-does-not-exist/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-32188490-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-blog'>

  <div class='site'><a class='screen-reader-text' href='#content'>Skip to Content</a><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/blog/'>Blog Posts</a>
      </li><li class='item'>
        <a href='/notes/'>Various Notes</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Sam Stelfox&#39;s Thoughts &amp; Notes</p><p class='desc site-desc'>Thoughts from a software engineer, systems architect and Linux gubernāre.</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>PG::Error: ERROR: Type &#39;Hstore&#39; Does Not Exist</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2014-05-28T18:00:55-04:00'>2014, May 28</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
3 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>I've been using the PostgreSQL's hstore extension in a Rails application lately
and kept encountering the error that is this post's namesake. It would
specifically happen when a database had been dropped, recreated and I freshly
ran the migrations.</p>
<p>It seems that while Rails 4 supports the HStore datatype, it doesn't enable the
extension itself. I've found two ways too solve this issue in wildly different
ways.</p>
<h2 id="first-solution-enable-hstore-by-default">First Solution: Enable HStore by Default</h2>
<p>This is the common solution that is recommended too solve this issue. It
enables the HStore extension by default on all newly created databases. Too
understand this you need to know a bit about PostgreSQL's behavior.</p>
<p>When a new database is created, PostgreSQL creates a copy of a special
pre-existing database named <code>template1</code> by default. Anything done too this
database will be reflected in all new databases, including enabling extensions.</p>
<p>Too enable the HStore extension on the <code>template1</code> database you can execute the
following command (generally as the <code>postgres</code> user or with your authentication
of choice).</p>
<pre><code>psql -d template1 -c 'CREATE EXTENSION hstore;'
</code></pre><h2 id="second-solution-rails-migration">Second Solution: Rails Migration</h2>
<p>The above solution doesn't sit well with me. While it's uncommon for any
individual PostgreSQL server to be shared among different applications with
different databases, the possibility is there. Perhaps the application will get
decommissioned and the DBA will simply drop the associated database and roles
instead of setting up a new one.</p>
<p>Disconnecting the requirements of the application from the application itself
always seems to lead too trouble.</p>
<p>Rails already has a mechanism too handle modifications too the database
overtime, migrations. They're solid, well tested, and encapsulate not only how
to get the database to a particular state but also how to return it back to
it's prior state (generally).</p>
<p>We can also do this without using raw SQL which now also seems a bit&hellip; Off to
me. The following is a sample Rails migration that will both enable and disable
the extension:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ManageHstore</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ActiveRecord</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Migration</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e"></span><span style="color:#f92672"></span><span style="color:#a6e22e">change</span>
    reversible <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>op<span style="color:#f92672">|</span>
      op<span style="color:#f92672">.</span>up { enable_extension <span style="color:#e6db74">&#39;hstore&#39;</span> }
      op<span style="color:#f92672">.</span>down { disable_extension <span style="color:#e6db74">&#39;hstore&#39;</span> }
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Now the biggest problem with this migration is that too use it, you need too
plan ahead of time too use the extension or not worry about freshly running all
the migrations (generally because you dropped and created the database). This
migration needs to be named so it alphabetically comes before any migration in
your application that makes use of the HStore datatype.</p>
<p>ActiveRecord uses timestamps at the beginning of the migration names to handle
this alphabetic sorting, and such you'll want to fake this in before you used
the HStore datatype.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/postgres/'>postgres</a>, <a class='tag' href='/tags/ruby/'>ruby</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/blog/2014/05/chain-loading-kernels/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Chain Loading Kernels</a>
    </div><div class='next-entry sep-before'>
      <a href='/blog/2014/05/extracting-content-from-markdown/'>
        <span class='screen-reader-text'>Next post: </span>Extracting Content From Markdown<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2011-2020 Sam Stelfox </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.c3bcf2df.js'></script>

</body>

</html>

