<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

    <title>Sam Stelfox&#x27;s Thoughts &amp; Notes</title>
    <link rel="stylesheet" href="https://stelfox.net/colors-dark.css">

    

    
    
  </head>
  <body>
    <header id="header">
      <h1><a href="https:&#x2F;&#x2F;stelfox.net">Sam Stelfox&#x27;s Thoughts &amp; Notes</a></h1>
      <p>Thought&#x27;s from a software engineer, systems architect, and Linux gubernƒÅre.</p>
    </header>
    <div id="page">
      <div id="sidebar">
        
          
          <nav>
            <ul class="nav">
              
                
                  <li>
                    <a href="&#x2F;"><span>Home</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;about&#x2F;"><span>About</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;blog&#x2F;"><span>Blog</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;projects&#x2F;"><span>Projects</span></a>
                  </li>
                
                  <li>
                    <a href="&#x2F;notes&#x2F;"><span>Various Notes</span></a>
                  </li>
                
              
            </ul>
          </nav>
          
        
      </div>
      <div id="content">
        
<article class="post">
  <h1><a href="https:&#x2F;&#x2F;stelfox.net&#x2F;blog&#x2F;2014&#x2F;starting-puppetmaster-on-fedora-19&#x2F;">Starting Puppet Master on Fedora 19</a></h1>

  <div class="post-content"><p>I was trying to get puppet running out of the box on Fedora 19 and found a bug
exists in their systemd service file. After installing <code>puppet</code> and
<code>puppet-server</code>, whenever I tried to start the server with the following
command:</p>
<span id="continue-reading"></span><pre data-lang="sh" class="language-sh "><code class="language-sh" data-lang="sh">systemctl start puppetmaster.service
</code></pre>
<p>It would hang for a long time and the following error message would show up in
the log:</p>
<pre><code>Jan 19 03:42:18 puppet-01 puppet-master[1166]: Starting Puppet master version 3.3.1
Jan 19 03:42:18 puppet-01 systemd[1]: PID file /run/puppet/master.pid not readable (yet?) after start.
Jan 19 03:43:07 puppet-01 systemd[1]: puppetmaster.service operation timed out. Terminating.
Jan 19 03:43:07 puppet-01 puppet-master[1166]: Could not run: can't be called from trap context
</code></pre>
<p>Starting puppet directly from the command line using the same command specified
in the service file would work fine, but that wasn't really a solution. Turns
out puppet, additionally I would briefly see the <code>puppetmaster</code> service open up
port 8140 before systemd would kill it.</p>
<p>Turns out the systemd service script is looking in the wrong location for the
pid file. All of the pids are stored in <code>/var/run/puppet/</code> with a filename of
either <code>agent.pid</code> or <code>master.pid</code> depending on the mode it was run as. The
systemd script, as the log indicates is looking for the pid files in
<code>/run/puppet</code>.</p>
<p>The real solution would be to bring this too the attention of the script
maintainers, but I haven't had a lot of luck going through those processes.
Instead you can work around the issue without any bureaucracy by changing the
<code>rundir</code> configuration option in <code>/etc/puppet/puppet.conf</code> to <code>/run/puppet</code>,
and creating <code>/run/puppet</code> (with puppet as the user and group owning the
directory).</p>
<p>After that, voila! The service starts up. You'd think a QA process would catch
that the service script doesn't work...</p>
</div><p class="meta">Posted on <span class="postdate">2014-01-18</span></p></article>

      </div>
      <footer id="footer">
        <p class="copyright">
          
          &copy; 2011 &ndash; 2021 Sam Stelfox | <a href="https://stelfox.net/licenses/">Site Content Licenses</a>
          
        </p>
      </footer>
    </div>
  </body>
</html>
