<!DOCTYPE html>
<html lang='en_US'>
  <head>
    <title>Security - Stelfox Athen&#xe6;um</title>

    <meta http-equiv='content-type' content='text/html; charset=utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1' />
    
    

    <link rel="alternate" type="application/atom+xml" title="Stelfox Athen&#xe6;um Feed" href="/atom.xml" />
    <link rel="canonical" href="https://stelfox.net" />
    <link rel="author" href="https://plus.google.com/+SamStelfox31337/"/>

    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Security" />
    <meta property="og:url" content="https://stelfox.net/tags/security/" />
    <meta property="og:site_name" content="Stelfox Athen&#xe6;um" />
    <meta property="article:publisher" content="https://www.facebook.com/sstelfox" />
    <meta property="og:image" content="https://stelfox.net/static/avatar-01.jpg" />

    <link rel='stylesheet' href="//fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Alegreya+SC:700" />
    <link rel="stylesheet" href="https://stelfox.net/css/3HrCRVwL3Gos2V4HzXAw/Om/nxs=.css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-32188490-1', 'stelfox.net');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <header class='masthead'>
      <div class='masthead-inner'>
        <h1><a href='/' title='Home'>Sam Stelfox</a></h1>
        <p class='lead'>Thoughts from a systems hacker and developer.</p>
        <nav>
          <ul>
            <li><a href="/about/" title="About">About</a></li>
            <li><a href="/blog/" title="Blog">Blog</a></li>
            <li><a href="/knowledge_base/" title="Knowledge Base">Knowledge Base</a></li>
            <li><form action="/search/" method="get"><input type="search" name="q" placeholder="Search" /></form></li>
          </ul>
        </nav>
        <footer class='colophon'>
          <p>&copy; 2014, All rights reserved.</p>
        </footer>
      </div>
    </header>
    <div class='content container'>
      <div class="post">
  <h1>Security</h1>
  
    <div class='post'>
      <h2><a href="/blog/2014/07/unregistering-from-whisperpush-after-flashing-a-new-rom/">Unregistering From WhisperPush After Flashing a New ROM</a></h1>
      <aside>Posted at: 2014-07-22 21:54:59 -0400</aside>
      <article>
        <p>I&#39;ve been playing around with my Nexus 5 lately. It was quickly rooted and I
began playing with various ROMs that had been pre-built for the Nexus 5. My
first stop was the <a href="http://www.cyanogenmod.org/">CyanogenMod</a>. Since I&#39;d last used CyanogenMod they added
a built-in framework that provides <a href="https://whispersystems.org/blog/cyanogen-integration/">transparent text</a> <a href="http://www.cyanogenmod.org/blog/whisperpush-secure-messaging-integration">message
encryption</a> called WhisperPush.</p>

<p>WhisperPush is an implementation of <a href="http://thoughtcrime.org/">Moxie Marlinspike&#39;s</a> highly respected
TextSecure and I was very excited at the possibility of using it. I immediately
signed up for the service.</p>

<p>After a day of use I found CyanogenMod far too unstable too use on my primary
device. It locked up multiple times the first day and mobile data simply
wouldn&#39;t work all day. I promptly formatted and flashed my phone, I haven&#39;t
settled on a new ROM but that&#39;s not what this post is about.</p>

<p>It occurred to me after flashing the phone I was still subscribed to
WhisperPush. If anyone that texts me was signed up as well. I&#39;d never receive
even an encrypted blob, it would just silently fail.</p>

<p>Searching around I found there is very little information on it, and no
official way to unregister, especially after you&#39;ve wiped your device and no
longer have your credentials. Ultimately I found a fairly easy solution, just
re-register and perform the backdoor steps too de-register.</p>

<p>I wiped my phone again and installed a new copy of the CyanogenMod nightly.
Booted it up and re-enabled WhisperPush. It didn&#39;t even note that my number was
registered in the past.</p>

<p>I found the solution somewhere in the CyanogenMod forums (though I lost the
link, and I&#39;m now too lazy to go find it again). You can unregister by
performing the following steps:</p>

<ol>
<li>Connect your computer with ADB too the phone and pair the computer with the
phone.</li>
<li>Enable developer options by opening the system settings, choosing &#39;About
phone&#39; and clicking on the &#39;Build number&#39; about 7 times (it will start
counting down).</li>
<li>Open up the developer options found in the root of the system settings menu
and enable root access for &#39;Apps and ADB&#39;.</li>
<li>On the computer use <code>adb shell</code> to get a shell on the device.</li>
<li>Switch to root using the <code>su</code> command.</li>
<li><p>Run the following command too view the WhisperPush internal settings:</p>
<div class="CodeRay">
  <div class="code"><pre>cat /data/user/0/org.whispersystems.whisperpush/shared_prefs/org.whispersystems.whisperpush_preferences.xml`
</pre></div>
</div></li>
<li><p>Note down the value for <code>pref_registered_number</code> (this should be your phone
number with a preceeding &#39;+&#39;) and <code>pre_push_password</code>.</p></li>
<li><p>Exit the shell.</p></li>
</ol>

<p>Finally too unregister we need too make a DELETE request against the
WhisperPush API. The classic HTTP swiss army knife <code>curl</code> is going to help us
on this front. Run the following command on any linux computer with curl
installed, replacing the registered number and registered password with the
value you recorded earlier.</p>
<div class="CodeRay">
  <div class="code"><pre>curl -v -k -X DELETE --basic --user ${pref_registered_number}:${pre_push_password} https://whisperpush.cyanogenmod.org/v1/accounts/gcm
</pre></div>
</div>

<p>Be sure too include the &#39;+&#39; in your pref_registered_number. You should end up
with a status code of 204. The output will look something like the following
(credentials removed).</p>
<div class="CodeRay">
  <div class="code"><pre>* About to connect() to whisperpush.cyanogenmod.org port 443 (#0)
*   Trying 54.201.5.27...
* Connected to whisperpush.cyanogenmod.org (54.201.5.27) port 443 (#0)
* Initializing NSS with certpath: sql:/etc/pki/nssdb
* skipping SSL peer certificate verification
* SSL connection using TLS_DHE_RSA_WITH_AES_128_CBC_SHA
* Server certificate:
*   subject: OU=Operations,O=&quot;Cyanogen, Inc.&quot;,E=ops@cyngn.com,C=US,ST=Washington,L=Seattle,CN=whisperpush.cyanogenmod.org
*   start date: Nov 26 05:39:18 2013 GMT
*   expire date: Nov 24 05:39:18 2023 GMT
*   common name: whisperpush.cyanogenmod.org
*   issuer: E=ops@cyngn.com,CN=Authority,OU=Operations,O=&quot;Cyanogen, Inc.&quot;,L=Seattle,ST=Washington,C=US
* Server auth using Basic with user '${pref_registered_number}'
&gt; DELETE /v1/accounts/gcm HTTP/1.1
&gt; Authorization: Basic ${encoded credentials}
&gt; User-Agent: curl/7.29.0
&gt; Host: whisperpush.cyanogenmod.org
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 204 No Content
&lt; Server: nginx/1.1.19
&lt; Date: Wed, 23 Jul 2014 01:45:25 GMT
&lt; Connection: keep-alive
&lt; 
* Connection #0 to host whisperpush.cyanogenmod.org left intact
</pre></div>
</div>

<p>I don&#39;t have any way too check that I&#39;m unregistered but it seems too have
worked. Here is hoping this helps some else out in the future.</p>

      </article>
    </div>
  
    <div class='post'>
      <h2><a href="/blog/2012/11/auditing-heroku-ssh-keys/">Auditing Heroku SSH Keys</a></h1>
      <aside>Posted at: 2012-11-26 10:18:00 -0500</aside>
      <article>
        <p>A good friend of mine recently left the organization I work for and the task of
resetting our passwords and auditing credentials fell on me. Since we use
<a href="https://www.heroku.com/">Heroku</a> for our development platform I needed to not only reset the
credentials for the web portion (which conveniently also handles resetting the
API key) but also revoke any SSH keys he may have added to access it.</p>

<p>Sadly Heroku does not seem to provide any web interface that I could find for
examining what keys were associated with the account. Searching for this
information also didn&#39;t turn up very valuable results; most people were looking
to add keys or resolve issues with missing keys rather than revoking them. I
suspect not many people think of SSH keys when it comes time to revoke access
which is a dire mistake.</p>

<p>I took to the command line to solve my issue as I knew you could list and add
keys that way, so it was a minor leap of logic to assume they could revoke keys
as well. I ran <code>heroku help keys</code> to get the syntax for the commands and was
pleasantly surprised to see an additional option listed in there:</p>
<div class="CodeRay">
  <div class="code"><pre>keys:clear       #  remove all authentication keys from the current user
</pre></div>
</div>

<p>As a now two person web-shop it&#39;s not a terrible amount of work to add our keys
back in and looking through there were already some keys in there that should
have been revoked long ago. One command and our applications were safe from
mischief, though I know my former associate wouldn&#39;t abuse that privilege
beyond perhaps pointing out the security flaw I&#39;d allowed.</p>

      </article>
    </div>
  
    <div class='post'>
      <h2><a href="/blog/2012/11/keep-your-gems-updated/">Keep Your Gems Updated</a></h1>
      <aside>Posted at: 2012-11-27 14:17:00 -0500</aside>
      <article>
        <p>I recently went back through my backups recently and found quite a few old
abandoned projects. Looking back on the code I see some things I&#39;m impressed
with, but the majority of the code I wouldn&#39;t write today.  Thats not to say
the code is bad, or doesn&#39;t function. It did exactly what I wanted to
accomplish at the time, just not necessarily in the most efficient way.</p>

<p>This archive of old code made me start wondering how much old code I&#39;m using in
the projects that I&#39;m currently writing. Not code that I&#39;ve written but code
that I&#39;m depending on, specifically gems. As of this writing I have 26 active
ruby projects in various states of development all of which make use of RVM and
bundler.</p>

<p>Conveniently enough, bundler provides an easy way to update all the gems
installed in a project unless specific version information was provided in the
Gemfile. None of my projects have had a version directly specified in the
Gemfile with the exception of Rails. Each project also has solid test coverage
(though I must admit it&#39;s usually not complete).</p>

<p>For each project I went through and ran <code>bundle update</code> and kept track of the
results. I did not keep track of unique gems so the four Rails projects
probably had a lot of duplicate gems each one more or less likely to have
different versions of different gems installed depending on when I started the
project.</p>

<p>Across all of the different projects I had 2214 gems installed. Of those 813
had updates. My initial plan was to go through the updates and see how many of
those updates were security or bugfixes, how many were added features, or
performance improvements, but I wasn&#39;t counting on the shear number of gems
that my projects were depending on.</p>

<p>The big question for myself after I updated the Gems was how much will this be
now? Running through the thousands of tests in all of the projects I had
exactly 7 tests that were now failing and they were all due too projects that
removed or renamed a piece of functionality that I was making use of. In one
case I had to extend the core Hash method to replace the functionality. All in
all it took me about a quarter of an hour to fix all the tests after updating
my Gems.</p>

<p>Since I didn&#39;t actually go through all of the gems I don&#39;t know for sure that
my projects are in anyway more secure, faster, or more stable but I can&#39;t
imagine they&#39;re in a worse state. If you have test coverage on your projects
you should try and update the gems and see for yourself.</p>

      </article>
    </div>
  
</div>

    </div>
  </body>
</html>
